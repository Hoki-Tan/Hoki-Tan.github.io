<!DOCTYPE html><html lang="en" data-beasties-container><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="https://img.alicdn.com/imgextra/i2/3343836081/O1CN01kq4lPt1un9Z2iQ6JH_!!3343836081.jpg"><script>!function(){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><style type="text/css">:root{color-scheme:light dark;--va-c-bg:#fff}html{background-color:var(--va-c-bg)}.yun-cloud{display:flex;width:100%;z-index:var(--yun-z-cloud);box-sizing:border-box}.yun-cloud .waves{display:flex;position:relative;width:100%;height:40px}.yun-cloud .parallax>use{animation:move-forever 25s cubic-bezier(.55,.5,.45,.5) infinite}.yun-cloud .parallax>use:first-child{opacity:.7;animation-delay:-2s;animation-duration:7s}.yun-cloud .parallax>use:nth-child(2){opacity:.5;animation-delay:-3s;animation-duration:10s}.yun-cloud .parallax>use:nth-child(3){opacity:.3;animation-delay:-4s;animation-duration:13s}.yun-cloud .parallax>use:nth-child(4){animation-delay:-5s;animation-duration:20s}@keyframes move-forever{0%{transform:translate3d(-90px,0,0)}to{transform:translate3d(85px,0,0)}}.yun-footer{letter-spacing:.05rem;line-height:1.8}.yun-footer-gradient{position:absolute;bottom:0;left:0;right:0;width:100%;height:300px;z-index:999;pointer-events:none;background:linear-gradient(to right,rgb(var(--gradient-from)/.2) 0,rgb(var(--gradient-to)/.2));-webkit-mask-image:linear-gradient(#fff0,#000 70%);mask-image:linear-gradient(#fff0,#000 70%);animation:fade-in 2s}.va-toc[data-v-91805d19]{text-align:left}.content[data-v-91805d19]{position:relative;padding-left:16px;font-size:14px;text-align:left}.outline-marker[data-v-91805d19]{position:absolute;top:32px;left:-2px;z-index:0;opacity:0;width:4px;height:18px;background-color:var(--va-c-brand);transition:top .25s cubic-bezier(0,1,.5,1),background-color .5s,opacity .25s;border-top-right-radius:2px;border-bottom-right-radius:2px}.outline-title[data-v-91805d19]{letter-spacing:.4px;line-height:28px;font-size:14px;font-weight:600}.visually-hidden[data-v-91805d19]{position:absolute;width:1px;height:1px;white-space:nowrap;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden}.yun-aside{width:0;transform:translate(100%);transition:all .2s cubic-bezier(.77,0,.17,1.02);max-height:calc(100vh - var(--yun-margin-top))}@media screen and (min-width:1280px){.yun-aside{transform:translate(0)}}.toc-btn{color:var(--va-c-primary);z-index:var(--yun-z-toc-btn)}.back-to-top{position:fixed;right:-1.5rem;bottom:1rem;z-index:var(--yun-z-go-up-btn);opacity:0;pointer-events:none;color:var(--va-c-primary);transform:translate(0) rotate(270deg);transition:all var(--va-transition-duration),opacity var(--va-transition-duration-fast)!important}.progress-circle{transition:.3s stroke-dashoffset;transform:rotate(-90deg);transform-origin:50% 50%}.progress-circle-container{position:absolute}.spinner[data-v-d067c193]{width:60px;height:60px;border:1px solid var(--va-c-primary);margin:100px auto;animation:rotateplane-d067c193 1.2s infinite ease-in-out}@keyframes rotateplane-d067c193{0%{transform:perspective(120px) rotateX(0) rotateY(0)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0)}to{transform:perspective(120px) rotateX(-180deg) rotateY(-180deg)}}.yun-bg{position:fixed;width:100%;height:100%;z-index:-1;top:0;left:0;background-image:var(--yun-bg-img);background-size:cover;background-position:center;background-repeat:no-repeat;background-attachment:fixed;animation-name:bg-fade-in;animation-duration:2s;opacity:var(--yun-bg-img-opacity, 1)}@supports (-webkit-touch-callout:none){.yun-bg{background-attachment:scroll}}@keyframes bg-fade-in{0%{opacity:0}to{opacity:var(--yun-bg-img-opacity, 1)}}canvas.fireworks{position:fixed;left:0;top:0;z-index:1;pointer-events:none}.yun-page-header-gradient{position:absolute;top:0;left:0;right:0;width:100%;height:500px;z-index:var(--yun-z-page-gradient);pointer-events:none;background:linear-gradient(to right,rgb(var(--gradient-from)/.2) 0,rgb(var(--gradient-to)/.2));-webkit-mask-image:linear-gradient(#000,#fff0 70%);mask-image:linear-gradient(#000,#fff0 70%);animation:fade-in 2s}:root{--vp-code-block-bg:var(--va-c-bg-alt);--vp-code-tab-divider:var(--va-c-gutter)}@media screen and (max-width:640px){.markdown-body div[class*=language-]{margin:0 var(--va-code-mobile-margin-x,-1rem)}}@media (width >= 640px){.markdown-body div[class*=language-]{border-radius:6px;margin:16px 0}}@media (width <= 639.9px){.markdown-body li div[class*=language-]{border-radius:6px 0 0 6px}}.markdown-body code{font-size:.85em}.markdown-body div[class*=language-]{overflow:auto hidden;position:relative;background-color:var(--va-code-block-bg)}.markdown-body [class*=language-] code,.markdown-body [class*=language-] pre{direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;tab-size:4;-webkit-hyphens:none;hyphens:none}.markdown-body [class*=language-] pre{position:relative;z-index:1;margin:0;padding:20px 0;background:0 0;overflow-x:auto}.markdown-body [class*=language-] code{display:block;padding:0 24px;width:fit-content;min-width:100%;line-height:var(--va-code-line-height);font-size:var(--va-code-font-size);color:var(--va-code-block-color);transition:color .5s}.markdown-body [class*=language-]>button.copy{direction:ltr;position:absolute;top:12px;right:12px;z-index:3;border:1px solid var(--va-code-copy-code-border-color);border-radius:4px;width:40px;height:40px;background-color:var(--va-code-copy-code-bg);opacity:0;cursor:pointer;background-image:var(--va-icon-copy);background-position:50%;background-size:20px;background-repeat:no-repeat;transition:border-color .25s,background-color .25s,opacity .25s}.markdown-body [class*=language-]:hover>button.copy,.markdown-body [class*=language-]>button.copy:focus{opacity:1}.markdown-body [class*=language-]>button.copy:hover{border-color:var(--va-code-copy-code-hover-border-color);background-color:var(--va-code-copy-code-hover-bg)}.markdown-body [class*=language-]>span.lang{position:absolute;top:2px;right:8px;z-index:2;font-size:12px;font-weight:500;color:var(--va-code-lang-color);transition:color .4s,opacity .4s}.markdown-body [class*=language-]:hover>button.copy+span.lang,.markdown-body [class*=language-]>button.copy:focus+span.lang{opacity:0}.markdown-body [class*=language-]>button.code-block-unfold-btn{display:none;position:absolute;z-index:10;bottom:0;left:0;width:100%;height:24px;opacity:1;cursor:pointer;background-image:linear-gradient(-180deg,rgba(0,0,0,0) 0,var(--va-c-bg-dark) 100%)}.markdown-body [class*=language-]>button.code-block-unfold-btn:before{display:block;content:"";width:100%;height:100%;background-image:var(--va-icon-collapse);background-position:50%;background-size:16px;background-repeat:no-repeat}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{position:relative;font-weight:600;outline:0}.markdown-body .header-anchor{position:absolute;top:0;left:0;margin-left:-.87em;font-weight:500;-webkit-user-select:none;user-select:none;opacity:0;text-decoration:none;transition:color .25s,opacity .25s}.markdown-body .header-anchor:before{content:var(--va-header-anchor-symbol, "#")}.markdown-body .header-anchor:before:hover{text-decoration:none}.markdown-body h1 .header-anchor:focus,.markdown-body h1:hover .header-anchor,.markdown-body h2 .header-anchor:focus,.markdown-body h2:hover .header-anchor,.markdown-body h3 .header-anchor:focus,.markdown-body h3:hover .header-anchor,.markdown-body h4 .header-anchor:focus,.markdown-body h4:hover .header-anchor,.markdown-body h5 .header-anchor:focus,.markdown-body h5:hover .header-anchor{opacity:1}@media (width >= 768px){.markdown-body h1{letter-spacing:-.02em;line-height:40px;font-size:32px}}html{transition:background-color .6s}:root{--p-overlay-popover-shadow:0px 4px 6px -1px rgb(0 0 0 / .1),0px 2px 4px -2px rgb(0 0 0 / .1);--p-overlay-popover-border-radius:4px;--p-tooltip-max-width:12.5rem;--p-tooltip-gutter:.25rem;--p-tooltip-shadow:var(--p-overlay-popover-shadow);--p-tooltip-padding:.25rem .75rem;--p-tooltip-border-radius:var(--p-overlay-popover-border-radius);--p-tooltip-background:var(--va-c-bg);--p-tooltip-color:var(--va-c-text)}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:var(--un-default-border-color,#e5e7eb)}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}a{color:inherit;text-decoration:inherit}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}button{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}button{-webkit-appearance:button;background-image:none}blockquote,h1,h2,h3,h4,h5,hr,p,pre{margin:0}ol,ul{list-style:none;margin:0;padding:0}button{cursor:pointer}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(/assets/KaTeX_Main-Bold.Cx986IdX.woff2) format("woff2"),url(/assets/KaTeX_Main-Bold.Jm3AIy58.woff) format("woff"),url(/assets/KaTeX_Main-Bold.waoOVXN0.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(/assets/KaTeX_Main-BoldItalic.DxDJ3AOS.woff2) format("woff2"),url(/assets/KaTeX_Main-BoldItalic.SpSLRI95.woff) format("woff"),url(/assets/KaTeX_Main-BoldItalic.DzxPMmG6.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(/assets/KaTeX_Main-Italic.NWA7e6Wa.woff2) format("woff2"),url(/assets/KaTeX_Main-Italic.BMLOBm91.woff) format("woff"),url(/assets/KaTeX_Main-Italic.3WenGoN9.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(/assets/KaTeX_Main-Regular.B22Nviop.woff2) format("woff2"),url(/assets/KaTeX_Main-Regular.Dr94JaBh.woff) format("woff"),url(/assets/KaTeX_Main-Regular.ypZvNtVU.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(/assets/KaTeX_Math-BoldItalic.CZnvNsCZ.woff2) format("woff2"),url(/assets/KaTeX_Math-BoldItalic.iY-2wyZ7.woff) format("woff"),url(/assets/KaTeX_Math-BoldItalic.B3XSjfu4.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(/assets/KaTeX_Math-Italic.t53AETM-.woff2) format("woff2"),url(/assets/KaTeX_Math-Italic.DA0__PXp.woff) format("woff"),url(/assets/KaTeX_Math-Italic.flOr_0UB.ttf) format("truetype")}.katex{font:1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0;text-rendering:auto}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .mfrac .frac-line{min-height:1px}.katex .mspace{display:inline-block}.katex .sizing.reset-size6.size3{font-size:.7em}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}body{counter-reset:katexEqnNo mmlEqnNo}.katex-display{overflow-x:auto;overflow-y:visible;padding:8px 0}:root{--va-c-border:#c2c2c4;--va-c-divider:#e2e2e3;--va-c-gutter:#e2e2e3}:root{--va-c-gray-1:#dddde3;--va-c-gray-2:#e4e4e9;--va-c-gray-3:#ebebef;--va-c-gray-soft:rgba(142, 150, 170, .14);--va-c-indigo-1:#3451b2;--va-c-indigo-2:#3a5ccc;--va-c-indigo-3:#5672cd;--va-c-indigo-soft:rgba(100, 108, 255, .14);--va-c-green-1:#18794e;--va-c-green-2:#299764;--va-c-green-3:#30a46c;--va-c-green-soft:rgba(16, 185, 129, .14);--va-c-yellow-1:#915930;--va-c-yellow-2:#946300;--va-c-yellow-3:#9f6a00;--va-c-yellow-soft:rgba(234, 179, 8, .14);--va-c-red-1:#b8272c;--va-c-red-2:#d5393e;--va-c-red-3:#e0575b;--va-c-red-soft:rgba(244, 63, 94, .14);--va-c-sponsor:#db2777}:root{--va-c-default-1:var(--va-c-gray-1);--va-c-default-2:var(--va-c-gray-2);--va-c-default-3:var(--va-c-gray-3);--va-c-default-soft:var(--va-c-gray-soft);--va-c-brand-1:var(--va-c-indigo-1);--va-c-brand-2:var(--va-c-indigo-2);--va-c-brand-3:var(--va-c-indigo-3);--va-c-brand-soft:var(--va-c-indigo-soft);--va-c-brand:var(--va-c-brand-1);--va-c-tip-1:var(--va-c-brand-1);--va-c-tip-2:var(--va-c-brand-2);--va-c-tip-3:var(--va-c-brand-3);--va-c-tip-soft:var(--va-c-brand-soft);--va-c-warning-1:var(--va-c-yellow-1);--va-c-warning-2:var(--va-c-yellow-2);--va-c-warning-3:var(--va-c-yellow-3);--va-c-warning-soft:var(--va-c-yellow-soft);--va-c-danger-1:var(--va-c-red-1);--va-c-danger-2:var(--va-c-red-2);--va-c-danger-3:var(--va-c-red-3);--va-c-danger-soft:var(--va-c-red-soft)}:root{--va-aside-width:256px;--va-sidebar-width:300px;--va-border-width:1px;--va-font-serif:"Noto Serif SC",DM Serif Display,STZhongsong,STKaiti,KaiTi,Roboto,serif;--va-font-sans:DM Sans,Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;--va-font-mono:DM Mono,Menlo,Monaco,Consolas,"Courier New",monospace;--va-transition-duration-fast:.2s;--va-transition-duration:.4s;--va-transition-duration-slow:.6s;--va-transition:all var(--va-transition-duration-fast) ease-in-out}:root{--va-c-white:#fff;--va-c-black:#1a1a1a;--va-c-gray:#8e8e8e;--va-c-danger:#db2828;--va-c-warning:#f2711c;--va-c-text-light-1:#213547;--va-c-text-light-2:rgba(60, 60, 60, .7);--va-c-text-light-3:rgba(60, 60, 60, .33);--va-c-text-light-4:rgba(60, 60, 60, .18);--va-c-text-dark-1:rgba(255, 255, 255, .87);--va-c-text-dark-2:rgba(235, 235, 235, .6);--va-c-text-dark-3:rgba(235, 235, 235, .38);--va-c-text-dark-4:rgba(235, 235, 235, .18);--va-c-primary-light:rgb(27.3, 232.5, 255);--va-c-primary-lighter:rgb(52.6, 235, 255);--va-c-primary-dark:rgb(0, 208.4442687747, 231.3);--va-c-primary:#02e6ff}:root{color-scheme:light;--va-c-brand:#02e6ff;--va-border-color:#222;--va-c-text:#333;--va-c-text-light:#555;--va-c-text-lighter:#666;--va-c-text-dark:#111;--va-c-primary-rgb:2,230,255;--va-c-link:var(--va-c-primary-dark)}:root{--va-c-text-1:rgba(60, 60, 67);--va-c-text-2:rgba(60, 60, 67, .78);--va-c-text-3:rgba(60, 60, 67, .56)}:root{--va-c-bg:#ffffff;--va-c-bg-light:#ffffff;--va-c-bg-dark:#fafafa;--va-c-bg-opacity:rgba(255, 255, 255, .8);--va-c-bg-soft:#f9f9f9;--va-c-bg-alt:#f9f9f9;--va-c-bg-mute:#f1f1f1}:root{--va-code-line-height:1.7;--va-code-font-size:.875em;--va-code-block-color:var(--va-c-text-2);--va-code-block-bg:var(--va-c-bg-alt);--va-code-block-divider-color:var(--va-c-gutter);--va-code-lang-color:var(--va-c-text-3);--va-code-line-highlight-color:var(--va-c-default-soft);--va-code-line-number-color:var(--va-c-text-3);--va-code-line-diff-add-color:var(--va-c-green-soft);--va-code-line-diff-add-symbol-color:var(--va-c-green-1);--va-code-line-diff-remove-color:var(--va-c-red-soft);--va-code-line-diff-remove-symbol-color:var(--va-c-red-1);--va-code-line-warning-color:var(--va-c-yellow-soft);--va-code-line-error-color:var(--va-c-red-soft);--va-code-copy-code-border-color:var(--va-c-divider);--va-code-copy-code-bg:var(--va-c-bg-soft);--va-code-copy-code-hover-border-color:var(--va-c-divider);--va-code-copy-code-hover-bg:var(--va-c-bg);--va-code-copy-code-active-text:var(--va-c-text-2);--va-code-copy-copied-text-content:"Copied";--va-code-tab-divider:var(--va-code-block-divider-color);--va-code-tab-text-color:var(--va-c-text-2);--va-code-tab-bg:var(--va-code-block-bg);--va-code-tab-hover-text-color:var(--va-c-text-1);--va-code-tab-active-text-color:var(--va-c-text-1);--va-code-tab-active-bar-color:var(--va-c-brand-1)}:root{--va-icon-copy:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2'/%3E%3C/svg%3E");--va-icon-copied:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' height='20' width='20' stroke='rgba(128,128,128,1)' stroke-width='2' class='h-6 w-6' viewBox='0 0 24 24'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2m-6 9 2 2 4-4'/%3E%3C/svg%3E");--va-icon-collapse:url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='32'%20height='32' stroke='rgba(128,128,128,1)' viewBox='0%200%2024%2024'%3E%3Cpath%20fill='currentColor'%20d='m12%2016.175l3.9-3.875q.275-.275.688-.288t.712.288q.275.275.275.7t-.275.7l-4.6%204.6q-.15.15-.325.213t-.375.062q-.2%200-.375-.063T11.3%2018.3l-4.6-4.6q-.275-.275-.288-.687T6.7%2012.3q.275-.275.7-.275t.7.275l3.9%203.875Zm0-6L15.9%206.3q.275-.275.688-.287t.712.287q.275.275.275.7t-.275.7l-4.6%204.6q-.15.15-.325.213t-.375.062q-.2%200-.375-.062T11.3%2012.3L6.7%207.7q-.275-.275-.288-.688T6.7%206.3q.275-.275.7-.275t.7.275l3.9%203.875Z'/%3E%3C/svg%3E")}:root{--va-header-anchor-symbol:"#"}html{-webkit-tap-highlight-color:transparent;font-family:var(--va-font-sans)}a{color:var(--va-c-link);font-weight:500}*{outline:0}hr{margin:1rem}button{background-color:transparent}#app,body,html{margin:0;padding:0;line-height:2}html{background-color:var(--va-c-bg)}a{cursor:pointer}:root{--yun-margin-top:68px;--yun-home-hero-image-filter:blur(48px);--yun-home-hero-name-background:-webkit-linear-gradient(120deg, var(--va-c-text) 30%, black);--yun-home-hero-image-background-image:linear-gradient(-45deg, #bd34fe 50%, #47caff 50%);--yun-nav-height:50px}:root{--yun-post-card-max-width:900px;--yun-c-cloud:white;--yun-z-select:6;--yun-z-cloud:7;--yun-z-go-down:9;--yun-z-backdrop:9;--yun-z-sidebar:10;--yun-z-fireworks:11;--yun-z-toc-btn:11;--yun-z-go-up-btn:20;--yun-z-fullscreen-menu:21;--yun-z-nav-menu:22;--yun-z-menu-btn:22;--yun-z-search-popup:30;--yun-z-search-btn:31;--yun-z-overlay:32;--yun-z-aside:33;--yun-z-left-sidebar:34;--yun-z-left-sidebar-menu:35;--yun-z-page-gradient:35;--yun-z-dock:999999;--va-z-overlay:var(--yun-z-backdrop)}:root{--yun-bg-img:url(/assets/bg-img.kXdNMxcF.jpg);--yun-sidebar-bg-color:var(--va-c-bg-light);--yun-sidebar-bg-img:url(/assets/sidebar-bg-img.mp54gEws.webp)}@media screen and (width <= 768px){:root{--rect-margin:16px}}@media screen and (width > 768px){:root{--rect-margin:48px}}.post-category{color:var(--va-c-text)}.post-tag{white-space:nowrap;color:var(--yun-tag-color)}.post-tag:hover{color:var(--va-c-primary)}html{overflow-y:scroll}:root{--smc-font-sans:Raleway,-apple-system,"PingFang SC","Microsoft YaHei",Arial,sans-serif;--smc-font-serif:"Songti SC","Noto Serif SC",STZhongsong,STKaiti,KaiTi,Roboto,serif;--smc-font-mono:Menlo,Monaco,Consolas,"Courier New",monospace}:root{--smc-c-primary-light:rgb(104, 240.0790513834, 255);--smc-c-primary-lighter:rgb(180.5, 247.6383399209, 255);--smc-c-primary:#02e6ff;--smc-theme-name:yun;--smc-line-height:1.8;--smc-c-primary-rgb:2,230,255;--smc-c-text:#24292e;--smc-c-text-light:#555;--smc-c-text-lighter:#666;--smc-header-bottom-color:#eaecef;--smc-border-color:var(--smc-c-primary-light);--smc-code-bg-color:#f6f8fa;--smc-link-color:rgb(0, 185.6442687747, 206)}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;background:var(--smc-bg-color);color:var(--smc-c-text);font-family:var(--smc-font-sans);font-size:1rem;line-height:var(--smc-line-height);overflow-wrap:break-word}.markdown-body *{box-sizing:border-box}.markdown-body a{background-color:transparent}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body hr{background-color:var(--smc-c-primary,#333);height:2px;margin:1.5rem 0}.markdown-body blockquote{margin:1rem 0;padding:0 1rem;border-left:.25em solid var(--smc-border-color)}.markdown-body code,.markdown-body pre{font-family:Source Code Pro,Consolas,Monaco,SFMono-Regular,Ubuntu Mono,Menlo,monospace}.markdown-body code{padding:3px 6px;font-size:.85rem;color:var(--smc-c-text-light);background:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre{margin-top:0;margin-bottom:0;overflow-wrap:normal;padding:1rem;overflow:auto;background-color:var(--smc-code-bg-color);border-radius:3px}.markdown-body pre>code{font-size:.85rem;white-space:pre}.markdown-body pre code{display:block;padding:0;margin:0;overflow:visible;line-height:inherit;word-break:normal;background-color:transparent;border:0}.markdown-body img{display:block;margin:1rem auto;max-width:92%;max-height:600px;border-radius:.2rem;transition:.4s;--tw-shadow:0 1px 3px 0 rgb(0 0 0/.1),0 1px 2px -1px rgb(0 0 0/.1);--tw-shadow-colored:0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color);-webkit-box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow);box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}.markdown-body img:hover{--tw-shadow:0 4px 6px -1px rgb(0 0 0/.1),0 2px 4px -2px rgb(0 0 0/.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color)}.markdown-body img:before{content:"「 LOADING ERROR 」"}@media screen and (min-width:1600px){.markdown-body img{max-width:800px}}.markdown-body a{color:var(--smc-c-primary);text-decoration:none;border-bottom:1px solid transparent;transition:all .2s ease-in-out}.markdown-body a:hover{color:var(--smc-link-color);border-bottom:1px solid var(--smc-link-color)}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul{margin-top:0;margin-bottom:0}.markdown-body ol ol{list-style-type:lower-roman}.markdown-body li{overflow-wrap:break-all;margin-top:.25em}.markdown-body li>p{margin-top:16px}.markdown-body table{width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid var(--smc-c-primary-light,#999)}.markdown-body table thead th{font-weight:600}.markdown-body table>tbody>tr:hover{background-color:rgba(var(--smc-c-primary-rgb),.1)}.markdown-body strong{font-family:var(--smc-font-serif);font-weight:900}.markdown-body p{margin-top:1rem;margin-bottom:1rem;overflow-x:auto;overflow-y:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{margin-top:1.5rem;margin-bottom:1rem;font-weight:300;line-height:1.5}.markdown-body h1{font-size:2.5rem;border-bottom:1px solid var(--smc-header-bottom-color)}.markdown-body h2{font-size:2.2rem;border-bottom:1px solid var(--smc-header-bottom-color)}.markdown-body h3{font-size:1.9rem}.markdown-body h4{font-size:1.6rem}.markdown-body h5{font-size:1.3rem}@media screen and (max-width:768px){.markdown-body h1{font-size:2rem}.markdown-body h2{font-size:1.8rem}.markdown-body h3{font-size:1.6rem}.markdown-body h4{font-size:1.4rem}.markdown-body h5{font-size:1.2rem}}.yun-icon-btn{background-color:transparent;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;border:none;width:3rem;height:3rem;border-radius:50%;transition:background-color var(--va-transition-duration)}.yun-icon-btn div{font-size:1.2rem}.yun-icon-btn:hover{background-color:rgba(var(--va-c-primary-rgb),.08)}.yun-icon-btn:active{background-color:rgba(var(--va-c-primary-rgb),.16)}.markdown-body{--smc-font-family:var(--va-font-sans);--c-toc-link:var(--va-c-text-light)}.markdown-body{word-wrap:break-word}.markdown-body a{color:var(--va-c-link)}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{font-family:var(--va-font-serif);font-weight:900}.markdown-body ul{list-style:initial}.markdown-body ul li>p{margin-bottom:0}.markdown-body ol>li{list-style:decimal}.markdown-body img{margin:.5rem auto;height:auto;max-width:min(92%,800px)}.markdown-body p{overflow:unset}.markdown-body hr{opacity:.6;height:2px;border-top-width:0;background-color:var(--va-c-text)}@media (width <= 767.9px){.markdown-body{padding:.5rem}}@media screen and (max-width:640px){.markdown-body div[class*=language-]{position:relative;margin:16px -24px 0;height:auto}}html:not(.dark) .vp-code span{color:var(--shiki-light,inherit)}:root{--va-custom-block-font-size:14px;--va-custom-block-code-font-size:13px;--va-custom-block-info-border:transparent;--va-custom-block-info-text:var(--va-c-text-1);--va-custom-block-info-bg:var(--va-c-default-soft);--va-custom-block-info-code-bg:var(--va-c-default-soft);--va-custom-block-tip-border:transparent;--va-custom-block-tip-text:var(--va-c-text-1);--va-custom-block-tip-bg:var(--va-c-brand-soft);--va-custom-block-tip-code-bg:var(--va-c-brand-soft);--va-custom-block-warning-border:transparent;--va-custom-block-warning-text:var(--va-c-text-1);--va-custom-block-warning-bg:var(--va-c-warning-soft);--va-custom-block-warning-code-bg:var(--va-c-warning-soft);--va-custom-block-danger-border:transparent;--va-custom-block-danger-text:var(--va-c-text-1);--va-custom-block-danger-bg:var(--va-c-danger-soft);--va-custom-block-danger-code-bg:var(--va-c-danger-soft);--va-custom-block-details-border:var(--va-custom-block-info-border);--va-custom-block-details-text:var(--va-custom-block-info-text);--va-custom-block-details-bg:var(--va-custom-block-info-bg);--va-custom-block-details-code-bg:var(--va-custom-block-info-code-bg)}@supports ((-webkit-hyphens:none) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:after,:before{--un-scale-x:1;--un-scale-y:1;--un-scale-z:1;--un-leading:initial;--un-ease:initial;--un-bg-opacity:100%;--un-translate-x:initial;--un-translate-y:initial;--un-translate-z:initial;--un-rotate-x:rotateX(0);--un-rotate-y:rotateY(0);--un-rotate-z:rotateZ(0);--un-skew-x:skewX(0);--un-skew-y:skewY(0);--un-text-opacity:100%;--un-border-opacity:100%;--un-from-opacity:100%;--un-to-opacity:100%;--un-border-bottom-opacity:100%}}@property --un-text-opacity{syntax:"<percentage>";inherits:falseinitial-value:100%}@property --un-leading{syntax:"*"inherits:false}@property --un-outline-style{syntax:"*";inherits:falseinitial-value:solid}@property --un-border-opacity{syntax:"<percentage>";inherits:falseinitial-value:100%}@property --un-border-bottom-opacity{syntax:"<percentage>";inherits:falseinitial-value:100%}@property --un-bg-opacity{syntax:"<percentage>";inherits:falseinitial-value:100%}@property --un-inset-ring-color{syntax:"*"inherits:false}@property --un-inset-ring-shadow{syntax:"*";inherits:falseinitial-value:0 0 #0000}@property --un-inset-shadow{syntax:"*";inherits:falseinitial-value:0 0 #0000}@property --un-inset-shadow-color{syntax:"*"inherits:false}@property --un-ring-color{syntax:"*"inherits:false}@property --un-ring-inset{syntax:"*"inherits:false}@property --un-ring-offset-color{syntax:"*"inherits:false}@property --un-ring-offset-shadow{syntax:"*";inherits:falseinitial-value:0 0 #0000}@property --un-ring-offset-width{syntax:"<length>";inherits:falseinitial-value:0px}@property --un-ring-shadow{syntax:"*";inherits:falseinitial-value:0 0 #0000}@property --un-shadow{syntax:"*";inherits:falseinitial-value:0 0 #0000}@property --un-shadow-color{syntax:"*"inherits:false}@property --un-translate-x{syntax:"*";inherits:falseinitial-value:0}@property --un-translate-y{syntax:"*";inherits:falseinitial-value:0}@property --un-translate-z{syntax:"*";inherits:falseinitial-value:0}@property --un-rotate-x{syntax:"*";inherits:falseinitial-value:rotateX(0)}@property --un-rotate-y{syntax:"*";inherits:falseinitial-value:rotateY(0)}@property --un-rotate-z{syntax:"*";inherits:falseinitial-value:rotateZ(0)}@property --un-skew-x{syntax:"*";inherits:falseinitial-value:skewX(0)}@property --un-skew-y{syntax:"*";inherits:falseinitial-value:skewY(0)}@property --un-scale-x{syntax:"*";inherits:falseinitial-value:1}@property --un-scale-y{syntax:"*";inherits:falseinitial-value:1}@property --un-scale-z{syntax:"*";inherits:falseinitial-value:1}@property --un-ease{syntax:"*"inherits:false}@property --un-from-opacity{syntax:"<percentage>";inherits:falseinitial-value:100%}@property --un-gradient-from{syntax:"<color>";inherits:falseinitial-value:#0000}@property --un-gradient-from-position{syntax:"<length-percentage>";inherits:falseinitial-value:0%}@property --un-gradient-position{syntax:"*"inherits:false}@property --un-gradient-stops{syntax:"*"inherits:false}@property --un-gradient-to{syntax:"<color>";inherits:falseinitial-value:#0000}@property --un-gradient-to-position{syntax:"<length-percentage>";inherits:falseinitial-value:100%}@property --un-gradient-via{syntax:"<color>";inherits:falseinitial-value:#0000}@property --un-gradient-via-position{syntax:"<length-percentage>";inherits:falseinitial-value:50%}@property --un-gradient-via-stops{syntax:"*"inherits:false}@property --un-to-opacity{syntax:"<percentage>";inherits:falseinitial-value:100%}@property --un-blur{syntax:"*"inherits:false}@property --un-brightness{syntax:"*"inherits:false}@property --un-contrast{syntax:"*"inherits:false}@property --un-drop-shadow{syntax:"*"inherits:false}@property --un-grayscale{syntax:"*"inherits:false}@property --un-hue-rotate{syntax:"*"inherits:false}@property --un-invert{syntax:"*"inherits:false}@property --un-saturate{syntax:"*"inherits:false}@property --un-sepia{syntax:"*"inherits:false}:root{--spacing:.25rem;--default-transition-timingFunction:cubic-bezier(.4, 0, .2, 1);--default-transition-duration:.15s;--container-4xl:56rem;--radius-DEFAULT:.25rem;--fontWeight-bold:700;--leading-none:1;--container-3xl:48rem;--ease-in-out:cubic-bezier(.4, 0, .2, 1);--container-sm:24rem;--radius-lg:.5rem;--container-2xl:42rem;--colors-white:#fff;--ease-in:cubic-bezier(.4, 0, 1, 1);--colors-black:#000;--fontWeight-medium:500;--leading-loose:2;--fontWeight-black:900;--container-md:28rem;--ease-DEFAULT:cubic-bezier(.4, 0, .2, 1);--fontWeight-light:300;--colors-gray-100:oklch(96.7% .003 264.542);--colors-gray-DEFAULT:oklch(70.7% .022 261.325);--colors-red-DEFAULT:oklch(70.4% .191 22.216);--colors-dark-DEFAULT:oklch(25.2% 0 0);--colors-blue-500:oklch(62.3% .214 259.815);--text-sm-fontSize:.875rem;--text-sm-lineHeight:1.25rem;--text-2xl-fontSize:1.5rem;--text-2xl-lineHeight:2rem;--text-xl-fontSize:1.25rem;--text-xl-lineHeight:1.75rem;--text-lg-fontSize:1.125rem;--text-lg-lineHeight:1.75rem;--text-xs-fontSize:.75rem;--text-xs-lineHeight:1rem;--text-base-fontSize:1rem;--text-base-lineHeight:1.5rem;--radius-none:0;--colors-dark-300:oklch(29.72% 0 0);--colors-green-DEFAULT:oklch(79.2% .209 151.711);--colors-blue-DEFAULT:oklch(70.7% .165 254.624);--colors-orange-DEFAULT:oklch(75% .183 55.934);--colors-red-400:oklch(70.4% .191 22.216);--text-4xl-fontSize:2.25rem;--text-4xl-lineHeight:2.5rem;--colors-gray-600:oklch(44.6% .03 256.802);--font-sans:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--default-font-family:var(--font-sans);--default-monoFont-family:var(--font-mono)}*,:after,:before{box-sizing:border-box;margin:0;padding:0;border:0 solid}html{line-height:1.5;-webkit-text-size-adjust:100%;tab-size:4;font-family:var( --default-font-family, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji" );font-feature-settings:var(--default-font-featureSettings,normal);font-variation-settings:var(--default-font-variationSettings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}h1,h2,h3,h4,h5{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,pre{font-family:var( --default-monoFont-family, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace );font-feature-settings:var(--default-monoFont-featureSettings,normal);font-variation-settings:var(--default-monoFont-variationSettings,normal);font-size:1em}table{text-indent:0;border-color:inherit;border-collapse:collapse}ol,ul{list-style:none}canvas,img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;border-radius:0;background-color:transparent;opacity:1}button{appearance:button}.i-ri-alipay-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M18.408 16.79q-3.26-1.425-4.64-2.086c-1.4 1.696-2.872 2.72-5.08 2.72S5 16.064 5.176 14.392c.12-1.096.872-2.888 4.128-2.576c1.72.16 2.504.48 3.912.944c.36-.664.664-1.4.888-2.176H7.88v-.616h3.072V8.864H7.2v-.68h3.752V6.592s.032-.248.312-.248H12.8v1.848h4v.68h-4v1.104h3.264a12.4 12.4 0 0 1-1.32 3.32q.765.273 4.76 1.483a8 8 0 1 0-1.096 2.012M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m-3.568-5.632c1.44 0 2.824-.872 3.96-2.352c-1.608-.776-2.944-1.16-4.44-1.16c-1.304 0-1.984.8-2.104 1.416s.248 2.096 2.584 2.096'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-arrow-right-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m13.172 12l-4.95-4.95l1.414-1.413L16 12l-6.364 6.364l-1.414-1.415z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-arrow-up-s-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m12 10.828l-4.95 4.95l-1.414-1.414L12 8l6.364 6.364l-1.414 1.414z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-calendar-2-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M9 1v2h6V1h2v2h4a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h4V1zm11 10H4v8h16zM8 13v2H6v-2zm5 0v2h-2v-2zm5 0v2h-2v-2zM7 5H4v4h16V5h-3v2h-2V5H9v2H7z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-calendar-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M9 1v2h6V1h2v2h4a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h4V1zm11 10H4v8h16zM7 5H4v4h16V5h-3v2h-2V5H9v2H7z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}.i-ri-cloud-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12 2a7 7 0 0 1 6.992 7.339A6 6 0 0 1 17 21H7A6 6 0 0 1 5.008 9.339A7 7 0 0 1 12 2m0 2a5 5 0 0 0-4.994 5.243l.07 1.488l-1.404.494A4.002 4.002 0 0 0 7 19h10a4 4 0 1 0-3.796-5.265l-1.898-.633A6 6 0 0 1 17 9a5 5 0 0 0-5-5'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-file-list-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M20 22H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1m-1-2V4H5v16zM8 7h8v2H8zm0 4h8v2H8zm0 4h8v2H8z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-file-word-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M16 8v8h-2l-2-2l-2 2H8V8h2v5l2-2l2 2V8h1V4H5v16h14V8zM3 2.992C3 2.444 3.447 2 3.999 2H16l5 5v13.993A1 1 0 0 1 20.007 22H3.993A1 1 0 0 1 3 21.008z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-folder-2-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.414 5H21a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h7.414zM20 11H4v8h16zm0-2V7h-8.414l-2-2H4v4z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-heart-fill=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M12.001 4.529a6 6 0 0 1 8.242.228a6 6 0 0 1 .236 8.236l-8.48 8.492l-8.478-8.492a6 6 0 0 1 8.48-8.464'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}[i-ri-timer-line=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m17.618 5.968l1.453-1.453l1.414 1.414l-1.453 1.453A9 9 0 1 1 12 4c2.125 0 4.078.736 5.618 1.968M12 20a7 7 0 1 0 0-14a7 7 0 0 0 0 14M11 8h2v6h-2zM8 1h8v2H8z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}.i-ri-wechat-pay-line{--un-icon:url("data:image/svg+xml;utf8,%3Csvg viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='m19.146 8.993l-9.799 5.608l-.07.045a.65.65 0 0 1-.3.07a.66.66 0 0 1-.58-.345l-.046-.092l-1.831-3.95c-.023-.046-.023-.092-.023-.138c0-.184.139-.321.324-.321q.105 0 .209.069l2.155 1.515c.162.092.347.161.556.161a.9.9 0 0 0 .348-.069l8.274-3.649C16.935 6.273 14.635 5.2 12.001 5.2c-4.421 0-7.9 3.022-7.9 6.6c0 1.365.5 2.673 1.431 3.78q.073.088.215.236a4 4 0 0 1 1.1 3.102l-.024.297l.715-.436a4 4 0 0 1 2.706-.536q.317.05.52.076q.61.081 1.237.081c4.42 0 7.9-3.022 7.9-6.6c0-.996-.27-1.95-.755-2.807M6.193 21.943a1 1 0 0 1-1.527-.932l.189-2.259a2 2 0 0 0-.55-1.551a7 7 0 0 1-.303-.333C2.806 15.447 2.1 13.695 2.1 11.8c0-4.75 4.432-8.6 9.9-8.6c5.467 0 9.9 3.85 9.9 8.6s-4.433 8.6-9.9 8.6q-.765-.001-1.5-.098q-.229-.03-.568-.084a2 2 0 0 0-1.353.268z'/%3E%3C/svg%3E");-webkit-mask:var(--un-icon) no-repeat;mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;background-color:currentColor;color:inherit;width:1.2em;height:1.2em}.va-card{background-color:color-mix(in oklab,var(--va-c-bg-light) var(--un-bg-opacity),transparent);--un-shadow:0 1px 3px 0 var(--un-shadow-color, rgb(0 0 0 / .1)),0 1px 2px -1px var(--un-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--un-inset-shadow),var(--un-inset-ring-shadow),var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.flex-center,[flex~=center]{display:flex;align-items:center;justify-content:center}.inline-flex-center{display:inline-flex;align-items:center;justify-content:center}.yun-card{--un-shadow:0 1px 3px 0 var(--un-shadow-color, rgb(0 0 0 / .1)),0 1px 2px -1px var(--un-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--un-inset-shadow),var(--un-inset-ring-shadow),var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow);transition-property:all;transition-timing-function:var(--un-ease,var(--default-transition-timingFunction));transition-duration:var(--un-duration, var(--default-transition-duration));transition-duration:var(--va-transition-duration)}.va-card:hover{--un-shadow:0 10px 15px -3px var(--un-shadow-color, rgb(0 0 0 / .1)),0 4px 6px -4px var(--un-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--un-inset-shadow),var(--un-inset-ring-shadow),var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.yun-card:hover{--un-shadow:0 25px 50px -12px var(--un-shadow-color, rgb(0 0 0 / .25));box-shadow:var(--un-inset-shadow),var(--un-inset-ring-shadow),var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}[text~="2xl"]{font-size:var(--text-2xl-fontSize);line-height:var(--un-leading, var(--text-2xl-lineHeight))}[text~=sm]{font-size:var(--text-sm-fontSize);line-height:var(--un-leading, var(--text-sm-lineHeight))}[text~=xl]{font-size:var(--text-xl-fontSize);line-height:var(--un-leading, var(--text-xl-lineHeight))}.text-xs{font-size:var(--text-xs-fontSize);line-height:var(--un-leading, var(--text-xs-lineHeight))}.text-\$va-c-text-light{color:color-mix(in oklab,var(--va-c-text-light) var(--un-text-opacity),transparent)}[text~=red-400]{color:color-mix(in srgb,var(--colors-red-400) var(--un-text-opacity),transparent)}[hover~=text-white]:hover{color:color-mix(in srgb,var(--colors-white) var(--un-text-opacity),transparent)}.leading-none{--un-leading:var(--leading-none);line-height:var(--leading-none)}[font~=black]{--un-font-weight:var(--fontWeight-black);font-weight:var(--fontWeight-black)}[m~="0"]{margin:calc(var(--spacing) * 0)}[m~="2"]{margin:calc(var(--spacing) * 2)}.m-auto{margin:auto}[mx-1=""],[m~=x-1]{margin-inline:calc(var(--spacing) * 1)}[m~=y-4]{margin-block:calc(var(--spacing) * 4)}[mx~="2"]{margin-inline:calc(var(--spacing) * 2)}[m~=b-2]{margin-bottom:calc(var(--spacing) * 2)}.mb-4,[mb~="4"]{margin-bottom:calc(var(--spacing) * 4)}.ml-1{margin-left:calc(var(--spacing) * 1)}.mt-12{margin-top:calc(var(--spacing) * 12)}.mt-14{margin-top:calc(var(--spacing) * 14)}.mt-2{margin-top:calc(var(--spacing) * 2)}.mt-2px{margin-top:2px}.mt-4{margin-top:calc(var(--spacing) * 4)}[m~=t-6]{margin-top:calc(var(--spacing) * 6)}.mt-8{margin-top:calc(var(--spacing) * 8)}[p~="1"]{padding:calc(var(--spacing) * 1)}[p~="2"]{padding:calc(var(--spacing) * 2)}[p~="4"]{padding:calc(var(--spacing) * 4)}[px-2=""]{padding-inline:calc(var(--spacing) * 2)}.px-4,[p~=x-4]{padding-inline:calc(var(--spacing) * 4)}.py-4{padding-block:calc(var(--spacing) * 4)}[py~="1"]{padding-block:calc(var(--spacing) * 1)}[pb-2=""]{padding-bottom:calc(var(--spacing) * 2)}.pt-0{padding-top:calc(var(--spacing) * 0)}[p~=b-8]{padding-bottom:calc(var(--spacing) * 8)}[text~=center]{text-align:center}[border=""],[border~="~"]{border-width:1px}.border-\$va-c-divider{border-color:color-mix(in oklab,var(--va-c-divider) var(--un-border-opacity),transparent)}[border~=rounded]{border-radius:var(--radius-DEFAULT)}.rounded-2{border-radius:.5rem}[rounded-full=""]{border-radius:calc(infinity * 1px)}[bg~="$va-c-bg-light"]{background-color:color-mix(in oklab,var(--va-c-bg-light) var(--un-bg-opacity),transparent)}.bg-\$va-c-bg-soft{background-color:color-mix(in oklab,var(--va-c-bg-soft) var(--un-bg-opacity),transparent)}[bg~=white]{background-color:color-mix(in srgb,var(--colors-white) var(--un-bg-opacity),transparent)}[bg~="$va-c-bg"]{background-color:color-mix(in oklab,var(--va-c-bg) var(--un-bg-opacity),transparent)}[hover~=bg-blue-500]:hover{background-color:color-mix(in srgb,var(--colors-blue-500) var(--un-bg-opacity),transparent)}.op-60{opacity:60%}.op-80{opacity:80%}.flex,[flex=""],[flex~="~"]{display:flex}.inline-flex,[inline-flex=""]{display:inline-flex}[flex~="1"]{flex:1 1 0%}.flex-grow,[flex~=grow]{flex-grow:1}.flex-col,[flex~=col]{flex-direction:column}[flex~=wrap]{flex-wrap:wrap}.gap-1,[gap~="1"]{gap:calc(var(--spacing) * 1)}.gap-2{gap:calc(var(--spacing) * 2)}.gap-2\!{gap:calc(var(--spacing) * 2)!important}.gap-4{gap:calc(var(--spacing) * 4)}.size-8{width:calc(var(--spacing) * 8);height:calc(var(--spacing) * 8)}.min-h-sm{min-height:var(--container-sm)}.w-full,[w~=full]{width:100%}[h~="64"]{height:calc(var(--spacing) * 64)}[h~="7"]{height:calc(var(--spacing) * 7)}[min-h~="100px"]{min-height:100px}.inline-block{display:inline-block}.select-none{-webkit-user-select:none;user-select:none}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.shadow{--un-shadow:0 1px 3px 0 var(--un-shadow-color, rgb(0 0 0 / .1)),0 1px 2px -1px var(--un-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--un-inset-shadow),var(--un-inset-ring-shadow),var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.hover\:shadow-md:hover,.shadow-md{--un-shadow:0 4px 6px -1px var(--un-shadow-color, rgb(0 0 0 / .1)),0 2px 4px -2px var(--un-shadow-color, rgb(0 0 0 / .1));box-shadow:var(--un-inset-shadow),var(--un-inset-ring-shadow),var(--un-ring-offset-shadow),var(--un-ring-shadow),var(--un-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,--un-gradient-from,--un-gradient-via,--un-gradient-to,opacity,box-shadow,transform,translate,scale,rotate,filter,-webkit-backdrop-filter,backdrop-filter;transition-timing-function:var(--un-ease,var(--default-transition-timingFunction));transition-duration:var(--un-duration, var(--default-transition-duration))}.items-start{align-items:flex-start}.items-center,[items-center=""],[items~=center]{align-items:center}[start~="2"]{inset-inline-start:calc(var(--spacing) * 2)}[start~="3"]{inset-inline-start:calc(var(--spacing) * 3)}[start~="4"]{inset-inline-start:calc(var(--spacing) * 4)}[bottom-0=""]{bottom:calc(var(--spacing) * 0)}.left-0,[left-0=""]{left:calc(var(--spacing) * 0)}.right-0,[right-0=""]{right:calc(var(--spacing) * 0)}.top--10{top:calc(var(--spacing) * -10)}.top-0,[top-0=""]{top:calc(var(--spacing) * 0)}[bottom~="19"]{bottom:calc(var(--spacing) * 19)}[right~="4"]{right:calc(var(--spacing) * 4)}[justify~=end]{justify-content:flex-end}.justify-center,[justify~=center]{justify-content:center}.justify-around{justify-content:space-around}.absolute,[absolute=""]{position:absolute}.fixed{position:fixed}.relative{position:relative}.sticky{position:sticky}.z-1{z-index:1}[z-10=""]{z-index:10}.z-20{z-index:20}[overflow~=auto]{overflow:auto}[stroke-width~="2"]{stroke-width:2px}@keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes pulse{0%,to{opacity:1}50%{opacity:.5}}.animate-fade-in{animation:fade-in 1s linear 1}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}.animate-iteration-1{animation-iteration-count:1}.object-cover{object-fit:cover}[font~=serif]{font-family:var(--va-font-serif)}@supports (color:color-mix(in lab,red,red)){[text~=red-400]{color:color-mix(in oklab,var(--colors-red-400) var(--un-text-opacity),transparent)}[hover~=text-white]:hover{color:color-mix(in oklab,var(--colors-white) var(--un-text-opacity),transparent)}[bg~=white]{background-color:color-mix(in oklab,var(--colors-white) var(--un-bg-opacity),transparent)}[hover~=bg-blue-500]:hover{background-color:color-mix(in oklab,var(--colors-blue-500) var(--un-bg-opacity),transparent)}}@media (max-width:calc(48rem - .1px)){[p~="lt-md:0"]{padding:calc(var(--spacing) * 0)}.lt-md\:w-full{width:100%}}@media (min-width:40rem){.sm\:p-6{padding:calc(var(--spacing) * 6)}.sm\:px-6{padding-inline:calc(var(--spacing) * 6)}}@media (min-width:48rem){.md\:mt-24{margin-top:calc(var(--spacing) * 24)}.md\:w-3xl{width:var(--container-3xl)}}@media (min-width:64rem){.lg\:px-12{padding-inline:calc(var(--spacing) * 12)}.lg\:w-2xl{width:var(--container-2xl)}.lg\:top-\$yun-margin-top{top:var(--yun-margin-top)}}@media (min-width:80rem){.xl\:px-16{padding-inline:calc(var(--spacing) * 16)}.xl\:w-2xl{width:var(--container-2xl)}.xl\:hidden{display:none}}@media (min-width:96rem){.\32xl\:w-4xl{width:var(--container-4xl)}}.v-a-face{display:block;width:100%;margin:.5em 0}.v-a-face img.v-a-face-img{display:block;margin:0 auto;max-width:100%;height:auto}</style><script>const locale=localStorage.getItem("valaxy-locale")||"zh-CN";document.documentElement.setAttribute("lang",locale)</script><script type="module" async crossorigin src="/assets/app.DVqel8FN.js"></script><link rel="modulepreload" crossorigin href="/assets/framework.CzqXvcaZ.js"><link rel="modulepreload" crossorigin href="/assets/chunks/@vueuse/motion.ChokKGFY.js"><link rel="modulepreload" crossorigin href="/assets/chunks/vue-router.BxwhCc9-.js"><link rel="modulepreload" crossorigin href="/assets/chunks/dayjs.BdcnXKr1.js"><link rel="modulepreload" crossorigin href="/assets/chunks/vue-i18n.DKUSMKgm.js"><link rel="modulepreload" crossorigin href="/assets/chunks/pinia.BnQGIDvb.js"><link rel="modulepreload" crossorigin href="/assets/chunks/nprogress.B6x19dEb.js"><link rel="preload" crossorigin href="/assets/app.nT9ww568.css" onload='this.rel="stylesheet"' as="style"><noscript><link rel="stylesheet" crossorigin href="/assets/app.nT9ww568.css"></noscript><link rel="preload" crossorigin href="/assets/group-icons.DLBb7Rhi.css" onload='this.rel="stylesheet"' as="style"><noscript><link rel="stylesheet" crossorigin href="/assets/group-icons.DLBb7Rhi.css"></noscript><link rel="modulepreload" crossorigin href="/assets/post.BV8rz8hk.js"><link rel="preload" href="/assets/group-icons.DLBb7Rhi.css" onload='this.rel="stylesheet"' as="style"><noscript><link rel="stylesheet" href="/assets/group-icons.DLBb7Rhi.css"></noscript><link rel="modulepreload" crossorigin href="/assets/Shader.Cvly96UT.js"><link rel="preload" href="/assets/Shader.CTAybgSN.css" onload='this.rel="stylesheet"' as="style"><noscript><link rel="stylesheet" href="/assets/Shader.CTAybgSN.css"></noscript><title>shader入门学习 - Hokit Blog | 好吉小站</title><script id="check-mac-os" async>document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><link rel="stylesheet" href="https://unpkg.com/aplayer/dist/APlayer.min.css"><meta property="og:locale:alternate" content="en"><meta name="description" content="世界上只有一种英雄主义，就是在认清生活真相之后依然热爱生活。"><meta property="og:description" content="世界上只有一种英雄主义，就是在认清生活真相之后依然热爱生活。"><meta property="og:locale" content="zh-CN"><meta property="og:site_name" content="Hokit Blog | 好吉小站"><meta property="og:title" content="shader入门学习"><meta property="og:image" content="https://img.alicdn.com/imgextra/i2/3343836081/O1CN01WEkPZv1un9ZHW0TBS_!!3343836081.jpg"><meta property="og:type" content="website"><meta property="og:url" content="hokitan.xyz/"><link rel="icon" href="https://img.alicdn.com/imgextra/i2/3343836081/O1CN01kq4lPt1un9Z2iQ6JH_!!3343836081.jpg" type="image/png"><meta name="generator" content="Valaxy 0.26.6"><meta name="theme-color" content="#fff"><meta name="msapplication-TileColor" content="#fff"><meta name="twitter:card" content="summary_large_image"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_AMS-Regular.BQhdFMY1.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Bold.Dq_IR9rO.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Caligraphic-Regular.Di6jR-x-.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Bold.CL6g_b3V.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Fraktur-Regular.CTYiF6lA.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Bold.Cx986IdX.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-BoldItalic.DxDJ3AOS.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Italic.NWA7e6Wa.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Main-Regular.B22Nviop.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-BoldItalic.CZnvNsCZ.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Math-Italic.t53AETM-.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Bold.D1sUS0GD.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Italic.C3H0VqGB.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_SansSerif-Regular.DDBCnlJ7.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Script-Regular.D3wIWfF6.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size1-Regular.mCD8mA8B.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size2-Regular.Dy4dx90m.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="data:font/woff2;base64,d09GMgABAAAAAA4oAA4AAAAAHbQAAA3TAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAAgRQIDgmcDBEICo1oijYBNgIkA14LMgAEIAWJAAeBHAyBHBvbGiMRdnO0IkRRkiYDgr9KsJ1NUAf2kILNxgUmgqIgq1P89vcbIcmsQbRps3vCcXdYOKSWEPEKgZgQkprQQsxIXUgq0DqpGKmIvrgkeVGtEQD9DzAO29fM9jYhxZEsL2FeURH2JN4MIcTdO049NCVdxQ/w9NrSYFEBKTDKpLKfNkCGDc1RwjZLQcm3vqJ2UW9Xfa3tgAHz6ivp6vgC2yD4/6352ndnN0X0TL7seypkjZlMsjmZnf0Mm5Q+JykRWQBKCVCVPbARPXWyQtb5VgLB6Biq7/Uixcj2WGqdI8tGSgkuRG+t910GKP2D7AQH0DB9FMDW/obJZ8giFI3Wg8Cvevz0M+5m0rTh7XDBlvo9Y4vm13EXmfttwI4mBo1EG15fxJhUiCLbiiyCf/ZA6MFAhg3pGIZGdGIVjtPn6UcMk9A/UUr9PhoNsCENw1APAq0gpH73e+M+0ueyHbabc3vkbcdtzcf/fiy+NxQEjf9ud/ELBHAXJ0nk4z+MXH2Ev/kWyV4k7SkvpPc9Qr38F6RPWnM9cN6DJ0AdD1BhtgABtmoRoFCvPsBAumNm6soZG2Gk5GyVTo2sJncSyp0jQTYoR6WDvTwaaEcHsxHfvuWhHA3a6bN7twRKtcGok6NsCi7jYRrM2jExsUFMxMQYuJbMhuWNOumEJy9hi29Dmg5zMp/A5+hhPG19j1vBrq8JTLr8ki5VLPmG/PynJHVul440bxg5xuymHUFPBshC+nA9I1FmwbRBTNHAcik3Oae0cxKoI3MOriM42UrPe51nsaGxJ+WfXubAsP84aabUlQSJ1IiE0iPETLUU4CATgfXSCSpuRFRmCGbO+wSpAnzaeaCYW1VNEysRtuXCEL1kUFUbbtMv3Tilt/1c11jt3Q5bbMa84cpWipp8Elw3MZhOHsOlwwVUQM3lAR35JiFQbaYCRnMF2lxAWoOg2gyoIV4PouX8HytNIfLhqpJtXB4vjiViUI8IJ7bkC4ikkQvKksnOTKICwnqWSZ9YS5f0WCxmpgjbIq7EJcM4aI2nmhLNY2JIUgOjXZFWBHb+x5oh6cwb0Tv1ackHdKi0I9OO2wE9aogIOn540CCCziyhN+IaejtgAONKznHlHyutPrHGwCx9S6B8kfS4Mfi4Eyv7OU730bT1SCBjt834cXsf43zVjPUqqJjgrjeGnBxSG4aYAKFuVbeCfkDIjAqMb6yLNIbCuvXhMH2/+k2vkNpkORhR59N1CkzoOENvneIosjYmuTxlhUzaGEJQ/iWqx4dmwpmKjrwTiTGTCVozNAYqk/zXOndWxuWSmJkQpJw3pK5KX6QrLt5LATMqpmPAQhkhK6PUjzHUn7E0gHE0kPE0iKkolgkUx9SZmVAdDgpffdyJKg3k7VmzYGCwVXGz/tXmkOIp+vcWs+EMuhhvN0h9uhfzWJziBQmCREGSIFmQIkgVpAnSBRmC//6hkLZwaVhwxlrJSOdqlFtOYxlau9F2QN5Y98xmIAsiM1HVp2VFX+DHHGg6Ecjh3vmqtidX3qHI2qycTk/iwxSt5UzTmEP92ZBnEWTk4Mx8Mpl78ZDokxg/KWb+Q0QkvdKVmq3TMW+RXEgrsziSAfNXFMhDc60N5N9jQzjfO0kBKpUZl0ZmwJ41j/B9Hz6wmRaJB84niNmQrzp9eSlQCDDzazGDdVi3P36VZQ+Jy4f9UBNp+3zTjqI4abaFAm+GShVaXlsGdF3FYzZcDI6cori4kMxUECl9IjJZpzkvitAoxKue+90pDMvcKRxLl53TmOKCmV/xRolNKSqqUxc6LStOETmFOiLZZptlZepcKiAzteG8PEdpnQpbOMNcMsR4RR2Bs0cKFEvSmIjAFcnarqwUL4lDhHmnVkwu1IwshbiCcgvOheZuYyOteufZZwlcTlLgnZ3o/WcYdzZHW/WGaqaVfmTZ1aWCceJjkbZqsfbkOtcFlUZM/jy+hXHDbaUobWqqXaeWobbLO99yG5N3U4wxco0rQGGcOLASFMXeJoham8M+/x6O2WywK2l4HGbq1CoUyC/IZikQhdq3SiuNrvAEj0AVu9x2x3lp/xWzahaxidezFVtdcb5uEnzyl0ZmYiuKI0exvCd4Xc9CV1KB0db00z92wDPde0kukbvZIWN6jUWFTmPIC/Y4UPCm8UfDTFZpZNon1qLFTkBhxzB+FjQRA2Q/YRJT8pQigslMaUpFyAG8TMlXigiqmAZX4xgijKjRlGpLE0GdplRfCaJo0JQaSxNBk6ZmMzcya0FmrcisDdn0Q3HI2sWSppYigmlM1XT/kLQZSNpMJG0WkjYbSZuDpM1F0uYhFc1HxU4m1QJjDK6iL0S5uSj5rgXc3RejEigtcRBtqYPQsiTskmO5vosV+q4VGIKbOkDg0jtRrq+Em1YloaTFar3EGr1EUC8R0kus1Uus00usL97ABr2BjXoDm/QGNhuWtMVBKOwg/i78lT7hBsAvDmwHc/ao3vmUbBmhjeYySZNWvGkfZAgISDSaDo1SVpzGDsAEkF8B+gEapViUoZgUWXcRIGFZNm6gWbAKk0bp0k1MHG9fLYtV4iS2SmLEQFARzRcnf9PUS0LVn05/J9MiRRBU3v2IrvW974v4N00L7ZMk0wXP1409CHo/an8zTRHD3eSJ6m8D4YMkZNl3M79sqeuAsr/m3f+8/yl7A50aiAEJgeBeMWzu7ui9UfUBCe2TIqZIoOd/3/udRBOQidQZUERzb2/VwZN1H/Sju82ew2H2Wfr6qvfVf3hqwDvAIpkQVFy4B9Pe9e4/XvPeceu7h3dvO56iJPf0+A6cqA2ip18ER+iFgggiuOkvj24bby0N9j2UHIkgqIt+sVgfodC4YghLSMjSZbH0VR/6dMDrYJeKHilKTemt6v6kvzvn3/RrdWtr0GoN/xL+Sex/cPYLUpepx9cz/D46UPU5KXgAQa+NDps1v6J3xP1i2HtaDB0M9aX2deA7SYff//+gUCovMmIK/qfsFcOk+4Y5ZN97XlG6zebqtMbKgeRFi51vnxTQYBUik2rS/Cn6PC8ADR8FGxsRPB82dzfND90gIcshOcYUkfjherBz53odpm6TP8txlwOZ71xmfHHOvq053qFF/MRlS3jP0ELudrf2OeN8DHvp6ZceLe8qKYvWz/7yp0u4dKPfli3CYq0O13Ih71mylJ80tOi10On8wi+F4+LWgDPeJ30msSQt9/vkmHq9/Lvo2b461mP801v3W4xTcs6CbvF9UDdrSt+A8OUbpSh55qAUFXWznBBfdeJ8a4d7ugT5tvxUza3h9m4H7ptTqiG4z0g5dc0X29OcGlhpGFMpQo9ytTS+NViZpNdvU4kWx+LKxNY10kQ1yqGXrhe4/1nvP7E+nd5A92TtaRplbHSqoIdOqtRWti+fkB5/n1+/VvCmz12pG1kpQWsfi1ftlBobm0bpngs16CHkbIwdLnParxtTV3QYRlfJ0KFskH7pdN/YDn+yRuSd7sNH3aO0DYPggk6uWuXrfOc+fa3VTxFVvKaNxHsiHmsXyCLIE5yuOeN3/Jdf8HBL/5M6shjyhxHx9BjB1O0+4NLOnjLLSxwO7ukN4jMbOIcD879KLSi6Pk61Oqm2377n8079PXEEQ7cy7OKEC9nbpet118fxweTafpt69x/Bt8UqGzNQt7aelpc44dn5cqhwf71+qKp/Zf/+a0zcizOUWpl/iBcSXip0pplkatCchoH5c5aUM8I7/dWxAej8WicPL1URFZ9BDJelUwEwTkGqUhgSlydVes95YdXvhh9Gfz/aeFWvgVb4tuLbcv4+wLdutVZv/cUonwBD/6eDlE0aSiKK/uoH3+J1wDE/jMVqY2ysGufN84oIXB0sPzy8ollX/LegY74DgJXJR57sn+VGza0x3DnuIgABFM15LmajjjsNlYj+JEZGbuRYcAMOWxFkPN2w6Wd46xo4gVWQR/X4lyI/R6K/YK0110GzudPRW7Y+UOBGTfNNzHeYT0fiH0taunBpq9HEW8OKSaBGj21L0MqenEmNRWBAWDWAk4CpNoEZJ2tTaPFgbQYj8HxtFilErs3BTRwT8uO1NXQaWfIotchmPkAF5mMBAliEmZiOGVgCG9LgRzpscMAOOwowlT3JhusdazXGSC/hxR3UlmWVwWHpOIKheqONvjyhSiTHIkVUco5bnji8m//zL7PKaT1Vl5I6UE609f+gkr6MZKVyKc7zJRmCahLsdlyA5fdQkRSan9LgnnLEyGSkaKJCJog0wAgvepWBt80+1yKln1bMVtCljfNWDueKLsWwaEbBSfSPTEmVRsUcYYMnEjcjeyCZzBXK9E9BYBXLKjOSpUDR+nEV3TFSUdQaz+ot98QxgXwx0GQ+EEUAKB2qZPkQQ0GqFD8UPFMqyaCHM24BZmSGic9EYMagKizOw9Hz50DMrDLrqqLkTAhplMictiCAx5S3BIUQdeJeLnBy2CNtMfz6cV4u8XKoFZQesbf9YZiIERiHjaNodDW6LgcirX/mPnJIkBGDUpTBhSa0EIr38D5hCIszhCM8URGBqImoWjpvpt1ebu/v3Gl3qJfMnNM+9V+kiRFyROTPHQWOcs1dNW94/ukKMPZBvDi55i5CttdeJz84DLngLqjcdwEZ87bFFR8CIG35OAkDVN6VRDZ7aq67NteYqZ2lpT8oYB2CytoBd6VuAx4WgiAsnuj3WohG+LugzXiQRDeM3XYXlULv4dp5VFYC"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Size4-Regular.Dl5lxZxV.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/assets/KaTeX_Typewriter-Regular.CO6r4hn1.woff2"></head><body><div id="app" data-server-rendered="true"><!--[--><!--[--><!--[--><!----><!----><div class="yun-page-header-gradient" style="--gradient-from:161 196 253;--gradient-to:194 233 251"></div><!----><!----><!----><canvas class="fireworks"></canvas><!--[--><div class="yun-bg"></div><!--]--><div class="yun-page-loading" absolute left-0 right-0 bottom-0 top-0 flex justify="center" items-center z-10 bg="$va-c-bg" data-v-d067c193><div class="spinner" data-v-d067c193></div></div><a href="#" class="back-to-top yun-icon-btn bg-$va-c-bg-soft shadow-md"><div class="size-8" i-ri-arrow-up-s-line></div><svg class="progress-circle-container" viewBox="0 0 100 100"><circle stroke-dasharray="301.59289474462014 301.59289474462014" stroke-dashoffset="301.59289474462014" stroke="currentColor" stroke-width="2" stroke-linecap="round" class="progress-circle" cx="50" cy="50" r="48" fill="none"/></svg></a><!-- TODO --><!-- <YunDock /> --><!--]--><!--[--><!--[--><!-- eslint-disable-next-line vue/component-name-in-template-casing --><meting-js style id="3778678" server="netease" type="playlist" fixed="true"></meting-js><!--]--><!--]--><!----><!--]--><!--[--><div flex="~" class="w-full m-auto justify-center items-start gap-4 mt-12 md:mt-24"><!--[--><!----><main class="yun-main lt-md:w-full" flex="~ center"><!--[--><div class="content w-full md:w-3xl lg:w-2xl xl:w-2xl 2xl:w-4xl" flex="~ col grow" p="lt-md:0"><div class="yun-card flex-center rounded-2 relative" flex="col" min-h="100px" bg="$va-c-bg-light" m="0" style><img width="640" height="360" class="object-cover select-none" h="64 md:sm" w="full" src="https://img.alicdn.com/imgextra/i2/3343836081/O1CN01WEkPZv1un9ZHW0TBS_!!3343836081.jpg" loading="lazy"><!----><!--[--><div class="mt-8 mb-4"><!--[--><header class="post-header" cover="https://img.alicdn.com/imgextra/i2/3343836081/O1CN01WEkPZv1un9ZHW0TBS_!!3343836081.jpg"><h1 p="2" text="2xl center" font="serif black" style="" class="post-title flex-center"><!----><span inline-flex class="leading-none" style="color:#fff">shader入门学习</span></h1></header><!--]--></div><!--[--><!--[--><!--[--><!--[--><!----><!----><!----><div flex="~ center" text="sm" class="flex-col gap-2! post-meta gap-4"><div class="post-time flex items-center gap-4"><span class="posted-time inline-flex-center gap-1" title="发表于2025-03-01 00:00:00"><div class="inline-block" i-ri-calendar-line></div><time class="op-80">2025-03-01</time></span><span class="edited-time inline-flex-center gap-1" title="更新于2025-09-22 17:23:13"><div i-ri-calendar-2-line></div><time class="op-80">2025-09-22</time></span></div><!--[--><!--]--><div class="inline-flex-center gap-4"><div class="inline-flex-center post-counter gap-4"><span class="word-count inline-flex-center gap-1" title="本文字数"><div class="inline-block" i-ri-file-word-line></div><span class="op-80">119.6k</span></span><span class="reading-time inline-flex-center gap-1" title="阅读时长"><div i-ri-timer-line></div><time class="op-80">443m</time></span></div><!----></div></div><!--]--><div class="inline-flex mt-2" text="sm" py="1"><a href="/categories?category=shader" class="transition post-category inline-flex-center text-xs border-$va-c-divider" px-2 h="7" border rounded-full hover="bg-blue-500 text-white"><div m="x-1" inline-flex i-ri-folder-2-line></div><span>shader</span></a><span mx="2"></span><div class="post-tags inline-flex" items="center" gap="1" flex="wrap 1" justify="end"><!--[--><a href="/tags/?tag=shader" class="transition post-tag inline-flex-center text-xs border-$va-c-divider" px-2 h="7" rounded-full border hover="bg-blue-500 text-white"><span>shader</span></a><!--]--></div></div><!--]--><!--]--><!--]--><div p="x-4 b-8" class="sm:px-6 lg:px-12 xl:px-16" w="full"><!--[--><!--]--><!--[--><!-- <Transition appear> --><article class="markdown-body"><!--[--><!----><!----><!--[--><!--]--><!--[--><h1 id="shader开发" tabindex="-1">Shader开发 <a class="header-anchor" href="#shader开发" aria-label="Permalink to &quot;Shader开发&quot;">​</a></h1><h2 id="坐标空间转换" tabindex="-1">坐标空间转换 <a class="header-anchor" href="#坐标空间转换" aria-label="Permalink to &quot;坐标空间转换&quot;">​</a></h2><h3 id="一、坐标空间" tabindex="-1">一、坐标空间 <a class="header-anchor" href="#一、坐标空间" aria-label="Permalink to &quot;一、坐标空间&quot;">​</a></h3><blockquote><p>坐标空间是什么?</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**坐标空间是一个用于描述和定位物体位置的数学概念**。<!--]--></span><!--]--><p>它一般由一个基础参照物（原点）和轴线（相互垂直的轴线）组成。</p><p>常见的坐标空间包括二维平面坐标空间和三维空间 在三维空间中，通常决定一个原点（0,0,0）并</p><p>使用三个坐标轴（通常是x轴、y轴和z轴）来描述点的位置。</p><p>例如，在三维坐标空间中，一个点可以通过其x、y和z坐标来确定其在空间中的位置。</p><blockquote><p>坐标空间的变换</p></blockquote><p>在Shader开发中为了方便我们制作模型，使用模型，渲染模型，也存在很多不同的坐标空间</p><p>比如：模型空间、世界空间、观察空间、裁剪空间、屏幕空间</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->这里的坐标空间的变换主要是指 在渲染管线中的，我们需要将坐标数据，在这几种空间当中进行变换计算（利用矩阵相关知识)<!--]--></span><!--]--><p>举例: 在设计模型时，使用的是模型空间（所有的顶点、法线等等相关数据都是基于模型空间坐标系的） 当我们将模型导入到Unity后，最终能够被我们在屏幕上看到，这里面的就经历了我们看不到的坐标空间变换</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**变换过程：模型空间 → 世界空间 → 观察空间 → 裁剪空间 → 屏幕空间** <!--]--></span><!--]--><hr><h3 id="二、-坐标空间的变换规则" tabindex="-1">二、 坐标空间的变换规则 <a class="header-anchor" href="#二、-坐标空间的变换规则" aria-label="Permalink to &quot;二、 坐标空间的变换规则&quot;">​</a></h3><blockquote><p>坐标空间的组成</p></blockquote><ol><li><strong>坐标原点位置</strong></li><li><strong>3个坐标轴的方向（三维坐标系中）</strong></li></ol><blockquote><p>坐标空间的变换矩阵</p></blockquote><p>坐标空间之间是会存在父子关系的。</p><p>假设一个父坐标空间为 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>F</strong><!--]--></span><!--]-->，子坐标空间为 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->S<!--]--></span><!--]-->。</p><p>已知 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->S<!--]--></span><!--]-->坐标空间的原点位置和3个单位坐标轴（基于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>F</strong><!--]--></span><!--]-->坐标空间的数据表达）</p><p>对于坐标空间转换我们一般会有以下两种需求：</p><ol><li><p>把子坐标空间 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->S<!--]--></span><!--]--> 下的点或向量 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[--><strong>As</strong><!--]--></span><!--]--> 转换到父坐标空间 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->F<!--]--></span><!--]--> 中为 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Af<!--]--></span><!--]--></p></li><li><p>把父坐标空间 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->F<!--]--></span><!--]--> 下的点或向量 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Bf<!--]--></span><!--]--> 转换到子坐标空间 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->S<!--]--></span><!--]-->中为 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->Bs<!--]--></span><!--]--></p></li></ol><p>如果用矩阵来表示的话：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Af<!--]--></span><!--]--> = `Ms-f` <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->As<!--]--></span><!--]--> <code>—— Ms-f</code> 代表从子坐标空间到父坐标空间的变换矩阵<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->Bs<!--]--></span><!--]--> = Mf-s <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Bf<!--]--></span><!--]--> <code>—— Mf-s</code> 是 <code>Ms-f</code> 的逆矩阵（逆矩阵可以进行逆向变换），代表父到子的变换矩阵<p>也就是说我们只要知道 Ms-f 和 Mf-s 的其中一个矩阵，另一个矩阵都可以通过求逆矩阵得到对应的结果</p><blockquote><p>推导 Ms-f ，也就是子坐标空间到父坐标空间的变换矩阵</p></blockquote><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/推导 Ms-f(子坐标空间到父坐标空间的变换矩阵).png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/推导 Ms-f(子坐标空间到父坐标空间的变换矩阵)2.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/推导 Ms-f(子坐标空间到父坐标空间的变换矩阵)3.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/推导 Ms-f(子坐标空间到父坐标空间的变换矩阵)4.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/推导 Ms-f(子坐标空间到父坐标空间的变换矩阵)5.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/推导 Ms-f(子坐标空间到父坐标空间的变换矩阵)6.png" loading="lazy"></div><blockquote><p>总结</p></blockquote><ol><li><p>坐标空间的组成</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**坐标原点位置 和 3个坐标轴的方向（三维坐标系中）** <!--]--></span><!--]--></li><li><p>坐标空间之间的关系</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**大部分坐标空间都是另一个坐标空间的子空间** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**Unity中的坐标空间的变换实际上就是父空间和子空间之间对点或向量进行变换** <!--]--></span><!--]--></li><li><p>坐标空间之间的变换矩阵</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**子到父的变换矩阵： Ms−f =&nbsp;** <!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/推导 Ms-f(子坐标空间到父坐标空间的变换矩阵)7.png" loading="lazy"></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**父到子的变换矩阵： Mf-s = Ms−f −1** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**其中前三列在没有缩放时，使用轴向的单位方向向量** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**存在缩放时可能就不是单位向量了**<!--]--></span><!--]--></li></ol><hr><h3 id="三、模型空间变换" tabindex="-1">三、模型空间变换 <a class="header-anchor" href="#三、模型空间变换" aria-label="Permalink to &quot;三、模型空间变换&quot;">​</a></h3><blockquote><p>模型空间变换意义</p></blockquote><p>模型空间（model space）也被称为</p><p>对象空间（object space）或局部空间（local space）</p><p>它一般指3D模型的局部坐标系，每个模型都有自己独立的坐标空间，</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**模型空间的主要意义是方便我们建模，模型的顶点等数据都是基于 模型空间表达的。** <!--]--></span><!--]--><p>注意：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**在Unity中当模型移动或旋转时，模型空间坐标系也会随着变换， 因为此时的模型坐标空间是世界坐标空间的子空间**<!--]--></span><!--]--><p>在模型空间中，我们一般会有上、下、左、右、前、后 六种方向概念</p><p>Unity使用的是<strong>左手坐标系</strong> 因此模型空间的x、y、z轴，对应的是模型的<strong>右、上、前</strong>三个方向.</p><blockquote><p>如何进行模型空间变换</p></blockquote><p>在进行复合运算时，一定遵守先缩放、后旋转、再平移的规则。</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**认为一开始模型坐标空间和世界坐标空间重合，模型发生缩放、旋转、平移变换时 模型空间下的点和向量也应该发生相同的变换**<!--]--></span><!--]--><p>等式如下：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>相对世界坐标系的位置 = 平移矩阵 * 旋转矩阵 * 缩放矩阵 * 模型空间下的点或向量</strong><!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->其中平移、旋转、缩放矩阵中的具体变换值都是相对于世界空间下的数据<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**使用坐标变换规则进行计算，如果存在缩放，直接用轴向单位向量乘以对应轴缩放因子**<!--]--></span><!--]--></li></ol><hr><h3 id="四、观察空间变换" tabindex="-1">四、观察空间变换 <a class="header-anchor" href="#四、观察空间变换" aria-label="Permalink to &quot;四、观察空间变换&quot;">​</a></h3><blockquote><p>观察空间变换的意义</p></blockquote><p>观察空间（view space）也被成为</p><p>摄像机空间（camera space）</p><p><strong>观察空间</strong>可以认为<strong>是一个特殊的模型空间</strong>，这里的模型指的是场景中的 摄像机，摄像机可以认为是一个非常特殊的模型，它不可见，但是它可以 决定我们在屏幕上看到的内容，因此我们将<strong>摄像机的模型空间</strong>单独提出来 讨论和学习，并将它<strong>称为观察空间</strong>。</p><p><strong>观察空间的主要意义是摄像机决定了渲染的视角和视野</strong></p><p><strong>注意：</strong></p><p>在模型空间中，我们讲过模型空间的x、y、z轴，对应的是模型的右、上、前三个方向。 是因为Unity中的模型空间遵循左手坐标系原则。</p><p>但是在Unity的观察空间中，<strong>观察空间是遵循右手坐标系原则的</strong>，因此它的坐标轴方向有所不同。</p><p>观察空间中的x、y、z轴的正方向 分别对应摄像机的 <strong>右、上、后方</strong>。</p><p>主要原因： 在计算机图形学的OpenGL中，为了统一处理场景中物体的渲染和投影 通常使用右手坐标系，为了方便之后的数据处理，因此在Unity当中 的观察空间，也遵循右手坐标系</p><blockquote><p>观察空间变换指什么</p></blockquote><p>观察空间变换指的主要是<strong>将模型空间中的点或向量从世界空间中变换到观察空间中</strong>。 它是顶点变换的第二步，<strong>就是将 数据 从 世界空间—&gt;观察空间 进行变换</strong> 观察空间变换也可以称为观察变换（view transform）</p><blockquote><p>如何进行观察空间变换</p></blockquote><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**首先进行模型空间转换**<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->得到的结果再进行观察空间变换 变换方式有两种<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**方法一：坐标空间变换规则**<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/坐标变换规则.png" loading="lazy"></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**方法二：逆向变换观察空间** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**让观察空间和世界坐标空间重合**<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**重合时观察空间下的点或向量的数据表达和世界空间下的数据表达式相同的**<!--]--></span><!--]--></li></ol><h3 id="五、齐次裁剪空间" tabindex="-1">五、齐次裁剪空间 <a class="header-anchor" href="#五、齐次裁剪空间" aria-label="Permalink to &quot;五、齐次裁剪空间&quot;">​</a></h3><blockquote><p>视锥体</p></blockquote><p>摄像机的<strong>视锥体是在三维空间中表示摄像机可见区域的虚拟体积</strong>，它类似一个<strong>六面体的形状</strong>， 根据摄像机的属性和投影方式而定。</p><p><strong>视锥体定义了摄像机在场景中能够看到的物体区域，超出这个区域的物体将在渲染时被裁减掉， 从而提高渲染性能。</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/正交透视.png" loading="lazy"></div><p>视锥体主要包含几种重要部分：</p><p><strong>远近裁剪平面</strong></p><p><strong>左、右、上、下裁剪平面</strong></p><p><strong>透视投影中，视锥体类似一个金字塔形状，远裁剪面比近裁剪面大，所以产生透视效果</strong></p><p><strong>正交投影中，视锥体类似于长方体的形状，远近裁剪平面大小一致，不会产生透视效果</strong></p><blockquote><p>齐次裁剪空间</p></blockquote><p><strong>裁剪空间也被称为 齐次裁剪空间</strong></p><p><strong>齐次裁剪空间</strong> （裁剪空间）<strong>是一个非常特殊的坐标空间</strong></p><p>齐次裁剪空间 是一个三维空间，<strong>是在计算机图形学中用于在图形渲染过程中进行裁剪和投影的。 它的坐标范围为(-1,-1,-1)到（1,1,1），超出这个范围的坐标在渲染时会被裁减掉，只会保留范围 内的坐标。</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/齐次裁剪空间.png" loading="lazy"></div><p><strong>齐次裁剪空间是通过将摄像机的视锥体投影到一个规范化的立方体而转换来的。 这个立方体就是齐次裁剪空间。</strong></p><h4 id="_1-正交投影" tabindex="-1">1. 正交投影 <a class="header-anchor" href="#_1-正交投影" aria-label="Permalink to &quot;1. 正交投影&quot;">​</a></h4><blockquote><p>目标</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将摄像机视锥体的 正交投影 空间 转换到 齐次坐标裁剪空间 时的 **变换矩阵**<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/正交裁剪.png" loading="lazy"></div><p>可以将其分成两步来完成</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**将视锥体中心位移到观察空间原点中心** <!--]--></span><!--]--></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将长方体视锥体的xyz坐标范围映射到(-1,1)长宽高为2的正方体中<!--]--></span><!--]--></strong></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/正交裁剪2.png" loading="lazy"></div><blockquote><p>Unity中正交投影重要参数</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->Projection：该参数为Orthographic时，为正交摄像机 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Size：视锥体竖直方向上高度的一半 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->Clipping Planes：裁剪平面 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Near：近裁剪面离摄像机的距离 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Far：远裁剪面离摄像机的距离<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/unity正交参数.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/unity正交参数2.png" loading="lazy"></div><p>利用已知参数，获取到远近裁剪面的高度</p><p>已知：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Size：视锥体竖直方向上高度的一半 <!--]--></span><!--]--><p>可得：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->近裁剪面高 = `2 * Size` <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->远裁剪面高 = `2 * Size`<!--]--></span><!--]--><p>远近裁剪面的宽通过摄像机参数得到Game窗口的宽高比</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/unity正交参数3.png" loading="lazy"></div><p>Aspect = <code>宽 : 高 = 宽 / 高</code></p><p>因此可以得到</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->近裁剪面宽 = 远裁剪面宽 = Aspect * 高 = Aspect * 2 * Size<!--]--></span><!--]--><blockquote><p>正交投影变换矩阵</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**第一步：将视锥体中心位移到观察空间原点中心**<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/正交投影变换矩阵.png" loading="lazy"></div><p>想要从图一变换到图二</p><p>我们只需要对视锥体进行Z方向的平移 X、Y方向是不需要变换的。</p><p>因此第一步的变换矩阵的结构一定是一个平移矩阵</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{matrix} 1 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; 1 &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 1 &amp; Z\\ 0 &amp; 0 &amp; 0 &amp; 1 \end{matrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.8em;vertical-align:-2.15em"></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65em"><span style="top:-4.81em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.07153em">Z</span></span></span><span style="top:-1.21em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15em"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>我们只需要求出该平移变换矩阵中Z应该平移多少即可</p><p>我们已知远近裁剪面离摄像机的距离为 Near 和 Far</p><p>而观察空间中Z方向是摄像机后方</p><p>因此可知 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>视锥体中心点的 Z 坐标为</strong><!--]--></span><!--]--></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mo stretchy="false">(</mo><mo>−</mo><mi>𝑁</mi><mi>𝑒</mi><mi>𝑎</mi><mi>𝑟</mi><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mo>−</mo><mi>𝐹</mi><mi>𝑎</mi><mi>𝑟</mi><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{(−𝑁𝑒𝑎𝑟) +(−𝐹𝑎𝑟)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.113em;vertical-align:-.686em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222em"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>知道了视锥体中心点的Z坐标，那么我们只需要将视锥体平移 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><code>-((−𝑁𝑒𝑎𝑟) +(−𝐹𝑎𝑟) /2)</code><!--]--></span><!--]--> 个单位即可</p><p>所以，该平移矩阵为:</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mi>𝐹</mi><mi>𝑎</mi><mi>𝑟</mi><mo>+</mo><mi>𝑁</mi><mi>𝑒</mi><mi>𝑎</mi><mi>𝑟</mi></mrow><mn>2</mn></mfrac></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{matrix} 1 &amp; 0 &amp; 0 &amp; 0\\ 0 &amp; 1 &amp; 0 &amp; 0\\ 0 &amp; 0 &amp; 1 &amp; \frac{𝐹𝑎𝑟+𝑁𝑒𝑎𝑟 }{2}\\ 0 &amp; 0 &amp; 0 &amp; 1 \end{matrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.8323em;vertical-align:-2.1662em"></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6662em"><span style="top:-4.8262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.6262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.3938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.1938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1662em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6662em"><span style="top:-4.8262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.6262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.3938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.1938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1662em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6662em"><span style="top:-4.8262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.6262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.3938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.1938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1662em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6662em"><span style="top:-4.8262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.6262em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.3938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8723em"><span style="top:-2.655em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:.10903em">N</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:.02778em">r</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.345em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.1938em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1662em"><span></span></span></span></span></span></span></span></span></span></span></span></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**第二步：将长方体视锥体的xyz坐标范围映射到(-1,1)长宽高为2的正方体中**<!--]--></span><!--]--><p>可以得到观察空间中的xyz和齐次坐标系中xyz的关系如下图:</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/观察空间中的xyz和齐次坐标系中xyz的关系.png" loading="lazy"></div><p>根据这些关系图，我们可以得到一些公式:</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/观察空间中的xyz和齐次坐标系中xyz的关系2.png" loading="lazy"></div><p>因此，根据我们的推论，这一步的变换其实就是一个缩放变换，因此，我们可以根据刚才推导的公式</p><p>获得目标缩放矩阵</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/目标缩放矩阵.png" loading="lazy"></div><blockquote><p>正交投影变换矩阵</p></blockquote><p>我们现在得到了两步的对应平移平移矩阵和缩放矩阵，我们将其进行乘法计算后，便可以得到</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**将摄像机视锥体的 正交投影 空间 转换到 齐次坐标裁剪空间 时的 变换矩阵**<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/正交投影 空间 转换到 齐次坐标裁剪空间 时的 变换矩阵.png" loading="lazy"></div><hr><h4 id="_2-透视投影" tabindex="-1">2. 透视投影 <a class="header-anchor" href="#_2-透视投影" aria-label="Permalink to &quot;2. 透视投影&quot;">​</a></h4><blockquote><p>目标</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将摄像机视锥体的 透视投影 转换到 齐次坐标系 时的 **变换矩阵**<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/透视投影 转换到 齐次坐标系 时的 变换矩阵.png" loading="lazy"></div><blockquote><p>步骤</p></blockquote><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将透视视锥体变成一个长方体 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:gray" data-v-59b6df29><!--[-->将该长方体进行正交投影变换的操作 <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将视锥体中心位移到观察空间原点中心 <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将长方体视锥体的xyz坐标范围映射到(-1,1)长宽高为2的正方体中<!--]--></span><!--]--></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/透视投影步骤.png" loading="lazy"></div><blockquote><p>Unity中透视投影重要参数</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->Projection：该参数为Perspective时，为透视摄像机 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->FOV（Field of View）：决定视锥开口角度 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->Clipping Planes：裁剪平面 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Near：近裁剪面离摄像机的距离 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Far：远裁剪面离摄像机的距离<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/Unity中透视投影重要参数.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/Unity中透视投影重要参数2.png" loading="lazy"></div><p>利用已知参数，获取到远近裁剪面的高度</p><p>已知：</p><p><strong>Near：近裁剪面离摄像机的距离</strong></p><p><strong>Far：远裁剪面离摄像机的距离</strong></p><p><strong>FOV（Field of View）：决定视锥开口角度</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->可得： <!--]--></span><!--]--><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>近裁剪面高</mtext><mo>=</mo><mn>2</mn><mo>∗</mo><mi>N</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo>∗</mo><mi>t</mi><mi>a</mi><mi>n</mi><mfrac><mrow><mo stretchy="false">(</mo><mi>F</mi><mi>O</mi><mi>V</mi><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\text{近裁剪面高} = 2 * Near * tan\frac{ (FOV)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">近裁剪面高</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-.686em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">FO</span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>远裁剪面高</mtext><mo>=</mo><mn>2</mn><mo>∗</mo><mi>F</mi><mi>a</mi><mi>r</mi><mo>∗</mo><mi>t</mi><mi>a</mi><mi>n</mi><mfrac><mrow><mo stretchy="false">(</mo><mi>F</mi><mi>O</mi><mi>V</mi><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\text{远裁剪面高} = 2 * Far * tan\frac{ (FOV)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">远裁剪面高</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-.686em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">FO</span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>近裁剪面宽</mtext><mo>=</mo><mi>A</mi><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>∗</mo><mtext>近裁剪面高</mtext><mo>=</mo><mi>A</mi><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>∗</mo><mn>2</mn><mo>∗</mo><mi>N</mi><mi>e</mi><mi>a</mi><mi>r</mi><mo>∗</mo><mi>t</mi><mi>a</mi><mi>n</mi><mfrac><mrow><mo stretchy="false">(</mo><mi>F</mi><mi>O</mi><mi>V</mi><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\text{近裁剪面宽} = Aspect *\text{近裁剪面高} = Aspect * 2 * Near *tan\frac{ (FOV)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">近裁剪面宽</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8778em;vertical-align:-.1944em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">近裁剪面高</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8778em;vertical-align:-.1944em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-.686em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">FO</span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>远裁剪面宽</mtext><mo>=</mo><mi>A</mi><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>∗</mo><mtext>远裁剪面高</mtext><mo>=</mo><mi>A</mi><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo>∗</mo><mn>2</mn><mo>∗</mo><mi>F</mi><mi>a</mi><mi>r</mi><mo>∗</mo><mi>t</mi><mi>a</mi><mi>n</mi><mfrac><mrow><mo stretchy="false">(</mo><mi>F</mi><mi>O</mi><mi>V</mi><mo stretchy="false">)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\text{远裁剪面宽} = Aspect *\text{远裁剪面高} = Aspect * 2 * Far *tan\frac{ (FOV)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">远裁剪面宽</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8778em;vertical-align:-.1944em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">远裁剪面高</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8778em;vertical-align:-.1944em"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6444em"></span><span class="mord">2</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-.686em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">FO</span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.686em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><blockquote><p>透视投影变换矩阵</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**第一步：将透视视锥体变成一个长方体**<!--]--></span><!--]--><p>我们需要满足3个特性</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->近裁剪面上的所有点保持不变<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->远裁剪面的z值不变，远裁剪面的中心点不变 <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->远裁剪面宽高映射成近裁剪面的宽高<!--]--></span><!--]--></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/透视投影变换矩阵.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/透视投影变换矩阵2.png" loading="lazy"></div><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->近裁剪面上的所有点保持不变<!--]--></span><!--]--><p>近裁剪面上的点 (x,y,Near,1) 变换后还是 (x,y,Near,1)</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/近裁剪面上的所有点保持不变.png" loading="lazy"></div><p>其中，x和y等于0时，相当于就是近裁剪面的中心点，也满足下面的等式</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/近裁剪面上的所有点保持不变2.png" loading="lazy"></div></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->远裁剪面的z值不变，远裁剪面的中心点不变 <!--]--></span><!--]--><p>相当于Z 轴与远裁剪面的</p><p>交点（0,0,Far,1）变换后仍为（0,0,Far,1）</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/将透视视锥体变成一个长方体3.png" loading="lazy"></div></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->远裁剪面宽高映射成近裁剪面的宽高<!--]--></span><!--]--><p>这一步相对来说复杂一些，我们需要利用之前学习的知识点 来进行一些推导</p><p><strong>回顾知识点</strong>：</p><ol><li>视锥体内顶点和原点连接，在近裁剪面的交点为投影点</li><li>相似三角形的对应边成比例<code>a/a’= b/b’= c/c’</code></li></ol></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/远裁剪面宽高映射成近裁剪面的宽高.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/远裁剪面宽高映射成近裁剪面的宽高2.png" loading="lazy"></div><p>通过此推导我们发现，视锥体内的所有点的x、y坐标 都经过了同样的缩放，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>缩放因子为：</strong> <code>−𝑁ear/𝑍</code><!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->其中 Near是近裁剪面离摄像机的距离，Z为视锥体中点的Z坐标<!--]--></span><!--]--><p>因此我们已推导出：</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/远裁剪面宽高映射成近裁剪面的宽高3.png" loading="lazy"></div><p>现在我们得到了三个和变换矩阵有关的等式</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/了三个和变换矩阵有关的等式.png" loading="lazy"></div><p><strong>补充知识点：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->四维齐次坐标中 乘以或者除以一个非零的数（标量）， 所映射的三维坐标始终是同一个坐标<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/df0a491a49563bd33613ccb06baae5e0.png" loading="lazy"></div><p>我们只需要推导出该变换矩阵的第三行的构成，就能够得到我们的目标：</p><p>将透视视锥体变成一个长方体的变换矩阵</p><p>因此，我们可以假设</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/d38b27800029b6ff1dd4c26bef182231.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/d3a8b8fd6c32b197edcbe6999bfd5b39.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/6ddef20f2443818361eda7ad0aee3126.png" loading="lazy"></div><p>通过</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`-aNear + b = -Near²`<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`-aFar + b = -Far²` <!--]--></span><!--]--><p>可以推导出 a、b的值</p><p><code>-aNaer + aFar = Far² - Near² =&gt; a(Far – Near) = (Far + Near)(Far - Near) =&gt;</code><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><code>a = Far + Near</code><!--]--></span><!--]--></p><p><code>-(Far + Near)Near + b = -Near² =&gt; -FarNear – Near² + b = -Near²=&gt;</code><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><code>b = Far * Near</code><!--]--></span><!--]--></p><p>因此变换矩阵为</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/d28ec1e5a06d1be1fe6ef75256ebafe3.png" loading="lazy"></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**第二步：将视锥体中心位移到观察空间原点中心**<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/eec9b1159a4bdf670d7ab98a353fae89.png" loading="lazy"></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**第三步：将长方体视锥体的xyz坐标范围映射到(-1,1)长宽高为2的正方体中**<!--]--></span><!--]--><p>我们可以得到观察空间中的xyz和齐次坐标系中xyz的关系如下图</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/f784dfde456cfa03c61b6b1c4342f5df.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/a64d7b4f18f14e25979881bc2cc524c9.png" loading="lazy"></div><p>因此，根据我们的推论，这一步的变换其实就是一个缩放变换，因此，我们可以根据刚才推导的公式</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/6bef041905037f0993cb01a0ae6b4cd0.png" loading="lazy"></div><p>我们现在得到了三个变换矩阵，我们将其进行乘法计算后，便可以得到</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**将摄像机视锥体的 透视投影 空间 转换到 齐次坐标裁剪空间 时的 变换矩阵**<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/53d727b0fffd87cf7bb4851fa97a4396.png" loading="lazy"></div><h4 id="_3-裁剪空间变换的意义" tabindex="-1">3.裁剪空间变换的意义 <a class="header-anchor" href="#_3-裁剪空间变换的意义" aria-label="Permalink to &quot;3.裁剪空间变换的意义&quot;">​</a></h4><blockquote><p>裁剪空间变换的意义</p></blockquote><p>我们之所以要将观察空间中的顶点等信息变换到裁剪空间中</p><p>主要意义，其实我们一开始就提到过</p><p><strong>是为了让我们可以更通用、便捷的来进行裁剪工作。</strong></p><p>因为如果直接使用视锥体定义的空间来进行裁剪，那不同的视锥体就需要不同的处理过程，</p><p>比如正交摄像机的 Size、Near、Far等参数，透视摄像机中的FOV、Near、Far等参数</p><p>他们决定了视锥体的体积大小会各不相同，而且对于透视投影的视锥体来说，判断顶点是否在 其范围内相对较麻烦。</p><p>**因此前辈们就制定了裁剪空间这一规则，让我们可以更容易的完成裁剪工作， **</p><p><strong>这也是该变换的意义所在</strong></p><blockquote><p>如何决定顶点是否被裁剪</p></blockquote><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/555df39aa619240b37820a22647da853.png" loading="lazy"></div><hr><h3 id="六、屏幕空间变换" tabindex="-1">六、屏幕空间变换 <a class="header-anchor" href="#六、屏幕空间变换" aria-label="Permalink to &quot;六、屏幕空间变换&quot;">​</a></h3><blockquote><p>屏幕空间的意义</p></blockquote><p>屏幕空间（Screen Space）是计算机图形学中的概念</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->指渲染结果在屏幕上显示的坐标空间 <!--]--></span><!--]--><p>三维坐标经过一系列转换后会转换到最终的二维屏幕坐标空间中</p><p>使得图像可以在屏幕上进行展示。</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->屏幕空间的主要意义是屏幕空间中对应的位置信息是真正的像素位置，而不是虚拟的三维坐标。 有了相对屏幕空间的坐标位置，才能准确的控制屏幕上像素点的显示效果<!--]--></span><!--]--><p>在Unity中</p><p>屏幕空间左下角为像素坐标（0,0）点</p><p>屏幕空间右上角为像素坐标（分辨率宽，分辨率高）</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/5dcd6de833170660bb48128e61b40e66.png" loading="lazy"></div><blockquote><p>屏幕空间变换指什么</p></blockquote><p>屏幕空间变换指的主要是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将模型空间中的点或向量从裁剪空间中变换到屏幕空间中 它是顶点变换的第四步，就是将 数据 从裁剪空间 → 屏幕空间 进行变换<!--]--></span><!--]--></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/f93a5367898cdab6830f31d004cc46c9.png" loading="lazy"></div><p>从图中我们可以看到，主要是将<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->三维坐标(x,y,z)中的x,y分量映射到屏幕上，而z分量一般会被用于 深度缓冲<!--]--></span><!--]-->，之后用于深度测试等（决定是否被遮挡等）</p><blockquote><p>如何进行屏幕空间变换</p></blockquote><p>屏幕空间变换，可以说是所有空间变换中最简单的一步，我们只需要将齐次裁剪空间（xyz范围 在-1到1之间，长度为2的正方体）中的顶点映射到屏幕坐标即可。我们只需要找到他们的映射关 系即可。</p><p>首先我们通过上节课知道，正交投影中w分量为1，透视投影中w分量可能为任一数，我们首先 需要进行透视除法，保证裁剪空间中点的数据表达在齐次裁剪空间的范围内。 即，<strong>假设 裁剪空间中的点为（Xclip, Yclip, Zclip, Wclip）</strong></p><p><strong>进行透视除法：</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/5d3437811917c592eb10ec0ab02545c1.png" loading="lazy"></div><p>对于正交投影来说 W 值为1，所以除以1后，xyz也不会改变</p><p>对于透视投影来说 W 值为任一值，所以除以W后，XYZ的范围将在-1到1之间，W为1</p><p>接着我们来找到齐次裁剪空间和屏幕空间的映射关系</p><p>主要就是找到直线的斜率</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/1ef47586c4b3bba3b3ac83453ea6177b.png" loading="lazy"></div><p>那么裁剪空间中的Z和W应该如何处理呢？</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/b2abddf8de7d74a760366602b0b33e55.png" loading="lazy"></div><p>举例：</p><p>首先我们还是之前用于举例的顶点来说明</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->模型空间<!--]--></span><!--]-->下的顶点坐标为（<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->0.63, 0.84, -0.04）<!--]--></span><!--]--><p>当模型进行2倍缩放，又进行（0,45,0）的旋转，然后再进行(5,0,5)的平移后</p><p>该顶点的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->世界空间<!--]--></span><!--]-->下的坐标为<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->（5.834, 1.68, 4.052）<!--]--></span><!--]--></p><p>摄像机的轴向和坐标为</p><p>转换到<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:orange" data-v-59b6df29><!--[-->观察空间<!--]--></span><!--]-->后的坐标为<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:orange" data-v-59b6df29><!--[-->（4.562, 0.679, -7.722, 1）<!--]--></span><!--]--></p><p>转换到裁剪空间后的坐标为</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->正交摄像机：（0.513225, 0.1358, 0.492284, 1） <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->透视摄像机：（4.446, 1.176, 7.2142, 7.722)<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/坐标变换/88bcf881039b7e20850dd60ed9d9e94f.png" loading="lazy"></div><p>假设屏幕分辨率为 1920*1080</p><p>那么只需要将数据带入公式中计算即可</p><p>屏幕坐标（正交摄像机）：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->（1452.696, 613.332） <!--]--></span><!--]--></p><p>屏幕坐标（透视摄像机）：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->（1512.7272, 622.237）<!--]--></span><!--]--></p><hr><h2 id="shaderlab语法" tabindex="-1">ShaderLab语法 <a class="header-anchor" href="#shaderlab语法" aria-label="Permalink to &quot;ShaderLab语法&quot;">​</a></h2><h3 id="一、unity-shader-和-shader的区别" tabindex="-1">一、Unity Shader 和 Shader的区别 <a class="header-anchor" href="#一、unity-shader-和-shader的区别" aria-label="Permalink to &quot;一、Unity Shader 和 Shader的区别&quot;">​</a></h3><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader是一个更通用的概念，用于描述图形渲染程序中的着色器程序而Unity Shader是特指在Unity中使用的着色器</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">你可以认为Unity Shader是对Shader的一种封装</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它是对底层图形渲染技术的封装，它提供了一种叫做ShaderLab的语言</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">来让我们更加轻松的编写和管理着色器</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="二、unity中的shader" tabindex="-1">二、Unity中的Shader <a class="header-anchor" href="#二、unity中的shader" aria-label="Permalink to &quot;二、Unity中的Shader&quot;">​</a></h3><ol><li><strong>Standard Surface Shader</strong>（标准曲面着色器） 包含标准光照模型的表面着色器模板</li><li><strong>Unlit Shader</strong> 不包含光照的基本顶点/片元着色器</li><li><strong>Image Effect Shader</strong> 用于实现屏幕后处理效果的基本模板</li><li><strong>Compute Shader</strong> 利用GPU并行计算一些和常规渲染流水线无关的内容</li><li><strong>Ray Tracing Shader</strong> 用于实现光线追踪效果的着色器</li></ol><h3 id="三、介绍shaderlab" tabindex="-1">三、介绍ShaderLab <a class="header-anchor" href="#三、介绍shaderlab" aria-label="Permalink to &quot;三、介绍ShaderLab&quot;">​</a></h3><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Unity Shader是对Shader的一种封装</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它是对底层图形渲染技术的封装，它提供了一种叫做ShaderLab的语言</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">来让我们更加轻松的编写和管理着色器</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ShaderLab其实就是Unity自定义的一种语法规则</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">是用于在Untiy中编写和管理着色器的专门的语言</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它提供了一种结构化的方式来描述Unity着色器的各个部分</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">从而让我们可以更轻松的创建和管理着色器</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">总而言之：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">无论我们编写哪种类型的Shader，或是选择哪种语言去编写Shader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在Unity中总会通过ShaderLab语言对其进行包装和组织</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它是Unity自定义的一种语法规则</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>ShaderLab 代码构成</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> ShaderLab主要由4个部分组成</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Shader的名字</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Shader的属性</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">n个子着色器</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.备用的Shader</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 第一部分</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"着色器名字"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">     //第二部分</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">         //材质面板上可以看到的属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">     //第三部分</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">         //顶点-片段着色器 或 表面着色器 或 固定函数着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">         //更加精简的版本</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">         //目的是适配旧设备</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">     ....</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.可以有n个SubShader代码块</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">     //第四部分</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"备用的Shader"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="四、shader属性" tabindex="-1">四、Shader属性 <a class="header-anchor" href="#四、shader属性" aria-label="Permalink to &quot;四、Shader属性&quot;">​</a></h3><p>Shader的属性具有两个<strong>特点</strong></p><ol><li>可以在材质面板被编辑</li><li>可以在后续当作输入变量提供给所有子着色器使用</li></ol><blockquote><p>语法</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, type) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> defaultValue[{ options}]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_Name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 属性名字，规则是需要在前面加一个下划线，方便在之后获取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Display Name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 材质面板上显示的名字</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">属性的类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">defaultValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">将Shader指定给材质的时候初始化的默认值</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>数值类型属性</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.整形</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Int) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> number</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.浮点型</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> number</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.范围浮点型</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(min, max)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> number</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：Unity </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Shader中的数值类型属性基本都是浮点型</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(Float)数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">     虽然提供了整数</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(Int)，但是编译时最终都会转换为浮点型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     因此我们更多的使用的还是Float类型</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>颜色和向量类型属性</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (number1, number2, number3, number4)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：颜色值中的RGBA的取值范围是 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">~</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> （映射0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">~</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Vector) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (number1, number2, number3, number4)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：向量值中的XYZW的取值范围没有限制</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>贴图纹理类型属性</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 纹理（最常用的纹理，漫反射贴图、法线贴图都属于2D纹理）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "defaulttexture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{ }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">2.2DArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 纹理（纹理数组，允许在纹理中存储多层图像数据，每层看做一个2D图像，一般使用脚本创建，较少使用，了解即可）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">2DArray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "defaulttexture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{ }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Cube map texture纹理（立方体纹理，由前后左右上下6张有联系的2D贴图拼成的立方体，比如天空盒和反射探针）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "defaulttexture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{ }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4.3D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">纹理（一般使用脚本创建，极少使用，了解即可）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Display Name"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "defaulttexture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{ }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.关于defaulttexture默认值取值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  不写</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 默认贴图为空</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       white</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">默认白色贴图（RGBA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       black</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: 默认黑色贴图（</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       gray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: 默认灰色贴图（</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       bump</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: 默认凸贴图（</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）,一般用于法线贴图默认贴图</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       red：默认红色贴图（</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RGBA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.关于默认值后面的 { } ,固定写法（老版本中括号内可以控制固定函数纹理坐标的生成，但是新版本中没有该功能了）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="五、subshader" tabindex="-1">五、SubShader <a class="header-anchor" href="#五、subshader" aria-label="Permalink to &quot;五、SubShader&quot;">​</a></h3><blockquote><p><strong>作用</strong></p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">每一个Shader中都会包含至少一个SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">当Unity想要显示一个物体的时候</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">就会在Shader文件中去检测这些SubShader语句块</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">然后选择第一个能够在当前显卡运行的SubShader进行执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">因此在一个Shader当中实现一些高级效果时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">为了避免在在某些设备上无法执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可能会存在多个SubShader语句块，用于适配这些低端设备</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">SubShader当中包含最终的渲染相关代码，决定了最终的渲染效果</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>构成</p></blockquote><pre><code>SubShader
{
    1.渲染标签
    Tags{ "标签名1" = "标签值1" "标签名2" = "标签值2".....}

    2.渲染状态.....

    3.渲染通道
    Pass
    {
        第一个渲染通道fixed3 color = UNITY_LIGHTMODEL_AMBIENT.rgb * albedo + (lambertColor + specularColor)*atten;
    }
    Pass
    {
        第二个渲染通道
    }
	.............
}

注意：
在SubShader中每定义一个渲染通道Pass，就会让物体执行一次渲染
n个Pass，就会有n次渲染，在实现一些复杂渲染效果时需要使用多个Pass进行组合实现
但是我们要尽量减少它的数量，更多的Pass会增加性能消耗
</code></pre><blockquote><p>片元</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//在渲染管线中，片元是指在光栅化阶段生成的像素或像素片段</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//片元是渲染管线中进行像素级别操作和计算的基本单位</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//每个片元代表了屏幕上的一个像素，并且具有位置信息和与之相关的属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//比如：颜色、深度值、法线等等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="六、tags-渲染标签" tabindex="-1">六、Tags (渲染标签) <a class="header-anchor" href="#六、tags-渲染标签" aria-label="Permalink to &quot;六、Tags (渲染标签)&quot;">​</a></h3><blockquote><p>渲染标签的语法结构</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"标签名1"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值1"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签名2"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值2"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签名2"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值2"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">......</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">渲染标签是通过键值对的形式进行声明的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">并且没有数量限制，可以使用任意多个标签</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>渲染队列Queue</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：确定物体的渲染顺序</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">常用Unity预先定义好的渲染队列标签值：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(背景)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">队列号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">最早被渲染的物体的队列，一般用来渲染天空盒或者背景</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Background"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Geometry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(几何)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">队列号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不透明的几何体通常使用该队列，当没有声明渲染队列时，Unity会默认使用这个队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Geometry"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">AlphaTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(透明测试)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">队列号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2450</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">有透明通道的，需要进行Alpha测试的几何体会使用该队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">当所有Geometry队列实体绘制完后再绘制AlphaTest队列，效率更高</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "AlphaTest"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Transparent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(透明的)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">队列号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">该队列中几何体按照由远到近的顺序进行绘制，半透明物体的渲染队列，所有进行透明混合的几何体都应该使用该队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">比如：玻璃材质，粒子特效等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Overlay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(覆盖)(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">队列号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用是放在最后渲染的队列，于叠加渲染的效果，比如镜头光晕等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Overlay"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.自定义队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">基于Unity预先定义好的这些渲染队列标签来进行加减运算来定义自己的渲染队列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">比如：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Geometry+1"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">代表的队列号就是 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2001</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Transparent-1"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">代表的队列号就是 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2999</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">自定义队列在一些特殊情况下，特别有用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">比如 一些水的渲染 想要在不透明物体之后，半透明物体之前进行渲染，就可以自定义</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：自定义队列只能基于预先定义好的各类型进行计算，不能在Shader中直接赋值数字</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果实在想要直接赋值数字，可以在材质面板中进行设置</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>渲染类型RenderType</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">对着色器进行分类，之后可以用于着色器替换功能</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">摄像机上有对应的API，可以指定这个渲染类型来替换成别的着色器</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">常用Unity预先定义好的渲染类型标签值：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Opaque</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(不透明的)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于普通Shader，比如：不透明、自发光、反射等</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Transparent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(透明的)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于半透明Shader，比如：透明、粒子</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TransparentCutout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(透明切割)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于透明测试Shader，比如：植物叶子</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Background</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(背景)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于天空盒Shader</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Overlay</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(覆盖)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于GUI纹理、Halo（光环）、Flare（光晕）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">了解即可</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.TreeOpaque</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于地形系统中的树干</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.TreeTransparentCutout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于地形系统中的树叶</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.TreeBillboard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于地形系统中的Billboarded树</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Grass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于地形系统中的草</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.GrassBillboard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于地形系统中的Billboarded草</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>禁用批处理</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">当使用批处理时，模型会被变换到世界空间中，模型空间会被丢弃</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这可能会导致某些使用模型空间顶点数据的Shader最终无法实现想要的结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以通过开启禁用批处理来解决该问题</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">总是禁用批处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"DisableBatching"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "True"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不禁用批处理（默认值）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"DisableBatching"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "False"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">了解即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">LOD效果激活时才会禁用批处理，主要用于地形系统上的树</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"DisableBatching"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "LODFading"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>禁用阴影投影</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">控制该SubShader的物体是否会投射阴影</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不投射阴影</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForceNoShadowCasting"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "True"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">投射阴影（默认值）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForceNoShadowCasting"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "False"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">English</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">--</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Force</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:强制</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shadow：阴影</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Casting：投射</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>忽略投影机</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">物体是否受到Projector（投影机）的投射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Projector是Unity中的一个功能</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">忽略Projector（一般半透明Shader需要开启该标签）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "True"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不忽略Projector（默认值）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "False"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>其他标签</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.是否用于精灵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 想要将该SubShader用于Sprite时，将该标签设置为False</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"CanUseSpriteAtlas"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "False"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.预览类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 材质在预览窗口默认为球形，如果想要改变为平面或天空盒</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 只需要改变预览标签即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 平面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"PreviewType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Panel"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 天空盒</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"PreviewType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "SkyBox"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="七、渲染状态" tabindex="-1">七、渲染状态 <a class="header-anchor" href="#七、渲染状态" aria-label="Permalink to &quot;七、渲染状态&quot;">​</a></h3><blockquote><p>语法结构</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">渲染状态 状态类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">渲染状态是通过 渲染状态关键词</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">空格 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 状态类型 决定的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果存在多个渲染状态</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以通过空行隔开</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_1-剔除方式" tabindex="-1">1.剔除方式 <a class="header-anchor" href="#_1-剔除方式" aria-label="Permalink to &quot;1.剔除方式&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">设置多边形的剔除方式，有背面剔除、正面剔除、不剔除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">所谓的剔除，就是不渲染，背面剔除就是背面不渲染，正面剔除就是正面不渲染，不剔除就是都渲染</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Cull Back 背面剔除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Cull Front    正面剔除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Cull Off 不剔除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不设置的话，默认为背面剔除</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般情况下，我们需要两面渲染时，会设置为不剔除</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_2-深度缓冲" tabindex="-1">2.<strong>深度缓冲</strong> <a class="header-anchor" href="#_2-深度缓冲" aria-label="Permalink to &quot;2.**深度缓冲**&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">是否写入深度缓冲</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">深度缓冲（Depth Buffer）：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">深度缓冲是一个与屏幕像素对应的缓冲区，用于存储每个像素的深度值（距离相机的距离）。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在渲染场景之前，深度缓冲被初始化为最大深度值，表示所有像素都在相机之外。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">最后留在深度缓冲中的信息会被渲染</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZWrite On 	写入深度缓冲</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZWrite Off  不写入深度缓冲</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不设置的话，默认为写入</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般情况下，我们在做透明等特殊效果时，会设置为不写入</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_3-深度测试" tabindex="-1">3.<strong>深度测试</strong> <a class="header-anchor" href="#_3-深度测试" aria-label="Permalink to &quot;3.**深度测试**&quot;">​</a></h4><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/深度测试图.png" loading="lazy"></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">设置深度测试的对比方式</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">深度测试的主要目的是确保在渲染时，像素按照正确的深度（距离相机的距离）顺序进行绘制，</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">从而创建正确的遮挡关系和透视效果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在渲染场景之前，深度缓冲被初始化为最大深度值，表示所有像素都在相机之外。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在渲染过程中，对于每个像素，深度测试会将当前像素的深度值与深度缓冲中对应位置的值进行比较。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般情况下</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.如果当前像素的深度值小于深度缓冲中的值，说明当前像素在其他物体之前，它会被绘制，并更新深度缓冲。</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.如果当前像素的深度值大于等于深度缓冲中的值，说明当前像素在其他物体之后，它会被丢弃，不会被绘制，并保持深度缓冲不变。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest Less      小于当前深度缓冲中的值，就通过测试，写入到深度缓冲中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest Greater 	大于当前深度缓冲中的值，就通过测试，写入到深度缓冲中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest LEqual 	小于等于当前深度缓冲中的值，就通过测试，写入到深度缓冲中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest GEqual 	大于等于当前深度缓冲中的值，就通过测试，写入到深度缓冲中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest Equal 	等于当前深度缓冲中的值，就通过测试，写入到深度缓冲中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest NotEqual 	不等于当前深度缓冲中的值，就通过测试，写入到深度缓冲中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest Always 	始终通过深度测试写入深度缓冲中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不设置的话，默认为LEqual 小于等于</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般情况下，我们只有在实现一些特殊效果时才会区修改深度测试方式，比如透明物体渲染会修改为Less，描边效果会修改为Greater等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/深度测试举例.png" loading="lazy"></div><h4 id="_4-混合方式" tabindex="-1">4.混合方式 <a class="header-anchor" href="#_4-混合方式" aria-label="Permalink to &quot;4.混合方式&quot;">​</a></h4><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/混合流程图.png" loading="lazy"></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">设置渲染图像的混合方式（多种颜色叠加混合，比如透明、半透明效果和遮挡的物体进行颜色混合）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Blend One One 线性减淡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Blend SrcAlpha OneMinusSrcAlpha 正常透明混合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Blend OneMinusDstColor One 滤色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Blend DstColor Zero 正片叠底</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Blend DstColor SrcColor X光片效果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Blend One OneMinusSrcAlpha 透明度混合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">等等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不设置的话，默认不会进行混合</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般情况下，我们需要多种颜色叠加渲染时，就需要设置混合方式，具体情况具体处理</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>其他渲染状态</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.LOD         控制LOD级别，在不同距离下使用不同的渲染方式处理</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.ColorMask   设置颜色通道的写入蒙版，默认蒙版为RGBA</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">等等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_5-深度测试和深度写入带来的好处" tabindex="-1">5.深度测试和深度写入带来的好处 <a class="header-anchor" href="#_5-深度测试和深度写入带来的好处" aria-label="Permalink to &quot;5.深度测试和深度写入带来的好处&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->有了深度测试和深度写入发挥作用 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->让我们不需要关心不透明物体的渲染顺序<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：处理透明混合时，需要**关闭深度写入**<!--]--></span><!--]--><h3 id="八、pass-渲染通道" tabindex="-1">八、Pass(渲染通道)* <a class="header-anchor" href="#八、pass-渲染通道" aria-label="Permalink to &quot;八、Pass(渲染通道)*&quot;">​</a></h3><blockquote><p>渲染通道的语法结构</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Pass{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">  1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Name 名称</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">  2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.渲染标签</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">  3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.渲染状态</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">  4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.其他着色器代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>调用其他代码Pass</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">UsePass </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Shader路径/Pass名"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Unity内部会把Pass名称转换为大写字母</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">因此在使用UsePass命令时必须使用大写形式的名字</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Pass{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Name MyPass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在其他Shader中复用该Pass代码时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">UsePass </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"TeachShader/Lesson4/MYPASS"</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>Pass中的渲染标签</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Pass中的渲染标签语法和SubShader中相同</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"标签名1"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值1"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签名2"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值2"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签名2"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值2"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">......</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">SubShader语句块中的渲染标签不能够在Pass中使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Pass当中有自己专门的渲染标签</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p><code>Tags{ "LightMode" = "标签值" }</code></p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">指定了该Pass应该在哪个阶段执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以将着色器代码分配给适当的渲染阶段，以实现所需的效果</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    始终渲染；不应用光照</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.ForwardBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    在前向渲染中使用；应用环境光、主方向光、顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> SH 光源和光照贴图</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.ForwardAdd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    在前向渲染中使用；应用附加的每像素光源（每个光源有一个通道）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Deferred</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    在延迟渲染中使用；渲染 G 缓冲区</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.ShadowCaster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    将对象深度渲染到阴影贴图或深度纹理中</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.MotionVectors</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    用于计算每对象运动矢量</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.PrepassBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    在旧版延迟光照中使用；渲染法线和镜面反射指数</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.PrepassFinal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    在旧版延迟光照中使用；通过组合纹理、光照和反光来渲染最终颜色</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Vertex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    当对象不进行光照贴图时在旧版顶点光照渲染中使用；应用所有顶点光源</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.VertexLMRGBM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    当对象不进行光照贴图时在旧版顶点光照渲染中使用；在光照贴图为 RGBM 编码的平台上（PC 和游戏主机）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.VertexLM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    当对象不进行光照贴图时在旧版顶点光照渲染中使用；在光照贴图为双 LDR 编码的平台上（移动平台）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">关于向前渲染、延迟渲染、旧版光照等概念了解</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">https</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//docs.unity.cn/cn/2019.4/Manual/RenderingPaths.html</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p><code>Tags{ "RequireOptions" = "标签值" }</code></p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RequireOptions"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "标签值"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 用于指定当满足某些条件时才渲染该Pass</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 目前Unity仅支持</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RequireOptions"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "SoftVegetation"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 仅当Quality窗口中开启了SoftVegetation时才渲染此通道</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>`Tags{ "PassFlags" = "标签值" }``</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 主要作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 一个渲染通道Pass可指示一些标志来更改渲染管线向Pass传递数据的方式</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 目前Unity仅支持</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"PassFlags"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "OnlyDirectional"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 在 ForwardBase 向前渲染的通道类型中使用时，此标志的作用是仅允许主方向光和环境光 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 光照探针数据传递到着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 这意味着非重要光源的数据将不会传递到顶点光源或球谐函数着色器变量</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>GrabPass命令</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以利用GrabPass命令把即将绘制对象时的屏幕内容抓取到纹理中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在后续通道中即可使用此纹理，从而执行基于图像的高级效果。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">举例：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">将绘制该对象之前的屏幕抓取到 _BackgroundTexture 中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">GrabPass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">    "_BackgroundTexture"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">该命令一般写在某个Pass前，在之后的Pass代码中可以利用_BackgroundTexture变量进行处理</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="九、备用shader" tabindex="-1">九、备用Shader <a class="header-anchor" href="#九、备用shader" aria-label="Permalink to &quot;九、备用Shader&quot;">​</a></h3><blockquote><p>备用Shader的作用</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们知道ShaderLab当中允许有多个SubShader子着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">当执行渲染时，会从上到下使用第一个能够正常执行的SubShader子着色器来渲染对象</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">那有没有可能所有SubShade子着色器都不能够在显卡上执行呢？</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">答案是肯定的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">有可能出现在某一个设备上，我们自定义的所有SubShader都无法正常执行（设备显卡无法支持一些api等情况）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">那么这时备用Shader就可以起到很大作用了，它至少可以让对象能够正常渲染出来</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">因此</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">备用Shader主要作用就是当Shader文件中的所有SubShader子着色器都无法正常运行时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">起到一个保险作用，让物体能够使用一个最低级的Shader去渲染出来（效果略差，但至少能够显示）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>备用Shader的语法</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Shader名"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">或者</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Fallback Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在Fallback关键词后面空格并通过一个字符串来告诉Unity</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">“最低级的Unity Shader”是谁</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">也可以直接关闭Fallback功能，但是如果关闭那就意味着“放弃治疗”</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="十、shader的编写形式" tabindex="-1">十、Shader的编写形式* <a class="header-anchor" href="#十、shader的编写形式" aria-label="Permalink to &quot;十、Shader的编写形式*&quot;">​</a></h3><blockquote><p>Shader的形式是什么？</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通过之前的课程，我们已经对Shader文件的文件结构有一定的认识</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">并且学习了ShaderLab语法相关的知识</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通过学习我们知道 在Unity Shader当中我们可以通过ShaderLab语法去设置很多内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">比如属性、渲染状态、渲染标签等等</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">但是其最主要的作用是需要指定各种着色器所需的代码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">而这些着色器代码即可以放在SubShader子着色器语句块中，也可以放在其中的Pass渲染通道语句块中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不同的Shader形式放置着色器代码的位置也有所不同</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们一般会使用以下3种形式来编写Unity Shader</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.表面着色器（可控性较低）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 片元着色器（重点学习）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.固定函数着色器（基本已弃用，了解即可）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_1-表面着色器" tabindex="-1">1. 表面着色器 <a class="header-anchor" href="#_1-表面着色器" aria-label="Permalink to &quot;1. 表面着色器&quot;">​</a></h4><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">表面着色器（Surface Shader）是Unity自己创造的一种着色器代码类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它的本质是对顶点 / 片元着色器的一层封装</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它需要的代码量很少，很多工作都帮助我们去完成了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">但是缺点是渲染的消耗较大，可控性较低</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它的优点在于，它帮助我们处理了很多光照细节，我们可以直接使用而无需自己计算实现光照细节</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们可以在创建Shader时，选择创建Standard Surface Shader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通过观察该Shader文件的内部结构，你会发现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">着色器相关代码被放在SubShader语句块中（并非Pass）的 CGPROGRAM 和 ENDCG 之间</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>表面着色器的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--> 特点<!--]--></span><!--]--></p><ol><li>直接在SubShader语句块中书写着色器逻辑</li><li><strong>我们不需要关心也不需要使用多个Pass，每个Pass如何渲染，Unity会在内部帮助我们去处理</strong></li><li>可以使用CG或HLSL两种Shader语言去编写Shader逻辑</li><li><strong>代码量较少，可控性较低，性能消耗较高</strong></li><li><strong>适用于处理需要和各种光源打交道的着色器（主机、PC平台时更适用，移动平台需要考虑性能消耗）</strong></li></ol><h4 id="_2-顶点-片元着色器" tabindex="-1">2. 顶点/片元着色器 <a class="header-anchor" href="#_2-顶点-片元着色器" aria-label="Permalink to &quot;2. 顶点/片元着色器&quot;">​</a></h4><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们可以在创建Shader时，选择创建Unlit Shader来快速创建顶点/ 片元着色器模板</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通过观察，我们发现</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">顶点 / 片元着色器的着色器代码是编写在Pass语句块中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们需要自己定义每个Pass需要使用的Shader代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">虽然比起表面着色器来说我们需要编写的代码较多</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">但是好处是灵活性更高，可控性更强，可以控制更多的渲染细节</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">决定对性能影响的高低</span></span></code></pre><button class="code-block-unfold-btn"></button></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--> 特点<!--]--></span><!--]--><ol><li>需要在Pass渲染通道中编写着色器逻辑</li><li>可以使用CG或HLSL两种Shader语言去编写Shader逻辑</li><li><strong>代码量较多，灵活性较强，性能消耗更可控，可以实现更多渲染细节</strong></li><li><strong>适用于光照处理较少，自定义渲染效果较多时（移动平台首选）</strong></li></ol><h4 id="_3-固定函数着色器" tabindex="-1">3. 固定函数着色器 <a class="header-anchor" href="#_3-固定函数着色器" aria-label="Permalink to &quot;3. 固定函数着色器&quot;">​</a></h4><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">表面着色器 和 顶点 / 片元着色器 这两种Unity Shader形式都使用了可编程管线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">而对于一些老设备（DX7.0、OpenGL1.5或OpenGL ES 1.1），它们不支持可编程管线着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这时就需要使用固定函数着色器来进行渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这些着色器只能实现一些非常简单的效果</span></span></code></pre><button class="code-block-unfold-btn"></button></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--> 特点<!--]--></span><!--]--><ol><li>需要在Pass渲染通道中编写着色器逻辑</li><li>需要使用ShaderLab语法中的渲染设置命令来编写，而非CG和HLSL着色器语言</li></ol><h2 id="cg-语法" tabindex="-1">CG 语法 <a class="header-anchor" href="#cg-语法" aria-label="Permalink to &quot;CG 语法&quot;">​</a></h2><h3 id="一、cg代码" tabindex="-1">一、CG代码 <a class="header-anchor" href="#一、cg代码" aria-label="Permalink to &quot;一、CG代码&quot;">​</a></h3><blockquote><p>CG语句写在哪里？</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">对于顶点\片元着色器来说</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">CG语句需要写在Pass渲染通道语句块中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们需要在Pass语句块中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">加入指令</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">CGPROGRAM</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在这两个指令之间 就是我们书写CG代码的地方</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ENDCG</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>重要的编译指令 —— 指定着色器函数</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        在真正书写CG代码之前</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        我们需要先使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma 声明编译指令</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        定义实现 顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 片元着色器 代码的函数名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma vertex name(实现顶点着色器的函数名)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma fragment name(实现片元着色器的函数名)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        这两个编译指令的作用是将顶点\片元着色器实现定位到两个函数中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        之后我们只需要在这两个函数中书写Shader逻辑即可</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="二、基础数据类型" tabindex="-1">二、基础数据类型 <a class="header-anchor" href="#二、基础数据类型" aria-label="Permalink to &quot;二、基础数据类型&quot;">​</a></h3><blockquote><p>基础数据类型</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">uint</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">      32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">为无符号整形</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">       32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">位整形</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">     32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">位浮点数 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">符号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">half      </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">位浮点数 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">符号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     12位浮点数(浮点符号一般用这个)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 布尔类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 字符串</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">sampler 纹理对象句柄</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  sampler</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: 通用的纹理采样器，可以用于处理各种不同维度和类型的纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  sampler1D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:   用于一维纹理，通常用于对一维纹理进行采样，例如从左到右的渐变色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  sampler2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:   用于二维纹理，最常见的纹理类型之一。它用于处理二维图像纹理，例如贴图</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  sampler3D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:   用于三维纹理，通常用于体积纹理，例如体积渲染</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  samplerCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: 用于立方体纹理，通常用于处理环境映射等需要立方体贴图的情况</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">  samplerRECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: 用于处理矩形纹理，通常用于一些非标准的纹理映射需求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  他们都是用于处理纹理（Texture）数据的数据类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  他们的主要区别是纹理的维度和类型</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>基础复合数据类型</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数组：和C#中类似</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一维</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> a[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">长度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">a.length</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">二维</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> b[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">},{ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">} }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">长度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">b.length为2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">b[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">].length为3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">结构体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">和C#基本一样</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">没有访问修饰符</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">结构体声明结束加分号</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般在函数外声明</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="三、特殊数据类型" tabindex="-1">三、特殊数据类型 <a class="header-anchor" href="#三、特殊数据类型" aria-label="Permalink to &quot;三、特殊数据类型&quot;">​</a></h3><blockquote><p>向量</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">向量类型属于CG语言的内置数据类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">内置的向量类型是基于基础数据类型声明的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">向量的最大维度不超过4维</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型可以是任意数值类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">基本构成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 数据类型2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(n1, n2)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 数据类型3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(n1, n2, n3)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 数据类型4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(n1, n2, n3, n4)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>矩阵</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">矩阵类型属于CG语言的内置数据类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">矩阵的最大行列不大于4，不小于1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型可以是任意数值类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">基本构成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'n'</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">'m'</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { n1m1,n1m2,n1m3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型2x2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型3x3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">数据类型4x4</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>bool类型特殊使用</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">bool类型同样可以用于如同向量一样声明</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它可以用于存储一些逻辑判断结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">比如</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">bool3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> b;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">运算后向量c的结果为bool3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="四、swizzle操作符" tabindex="-1">四、Swizzle操作符 <a class="header-anchor" href="#四、swizzle操作符" aria-label="Permalink to &quot;四、Swizzle操作符&quot;">​</a></h3><blockquote><p>什么是Swizzle操作符</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Swizzle操作符通常以点号</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(.)的形式使用，后面跟着所需的分量顺序</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">对于四维向量来说</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们可以通过</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">向量.xyzw</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">或</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">向量.rgba</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">两种分量的写法来表示向量中的四个值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">其中 xyzw和rgba分别代表四维向量中的四个元素</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在此的意义就是向量一般可以用来表示坐标和颜色</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.向量获取元素可以利用Swizzle操作符获取</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.矩阵获取元素和二维数组获取方式一样</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Swizzle操作符可以让我们对向量进行方便的操作</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.向量和矩阵在声明和获取时可以配合使用</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.高维向量或矩阵可以用低维容器装载，可以利用这个特点将4维变3维，</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">4x4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">变3x3</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="五、函数" tabindex="-1">五、函数 <a class="header-anchor" href="#五、函数" aria-label="Permalink to &quot;五、函数&quot;">​</a></h3><blockquote><p>运算符</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//CG语法中比较、条件、逻辑、数学等运算符的使用和C#中一致</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//需要注意的是：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//1.逻辑运算符在CG中不存在C#中的"短路"操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//2.数学运算符在CG中取余符号只能向整数取余</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>无返回值的函数</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">基本结构</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 参数类型</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 参数名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">out</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 参数类型</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 参数名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    函数体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">：以void开头，表示没有返回值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">name：函数的名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">in：表示是输入参数，表示由函数外部传递给函数内部，内部不会修改该参数，只会使用该参数进行计算，允许有多个</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">out：表示是输出参数，表示由函数内部传递给函数的调用者，在函数内部必须对该参数值进行初始化或修改，允许有多个</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">in和out都可以省略，省略后就没有了in和out相关的限制</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">虽然可以省略，但是建议在编写Shader时不要省略in和out</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">因为他们可以明确参数的传递方式，提高代码的可读性和可维护性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以让我们更容易的理解函数是如何与参数交互的，减少潜在的误解可能</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>有返回值的函数</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 基本结构</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 参数类型</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 参数名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     函数体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">       return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 返回值;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> type：返回值类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">：返回指定类型的数据</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 注意：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 虽然可以在有返回值的函数中使用out参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 但是这并不是常见做法，除非是一些自定义逻辑函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对于顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 片元着色器函数只会使用单返回值的方式进行处理</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="六、顶点-片元着色器" tabindex="-1">六、顶点/片元着色器 <a class="header-anchor" href="#六、顶点-片元着色器" aria-label="Permalink to &quot;六、顶点/片元着色器&quot;">​</a></h3><blockquote><p>顶点着色器</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">顶点着色器 回调函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    POSITION 和 SV_POSITION是CG语言的语义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    POSITION：把模型的顶点坐标填充到输入的参数v当中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SV_POSITION：顶点着色器输出的内容是裁剪空间中的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    如果没有这些语义来限定输入和输出参数的话，那么渲染器就完全不知道用户输入输出的是什么，就会得到错误的效果</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> myVert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:POSITION):SV_POSITION</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //mul是CG语言提供的矩阵和向量的乘法运算函数（就是一个内置的函数）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //UNITY_MATRIX_MVP 代表一个变换矩阵 是Unity内置的模型、观察、投影矩阵的集合</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //UnityObjectToClipPos它的作用和之前的矩阵乘法是一样的，主要目的就是在进行坐标变换 只不过新版本将其封装起来了 使用更加方便</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //mul(UNITY_MATRIX_MVP,v);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>片元着色器</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//片元着色器 回调函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//SV_Target:告诉渲染器，把用户输出颜色存储到一个渲染目标中，这里将输出到默认的帧缓存中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> myFrag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">():SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="七、语义" tabindex="-1">七、语义* <a class="header-anchor" href="#七、语义" aria-label="Permalink to &quot;七、语义*&quot;">​</a></h3><blockquote><p>语义的作用</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">CG语言中提供了 语义 这种特殊关键字用于修饰函数中的传入参数和返回值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它的主要作用是让Shader知道从哪里读取数据，并把数据输出到哪里</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">让我们在Shader开发当中可以获取到想要的数据，并且可以把数据传递出去</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：Unity中只支持CG当中的部分语义</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">语义的主要作用是让Shader知道从哪里读取数据，并把数据输出到哪里</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们在编写顶点片元着色器回调函数的相关逻辑时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们需要使用语义去修饰函数参数和返回值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这样我们才能获取到我们想要的数据，并且把结果数据明确的返回出去用于下一流程处理</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>应用阶段——&gt;顶点着色器</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">应用阶段传递模型数据给顶点着色器时Unity支持的语义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般在顶点着色器回调函数的传入参数中应用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">模型空间中的顶点位置，通常是float4类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">NORMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">顶点法线，通常是float3类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TANGENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">顶点切线，通常是float4类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TEXCOORDn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">比如</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TEXCOORD0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TEXCOORD1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">....</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">该顶点的纹理坐标</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">通常是float2或者float4类型</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                           TEXCOORD0表示第一组纹理坐标</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">依次类推</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                           纹理坐标</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">：</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">也称UV坐标</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">表示该顶点对应纹理图像上的位置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                           COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">顶点颜色</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">通常是fixed4或float4类型</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>顶点着色器——&gt;片元着色器</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">从顶点着色器传递数据给片元着色器时Unity支持的语义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">一般在顶点着色器回调函数的返回值中应用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">裁剪空间中的顶点坐标（必备）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">COLOR0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通常用于输出第一组顶点颜色（不是必须的）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">COLOR1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通常用于输出第二组顶点颜色（不是必须的）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">TEXCOORD0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">~</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TEXCOORD7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通常用于输出纹理坐标（不是必须的）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>片元着色器输出</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 片元着色器输出时Unity支持的常用语义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 一般在片元着色器回调函数的返回值中应用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SV_Target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 输出值会存储到渲染目标中</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>更多语义</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//HLSL语义汇总：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//https://learn.microsoft.com/zh-cn/windows/win32/direct3dhlsl/dx-graphics-hlsl-semantics?redirectedfrom=MSDN</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//CG的语义大部分和HLSL的相同，在此做了解即可</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//以后我们用到其他语义时，再着重讲解即可</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="八、顶点-片元着色器传递更多参数" tabindex="-1">八、顶点/片元着色器传递更多参数 <a class="header-anchor" href="#八、顶点-片元着色器传递更多参数" aria-label="Permalink to &quot;八、顶点/片元着色器传递更多参数&quot;">​</a></h3><blockquote><p>顶点着色器获取更多数据信息</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">当我们在顶点着色器当中想要获取更多模型相关信息时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以使用结构体对数据进行封装</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通过对结构体中成员变量加语义的方式来定义想要获取的信息</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>片元着色器获取更多数据信息</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">当我们在片元着色器当中想要获取更多信息时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">采用的方式还是封装结构体的方式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">片元着色器中获取的数据基本上都是由顶点着色器传递过来的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">所以我们封装的结构体还需要作为顶点着色器的返回值类型</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>例子</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson22"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //该结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //是用于从应用阶段获取对应语义数据后</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //传递给顶点着色器回调函数的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct a2v</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标(基于模型空间)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点法线(基于模型空间)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //纹理坐标(uv坐标)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //从顶点着色器传递给片元着色器的 结构体数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //同样这里面的成员也需要用语义去进行修饰</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">position</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点法线(基于模型空间)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //纹理坐标(uv坐标)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">a2v</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //需要传递给片元着色器的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v2fData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.position </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(data.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.normal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data.normal;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data.uv;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="九、shaderlab属性类型和cg变量类型的匹配关系" tabindex="-1">九、ShaderLab属性类型和CG变量类型的匹配关系 <a class="header-anchor" href="#九、shaderlab属性类型和cg变量类型的匹配关系" aria-label="Permalink to &quot;九、ShaderLab属性类型和CG变量类型的匹配关系&quot;">​</a></h3><table><thead><tr><th>ShaderLab属性类型</th><th>CG变量类型</th></tr></thead><tbody><tr><td>Color,Vector</td><td>float4,half4,fixed4</td></tr><tr><td>Range,Float,Int</td><td>float,half,fixed</td></tr><tr><td>2D</td><td>sampler2D</td></tr><tr><td>Cube</td><td>samplerCube</td></tr><tr><td>3D</td><td>sampler3D</td></tr><tr><td>2DArray</td><td>sampler2DArray</td></tr></tbody></table><blockquote><p>如何在CG语句块中使用ShaderLab中声明的属性</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">直接在CG语句块中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">声明和属性中对应类型的同名变量即可</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="十、cg内置函数" tabindex="-1">十、CG内置函数* <a class="header-anchor" href="#十、cg内置函数" aria-label="Permalink to &quot;十、CG内置函数*&quot;">​</a></h3><blockquote><p>CG内置函数是什么</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Unity Shader中的CG语言</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">提供了各种用于图形编程的函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这些函数是CG为我们封装好的逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们可以使用它们来编写Unity Shader</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_1-数学函数" tabindex="-1">1. 数学函数 <a class="header-anchor" href="#_1-数学函数" aria-label="Permalink to &quot;1. 数学函数&quot;">​</a></h4><blockquote><p>三角函数</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">sincos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> x, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> s, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> c)     该函数同时计算x的sin值和cos值通过s和c进行返回（比分别运算快很多）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">sin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            正弦函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">cos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            余弦函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            正切函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">sinh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           双曲正弦函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">cosh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           双曲余弦函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tanh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           双曲正切函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">asin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           反正弦函数，输入参数范围[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]，返回[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">π </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, π </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]区间的角度值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">acos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           反余弦函数，输入参数范围[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]，返回[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, π]区间的角度值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">atan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           反正切函数，输入参数范围[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]，返回[</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">π </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, π </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]区间的角度值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">atan2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(y, x)                        计算y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> x的反正切值。和atan功能一样，只是输入参数不同。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">atan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> atan2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>向量、矩阵相关</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(A, B)                        叉乘（注意：传入向量必须是三维向量）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(A, B)                          点乘（注意：传入向量必须是三维向量）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(M, N)                          计算两个矩阵相乘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(M, v)                          计算矩阵和向量相乘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v, M)                          计算向量和矩阵相乘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">transpose</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(M)                      M为矩阵，计算M的转置矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">determinant</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(m)                    计算矩阵的行列式因子</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>数值相关</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            返回输入参数的绝对值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ceil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           对输入参数向上取整</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">floor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                          对输入参数向下取整</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">clamp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x, a, b)                      如果x小于a，则返回a；x大于b，则返回b；否则，返回x（</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"夹紧"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">函数）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">radians</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                        角度转弧度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">degrees</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                        弧度转角度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(a, b)                          返回最大值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(a, b)                          返回最小值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           求x的平方根，x必须大于0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x, y)                          x的y次方的值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">round</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                          对x四舍五入</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">rsqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                          x的反平方根，x必须大于0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(a, b, f)                       差值函数，</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">计算</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> f) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> f 或者 a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> a)的值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">exp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            计算e的x次方的值，e </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2.71828182845904523536</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">exp2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           计算2的x次方的值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fmod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x, y)                         返回x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> y的余数，y不为0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">frac</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           返回标量或每个矢量分量的小数部分</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">frexp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> exp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">将浮点数x分解为尾数和直属，即 x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">的exp次方，返回m，将指数存储exp中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isfinite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">判断标量或者向量中的每个数据是否是有限数，如果是返回true，否则返回false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isinf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">判断标量或者向量中的每个数据是否是无限，如果是返回true，否则返回false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">isnan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">判断标量或者向量中的每个数据是否是非数据，如果是返回true，否则返回false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ldexp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x, n)                       计算x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">的n次方 的值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">计算ln</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)的值，x必须大于0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">log2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">计算log2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x次方)的值，x必须大于0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">log10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                          </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">计算log2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x次方)的值，x必须大于0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                       如果x小于0，返回0；如果x大于1，返回1；否则，返回x</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">sign</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                           如果x大于0，返回1；如果x小于0，返回 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">；否则，返回0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">smoothstep</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(min, max, x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">值x位于min、max区间内，如果x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> min，返回0；如果x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> max，返回1；如果在两者之间，返回</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> ((x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> min) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (max </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> min))的三次方 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> ((x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> min) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (max </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> min))的2次方</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(a, x)                        如果x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> a,返回0；否则，返回1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            输入参数均不为0，则返回true; 否则返回False。相当于逻辑与 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&amp;&amp;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)                            输入参数只要有其中一个不为0，则返回true。相当于逻辑或</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">||</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>其他</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(NdotL, NdotH, m)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">N表示法向量；L表示入射光向量；H表示半角向量；m表示高光系数该函数计算环境光、散射光、镜面光的贡献，返回4维向量；x位表示环境光贡献；y位表示散射光贡献；z位表示镜面光贡献；w始终为1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">噪声函数，返回值始终是0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">~</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">之间；对于相同的输入，始终返回相同值，不是真正意义的随机噪声</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_2-几何函数" tabindex="-1">2. 几何函数 <a class="header-anchor" href="#_2-几何函数" aria-label="Permalink to &quot;2. 几何函数&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v)                     返回一个向量的模长</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v)                  归一化向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">distance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(p1, p2)               计算两点之间的距离</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(I, N)                  计算反射光方向向量，I为入射光，N为顶点法向量，。I是指向顶点的，I和N必须被归一化，必须是3维向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(I, N, eta)              计算折射向量，I为入射光，N为顶点法向量，eta为折射系数。I是指向顶点的，I和N必须被归一化，必须是3维向量</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_3-纹理函数" tabindex="-1">3. 纹理函数 <a class="header-anchor" href="#_3-纹理函数" aria-label="Permalink to &quot;3. 纹理函数&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：这些纹理采样函数返回值为 fixed4 类型的颜色值<!--]--></span><!--]--><blockquote><p>二维纹理</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler2D tex, float2 s)                                    二维纹理查询</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler2D tex, float2 s, float2 dsdx, float2 dsdy)          使用导数值查询二维纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler2D tex, float3 sz)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">二维纹理查询，并进行深度值比较</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler2D tex, float3 sz, float2 dsdx, float2 dsdy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">使用导数值查询二维纹理，并进行深度值比较</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2Dproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler2D tex, float3 sq)                               二维投影纹理查询</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2Dproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler2D tex, float4 szq)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>立方体纹理</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerCUBE tex, float3 s)                                查询立方体纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerCUBE tex, float3 s, float3 dsdx, float3 dsdy)      结合导数值查询立方体纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texCUBEDproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerCUBE tex, float4 sq)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>其他纹理</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex1D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler1D tex, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> s)                                     一维纹理查询</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex1D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler1D tex, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> s, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> dsdx, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> dsdy)             使用导数值查询一维纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex1D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler1D tex, float2 sz)                                   一维纹理查询，并进行深度值比较</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex1D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler1D tex, float2 sz, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> dsdx, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> dsdy)           使用导数值查询一维纹理，并进行深度值比较</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex1Dproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler1D tex, float2 sq)                               一维投影纹理查询</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex1Dproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler1D tex, float3 szq)                              一维投影纹理查询，并进行深度值比较</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texRECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerRECT tex, float2 s)                                矩形纹理查询</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texRECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerRECT tex, float2 s, float2 dsdx, float2 dsdy)      使用导数值查询矩形纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texRECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerRECT tex, float3 sz)                               矩形纹理查询，并进行深度值比较</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texRECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerRECT tex, float3 sz, float2 dsdx, float2 dsdy)     使用导数值查询矩形纹理，并进行深度值比较</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texRECTproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerRECT tex, float3 sq)                           矩形投影纹理查询</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">texRECTproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(samplerRECT tex, float3 szq)                          矩形投影纹理查询，并进行深度值比较</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex3D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler3D tex, float3 s)                                    查询三维纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex3D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler3D tex, float3 s, float3 dsdx, float3 dsdy)          结合导数值查询三维纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex3DDproj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sampler3D tex, float4 sq)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_4-hlsl内置函数" tabindex="-1">4. HLSL内置函数 <a class="header-anchor" href="#_4-hlsl内置函数" aria-label="Permalink to &quot;4. HLSL内置函数&quot;">​</a></h4><blockquote><p>HLSL内置函数</p></blockquote><p><a href="https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-intrinsic-functions" target="_blank" rel="noreferrer">https://learn.microsoft.com/en-us/windows/win32/direct3dhlsl/dx-graphics-hlsl-intrinsic-functions</a></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这是HLSL对应的内置函数，CG和它类似（注意：不是所有函数都在Unity中被支持）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="十一、cg内置文件" tabindex="-1">十一、CG内置文件* <a class="header-anchor" href="#十一、cg内置文件" aria-label="Permalink to &quot;十一、CG内置文件*&quot;">​</a></h3><blockquote><p>CG内置文件的位置和作用</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们可以在Unity的安装目录中找到CG内置文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在Editor—</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Data—</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> CGIncludes中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">后缀为cginc的文件为CG语言内置文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">后缀为glslinc的文件为GLSL语言内置文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">他们是预定义的Shader文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">里面包含了一些已经写好的Shader相关逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">作用和CG内置函数一样，可以提升我们的Shader开发效率</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以直接使用其中的方法等内容来进行逻辑开发</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Unity中常用的内置文件有</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UnityCG.cginc                     包含最常用的帮助函数、宏和结构体等</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Lighting.cginc                    包含各种内置光照模型。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">如果编写的是Surface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Shader</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(标准表面着色器），会自动包含进来</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">3.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityShaderVariables</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">cginc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        编译UnityShader时</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，会自动包含进来。包含许多内置的全局变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">4.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">HLSLSupport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">cginc</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                 编译UnityShader时</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，会自动包含进来。声明了很多用于跨平台编译的宏和定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">等等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>如何使用CG内置文件</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在CG语句块中进行引用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通过编译指令</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#include "内置文件名.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">的形式进行引用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们便可以在CG语言中使用其中的内容</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：一些常用的函数、宏、变量，可以不用引用，Unity会在编译时自动识别</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     但是为了避免报错，建议都引用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"宏"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通常指的是一种预处理指令或代码片段，用于在代码中进行文本替换。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">宏允许程序员定义一个标识符（通常以大写字母表示）来代表一个代码片段，</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">然后在编译时将这个标识符替换为相应的代码，这种替换过程称为宏展开。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">说人话：就是为一些代码片段，取一个别名，方便使用。在真正编译时在把这个别名翻译成对应的代码。</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_1-常用内容" tabindex="-1">1. 常用内容 <a class="header-anchor" href="#_1-常用内容" aria-label="Permalink to &quot;1. 常用内容&quot;">​</a></h4><blockquote><p>方法(UnigyCG.cginc中)</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  输入一个模型空间中的顶点位置，返回世界空间中从该点到摄像机的观察方向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  输入一个模型空间中的顶点位置，返回模型空间中从该点到摄像机的观察方向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WorldSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  仅用于向前渲染中。输入一个模型空间中的顶点位置，返回世界空间中从该点到光源的光照方向。（返回值没有被归一化）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.flaot3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  仅用于向前渲染中。输入一个模型空间中的顶点位置，返回模型空间中从该点到光源的光照方向。（返回值没有被归一化）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float3 norm)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  把法线方向从模型空间转换到世界空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityObjectToWorldDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> float3 dir)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  把方向矢量从模型空间转换到世界空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldToObjectDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float3 dir)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  把方向矢量从世界空间转换到模型空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">等等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>结构体(UnigyCG.cginc中)</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.appdata_base</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  用于顶点着色器输入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  顶点位置、顶点法线、第一组纹理坐标</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.appdata_tan</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  用于顶点着色器输入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  顶点位置、顶点法线、顶点切线、第一组纹理坐标</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.appdata_full</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  用于顶点着色器输入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  顶点位置、顶点法线、顶点切线、四组（或更多）纹理坐标</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.appdata_img</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  用于顶点着色器输入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  顶点位置、第一组纹理坐标</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.v2f_img</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  用于顶点着色器输出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  裁剪空间中的位置，纹理坐标</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">等等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>变换矩阵宏(UnityShaderVariables.cginc中)</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">坐标空间变换顺序</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  模型空间-&gt;世界空间-&gt;观察空间-&gt;裁剪空间-&gt;屏幕空间</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UNITY_MATRIX_MVP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  当前的模型</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 观察</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">投影矩阵，用于将顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 方向向量从模型空间变换到裁剪空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UNITY_MATRIX_MV</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  当前的模型</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 观察矩阵，用于将顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 方向向量从模型空间变换到观察空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UNITY_MATRIX_V</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  当前的观察矩阵，用于将顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 方向向量从世界空间变换到观察空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UNITY_MATRIX_P</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  当前的投影矩阵，用于将顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 方向向量从观察空间变换到裁剪空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UNITY_MATRIX_VP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  当前的观察</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 投影矩阵，用于将顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 方向向量从世界空间变换到裁剪空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UNITY_MATRIX_T_MV</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  UNITY_MATRIX_MV的转置矩阵</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.UNITY_MATRIX_IT_MV</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  UNITY_MATRIX_MV的逆转置矩阵，用于将法线从模型空间变换到观察空间，也可用于得到UNITY_MATRIX_MV的逆矩阵</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">._Object2World</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  当前的模型矩阵，用于将顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 方向矢量从模型空间变换到世界空间</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">._World2Object</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  _Object2World的逆矩阵，用于将顶点 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 方向矢量从世界空间变换到模型空间</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">等等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>变量</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_Time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(不用引用，直接使用即可)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  自关卡加载以来的时间（t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">、t、t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">、t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）用于对着色器内的事物进行动画处理</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(向前渲染时，UnityLightingCommon.cginc；延迟渲染，UnityDeferredLibrary.cginc)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  光的颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">等等</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>总结</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">CG中的内置文件和内置函数一样</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">是用于帮助我们进行Shader开发的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">利用其中的函数、宏、全局变量等内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以提升我们Shader的开发效率</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>内置文件相关：<a href="https://docs.unity3d.com/Manual/SL-BuiltinIncludes.html" target="_blank" rel="noreferrer">https://docs.unity3d.com/Manual/SL-BuiltinIncludes.html</a> 函数相关：<a href="https://docs.unity3d.com/Manual/SL-BuiltinFunctions.html" target="_blank" rel="noreferrer">https://docs.unity3d.com/Manual/SL-BuiltinFunctions.html</a> 宏相关：<a href="https://docs.unity3d.com/Manual/SL-BuiltinMacros.html" target="_blank" rel="noreferrer">https://docs.unity3d.com/Manual/SL-BuiltinMacros.html</a> 变量相关：<a href="https://docs.unity3d.com/Manual/SL-UnityShaderVariables.html" target="_blank" rel="noreferrer">https://docs.unity3d.com/Manual/SL-UnityShaderVariables.html</a></p><h3 id="十二、常用内置函数" tabindex="-1">十二、常用内置函数 <a class="header-anchor" href="#十二、常用内置函数" aria-label="Permalink to &quot;十二、常用内置函数&quot;">​</a></h3><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   传入模型空间下的顶点位置，返回世界空间中从该点到摄像机的观察方向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(flaot4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   传入世界空间中的顶点位置，返回世界空间中从该点到摄像机的观察方向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   传入模型空间中的顶点位置，返回模型空间中从该点到摄像机的观察方向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WorldSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   (仅用于向前渲染中)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   传入模型空间中的顶点位置，返回世界空间中该点到光源的光照方向（没有归一化）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   (仅用于向前渲染中)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   传入世界空间中的顶点位置，返回世界空间中从该点到光源的光照方向（没有归一化）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   (仅用于向前渲染中)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   传入模型空间中的顶点位置，返回模型空间中从该点到光源的光照方向（没有归一化）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float3 normal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   把法线从模型空间转换到世界空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityObjectToWorldDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float3 dir)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   把方向矢量从模型空间转换到世界空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">. float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldToObjectDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float3 dir)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   把方向矢量从世界空间转换到模型空间中</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(float4 v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   输入模型空间中的顶点位置，返回裁剪空间下的顶点位置</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="光照模型" tabindex="-1">光照模型 <a class="header-anchor" href="#光照模型" aria-label="Permalink to &quot;光照模型&quot;">​</a></h2><h3 id="一、逐顶点光照和逐片元光照" tabindex="-1">一、逐顶点光照和逐片元光照 <a class="header-anchor" href="#一、逐顶点光照和逐片元光照" aria-label="Permalink to &quot;一、逐顶点光照和逐片元光照&quot;">​</a></h3><blockquote><p>逐顶点光照</p></blockquote><p>在哪计算： 顶点着色器 回调函数中</p><p><strong>计算方式：</strong> 逐顶点光照会在每个物体的顶点上进行光照计算 这意味着光照计算只在物体的顶点位置上执行 而在顶点之间的内部区域使用插值来获得颜色信息</p><p><strong>优点：</strong><strong>逐顶点光照的计算量较小，通常在移动设备上性能较好</strong>，适用于移动游戏等要求性能的场景</p><p><strong>缺点:</strong><strong>照明效果可能不够精细</strong>，特别是在物体表面上的细节区域，因为颜色插值可能不足以捕捉到细微的照明变化</p><p><strong>适用场景：</strong> 逐顶点光照适用于需要在有限资源下获得较好性能的场景，例如移动游戏</p><blockquote><p>逐片元光照</p></blockquote><p><strong>在哪计算：</strong> 片元着色器 回调函数中</p><p><strong>计算方式：</strong> 逐片元光照会在每个像素（片元）上进行光照计算 这意味着每个像素都会根据其位置、法线、材质等信息独立地进行光照计算</p><p><strong>优点：</strong> 逐片元光照提供了更高的精细度，可以捕捉到物体表面上的细微照明变化，<strong>提供更逼真的效果</strong></p><p><strong>缺点:</strong><strong>计算量较大</strong>，对于像素密集的场景需要更多的计算资源</p><p>适用场景： 逐片元光照通常用于需要高质量照明效果的PC和主机游戏，以及要求视觉逼真度较高的场景</p><h3 id="二、兰伯特光照模型" tabindex="-1">二、兰伯特光照模型 <a class="header-anchor" href="#二、兰伯特光照模型" aria-label="Permalink to &quot;二、兰伯特光照模型&quot;">​</a></h3><blockquote><p>两个颜色相乘</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">两个颜色变量相乘，通常用于计算光照、材质混合、纹理混合等等需求</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它是一种用于混合颜色的操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">计算结果可以理解为两种颜色叠加在一起的效果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在颜色相乘中，通常是使用颜色通道的值来执行逐通道的乘法</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">举例：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">颜色A、B都是 fixed4 类型的变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">颜色A</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">* </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">颜色B</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (A.r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> B.r, A.g </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> B.g, A.b </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> B.b, A.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> B.a);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">那么得到的这个结果就是A、B颜色叠加后的结果</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">总结：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">两个颜色变量相乘，得到的结果表示两个颜色叠加在一起</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>漫反射</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">漫反射（Diffuse Reflection）是光线撞击一个物体表面后以各个方向均匀地反射出去的过程</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在漫反射下，光线以无规律的方式散射，而不像镜面反射那样按照特定的角度反射。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这种散射导致了物体表面看起来均匀而不闪烁的效果。</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>原理</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">认为漫反射光的强度仅与入射光的方向和反射点处表面法线的夹角的余弦成正比</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_1-公式" tabindex="-1">1. 公式 <a class="header-anchor" href="#_1-公式" aria-label="Permalink to &quot;1. 公式&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`漫反射光照颜色 = 光源的颜色 * 材质的漫反射颜色 * max(0, 标准化后物体表面法线向量· 标准化后光源方向向量)`<!--]--></span><!--]--><p>其中：</p><ol><li>标准化后物体表面法线向量· 标准化后光源方向向量 得到的结果就是 cosθ</li><li><code>max(0, cosθ)</code>的目的是避免负数，对于模型背面的部分，认为找不到光，直接乘以0，变为黑色</li></ol><blockquote><p>相关公式</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.光源的颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  Lighting.cginc 内置文件中的 _LightColor0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.光源的方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  _WorldSpaceLightPos0 表示光源0在世界坐标系下的位置</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.向量归一化方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  normalize</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.取最大值方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  max</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.点乘方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  dot</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.兰伯特光照模型环境光变量（用于模拟环境光对物体的影响，避免物体阴影部分完全黑暗）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  UNITY_LIGHTMODEL_AMBIENT.rgb</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.将法线从模型空间转换到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  UnityObjectToWorldNormal</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="三、半兰伯特光照" tabindex="-1">三、半兰伯特光照 <a class="header-anchor" href="#三、半兰伯特光照" aria-label="Permalink to &quot;三、半兰伯特光照&quot;">​</a></h3><blockquote><p>原理</p></blockquote><p>和兰伯特光照模型的理论是一样的 认为漫反射光的强度仅与入射光的方向和反射点处表面法线的夹角的余弦成正比</p><h4 id="_1-公式-1" tabindex="-1">1. 公式 <a class="header-anchor" href="#_1-公式-1" aria-label="Permalink to &quot;1. 公式&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`漫反射光照颜色 = 光源的颜色 x 材质的漫反射颜色 x（（标准化后物体表面法线向量 x 标准化后光源方向向量）x 0.5 + 0.5）`<!--]--></span><!--]--><blockquote><p>对比</p></blockquote><p>兰伯特光照模型的 后半部分： max（0, 标准化后物体表面法线向量· 标准化后光源方向向量） 点乘小于0的部分都会变成0</p><p>半兰伯特光照模型的 后半部分： `（（标准化后物体表面法线向量· 标准化后光源方向向量）*0.5 + 0.5）````````````````````````````````````````````` 点乘小于0的部分都会变成 0 ~0.5</p><p>1 ~1 映射到了 0 ~1</p><hr><h3 id="四、phong式高光反射光照模型" tabindex="-1">四、Phong式高光反射光照模型 <a class="header-anchor" href="#四、phong式高光反射光照模型" aria-label="Permalink to &quot;四、Phong式高光反射光照模型&quot;">​</a></h3><blockquote><p>Phong式高光反射光照模型原理</p></blockquote><p>Phong式高光反射光照模型的理论是 基于光的反射行为和观察者的位置决定高光反射的表现效果 认为高光反射的颜色和 光源的反射光线以及观察者位置方向向量夹角的余弦成正比 并且通过对余弦值取n次幂来表示光泽度（或反光度）</p><h4 id="_1-公式-2" tabindex="-1">1. 公式 <a class="header-anchor" href="#_1-公式-2" aria-label="Permalink to &quot;1. 公式&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><b>高光反射光照颜色:</b><!--]--></span><!--]--><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>光源的颜色</mtext><mo>∗</mo><mtext>材质高光反射颜色</mtext><mo>∗</mo><mi>p</mi><mi>o</mi><mi>w</mi><mo stretchy="false">(</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mtext>标准化后观察方向向量</mtext><mi>x</mi><mtext>标准化后的反射方向</mtext><mo stretchy="false">)</mo><mo separator="true">,</mo><mtext>光泽度</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{光源的颜色} * \text{材质高光反射颜色} * pow (max(0, \text{标准化后观察方向向量}x\text{标准化后的反射方向} ),\text{光泽度} )</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">光源的颜色</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">材质高光反射颜色</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:.02691em">w</span><span class="mopen">(</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord text"><span class="mord cjk_fallback">标准化后观察方向向量</span></span><span class="mord mathnormal">x</span><span class="mord text"><span class="mord cjk_fallback">标准化后的反射方向</span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord text"><span class="mord cjk_fallback">光泽度</span></span><span class="mclose">)</span></span></span></span></span></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><b>标准化后观察方向向量</b><!--]--></span><!--]--><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>n</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo><mtext>观察者的位置（摄像机的位置）&nbsp;-&nbsp;世界空间下顶点位置</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">normalize(\text{观察者的位置（摄像机的位置） - 世界空间下顶点位置})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:.02778em">or</span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mopen">(</span><span class="mord text"><span class="mord cjk_fallback">观察者的位置（摄像机的位置）</span><span class="mord">&nbsp;-&nbsp;</span><span class="mord cjk_fallback">世界空间下顶点位置</span></span><span class="mclose">)</span></span></span></span></span></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><b>标准化后的反射方向</b><!--]--></span><!--]--><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mi>e</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">(</mo><mo>−</mo><mtext>世界空间下的光位置的方向向量,&nbsp;世界空间下的法线</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">reflect(-\text{世界空间下的光位置的方向向量, 世界空间下的法线})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord">−</span><span class="mord text"><span class="mord cjk_fallback">世界空间下的光位置的方向向量</span><span class="mord">,&nbsp;</span><span class="mord cjk_fallback">世界空间下的法线</span></span><span class="mclose">)</span></span></span></span></span></p><blockquote><p>关键api</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.观察者的位置（摄像机的位置）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_WorldSpaceCameraPos</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.相对于法向量的反射向量 方法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(入射向量,顶点法向量) 返回反射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.指数幂 方法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(底数，指数) 返回计算结果</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_2-逐顶点" tabindex="-1">2. 逐顶点 <a class="header-anchor" href="#_2-逐顶点" aria-label="Permalink to &quot;2. 逐顶点&quot;">​</a></h4><div class="language-Shader"><button title="Copy code" class="copy"></button><span class="lang">Shader</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson35_Specular"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //光泽度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //对应属性当中的颜色和光泽度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f data;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.将顶点坐标转换到裁剪空间当中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.计算颜色相关</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射光照颜色 = 光源的颜色 * 材质高光反射颜色 * max（0, 标准化后观察方向向量· 标准化后的反射方向）幂</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光源的颜色 _LightColor.rgb</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //材质高光反射颜色 _SpecularColor.rgb</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //幂(光泽度) _SpecularNum</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.标准化后观察方向向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将模型空间下的顶点位置 转换到 世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // UNITY_MATRIX_M : 从模型空间下 转到 世界空间下的转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> worldPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_MATRIX_M</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到的就是视角方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceCameraPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz - worldPos;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //单位化（归一化）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.标准化后的反射方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到的光位置的方向向量（世界空间下的）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //法线在世界空间下的向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> normal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //反射光线向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> reflectDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(-lightDir, normal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射光照颜色 = 光源的颜色 * 材质高光反射颜色 * max（0, 标准化后观察方向向量· 标准化后的反射方向）幂</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir, reflectDir)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.color = color;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_3-逐片元" tabindex="-1">3. 逐片元 <a class="header-anchor" href="#_3-逐片元" aria-label="Permalink to &quot;3. 逐片元&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson36_SpecularF"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色  光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //如果有多个Pass渲染通道时 一般情况下会把光照模式的 Tags放到对应的Pass中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //以免影响其他Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 法线信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.顶点裁剪空间变换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.进行法线空间变换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //3.顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.wPos = mul(UNITY_MATRIX_M, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.wPos = mul(_Object2World, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.视角单位向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceCameraPos.xyz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.wPos );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.光的反射单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光反射光线的单位向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflectDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">lightDir, i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //color = 光源颜色 * 材质高光反射颜色 * pow( max(0, dot(视角单位向量, 光的反射单位向量)), 光泽度 )</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir, reflectDir)), _SpecularNum );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="五、phong光照模型" tabindex="-1">五、Phong光照模型 <a class="header-anchor" href="#五、phong光照模型" aria-label="Permalink to &quot;五、Phong光照模型&quot;">​</a></h3><blockquote><p>颜色相乘和相加的不同</p></blockquote><p><strong>相乘:</strong> 颜色相乘时，最终颜色会往黑色靠拢 计算两个颜色混合时一般用颜色相乘 因为真实世界中多个颜色混在一起最终会变成黑色</p><p><strong>相加:</strong> 颜色相加时，最终颜色会往白色靠拢 计算光照反射时一般用颜色相加，因为向白色靠拢能带来 更亮的感觉，复合光的表现</p><blockquote><p>Unity Shader中的环境光</p></blockquote><p><code>Window——&gt; Rendering——&gt; Lighting</code> ` Environment(环境)页签中的Environment Lighting(环境光) 这里可以设置环境光来源 当是Skybox和Color时，我们可以通过 UNITY_LIGHTMODEL_AMBIENT 获取到对应环境光颜色 当是Gradient（渐变）时，通过以下3个成员可以得到对应的环境光 unity_AmbientSky（周围的天空环境光） unity_AmbientEquator（周围的赤道环境光） unity_AmbientGround（周围的地面环境光）</p><p><strong>注意</strong>： 这些内置变量都包含在 <code>UnityShaderVariables.cginc</code> 中 在编译时，会自动包含该文件，可以不用手动包含</p><blockquote><p>原理</p></blockquote><p>裴祥风认为物体表面反射光线是由三部分组成的 环境光 + 漫反射光 + 镜面反射光（高光反射光）</p><h4 id="_1-公式-3" tabindex="-1">1. 公式 <a class="header-anchor" href="#_1-公式-3" aria-label="Permalink to &quot;1. 公式&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">物体表面光照颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 环境光颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 漫反射光颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 高光反射光颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">其中：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">环境光颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UNITY_LIGHTMODEL_AMBIENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_AmbientSky、unity_AmbientEquator、unity_AmbientGround)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">漫反射光颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 兰伯特光照模型 计算得到的颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">高光反射光颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Phong式高光反射光照模型 计算得到的颜色</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h4 id="_2-逐顶点-1" tabindex="-1">2.逐顶点 <a class="header-anchor" href="#_2-逐顶点-1" aria-label="Permalink to &quot;2.逐顶点&quot;">​</a></h4><div class="language-ShaderLab"><button title="Copy code" class="copy"></button><span class="lang">ShaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson38_Phong"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //材质的漫反射光照颜色</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _MainColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //光泽度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //设置我们的光照模式 ForwardBase这种向前渲染模式 主要是用来处理 不透明物体的 光照渲染的</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //引用对应的内置文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //主要是为了之后 的 比如内置结构体使用，内置变量使用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质的漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //对应属性当中的颜色和光泽度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器传递给片元着色器的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对应顶点的漫反射光照颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算兰伯特光照模型 颜色 相关函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getLambertColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> objNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在模型空间下的发现</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //v.normal</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //获取到 相对于世界坐标系下的 发现信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> normal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(objNormal);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //有了相关的参数 就可以用公式来进行计算了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光照颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //_LightColor0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _MainColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(normal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算Phong高光反射光照模型 颜色 相关函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> objVertex, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> objNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.标准化后观察方向向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将模型空间下的顶点位置 转换到 世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // UNITY_MATRIX_M : 从模型空间下 转到 世界空间下的转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> worldPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_MATRIX_M</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, objVertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到的就是视角方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceCameraPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz - worldPos;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //单位化（归一化）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.标准化后的反射方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到的光位置的方向向量（世界空间下的）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //法线在世界空间下的向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> normal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(objNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //反射光线向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> reflectDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(-lightDir, normal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射光照颜色 = 光源的颜色 * 材质高光反射颜色 * max（0, 标准化后观察方向向量· 标准化后的反射方向）幂</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir, reflectDir)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f v2fData;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的 顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算兰伯特光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getLambertColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex, v.normal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用Phong光照模型公式 进行颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_LIGHTMODEL_AMBIENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb + lambertColor + specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_3-逐片元-1" tabindex="-1">3.逐片元 <a class="header-anchor" href="#_3-逐片元-1" aria-label="Permalink to &quot;3.逐片元&quot;">​</a></h4><div class="language-ShaderLab"><button title="Copy code" class="copy"></button><span class="lang">ShaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson39_PhongF"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _MainColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色  光泽度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">NORMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wPos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">TEXCOORD0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到兰伯特光照模型计算的颜色 （逐片元）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光源单位向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算除了兰伯特光照的漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _MainColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到Phong式高光反射模型计算的颜色（逐片元）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wPos, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.视角单位向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceCameraPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz - wPos );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.光的反射单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光反射光线的单位向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> reflectDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(-lightDir, wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //color = 光源颜色 * 材质高光反射颜色 * pow( max(0, dot(视角单位向量, 光的反射单位向量)), 光泽度 )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir, reflectDir)), _SpecularNum );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               v2f v2fData;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               v2fData.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               v2fData.wNormal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               v2fData.wPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">unity_ObjectToWorld</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算兰伯特光照颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算Phong式高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> phongColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_LIGHTMODEL_AMBIENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb + lambertColor + specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(phongColor.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="六、blinn-phong式高光反射光照模型" tabindex="-1">六、Blinn-Phong式高光反射光照模型 <a class="header-anchor" href="#六、blinn-phong式高光反射光照模型" aria-label="Permalink to &quot;六、Blinn-Phong式高光反射光照模型&quot;">​</a></h3><blockquote><p><strong>原理</strong></p></blockquote><ul><li>它是对Phong式高光反射光照模型的改进</li><li>它不再使用反射向量计算镜面反射，而是使用半角向量来进行计算半角向量为视角方向和灯光方向的角平分线方向</li><li>认为高光反射的颜色和 顶点法线向量以及半角向量夹角的余弦成正比</li><li>并且通过对余弦值取n次幂来表示光泽度（或反光度）</li></ul><blockquote><p>Phong和Blinn-Phong的区别</p></blockquote><p>由于两个光照模型中高光反射光照模型的计算方式不一样,从而会带来一些表现上的不同</p><ol><li><p><strong>高光散射</strong> Blinn-Phong模型的高光通常会产生相对均匀的高光散射，这会使物体看起来光滑而均匀。 Phong模型的高光可能会呈现更为锐利的高光散射，因为它基于观察者和光源之间的夹角。 这可能导致一些区域看起来特别亮，而另一些区域则非常暗。</p></li><li><p><strong>高光锐度</strong></p><p>Blinn-Phong模型的高光通常具有较广的散射角，因此看起来不那么锐利。 Phong模型的高光可能会更加锐利，特别是在观察者和光源夹角较小时，可能表现为小而亮的点。</p></li><li><p><strong>光滑度和表面纹理</strong></p><p>Blinn-Phong模型通常更适合表现光滑的表面，因为它考虑了表面微观凹凸之间的相互作用，使得光照在表面上更加均匀分布。 Phong模型有时更适合表现具有粗糙表面纹理的物体，因为它的高光散射可能会使纹理和细节更加突出。</p></li><li><p><strong>镜面高光大小</strong></p><p>Blinn-Phong模型通常产生的镜面高光相对较大，但均匀分布。 Phong模型可能会产生较小且锐利的镜面高光。</p></li></ol><hr><h4 id="_1-公式-4" tabindex="-1">1.公式 <a class="header-anchor" href="#_1-公式-4" aria-label="Permalink to &quot;1.公式&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`高光反射光照颜色 = 光源的颜色 * 材质高光反射颜色 * max（0, 标准化后顶点法线方向向量 · 标准化后半角向量方向向量）幂`<!--]--></span><!--]--><ol><li>标准化后顶点法线方向向量 · 标准化后半角向量方向向量 得到的结果就是 cosθ</li><li><strong>半角向量方向向量 = 视角单位向量 + 入射光单位向量</strong></li><li>幂 代表的是光泽度 余弦值取n次幂</li></ol><h4 id="_2-逐顶点-2" tabindex="-1">2.逐顶点 <a class="header-anchor" href="#_2-逐顶点-2" aria-label="Permalink to &quot;2.逐顶点&quot;">​</a></h4><div class="language-ShaderLab"><button title="Copy code" class="copy"></button><span class="lang">ShaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson41_Blinn-Phong"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">	Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">		_SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)=(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">		_SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">	SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">		Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">			"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">		LOD</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">		Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				v2f data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				data.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//标准化后变焦向量方向向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_MATRIX_M</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDic = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceCameraPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz - wPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//光线方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> LightDic = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfA = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDic + LightDic);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				data.color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_3-逐片元-2" tabindex="-1">3.逐片元 <a class="header-anchor" href="#_3-逐片元-2" aria-label="Permalink to &quot;3.逐片元&quot;">​</a></h4><div class="language-ShaderLab"><button title="Copy code" class="copy"></button><span class="lang">ShaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson42_Blinn-Phong"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">	Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">		//高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">		_SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">		//光泽度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">		_SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">	SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">		Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">			"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">		Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//裁剪空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">NORMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wPos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">TEXCOORD0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">			//对应属性当中的颜色和光泽度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				v2f data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				data.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				data.wPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">unity_ObjectToWorld</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				data.wNormal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//高光反射光照颜色 = 光源的颜色 * 材质高光反射颜色 * max（0, 标准化后顶点法线方向向量 · 标准化后半角向量方向向量）幂</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceCameraPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz - i.wPos );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光线方向 单位向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfA = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir + lightDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射光照颜色 = 光源的颜色 * 材质高光反射颜色 * max（0, 标准化后顶点法线方向向量 · 标准化后半角向量方向向量）幂</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)) , _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七、blinn-phong光照模型" tabindex="-1">七、Blinn Phong光照模型 <a class="header-anchor" href="#七、blinn-phong光照模型" aria-label="Permalink to &quot;七、Blinn Phong光照模型&quot;">​</a></h3><blockquote><p>来历</p></blockquote><p>Blinn Phong光照模型它是由吉姆·布林（Jim Blinn，美国计算机科学家）在1977年时，在Phong光照模型基础上进行修改提出的</p><ul><li>它和Phong一样是一个经验模型，并不符合真实世界中的光照现象 它们只是看起来正确</li></ul><blockquote><p>原理</p></blockquote><p>Blinn Phong和Phong光照模型一样，认为物体表面反射光线是由三部分组成的</p><ul><li><strong>环境光 + 漫反射光 + 镜面反射光（高光反射光）</strong></li></ul><h4 id="_1-公式-5" tabindex="-1">1.公式 <a class="header-anchor" href="#_1-公式-5" aria-label="Permalink to &quot;1.公式&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->物体表面光照颜色 = 环境光颜色 + 漫反射光颜色 + 高光反射光颜色<!--]--></span><!--]--><p>物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Blinn Phong式高光反射光照模型所得颜色</p><p>其中：</p><ul><li>环境光颜色 = <code>UNITY_LIGHTMODEL_AMBIENT(unity_AmbientSky、unity_AmbientEquator、unity_AmbientGround)</code></li><li>漫反射光颜色 = 兰伯特光照模型 计算得到的颜色</li><li>高光反射光颜色 = Blinn Phong式高光反射光照模型 计算得到的颜色</li></ul><h4 id="_2-逐顶点-3" tabindex="-1">2.逐顶点 <a class="header-anchor" href="#_2-逐顶点-3" aria-label="Permalink to &quot;2.逐顶点&quot;">​</a></h4><div class="language-ShaderLab"><button title="Copy code" class="copy"></button><span class="lang">ShaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson44_BlinnPhong"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //材质的漫反射光照颜色</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _MainColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //光泽度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //设置我们的光照模式 ForwardBase这种向前渲染模式 主要是用来处理 不透明物体的 光照渲染的</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //引用对应的内置文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //主要是为了之后 的 比如内置结构体使用，内置变量使用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质的漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //对应属性当中的颜色和光泽度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器传递给片元着色器的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对应顶点的漫反射光照颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">COLOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算兰伯特光照模型 颜色 相关函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getLambertColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> objNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在模型空间下的发现</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //v.normal</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //获取到 相对于世界坐标系下的 发现信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> normal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(objNormal);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //有了相关的参数 就可以用公式来进行计算了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光照颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //_LightColor0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _MainColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(normal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算BlinnPhong高光反射光照模型 颜色 相关函数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> objVertex, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> objNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.标准化后观察方向向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将模型空间下的顶点位置 转换到 世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // UNITY_MATRIX_M : 从模型空间下 转到 世界空间下的转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> worldPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_MATRIX_M</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, objVertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到的就是视角方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceCameraPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz - worldPos;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //单位化（归一化）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.标准化后的反射方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到的光位置的方向向量（世界空间下的）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //法线在世界空间下的向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> normal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(objNormal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量的单位向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfA = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir + lightDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射光照颜色 = 光源的颜色 * 材质高光反射颜色 * max（0, 标准化后观察方向向量· 标准化后的反射方向）幂</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(normal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f v2fData;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的 顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算兰伯特光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getLambertColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算BlinnPhong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex, v.normal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用Phong光照模型公式 进行颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_LIGHTMODEL_AMBIENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb + lambertColor + specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_3-逐片元-3" tabindex="-1">3.逐片元 <a class="header-anchor" href="#_3-逐片元-3" aria-label="Permalink to &quot;3.逐片元&quot;">​</a></h4><div class="language-ShaderLab"><button title="Copy code" class="copy"></button><span class="lang">ShaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson45_BlinnPhongF"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _MainColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色  光泽度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">NORMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wPos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">TEXCOORD0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到兰伯特光照模型计算的颜色 （逐片元）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光源单位向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算除了兰伯特光照的漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _MainColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到Blinn Phong式高光反射模型计算的颜色（逐片元）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wPos, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.视角单位向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceCameraPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz - wPos );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.光的反射单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfA = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir + lightDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //color = 光源颜色 * 材质高光反射颜色 * pow( max(0, dot(视角单位向量, 光的反射单位向量)), 光泽度 )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, halfA)), _SpecularNum );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                 v2f v2fData;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wNormal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">unity_ObjectToWorld</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算兰伯特光照颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算BlinnPhong式高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> blinnPhongColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_LIGHTMODEL_AMBIENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb + lambertColor + specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(blinnPhongColor.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="八、-为何逐片元比逐顶点平滑" tabindex="-1">八、**为何逐片元比逐顶点平滑 <a class="header-anchor" href="#八、-为何逐片元比逐顶点平滑" aria-label="Permalink to &quot;八、**为何逐片元比逐顶点平滑&quot;">​</a></h3><blockquote><p>为什么逐顶点光照的渲染表现比较粗糙</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点以外的像素点颜色，是进行插值运算的结果，效果不真实 <!--]--></span><!--]--><blockquote><p>为什么逐片元光照的渲染表现更加的平滑</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->每一个像素点都利用其相关数据（法线、位置等）进行颜色计算，效果更真实 <!--]--></span><!--]--><p>注意： 也侧面说明了片元着色器的性能消耗更大，顶点着色器的性能消耗更小</p><hr><h2 id="纹理" tabindex="-1">纹理 <a class="header-anchor" href="#纹理" aria-label="Permalink to &quot;纹理&quot;">​</a></h2><blockquote><p>纹理是用来干嘛的</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">模型的骨肉皮</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">骨：模型骨骼</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">肉：三角面片（由模型顶点围成模型的轮廓）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">皮：纹理图片</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">由此可以看出</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">纹理的主要作用就是使用一张图片来控制模型的外观</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">使用纹理映射技术，将图片和模型联系起来，让模型能呈现出图片中的颜色表现</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="一、纹理映射" tabindex="-1">一、纹理映射 <a class="header-anchor" href="#一、纹理映射" aria-label="Permalink to &quot;一、纹理映射&quot;">​</a></h3><p>是计算机图形学中的一种技术，它用来将图像（纹理）映射到三维模型的表面，从而赋予模型更加真实和细致的外观</p><p>这个过程实际上是将二维图像映射到三维空间的过程</p><blockquote><p>如何进行纹理映射</p></blockquote><p>在建模软件中，美术同学会利用纹理展开技术把纹理映射坐标存储在每个顶点上</p><p>模型表面的顶点都与纹理坐标相关联</p><p><strong>纹理坐标通常使用二维坐标系统（称为UV坐标），其中U表示水平轴，V表示垂直轴</strong></p><h4 id="_1-uv坐标" tabindex="-1">1.UV坐标 <a class="header-anchor" href="#_1-uv坐标" aria-label="Permalink to &quot;1.UV坐标&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->二维坐标系统，其中U表示水平轴，V表示垂直轴<!--]--></span><!--]--><blockquote><p>UV坐标的注意事项</p></blockquote><ol><li><p>纹理坐标（UV坐标）的<strong>横轴和纵轴的取值范围是被归一化过的，在<code>[0,1]</code>的范围中</strong></p><p>主要目的是为了适应不同大小的纹理图片（256x256、512x512、1024x1024等等）</p></li><li><p>顶点之间的点（片元），会通过插值运算得到对应的UV坐标</p><p>从而从纹理图片中取出对应位置的颜色</p></li></ol><blockquote><p>如何用缩放平移参数参与uv值计算</p></blockquote><ol><li><p>如何获取模型中携带的uv信息？</p><p>在顶点着色器中，我们可以利用TEXCOORD语义获取到模型中的纹理坐标信息</p><p>它是一个float4类型的</p><p>xy获取到的是纹理坐标的水平和垂直坐标 zw获取到的是纹理携带的一些额外信息，例如深度值等</p></li><li><p>如何计算</p><p>固定算法</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->先缩放，后平(偏)移 缩放用乘法，平(偏)用加法<!--]--></span><!--]--><p><code>纹理坐标.xy * 纹理名_ST.xy + 纹理名_ST.wz</code> 或者直接用内置宏 TRANSFORM_TEX(纹理坐标变量, 纹理变量) 该宏在内部会进行相同的计算</p></li></ol><hr><h3 id="二、重要纹理相关设置" tabindex="-1">二、重要纹理相关设置 <a class="header-anchor" href="#二、重要纹理相关设置" aria-label="Permalink to &quot;二、重要纹理相关设置&quot;">​</a></h3><ol><li><p>Texture Type(纹理图片类型) 和 Texture Shape(纹理图片类型)</p><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">决定了我们是否能在Shader当中获取正确数据</span></span></code></pre><button class="code-block-unfold-btn"></button></div></li><li><p>Wrap Mode(循环模式)</p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">决定了缩放偏移的表现效果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Repeat：在区块中重复纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Clamp： 拉伸纹理的边缘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Mirror：在每个整数边界上镜像纹理以创建重复图案</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Mirror Once：镜像纹理一次，然后将拉伸边缘纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Per</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">axis：单独控制如何在U轴和V轴上包裹纹理</span></span></code></pre><button class="code-block-unfold-btn"></button></div></li><li><p>Filter Mode(过滤模式)</p><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">决定了放大缩小纹理时看到的图片质量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Point：纹理在靠近时变为块状</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Bilinear：纹理在靠近时变得模糊</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Trilinear：与Bilinear类似，但纹理也在不同的Mip级别之间模糊</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">过滤模式在开启MipMaps根据实际表现选择，可以达到不同的表现效果</span></span></code></pre><button class="code-block-unfold-btn"></button></div></li></ol><h3 id="三、单张纹理结合blinnphong光照模型" tabindex="-1">三、单张纹理结合BlinnPhong光照模型 <a class="header-anchor" href="#三、单张纹理结合blinnphong光照模型" aria-label="Permalink to &quot;三、单张纹理结合BlinnPhong光照模型&quot;">​</a></h3><blockquote><p>3点注意点</p></blockquote><ol><li>纹理颜色需要和漫反射颜色 进行乘法叠加, 它们两共同影响最终的颜色</li><li>兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</li><li>最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加 为了避免最终的渲染效果偏灰</li></ol><div class="language-ShaderLab"><button title="Copy code" class="copy"></button><span class="lang">ShaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson50"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //主要就是将单张纹理Shader和布林方光照模型逐片元Shader进行一个结合</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">       _MainTex(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">       _MainColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">       _SpecularColor(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">       _SpecularNum(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">15</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            sampler2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">TEXCOORD0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wNormal:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">NORMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> wPos:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">TEXCOORD1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               v2f data;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">unity_ObjectToWorld</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv).rgb * _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_WorldSpaceLightPos0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * albedo.rgb * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfA = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir + lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">_LightColor0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * _SpecularColor * </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UNITY_LIGHTMODEL_AMBIENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.rgb * albedo + lambertColor + specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="四、凹凸纹理基本概念" tabindex="-1">四、凹凸纹理基本概念 <a class="header-anchor" href="#四、凹凸纹理基本概念" aria-label="Permalink to &quot;四、凹凸纹理基本概念&quot;">​</a></h3><blockquote><p>凹凸纹理是用来做什么的</p></blockquote><p>通过高度纹理或法线纹理在不添加顶点（不增加面）的情况下让模型看起来同样充满细节（凹凸感） 原理：计算“假”凹凸面时，使用“真”凹凸面的法线参与计算</p><h4 id="_4-1-高度纹理贴图" tabindex="-1">4.1 高度纹理贴图 <a class="header-anchor" href="#_4-1-高度纹理贴图" aria-label="Permalink to &quot;4.1 高度纹理贴图&quot;">​</a></h4><p>RGB都存储高度值，表现为一张灰度图，由于需要更多额外计算，我们一般不使用</p><h4 id="_4-2-法线纹理贴图" tabindex="-1">4.2 法线纹理贴图 <a class="header-anchor" href="#_4-2-法线纹理贴图" aria-label="Permalink to &quot;4.2 法线纹理贴图&quot;">​</a></h4><p>RGB分别存储法线的XYZ值，有相对模型空间（彩色）和切线空间（蓝色）两种法线贴图</p><h4 id="_4-3-为什么要使用切线空间下的法线纹理贴图" tabindex="-1">4.3 为什么要使用切线空间下的法线纹理贴图 <a class="header-anchor" href="#_4-3-为什么要使用切线空间下的法线纹理贴图" aria-label="Permalink to &quot;4.3 为什么要使用切线空间下的法线纹理贴图&quot;">​</a></h4><p>切线空间法线贴图虽然要产生额外计算，但是能让法线贴图更加的通用，灵活</p><hr><h3 id="五、法线贴图的计算方式" tabindex="-1">五、法线贴图的计算方式 <a class="header-anchor" href="#五、法线贴图的计算方式" aria-label="Permalink to &quot;五、法线贴图的计算方式&quot;">​</a></h3><blockquote><p>两种主流计算方式</p></blockquote><ol><li><p><strong>切线空间下计算（效率高，全局性差）</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在切线空间中计算，效率更高<!--]--></span><!--]-->，因为可以在顶点着色器中就完成对光照、视角方向的矩 阵变换，计算量相对较小。<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->(矩阵变换在顶点着色器中计算) <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在世界空间中计算，效率较低<!--]--></span><!--]-->，由于需要对法线贴图进行采样，所以变换过程必须在片 元着色器中实现，我们需要在片元着色器中对法线进行矩阵变换。<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->(矩阵变换在片元着色器中计算)<!--]--></span><!--]--></li><li><p><strong>世界空间下计算（效率低，全局性好）</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在切线空间中计算，对全局效果的表现可能会不够准确<!--]--></span><!--]--><p>在处理一些列如镜面反射、环境映射效果时表现效果可能不够准确</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在世界空间中计算，对全局效果的表现更准确 <!--]--></span><!--]--><p>可以更容易的应用于全局效果的计算</p></li></ol><blockquote><p>在切线空间下计算</p></blockquote><p>主要是计算模型空间到切线空间的变换矩阵</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在切线空间下进行光照计算，需要把光照方向、视角方向变换到切线空间下参与计算<!--]--></span><!--]--><p><strong>关键点：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->计算模型空间到切线空间的变换矩阵<!--]--></span><!--]--><p>由于我们<strong>主要用变换矩阵来进行矢量的变换</strong>而非点的变换，因此可以变为3x3矩阵</p><p>而<strong>x、y、z</strong>轴分别为切线空间中顶点的<strong>切线、副切线、法线</strong></p><p>已知切线、法线（从模型数据中可以获取），副切线为切线、法线的叉乘结果</p><p>而3个轴为相互垂直的单位向量，因此可以推出是正交矩阵</p><p>因此该<strong>变换矩阵的逆矩阵为其转置矩阵</strong>它就是<strong>模型空间到切线空间的变换矩阵</strong></p><p><strong>内置函数：</strong></p><p>得到模型空间光的方向：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>ObjSpaceLightDir</strong>(模型空间顶点坐标) <!--]--></span><!--]--></p><p>得到模型空间视角方向：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>ObjSpaceViewDir</strong>(模型空间顶点坐标) <!--]--></span><!--]--></p><p>得到光方向和视角方向相对于模型空间的数据表达后</p><p>再与模型空间到切线空间的变换矩阵进行运算</p><p>即可将他们转换到切线空间下参与后续计算</p><blockquote><p>在世界空间下计算</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在世界空间下进行光照计算，需要把法线方向变换到世界空间下参与计算<!--]--></span><!--]--><p>关键点：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->计算切线空间到世界空间的变换矩阵<!--]--></span><!--]--><p>变换矩阵为子到父的变换</p><p>由于我们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要用变换矩阵来进行矢量的变换<!--]--></span><!--]-->而非点的变换，因此可以变为3x3矩阵</p><p>而<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->x、y、z<!--]--></span><!--]-->轴分别为切线空间中顶点的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->切线、副切线、法线 <!--]--></span><!--]--></p><p>我们只需要得到3个轴相对于世界空间的向量表达，即可得到该变换矩阵</p><p>主要是计算切线空间到世界空间的变换矩阵</p><p>法线从模型空间到世界空间：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>UnityObjectToWorldNormal(模型空间法线数据)</strong><!--]--></span><!--]--></p><p>切线从模型空间到世界空间：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>UnityObjectToWorldDir(模型空间切线数据)</strong><!--]--></span><!--]--></p><p>世界空间的副切线：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>用上面计算的结果叉乘即可</strong><!--]--></span><!--]--></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> binormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>补充</p></blockquote><ol><li><p><strong>模型空间下的切线数据</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->模型数据中的切线数据为**float4类型**的，其中的w表示副切线的方向<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用法线和切线叉乘得到的副切线方向可能有两个，用切线数据中的w与之相乘确定副切线方向<!--]--></span><!--]--></li><li><p><strong>Unity当中的法线纹理类型</strong></p><p>当我们把纹理类型设置为Normal map(法线贴图)时，我们可以使用Unity提供的内置函数 <strong>UnpackNormal</strong>来得到正确的法线方向。该函数内部不仅可以进行<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>法线分量 = 像素分量 * 2 –1</strong><!--]--></span><!--]-->的逆运算，还会进行解压运算（Unity会根据不同平台对法线纹理进行压缩）</p></li><li><p><strong>法线纹理属性命名一般为_BumpMap(凸块贴图)</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**我们还会声明一个名为_BumpScale (凸块缩放) 的float属性**<!--]--></span><!--]--><p><strong>它主要用于控制凹凸程度</strong></p><p>当它为0时，表示没有法线效果，法线的影响会被消除</p><p>当它为1时，表示使用法线贴图中的原始法线信息，没有缩放</p><p>我们可以根据实际需求调整它的值，来达到视觉上令人满意的效果</p></li><li><p><strong>如果使用的凹凸纹理不是法线纹理，而是高度纹理，我们需要进行如下设置</strong></p><p><strong>图片类型设置为Normal map（法线贴图）</strong></p><p><strong>勾选 Create from Grayscale（从灰度创建）</strong></p><p><strong>这样我们就可以把高度纹理当成切线空间下的法线纹理处理了</strong></p><p>多出的Bumpiness（颠簸值）</p><p>控制凹凸程度 Filtering（过滤模式）决定计算凹凸程度的算法</p><p>​ Sharp：滤波生成法线</p><p>​ Smooth：平滑的生成法线</p></li></ol><hr><h3 id="六、凹凸纹理" tabindex="-1">六、凹凸纹理 <a class="header-anchor" href="#六、凹凸纹理" aria-label="Permalink to &quot;六、凹凸纹理&quot;">​</a></h3><h4 id="_6-1-切线空间实现法线纹理" tabindex="-1">6.1 切线空间实现法线纹理 <a class="header-anchor" href="#_6-1-切线空间实现法线纹理" aria-label="Permalink to &quot;6.1 切线空间实现法线纹理&quot;">​</a></h4><blockquote><p>关键点</p></blockquote><ol><li><p><strong>属性相关：</strong></p><ul><li><p>漫反射颜色</p></li><li><p>单张纹理</p></li><li><p>法线纹理</p></li><li><p>凹凸程度</p></li><li><p>高光反射颜色</p></li><li><p>光泽度</p></li></ul></li><li><p>结构体相关</p></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  顶点着色器中传入：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  可以使用 UnityCG.cginc 中的 appdata_full</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  其中包含了我们需要的顶点、法线、切线、纹理坐标相关数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  片元着色器中传入：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  自定义一个结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  其中包含 裁剪空间下坐标、uv坐标、光的方向、视角的方向</span></span></code></pre><button class="code-block-unfold-btn"></button></div><ol start="3"><li>顶点着色器回调函数中</li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-1 顶点坐标模型转裁剪</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-2 单张纹理和法线纹理 UV坐标缩放偏移计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-3 副切线计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      用模型空间中的法线和切线进行叉乘 再乘以切线中的w（确定副切线方向）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-4 构建模型空间到切线空间的变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      ——  切线  ——</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      —— 副切线  ——</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      ——  法线  ——</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-5 将光照方向和视角方向转换到模型空间（利用ObjSpaceLightDir和ObjSpaceViewDir内置函数）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-6 将光照方向和视角方向转换到切线空间（利用变换矩阵进行乘法运算）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><ol start="4"><li>片元着色器回调函数中</li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-1 取出法线贴图中的法线信息（利用纹理采样函数tex2D）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-2 利用内置的UnpackNormal函数对法线信息进行逆运算以及可能的解压</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-3 用得到的切线空间的法线数据 乘以 BumpScale 来控制凹凸程度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-4 得到单张纹理颜色和漫反射颜色的叠加颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-5 用切线空间下的 光方向、视角方向、法线方向 进行Blinn Phong光照模型计算</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>实现</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson51"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">viewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//凹凸程度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//光泽度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_full</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在顶点着色器当中 得到 模型空间到切线空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //切线、副切线、法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> binormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3x3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rotation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3x3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( v.tangent.xyz,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              binormal,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的光的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.lightDir = ObjSpaceLightDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以模型空间到切线空间的转换矩阵 就可以得到切线空间下的 光的方向了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.lightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的视角的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.viewDir = ObjSpaceViewDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> packedNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tangentNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				tangentNormal.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir)));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.viewDir) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal, halfA)), _SpecularNum);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h4 id="_6-2-世界空间实现法线纹理" tabindex="-1">6.2 世界空间实现法线纹理 <a class="header-anchor" href="#_6-2-世界空间实现法线纹理" aria-label="Permalink to &quot;6.2 世界空间实现法线纹理&quot;">​</a></h4><blockquote><p>主要思路</p></blockquote><ul><li>在顶点着色器中计算切线空间到世界空间的变换矩阵</li><li>在片元着色器中进行法线采样转换</li></ul><blockquote><p>关键点</p></blockquote><ol><li><p>属性相关（和切下空间下计算相同）</p></li><li><p>结构体相关</p><p><strong>顶点着色器中传入：</strong> 可以使用 UnityCG.cginc 中的 appdata_full 其中包含了我们需要的顶点、法线、切线、纹理坐标相关数据</p><p><strong>片元着色器中传入：</strong> 自定义一个结构体 其中包含 裁剪空间下坐标、uv坐标、世界空间下顶点位置、变换矩阵</p></li><li><p>顶点着色器回调函数中</p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-1 顶点坐标模型转裁剪</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-2 单张纹理和法线纹理 UV坐标缩放偏移计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-3 模型空间下顶点转换到世界空间下（之后在片元着色器中用于计算视角方向）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-4 将模型空间下的法线、切线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-5 副切线计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      用世界空间下的法线和切线进行叉乘 再乘以切线中的w（确定副切线方向）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-6 构建模型空间到切线空间的变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//       |    |     |</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      切线 副切线 法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//       |    |     |</span></span></code></pre><button class="code-block-unfold-btn"></button></div></li><li><p>片元着色器回调函数中</p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-1 计算光的方向、视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-2 取出法线贴图中的法线信息（利用纹理采样函数tex2D）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-3 利用内置的UnpackNormal函数对法线信息进行逆运算以及可能的解压</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-4 用得到的切线空间的法线数据 乘以 BumpScale 来控制凹凸程度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-5 将计算完毕后的切线空间下的法线转换到世界空间下</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-6 得到单张纹理颜色和漫反射颜色的叠加颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-7 用切线空间下的 光方向、视角方向、法线方向 进行Blinn Phong光照模型计算</span></span></code></pre><button class="code-block-unfold-btn"></button></div></li></ol><hr><h4 id="_6-3-光照方向的计算方式" tabindex="-1">6.3 光照方向的计算方式 <a class="header-anchor" href="#_6-3-光照方向的计算方式" aria-label="Permalink to &quot;6.3 光照方向的计算方式&quot;">​</a></h4><p>计算光照方式的两种方式：</p><ol><li><p><strong>模拟定向光源</strong></p><p>直接得到_WorldSpaceLightPos0光照位置 作为光照方向</p><p>表示光线是平行的，而不是从特定点发射</p><p>一般模拟太阳光效果 采用这种方式</p></li><li><p><strong>模拟点光源</strong></p><p>用光照位置_WorldSpaceLightPos0 减去 顶点坐标 表示光线是从特定点发射的，并朝着顶点方向 一般定点光源 采用这种方式</p></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson52"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//凹凸程度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//光泽度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点相对于世界坐标的位置 主要用于 之后的 视角方向的计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 worldPos:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //切线 到 世界空间的 变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3x3 rotation:TEXCOORD2;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //代表我们切线空间到世界空间的 变换矩阵的3行 tangent to world</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TtoW0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TtoW1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TtoW2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD3;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_full</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到世界空间下的 顶点位置 用于之后在片元中计算视角方向（世界空间下的）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.worldPos = mul(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的法线、切线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldTangent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldBinormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这个就是我们 切线空间到世界空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.rotation = float3x3( worldTangent.x, worldBinormal.x,  worldNormal.x,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //                          worldTangent.y, worldBinormal.y,  worldNormal.y,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //                          worldTangent.z, worldBinormal.z,  worldNormal.z);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent.x, worldBinormal.x,  worldNormal.x, worldPos.x);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent.y, worldBinormal.y,  worldNormal.y, worldPos.y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent.z, worldBinormal.z,  worldNormal.z, worldPos.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下视角方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> packedNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tangentNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把计算完毕后的切线空间下的法线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3x3 rotation = float3x3(i.TtoW0.xyz, i.TtoW1.xyz, i.TtoW2.xyz );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 worldNormal = mul(rotation, tangentNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //本质 就是在进行矩阵运算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW0.xyz, tangentNormal), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW1.xyz, tangentNormal), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW2.xyz, tangentNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightDir)));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightDir));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, halfA)), _SpecularNum);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h4 id="_6-4-如何让凹凸系数不影响光的效果" tabindex="-1">6.4 如何让凹凸系数不影响光的效果 <a class="header-anchor" href="#_6-4-如何让凹凸系数不影响光的效果" aria-label="Permalink to &quot;6.4 如何让凹凸系数不影响光的效果&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//有一种专门的算法</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.只让法线中的xy乘以凹凸系数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//tangentNormal.xy *= _BumpScale;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.保证法线为单位向量（让法线不会为0，而是趋近于顶点法线）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  x² + y² + z² = 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  z² = 1 - (x² + y²)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  z = 根号下(1 - (x² + y²))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//通过这样的计算，当凹凸系数在0~1之间变化时，会保证法线为单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//这样就不会影响光照表现了</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//注意：这种算法并不是来自真实的物理规律</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      只是为了“看起来正常”</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h4 id="_6-5-提升性能的写法" tabindex="-1">6.5 提升性能的写法 <a class="header-anchor" href="#_6-5-提升性能的写法" aria-label="Permalink to &quot;6.5 提升性能的写法&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//我们目前在v2f结构体中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//世界坐标顶点位置和变换矩阵使用了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//float3 和 float3x3 的两个变量来存储</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//但是在很多世界空间下计算 法线贴图的Shader中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//往往会使用3个 float4 类型的变量来存储它们</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//这样做的目的是因为</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//这种写法在很多情况下可以提高性能，因为它更好地与GPU的硬件架构匹配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//float4 类型的寄存器是非常高效的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//因为现代GPU通常会以 4 分量的向量为基本单位进行并行计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//float3x3 矩阵相对来说需要更多的寄存器和指令来表示和计算</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七、渐变纹理" tabindex="-1">七、渐变纹理 <a class="header-anchor" href="#七、渐变纹理" aria-label="Permalink to &quot;七、渐变纹理&quot;">​</a></h3><blockquote><p>渐变纹理是用来做什么的</p></blockquote><p>通过单张纹理和凹凸纹理相关知识的学习，我们知道图片中存储的数据不仅仅可以是颜 色数据，还可以是高度、法线数据。</p><p>理论上来说，图片中存储的数据我们可以自定义规则，我们可以往图片中存储任何满足 我们需求的数据用于渲染。</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->而渐变纹理就是用于控制漫反射光照结果的一种存储数据的方式 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**它的主要作用是让游戏中的对象具有插画卡通风格**<!--]--></span><!--]--><blockquote><p>基本原理</p></blockquote><p>渐变纹理的基本原理就是在计算漫反射时利用<strong>半兰伯特光照模型</strong>公式中<strong>后半部分</strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">半兰伯特：漫反射光照颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 光源的颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 材质的漫反射颜色 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">（（标准化后物体表面法线向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">· 标准化后光源方向向量）</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p><strong>得到一个0~1区间的值</strong>，将这个值<strong>作为uv坐标中的uv值，从渐变纹理中取出颜色</strong>与 公式中前面部分<strong>进行颜色叠加</strong>，最终得到漫反射光照颜色。</p><p>也就是说</p><p>决定漫反射明暗的不再是由 0~1这个值决定 而是由渐变纹理中取出的颜色进行叠加达到最终效果</p><h4 id="_7-1-渐变纹理基础shader实现" tabindex="-1">7.1 渐变纹理基础Shader实现 <a class="header-anchor" href="#_7-1-渐变纹理基础shader实现" aria-label="Permalink to &quot;7.1 渐变纹理基础Shader实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//关键点：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.属性相关</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  渐变纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  光泽度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.结构体相关</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  顶点着色器中传入：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  可以使用 UnityCG.cginc 中的 appdata_base</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  其中包含了我们需要的顶点、法线相关数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  片元着色器中传入：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  自定义一个结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  其中包含 裁剪空间下坐标、世界空间下顶点坐标、世界空间下法线方向</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.顶点着色器回调函数中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-1 顶点坐标模型转裁剪</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-2 顶点坐标模型转世界</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-3 法线从模型转世界</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.片元着色器回调函数中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-1 计算光的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-2 计算半兰伯特光照后半部分公式值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  diffuseColor = 光源的颜色 * 材质的漫反射颜色 *（（标准化后物体表面法线向量· 标准化后光源方向向量）* 0.5 + 0.5）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-3 利用该值从渐变纹理中取出对应颜色，参与漫反射光照计算 得出漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  diffuseColor = 光源的颜色 * 材质的漫反射颜色 * 渐变纹理中取出的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-4 计算Blinn Phong光照模型，其中的漫反射光照颜色使用上一步计算出来的颜色</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson53"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _RampTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RampTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RampTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RampTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.worldNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //漫反射颜色（通过渐变纹理得到的颜色来进行叠加）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfLambertNum = dot(normalize(i.worldNormal), lightDir) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //漫反射颜色 = 光的颜色 * 漫反射颜色 * 渐变纹理中取出的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuseColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_RampTex, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(halfLambertNum, halfLambertNum));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldPos));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldNormal, halfDir)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方 公式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diffuseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_7-2-避免黑点出现" tabindex="-1">7.2 避免黑点出现 <a class="header-anchor" href="#_7-2-避免黑点出现" aria-label="Permalink to &quot;7.2 避免黑点出现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//避免渐变纹理接缝处有黑点</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//我们需要将 Wrap Mode(循环模式)切换为 Clamp(拉伸模式)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//出现黑点的原因是：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//浮点数计算可能存在误差，会出现超过1的值（1.00001）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//如果使用Repeat(重复模式)，会舍弃整数部分，保留小数0.00001</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//这时对应的颜色会是最左边的值，因此会出现黑色</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_7-3-渐变纹理综合shader实现" tabindex="-1">7.3 渐变纹理综合Shader实现 <a class="header-anchor" href="#_7-3-渐变纹理综合shader实现" aria-label="Permalink to &quot;7.3 渐变纹理综合Shader实现&quot;">​</a></h4><blockquote><p>关键点</p></blockquote><p>将原本兰伯特光照模型 修改为渐变纹理的计算方式</p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson54"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _RampTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RampTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">viewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//凹凸程度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RampTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//渐变纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RampTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//渐变纹理的缩放和平移（基本不会用）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//光泽度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_full</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在顶点着色器当中 得到 模型空间到切线空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //切线、副切线、法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> binormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3x3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rotation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3x3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( v.tangent.xyz,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              binormal,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的光的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.lightDir = ObjSpaceLightDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以模型空间到切线空间的转换矩阵 就可以得到切线空间下的 光的方向了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.lightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的视角的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.viewDir = ObjSpaceViewDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> packedNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tangentNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //修改为 渐变纹理相关的计算方式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfLambertNum = dot(normalize(tangentNormal), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //渐变纹理 漫反射计算方式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuseColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_RampTex, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(halfLambertNum,halfLambertNum)).rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.viewDir) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal, halfA)), _SpecularNum);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diffuseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="八、遮罩纹理" tabindex="-1">八、遮罩纹理 <a class="header-anchor" href="#八、遮罩纹理" aria-label="Permalink to &quot;八、遮罩纹理&quot;">​</a></h3><blockquote><p>遮罩纹理是用来做什么的</p></blockquote><p>用于控制或限制某些效果的显示范围，如光照、透明度、特效等等</p><blockquote><p>高光遮罩纹理的基本原理</p></blockquote><ol><li>从纹理中取出对应的遮罩掩码值（颜色的RGB值都可以使用）</li><li>用该掩码值和遮罩系数(我们自己定义的)相乘得到遮罩值</li><li>用该遮罩值和高光反射计算出来的颜色相乘 通过 高光遮罩纹理 和 遮罩系数 共同影响高光反射表现效果</li></ol><blockquote><p>复用法线纹理贴图Shader代码（切线空间下的）</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">region</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 知识点二 将高光遮罩纹理实现融入其中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //1.从纹理中取出对应的遮罩掩码值（颜色的RGB值都可以使用）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //2.用该掩码值和遮罩系数(我们自己定义的)相乘得到遮罩值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //3.用该遮罩值和高光反射计算出来的颜色相乘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endregion</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">region</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 知识点三 遮罩纹理中的RGBA值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //对于高光遮罩纹理中的RGBA值，是非常浪费的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //因为我们只使用其中一个值就可以得到我们想要的数据</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //因此对于遮罩纹理来说</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //我们可以合理的利用其中的每一个值来存储我们想要的数据</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //随着以后的学习</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //我们可以在遮罩纹理当中存储更多信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //比如：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //R值代表高光遮罩数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //G值代表透明遮罩数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //B值代表特效遮罩数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //等等</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //甚至可以用 n 张遮挡纹理存储 4xn 个会参与 每个片元渲染计算的值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endregion</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson55"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularMask"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">viewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//凹凸程度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularMask</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光遮罩纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularMask_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光遮罩纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//遮罩系数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//光泽度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_full</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在顶点着色器当中 得到 模型空间到切线空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //切线、副切线、法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> binormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3x3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rotation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3x3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( v.tangent.xyz,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              binormal,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的光的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.lightDir = ObjSpaceLightDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以模型空间到切线空间的转换矩阵 就可以得到切线空间下的 光的方向了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.lightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的视角的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.viewDir = ObjSpaceViewDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> packedNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tangentNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir)));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.viewDir) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.从纹理中取出对应的遮罩掩码值（颜色的RGB值都可以使用）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.用该掩码值和遮罩系数(我们自己定义的)相乘得到遮罩值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularMaskNum = tex2D(_SpecularMask, i.uv.xy).r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularScale;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //3.用该遮罩值和高光反射计算出来的颜色相乘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal, halfA)), _SpecularNum) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularMaskNum;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="透明" tabindex="-1">透明 <a class="header-anchor" href="#透明" aria-label="Permalink to &quot;透明&quot;">​</a></h2><h3 id="一、渲染顺序的重要性" tabindex="-1">一、渲染顺序的重要性 <a class="header-anchor" href="#一、渲染顺序的重要性" aria-label="Permalink to &quot;一、渲染顺序的重要性&quot;">​</a></h3><blockquote><p>透明混合为什么需要关闭深度写入</p></blockquote><p>在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->图形学中模拟出现实世界的半透明效果是通过将 <!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->多个颜色进行混合计算呈现出来的<!--]--></span><!--]--><p><strong>举例：</strong></p><p>如果前方的A对象不关闭深度写入</p><p>那么B被A遮挡的部分会在深度测试时被舍弃（因为A离摄像机更近深度更小）</p><p>那么我们就无法得到被遮挡部分的颜色，也就无法进行颜色的混合计算</p><p>因此<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们必须关闭透明物体的深度写入 <!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->让其不会导致被遮挡物体无法通过深度测试从而无法进行颜色混合<!--]--></span><!--]--><blockquote><p>关闭深度写入带来的问题</p></blockquote><p>若关闭深度写入，那么物体的渲染顺序就会变得非常的重要</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**谁先被渲染，谁后被渲染都会影响最终的呈现效果** <!--]--></span><!--]--><p><strong>举例一:</strong></p><p>事例一 两个物体A为半透明物体 B为不透明物体</p><p>两种可能的渲染顺序</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->第一种：先渲染B，再渲染A，可以得到正确的半透明效果 <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->第二种：先渲染A，再渲染B，只会看到B的颜色<!--]--></span><!--]--><p><strong>从这个例子我们看出，想要得到正确的半透明混合效果</strong></p><p><strong>需要先渲染不透明物体，再渲染透明物体</strong></p><p><strong>举例二:</strong></p><p>两个物体A B 都为半透明物体</p><p>两种可能的渲染顺序</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**第一种：先渲染B，再渲染A，得到正确的半透明效果** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**第二种：先渲染A，再渲染B，得到错误的半透明效果（B在前）** <!--]--></span><!--]--><p><strong>从这个例子我们看出，想要得到正确的半透明混合效果</strong></p><p><strong>半透明物体之间也需要正确的渲染顺序才能得到正确结果</strong></p><h4 id="_1-如何解决渲染顺序带来的问题" tabindex="-1">1.如何解决渲染顺序带来的问题 <a class="header-anchor" href="#_1-如何解决渲染顺序带来的问题" aria-label="Permalink to &quot;1.如何解决渲染顺序带来的问题&quot;">​</a></h4><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->先渲染所有不透明物体 开启它们的深度测试和深度写入 <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将半透明物体按照离摄像机的远近进行排序，然后从后往前的顺序渲染它们 开启深度测试关闭深度写入<!--]--></span><!--]--></li></ol><h4 id="_2-特殊情况" tabindex="-1">2.特殊情况 <a class="header-anchor" href="#_2-特殊情况" aria-label="Permalink to &quot;2.特殊情况&quot;">​</a></h4><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/渲染顺序特殊情况.png" loading="lazy"></div><p>常规方法：</p><ol><li><strong>先渲染所有不透明物体 开启它们的深度测试和深度写入</strong></li><li><strong>将半透明物体按照离摄像机的远近进行排序，然后从后往前的顺序渲染它们 开启深度测试关闭深度写入（排序是基于物体的，而不是片元的）</strong></li></ol><p>解决方案：</p><ol><li>忍一忍，接受部分细节的小瑕疵</li><li>从模型入手：拆分模型</li><li>使用开启深度写入的半透明效果来模拟半透明（性能消耗较高）</li></ol><hr><h3 id="二、设置深度写入和渲染队列" tabindex="-1">二、设置深度写入和渲染队列 <a class="header-anchor" href="#二、设置深度写入和渲染队列" aria-label="Permalink to &quot;二、设置深度写入和渲染队列&quot;">​</a></h3><blockquote><p>Unity Shader中设置深度写入</p></blockquote><p>深度写入默认是开启的</p><p>我们需要通过渲染状态中的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->ZWrite off<!--]--></span><!--]--> 指令主动关闭深度写入</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**当我们把它写在Pass渲染通道中时，它只会影响该Pass** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**若我们把它写在SubShader语句块中，它将影响其中的所有Pass**<!--]--></span><!--]--><blockquote><p>Unity Shader中设置渲染队列</p></blockquote><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/Unity Shader中设置渲染队列.png" loading="lazy"></div><p>渲染队列一般都定义在SubShader语句块中，影响之后的所有Pass渲染通道</p><p>使用该Shader(着色器)的物体，就会根据你设置的渲染队列在特定的时间进行渲染</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在使用渲染队列Queue 时，一般会搭配忽视投影器IgnoreProjector 和渲染类型RenderType 一起使用<!--]--></span><!--]--><p><strong>忽视投影器IgnoreProjector 标签：</strong></p><p>投影器（Projector）是Unity中的一种特殊的光源，它用于在场景中投射纹理（Texture）或简单的几何形状（如圆形 或方形）来模拟光照、阴影或其他视觉效果。</p><p><strong>渲染类型RenderType 标签：</strong></p><p>对着色器进行分类，用于着色器替换功能，摄像机上有对应API，可以指定渲染类型替换成别的着色器 Opaque(不透明的)、 Transparent(透明的)、 TransparentCutout(透明切割)、 Background(背景)、 Overlay(覆盖)</p><h3 id="三、设置混合命令" tabindex="-1">三、设置混合命令 <a class="header-anchor" href="#三、设置混合命令" aria-label="Permalink to &quot;三、设置混合命令&quot;">​</a></h3><blockquote><p>混合的基本原理</p></blockquote><p>当我们在进行渲染时，当片元通过了深度测试后，会进入到混合流程中。 在混合流程中：</p><p><strong>当前片元的颜色被称为<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->源颜色<!--]--></span><!--]--></strong></p><p><strong>颜色缓冲区中的颜色被称为<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->目标颜色<!--]--></span><!--]--></strong></p><p><strong>混合就是将</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->源颜色和目标颜色用对应的混合算法进行计算后<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->输出一个新的颜色更新到颜色缓冲区中<!--]--></span><!--]--></strong></p><p><strong>注意：这些颜色都是RGBA包含透明通道A</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合透明原理.png" loading="lazy"></div><h4 id="_1-混合的计算规则" tabindex="-1">1.混合的计算规则 <a class="header-anchor" href="#_1-混合的计算规则" aria-label="Permalink to &quot;1.混合的计算规则&quot;">​</a></h4><blockquote><p>混合的计算规则—— 混合因子</p></blockquote><p>混合计算的规则就是需要构建两个混合等式</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合因子.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合因子2.png" loading="lazy"></div><p>如果我们使用方式二来设置因子</p><p>由于没有指定透明相关因子，因此，在计算时</p><p><strong>源透明因子= 源因子</strong></p><p><strong>目标透明因子= 目标因子 即</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合因子3.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合因子4.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合因子5.png" loading="lazy"></div><blockquote><p>混合的计算规则—— 混合操作</p></blockquote><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->BlendOp 混合操作命令来设定混合的计算方式<!--]--></span><!--]--></strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合操作.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/混合操作1.png" loading="lazy"></div><h4 id="_2-常见的混合类型" tabindex="-1">2.常见的混合类型 <a class="header-anchor" href="#_2-常见的混合类型" aria-label="Permalink to &quot;2.常见的混合类型&quot;">​</a></h4><p><strong>Blend：</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/图集/常见混合规则.png" loading="lazy"></div><h3 id="四、透明度测试" tabindex="-1">四、透明度测试 <a class="header-anchor" href="#四、透明度测试" aria-label="Permalink to &quot;四、透明度测试&quot;">​</a></h3><blockquote><p>透明测试的基本原理</p></blockquote><p><strong>基本原理：</strong></p><p>通过一个阈值来决定哪些像素应该被保留，哪些应该被丢弃</p><p><strong>具体实现：</strong></p><p>片元携带的颜色信息中的透明度（A值）</p><p>不满足条件时（通常是小于某个阈值）</p><p>该片元就会被舍弃，被舍弃的片元不会在进行任何处理，不会对颜色缓冲区产生任何影响</p><p>满足条件时（通常是大于等于某个阈值）</p><p>该片元会按照不透明物体的处理方式来处理</p><p><strong>阈值判断使用的方法：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**利用CG中的内置函数：clip(参数)**<!--]--></span><!--]--><p>该函数有重载，参数类型可以是 float4 float3 float2 float 等等 如果传入的参数任何一个分量是负数就会舍弃当前片元 它的内部实现会用到一个 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->discard<!--]--></span><!--]--> 指令，代表剔除该片元 不再参与渲染</p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">   if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      discard;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_1-实现" tabindex="-1">1.实现 <a class="header-anchor" href="#_1-实现" aria-label="Permalink to &quot;1.实现&quot;">​</a></h4><ol><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在属性中加一个阈值_Cutoff,取值范围为0~1，用来设定用来判断的阈值。并在CG中添加属性的映射成员<!--]--></span><!--]--></strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将渲染队列设置为AlphaTest，并配合IgnoreProjector和RenderType一起设置<!--]--></span><!--]--></strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在片元着色器中获取了颜色贴图颜色后，就进行阈值判断<!--]--></span><!--]--></strong></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson56_AlphaTest"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //主要就是将单张纹理Shader和布林方光照模型逐片元Shader进行一个结合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 15</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //透明度测试用的阈值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _Cutoff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cutoff"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //设置渲染队列 决定对象在何时渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"AlphaTest"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"True"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"TransparentCutout"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //透明度测试用的阈值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Cutoff;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理的颜色信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //判断贴图的 颜色信息中的 透明通道 有没有小于阈值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果小于了 就直接丢弃</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Cutoff);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //相当于</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //if(texColor.a - _Cutoff &lt; 0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //if(texColor.a &lt; _Cutoff)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    discard;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="五、透明度混合" tabindex="-1">五、透明度混合 <a class="header-anchor" href="#五、透明度混合" aria-label="Permalink to &quot;五、透明度混合&quot;">​</a></h3><blockquote><p>基本原理</p></blockquote><p><strong>关闭深度写入，开启混合，让片元颜色和颜色缓冲区中颜色进行混合计算</strong></p><blockquote><p>具体实现</p></blockquote><ol><li>采用半透明的混合因子进行混合 Blend SrcAlpha OneMinusSrcAlpha</li></ol><p>​ 因此</p><p>​ *<em>目标颜色 = SrcAlpha * 源颜色 + (1-SrcAlpha)<em>目标颜色</em></em></p><p>​ <strong>= 源颜色透明度 * 源颜色 + (1-源颜色透明度) * 目标颜色</strong></p><ol start="2"><li>声明一个0~1区间的_AlphaScale用于控制对象整体透明度</li></ol><hr><h4 id="_1-实现-1" tabindex="-1">1.实现 <a class="header-anchor" href="#_1-实现-1" aria-label="Permalink to &quot;1.实现&quot;">​</a></h4><ol><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在属性中加一个阈值_AlphaScale,取值范围为0~1，用来设定对象整体透明度。并在CG中添加属性的映射成员<!--]--></span><!--]--></strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将渲染队列设置为Transparent，并配合IgnoreProjector和RenderType一起设置<!--]--></span><!--]--></strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->关闭深度写入Zwrite off，设置混合因子Blend SrcAlpha OneMinusSrcAlpha<!--]--></span><!--]--></strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在片元着色器中获取了颜色贴图颜色后，修改最后返回颜色的A值为 纹理.a * _AlphaScale<!--]--></span><!--]--></strong></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson57_Transparent"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //主要就是将单张纹理Shader和布林方光照模型逐片元Shader进行一个结合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 15</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //用于控制对象整体透明度的值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _AlphaScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"AlphaScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //设置透明度混合的渲染队列 为 透明的Transparent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"True"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //对于处理半透明效果 需要</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //关闭深度写入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //将混合因子 设置为半透明效果的 搭配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于控制对象整体透明度的值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //取出纹理当中的颜色RGBA</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //修改我们的 Alpha返回值 决定颜色的透明度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="六、开启深度写入的半透明效果" tabindex="-1">六、开启深度写入的半透明效果 <a class="header-anchor" href="#六、开启深度写入的半透明效果" aria-label="Permalink to &quot;六、开启深度写入的半透明效果&quot;">​</a></h3><blockquote><p>开启深度写入的半透明效果是用来处理哪种需求的？</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//对于本身结构较为复杂的模型</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//使用之前的透明度混合Shader会由于关闭了深度写入</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//会产生错误的渲染效果</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//虽然我们可以通过拆分模型的方式解决部分问题</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//但是对于一些结构复杂的模型，拆分模型的方式会增加工作量</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//因此我们可以采用 开启深度写入的半透明Shader 来优化效果</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>基本原理</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">使用两个Pass渲染通道来处理渲染逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">第一个Pass：开启深度写入，不输出颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	目的是让该模型各片元的深度值能写入深度缓冲</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">第二个Pass：进行正常的透明度混合</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这样做的话，当执行第一个Pass时，会执行深度测试，并进行深度写入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果此时该片元没有通过深度测试会直接丢弃，不会再执行第二个Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">对于同一个模型中处于屏幕同一位置的片元们，会进行该位置的深度测试再决定渲染哪个片元</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>如何做到不输出颜色？</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">使用 ColorMask </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">颜色遮罩</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 渲染状态</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(命令)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它主要用于控制颜色分量是否写入到颜色缓冲区中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ColorMask RGBA 表示写入颜色的RGBA通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ColorMask 0    表示不写入颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ColorMask RB   表示只写入红色和蓝色通道</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>注意</p></blockquote><ol><li>开启深度写入的半透明效果，模型内部之间不会有任何半透明效果（因为模型内部深度较大的片元会被丢弃掉）</li><li>由于有两个Pass渲染通道，因此它会带来一定的性能开销</li></ol><hr><h4 id="_1-实现-2" tabindex="-1">1.实现 <a class="header-anchor" href="#_1-实现-2" aria-label="Permalink to &quot;1.实现&quot;">​</a></h4><ol><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在SubShader中之前的Pass渲染通道前面加一个Pass渲染通道<!--]--></span><!--]--></strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在新加Pass渲染通道中开启深度写入，并且使用 ColorMask 0 颜色遮罩 渲染命令，不输出颜色<!--]--></span><!--]--></strong></li></ol><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson58"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //主要就是将单张纹理Shader和布林方光照模型逐片元Shader进行一个结合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 15</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //用于控制对象整体透明度的值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _AlphaScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"AlphaScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //设置透明度混合的渲染队列 为 透明的Transparent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"True"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //主要就是进行深度写入 但是不输出颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite On</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ColorMask </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //对于处理半透明效果 需要</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //关闭深度写入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //将混合因子 设置为半透明效果的 搭配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于控制对象整体透明度的值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //取出纹理当中的颜色RGBA</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //修改我们的 Alpha返回值 决定颜色的透明度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七、双面渲染的透明效果" tabindex="-1">七、双面渲染的透明效果 <a class="header-anchor" href="#七、双面渲染的透明效果" aria-label="Permalink to &quot;七、双面渲染的透明效果&quot;">​</a></h3><blockquote><p>双面渲染的透明效果用来处理哪种需求的</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">对于现实世界的半透明物体，我们不仅可以透过它看到其他物体的样子</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">也可以看到这个物体自己的内部结构</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">但是我们之前实现的 透明度测试 和 透明度混合 相关Shader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">都无法看到模型的内部结构</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">而双面渲染的透明效果Shader就是来解决该问题的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">让我们不仅可以透过半透明物体看到其他物体的样子还可以看到自己的内部结构</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>基本原理：</p></blockquote><p><strong>默认情况下，Unity会自动剔除物体的背面，而只渲染物体的正面</strong> 双面渲染的基本原理就是利用我们之前学习过的 Cull 剔除指令来进行指定操作 <strong>Cull Back 背面剔除</strong><strong>Cull Front 正面剔除</strong><strong>Cull Off 不剔除</strong> 不设置的话，默认为背面剔除</p><ul><li><p><strong>对于透明度测试Shader</strong> 由于它无需混合，因此我们直接 关闭剔除即可</p></li><li><p><strong>对于透明度混合Shader</strong> 由于它需要进行混合 需要使用两个Pass，一个用于渲染背面，一个用于渲染正面 两个Pass中除了剔除命令不同 其他代码和之前一致</p></li></ul><h4 id="_1-双面渲染的透明度测试" tabindex="-1">1.双面渲染的透明度测试 <a class="header-anchor" href="#_1-双面渲染的透明度测试" aria-label="Permalink to &quot;1.双面渲染的透明度测试&quot;">​</a></h4><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在Pass中关闭剔除 Cull Off<!--]--></span><!--]--></strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson59_AlphaTest_Both"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //主要就是将单张纹理Shader和布林方光照模型逐片元Shader进行一个结合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 15</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //透明度测试用的阈值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _Cutoff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cutoff"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //设置渲染队列 决定对象在何时渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"AlphaTest"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"True"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"TransparentCutout"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //关闭剔除 让正面和背面都去进行渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //透明度测试用的阈值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Cutoff;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理的颜色信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //判断贴图的 颜色信息中的 透明通道 有没有小于阈值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果小于了 就直接丢弃</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Cutoff);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //相当于</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //if(texColor.a - _Cutoff &lt; 0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //if(texColor.a &lt; _Cutoff)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    discard;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_2-双面渲染的透明度混合" tabindex="-1">2.双面渲染的透明度混合 <a class="header-anchor" href="#_2-双面渲染的透明度混合" aria-label="Permalink to &quot;2.双面渲染的透明度混合&quot;">​</a></h4><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在第一个Pass中剔除正面 Cull Front，在第二个Pass中剔除背面Cull Back<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->相当于一个片元先渲染背面再渲染正面<!--]--></span><!--]--></strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson59_Transparent_Both"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //主要就是将单张纹理Shader和布林方光照模型逐片元Shader进行一个结合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 15</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //用于控制对象整体透明度的值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _AlphaScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"AlphaScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //设置透明度混合的渲染队列 为 透明的Transparent</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"True"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //剔除正面 先去渲染背面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Front</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //对于处理半透明效果 需要</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //关闭深度写入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //将混合因子 设置为半透明效果的 搭配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于控制对象整体透明度的值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //取出纹理当中的颜色RGBA</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //修改我们的 Alpha返回值 决定颜色的透明度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //剔除背面 只渲染正面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Back</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //对于处理半透明效果 需要</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //关闭深度写入</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //将混合因子 设置为半透明效果的 搭配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于控制对象整体透明度的值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //取出纹理当中的颜色RGBA</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //修改我们的 Alpha返回值 决定颜色的透明度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AlphaScale);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="渲染路径" tabindex="-1">渲染路径 <a class="header-anchor" href="#渲染路径" aria-label="Permalink to &quot;渲染路径&quot;">​</a></h2><h3 id="一、渲染路径概述" tabindex="-1">一、渲染路径概述 <a class="header-anchor" href="#一、渲染路径概述" aria-label="Permalink to &quot;一、渲染路径概述&quot;">​</a></h3><blockquote><p>渲染路径是什么</p></blockquote><p>渲染路径（Rendering Path）是指在图形渲染过程中，图形引擎按照特定的步骤和顺序来处理场 景中的几何、光照、材质等信息，最终生成屏幕上的图像的一种算法或策略。</p><p>它决定了图形引擎如何组织和执行渲染过程，以产生最终的视觉效果。</p><p>对于我们来说：在Unity中，<strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染路径决定了光照如何应用到Unity Shader中<!--]--></span><!--]--></strong>，如果要在Unity Shader中和光源打交道，我们需要为每个Pass渲染通道匹配对应的渲染路径，这样**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->才能在Shader 当中获取到正确的光源数据进行处理<!--]--></span><!--]-->**。</p><ul><li><p><strong>总而言之：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染路径会影响光照处理，从而影响最终的渲染效果（光照、阴影等）。<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->存在多种不同的渲染路径<!--]--></span><!--]--></strong></p></li></ul><p><strong>为什么会影响</strong>：我们可以简单理解，使用不同的渲染路径时，Unity在Shader中准备光源数据的流 程是不同的，那么我们在Shader开发时，获取光源数据的方式就会有所不同</p><blockquote><p>渲染路径的种类和设置</p></blockquote><p>我们可以在Camera组件中的Rendering Path（渲染路径）对其进行修改</p><p>在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->内置渲染管线<!--]--></span><!--]-->中主要有3种渲染路径，分别是：</p><ol><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Forward（前向渲染路径）<!--]--></span><!--]--></strong></p><p><strong>默认的标准的渲染方式，适用于相对简单的场景和较少的光源</strong></p></li><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Deferred（延迟渲染路径）<!--]--></span><!--]--></strong></p><p><strong>可以处理较复杂的场景，有大量光源时可以提供更好的性能</strong></p></li><li><p>Legacy Vertex Lit（(遗产)顶点照明渲染路径）</p><p>较适用于为简单的渲染方式，适用于性能受限的场景。 基本已经不会使用</p><p><strong>注意：当显卡不支持选定的渲染路径时会自动选择一个较低精度的渲染路径 比如不支持延迟渲染路径时，前向渲染路径会被采用</strong></p></li></ol><blockquote><p>LightMode标签的作用</p></blockquote><p>我们之前在编写Shader时都会使用**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->LightMode<!--]--></span><!--]-->**（光模式）标签。</p><p>它的主要作用就是来**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->指明该Pass 匹配的渲染路径是哪种<!--]--></span><!--]-->**</p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只要匹配正确，我们便可以获取到正确的光源相关数据<!--]--></span><!--]--></strong></p><p><strong>注意：</strong></p><p><strong>LightMode标签通常应该与Camera中的Rendering Path匹配</strong></p><p>用于指定Pass在渲染过程中的哪个阶段</p><p><strong>如果它们不匹配，可能导致渲染不正确</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/渲染路径/LightMode 标签.png" loading="lazy"></div><p>在Shader开发中如果我们**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->不进行LightMode渲染标签的设置<!--]--></span><!--]-->**。</p><p>比如摄像机默认的是前向渲染路径，但是我们没有为Pass设置相关的标签，那么这个Pass会被当作一个顶点照明渲染路径的Pass。这时光源相关的数据就不会被正确的进行赋值，我们计算出来的 结果就会出现错误，从而<strong>可能呈现出<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->错误的渲染效果<!--]--></span><!--]--></strong>。</p><p><strong>因此</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在进行Unity Shader开发时，我们需要对Pass渲染通道<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->进行正确的LightMode标签设置，从而匹配当前使用的渲染路径<!--]--></span><!--]--></strong></p><hr><h3 id="二、前向渲染路径" tabindex="-1">二、前向渲染路径 <a class="header-anchor" href="#二、前向渲染路径" aria-label="Permalink to &quot;二、前向渲染路径&quot;">​</a></h3><h4 id="_1-前向渲染路径处理光照的方式" tabindex="-1">1.前向渲染路径处理光照的方式 <a class="header-anchor" href="#_1-前向渲染路径处理光照的方式" aria-label="Permalink to &quot;1.前向渲染路径处理光照的方式&quot;">​</a></h4><p>前向渲染路径中会将光源分为以下3种处理方式：</p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->1.逐像素处理（需要高等质量处理的光）<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->2.逐顶点处理（需要中等质量处理的光）<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->3.球谐函数（SH）处理（需要低等质量处理的光）<!--]--></span><!--]--></strong></p><p>球谐函数处理光照的方式是将光照场景投影到球谐函数的空间中，通过一组球谐系数来表示光照。 内存换性能，细节表现效果差（不需要我们自己书写，Unity底层会帮助我们进行处理）</p><blockquote><p>场景当中的各种光源将采用哪种方式处理？</p></blockquote><p><strong>在前向渲染中，一部分最亮的灯光以逐像素处理，然后4个点光源</strong></p><p><strong>以逐顶点方式处理，其余的灯光以SH处理</strong></p><p>一个光源是逐像素、逐顶点还是SH处理主要取决于以下几点：</p><ol><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染模式设置为Not Important(不重要)的灯光始终以 逐顶点或者SH的方式渲染<!--]--></span><!--]--></strong></p></li><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染模式设置为Important(重要)的灯光始终是逐像素渲染<!--]--></span><!--]--></strong></p></li><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最亮的平行光总是逐像素渲染<!--]--></span><!--]--></strong></p></li><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果逐像素光照的灯光数量少于项目质量设置中的<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Pixel Light Count(像素灯光计数)的数量，那么其余比较亮的<!--]--></span><!--]--></strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灯光将会被逐像素渲染<!--]--></span><!--]--></strong></p></li></ol><p><strong>注意：如果灯光渲染模式设置为Auto(自动)，Unity会根据灯光的亮度以及与物体的距离自动判断重要性</strong></p><blockquote><p>前向渲染路径处理光照的方式</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Unity当中有一套划分光源“三六九等”的规则<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要通过灯光渲染模式、项目质量设置中的像素灯光计数的数量、光照强度、距离物体距离来综合判定<!--]--></span><!--]--><hr><h4 id="_2-前向渲染路径在哪里进行光照计算" tabindex="-1">2.前向渲染路径在哪里进行光照计算 <a class="header-anchor" href="#_2-前向渲染路径在哪里进行光照计算" aria-label="Permalink to &quot;2.前向渲染路径在哪里进行光照计算&quot;">​</a></h4><p>要进行光照计算，那肯定是在Shader当中的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Pass渲染通道中进行计算<!--]--></span><!--]-->。</p><p>但是对于前向渲染来说，有两种Pass可以用来进行光照处理：</p><ol><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Base Pass（基础渲染通道<!--]--></span><!--]-->）</strong></p><p>渲染物体的主要光照通道，用于处理主要的光照效果</p><p><strong>主要用于计算逐像素的平行光以及所有逐顶点和SH光源</strong></p><p>可实现的效果：漫反射、高光反射、自发光、阴影、光照纹理等</p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Additional Pass（附加渲染通道）<!--]--></span><!--]--><p>渲染物体额外的光照通道，用于处理一些附加的光照效果</p><p><strong>主要用于计算其他影响物体的逐像素光源</strong></p><p>每个光源都会执行一次该Pass</p><p>可实现的效果：描边、轮廓、辉光等</p></li></ol><p>对于一个<strong>前向渲染路径下的Unity Shader</strong></p><p>通常会<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->定义一个Base Pass（基础渲染通道）<!--]--></span><!--]-->以及一个<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Additional Pass（附加渲染通道）<!--]--></span><!--]--></p><p><strong>每次渲染时</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->一个Base Pass仅会执行一次<!--]--></span><!--]-->（多个Base Pass情况除外）<strong>主要用于渲染环境光或自发光等</strong><p>而<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->一个Additional Pass会根据影响该物体的其他逐像素光源的数量被多次调用<!--]--></span><!--]--></p><p><strong>每个逐像素光源都会调用一次Additional Pass 由于开启了混合，渲染结果会和之前的光照颜色进行混合</strong></p><p><strong>注意：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**Base Pass也可以有多个，比如需要双面渲染的情况** <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Base Pass默认支持阴影， Additional Pass默认不支持 可以通过添加#pragma<!--]--></span><!--]--> <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->multi_compile_fwdadd_fullshadows编译指令开启阴影<!--]--></span><!--]--><p><strong>fwdadd(Forward Additional)</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->这些Pass当中我们具体处理光照的方式是由我们自己决定的，使用逐顶点光照还是逐像素光照的计算方式 都根据我们的具体实现而定，前文提到的逐像素光源只是按照期望处理类型来分的而已<!--]--></span><!--]--></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/渲染路径/常用内置光照变量.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/渲染路径/常用内置光照变量2.png" loading="lazy"></div><p><strong>简而言之：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通过这些内置光照变量，我们便可以获取到前向渲染路径当中，<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对渲染质量有不同要求的光源们的相关数据。<!--]--></span><!--]--><p><strong>我们只需要利用这些数据和函数在</strong></p><p><strong>Base Pass（基础渲染通道）和Additional Pass（附加渲染通道）</strong></p><p><strong>中按照需求进行相关的逻辑处理即可</strong></p><hr><h3 id="三、顶点照明渲染路径" tabindex="-1">三、顶点照明渲染路径 <a class="header-anchor" href="#三、顶点照明渲染路径" aria-label="Permalink to &quot;三、顶点照明渲染路径&quot;">​</a></h3><h4 id="_1-顶点照明渲染路径处理光照的方式" tabindex="-1">1.顶点照明渲染路径处理光照的方式 <a class="header-anchor" href="#_1-顶点照明渲染路径处理光照的方式" aria-label="Permalink to &quot;1.顶点照明渲染路径处理光照的方式&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基本思想就是所有的光都按照逐顶点的方式进行计算的<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在内置渲染管线中，它只会最多记录8个光源的数据<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只会将光相关的数据填充到那些逐顶点相关的内置光源变量<!--]--></span><!--]--><h4 id="_2-顶点照明渲染路径在哪里进行光照计算" tabindex="-1">2. 顶点照明渲染路径在哪里进行光照计算 <a class="header-anchor" href="#_2-顶点照明渲染路径在哪里进行光照计算" aria-label="Permalink to &quot;2. 顶点照明渲染路径在哪里进行光照计算&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在一个Pass当中按照逐顶点的方式一次性对所有光照去进行计算<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/渲染路径/顶点照明渲染路径在哪里进行光照计算.png" loading="lazy"></div><h4 id="_3-顶点照明渲染路径的内置光照变量和函数" tabindex="-1">3.顶点照明渲染路径的内置光照变量和函数 <a class="header-anchor" href="#_3-顶点照明渲染路径的内置光照变量和函数" aria-label="Permalink to &quot;3.顶点照明渲染路径的内置光照变量和函数&quot;">​</a></h4><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/渲染路径/顶点照明渲染路径的内置光照变量和函数2.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/渲染路径/顶点照明渲染路径的内置光照变量和函数.png" loading="lazy"></div><h3 id="四、延迟渲染路径" tabindex="-1">四、延迟渲染路径 <a class="header-anchor" href="#四、延迟渲染路径" aria-label="Permalink to &quot;四、延迟渲染路径&quot;">​</a></h3><h4 id="_1-延迟渲染路径处理光照的方式" tabindex="-1">1.延迟渲染路径处理光照的方式 <a class="header-anchor" href="#_1-延迟渲染路径处理光照的方式" aria-label="Permalink to &quot;1.延迟渲染路径处理光照的方式&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对光照的数量没有任何限制,并且所有灯光都可以采用逐像素渲染<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它不能处理半透明物体，并且不支持真正的抗锯齿<!--]--></span><!--]--><p>延迟渲染的效率不依赖于场景的复杂度，而是和我们使用的屏幕空间的大小有关。</p><p>这是因为延迟渲染路径中除了使用颜色缓冲和深度缓冲外，还会利用一个叫做G缓存的额外缓存区</p><p>它会存储我们关心的表面（通常是离摄像机最近的表面）的其他信息，比如表面的法线、位置、材 质属性等等。总之我们需要的信息都存储到缓冲区中，而这些缓冲区可以理解为一张张的2D图片， 我们实际上是在这些图像空间中进行处理的。</p><h4 id="_2-延迟渲染路径在哪里进行光照计算" tabindex="-1">2.延迟渲染路径在哪里进行光照计算 <a class="header-anchor" href="#_2-延迟渲染路径在哪里进行光照计算" aria-label="Permalink to &quot;2.延迟渲染路径在哪里进行光照计算&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->第一个Pass（对于每个物体，该Pass只会执行一次，通常无需我们自己实现）<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要判断哪些片元可见，并且将可见片元的相关信息存储到G缓冲区中<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->第二个Pass<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用G缓冲区中各个片元的相关信息进行真正的相关计算，最终将颜色写入颜色缓冲区<!--]--></span><!--]--><p><strong>注意：</strong></p><p><strong>在第二个Pass中计算光照时，默认情况下只能用Unity内置的标准(Standard)光照模型计算</strong></p><h4 id="_3-顶点照明渲染路径的内置光照变量" tabindex="-1">3.顶点照明渲染路径的内置光照变量 <a class="header-anchor" href="#_3-顶点照明渲染路径的内置光照变量" aria-label="Permalink to &quot;3.顶点照明渲染路径的内置光照变量&quot;">​</a></h4><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/渲染路径/顶点照明渲染路径的内置光照变量.png" loading="lazy"></div><h3 id="五、渲染路径对比" tabindex="-1">五、渲染路径对比 <a class="header-anchor" href="#五、渲染路径对比" aria-label="Permalink to &quot;五、渲染路径对比&quot;">​</a></h3><h4 id="_1-各渲染路径处理光照的区别" tabindex="-1">1.各渲染路径处理光照的区别 <a class="header-anchor" href="#_1-各渲染路径处理光照的区别" aria-label="Permalink to &quot;1.各渲染路径处理光照的区别&quot;">​</a></h4><p><strong>前向渲染路径：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**有一套划分光源“三六九等”的规则，将光源分成了高中低三种身份** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要通过灯光渲染模式、项目质量设置中的像素灯光计数的数量、光照强度、距离物体距离来综合判定<!--]--></span><!--]--><p><strong>顶点照明渲染路径：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基本思想就是所有的光都按照逐顶点的方式进行计算的<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在内置渲染管线中，它只会最多记录8个光源的数据<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只会将光相关的数据填充到那些逐顶点相关的内置光源变量<!--]--></span><!--]--><p><strong>延迟渲染路径：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对光照的数量没有任何限制,并且所有灯光都可以采用逐像素渲染<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它不能处理半透明物体，并且不支持真正的抗锯齿<!--]--></span><!--]--><h4 id="_2-各渲染路径pass处理的区别" tabindex="-1">2.各渲染路径Pass处理的区别 <a class="header-anchor" href="#_2-各渲染路径pass处理的区别" aria-label="Permalink to &quot;2.各渲染路径Pass处理的区别&quot;">​</a></h4><p><strong>前向渲染路径：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Base Pass（基础渲染通道）：<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要用于处理影响该物体的一个高质量光源（平行光）、所有中（逐顶点处理）低质量（SH处理）光源等<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Additional Pass（附加渲染通道）：<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要用于处理影响该物体的除平行光以外的其它高质量光源（每个高质量光源都会调用）<!--]--></span><!--]--><p><strong>顶点照明渲染路径：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在一个Pass当中按照逐顶点的方式一次性对所有光照去进行计算<!--]--></span><!--]--><p>**延迟渲染路径： **</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->第一个Pass（对于每个物体，该Pass只会执行一次，通常无需我们自己实现）<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要判断哪些片元可见，并且将可见片元的相关信息存储到G缓冲区中<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->第二个Pass 利用G缓冲区中各个片元的相关信息进行真正的相关计算，最终将颜色写入颜色缓冲区<!--]--></span><!--]--><h4 id="_3-各渲染路径的优缺点" tabindex="-1">3.各渲染路径的优缺点 <a class="header-anchor" href="#_3-各渲染路径的优缺点" aria-label="Permalink to &quot;3.各渲染路径的优缺点&quot;">​</a></h4><p><strong>前向渲染路径</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->优点：适用于相对简单的场景和较少数量的光源，基本可以实现任何渲染效果。设备支持率较高<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->缺点：对于复杂场景和大量光源的情况性能消耗相对较大<!--]--></span><!--]--><p><strong>顶点照明渲染路径</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->优点：相对来说，性能开销较小，适用于资源受限设备极差时的轻量级渲染情景<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->缺点：表现效果较差，光照计算精度较低<!--]--></span><!--]--><p><strong>延迟渲染路径</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->优点：适用于复杂场景和大量光源，能够有效减少光照计算的开销<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->缺点：对于透明物体和一些特殊效果不能直接支持，需要复杂的处理。并且对硬件有一定要求，不 是所有设备都支持，在一些性能较差的移动设备上不受支持<!--]--></span><!--]--><hr><h2 id="多种光源处理" tabindex="-1">多种光源处理 <a class="header-anchor" href="#多种光源处理" aria-label="Permalink to &quot;多种光源处理&quot;">​</a></h2><blockquote><p>Shader 开发中常用的光源属性</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->位置、方向、颜色、强度、衰减<!--]--></span><!--]--><h3 id="一、多种光源" tabindex="-1">一、多种光源 <a class="header-anchor" href="#一、多种光源" aria-label="Permalink to &quot;一、多种光源&quot;">​</a></h3><h4 id="_1-平行光" tabindex="-1">1.平行光 <a class="header-anchor" href="#_1-平行光" aria-label="Permalink to &quot;1.平行光&quot;">​</a></h4><p><strong>充当角色：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->太阳<!--]--></span><!--]--></strong></p><p><strong>照射范围：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->无限制<!--]--></span><!--]--></strong></p><p><strong>特点：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它不存在固定的位置 <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的重要属性只有方向（可以通过Transform的Rotation属性来改变方向）<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它到场景中所有点的方向都是一样的<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->由于它没有位置，因此它没有衰减的概念（光的强度不会随着距离而发生变化）<!--]--></span><!--]--></li></ol><h4 id="_2-点光源" tabindex="-1">2.点光源 <a class="header-anchor" href="#_2-点光源" aria-label="Permalink to &quot;2.点光源&quot;">​</a></h4><p><strong>充当角色：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灯泡、烛光等<!--]--></span><!--]--></strong></p><p><strong>照射范围：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->有限<!--]--></span><!--]--></strong></p><p><strong>特点：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的光是由一个点发出的，向四面八方延伸的光<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的范围由参数Range来决定<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的位置由Transform中的Position来决定<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它存在衰减，随着物体离点光源距离决定衰减强弱<!--]--></span><!--]--></li></ol><h4 id="_3-聚光灯" tabindex="-1">3.聚光灯 <a class="header-anchor" href="#_3-聚光灯" aria-label="Permalink to &quot;3.聚光灯&quot;">​</a></h4><p><strong>充当角色：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->探照灯、手电筒等<!--]--></span><!--]--></strong></p><p><strong>照射范围：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->有限<!--]--></span><!--]--></strong></p><p><strong>特点：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的光范围由空间中的一块锥形区域定义<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的范围由参数Range和Spot Angle 共同决定<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的位置由Transform中的Position来决定<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它存在衰减，随着物体离聚光灯距离决定衰减强弱。 但是它相对点光源衰减计算公式更复杂，因为需要点是否在锥形范围内<!--]--></span><!--]--></li></ol><hr><h3 id="二、如何在shader中判断光源类型" tabindex="-1">二、如何在Shader中判断光源类型 <a class="header-anchor" href="#二、如何在shader中判断光源类型" aria-label="Permalink to &quot;二、如何在Shader中判断光源类型&quot;">​</a></h3><blockquote><p>前向渲染路径中我们主要关注处理什么内容？</p></blockquote><p><strong>两个Pass</strong></p><ol><li><p><strong>Base Pass（基础渲染通道，每个片元只会计算一次）：</strong> 只需要处理一个逐像素平行光源（一般场景中最亮会自动赋值对应变量） 其他的中（逐顶点）、低质量（SH）光源Unity会帮助我们处理</p></li><li><p><strong>Additional Pass（附加渲染通道）:</strong></p><p>除了最亮的平行光、其他高质量的光源(可能是平行光、点光源、聚光灯)都会调用一次该Pass进行计算</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->因此我们一般需要在Additional Pass中判断光源类型来分别处理部分逻辑<!--]--></span><!--]--></li></ol><blockquote><p>如何在Shader中判断光源类型</p></blockquote><p>Unity中提供了三个重要的宏 分别是：</p><ul><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->_DIRECTIONAL_LIGHT : 平行光<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->_POINT_LIGHT : 点光源<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->_SPOT_LIGHT : 聚光灯<!--]--></span><!--]--></li></ul><p>宏在这里的作用： 可以用于在编译时根据条件判断来包含或排除不同的代码块，实现条件编译</p><p>我们可以使用这些宏配合Unity Shader中的条件编译预处理指令 用于在编译时根据一定的条件选择性地包含或排除代码块</p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	#</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_DIRECTIONAL_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    平行光逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_POINT_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    点光源逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_SPOT_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    聚光灯逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    其他逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>Unity底层会根据该条件编译指令</p><p>生成成多个 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Shader Variants（着色器变体）<!--]--></span><!--]--></p><p>这些 Variants 变体<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->共享相同的核心代码<!--]--></span><!--]-->，但<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->根据条件编译的选择会包含不同的代码块<!--]--></span><!--]--></p><blockquote><p><strong>Shader variants 的基本概念</strong></p></blockquote><p>是在编写 shader 时， 通过条件编译指令（<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->#if, #elif, #else, #endif）<!--]--></span><!--]--> 根据不同的配置选项生成多个版本的 shader。 这些不同版本的 shader 称为 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->shader variants<!--]--></span><!--]-->。</p><hr><h3 id="三、光照衰减" tabindex="-1">三、光照衰减 <a class="header-anchor" href="#三、光照衰减" aria-label="Permalink to &quot;三、光照衰减&quot;">​</a></h3><blockquote><p>光照衰减的基本概念</p></blockquote><p>​ <strong>光照衰减通常指的是在渲染过程中考虑光线在空间中传播时的减弱效应</strong></p><p>​ 比如：</p><p>​ <strong>任何光源的光照亮度会随着物体离光源的距离增加而迅速衰减</strong></p><p>​ <strong>一般常见的光照衰减计算方式有</strong></p><p>​ <strong>1. <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->线性衰减<!--]--></span><!--]--></strong></p><p>​ <strong>光强度与距离成线性关系。即光照衰减与光源到被照射表面的距离成正比</strong>。</p><p>​ <strong>2. <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->平方衰减<!--]--></span><!--]--></strong></p><p>​ <strong>光强度与距离的平方成反比。这种模型更符合现实世界中光照的特性，因为光在空间中的传播过程中通常会遵循平方衰减规律。</strong></p><blockquote><p>Unity中的光照衰减</p></blockquote><p>​ Unity中为了提升性能，我们一般不会直接通过数学公式计算光照衰减</p><p>​ 而是使用一张纹理作为<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->查找表（LUT, lookup table）<!--]--></span><!--]--> 在片元着色器中计算逐像素光照的 衰减</p><p>​ Unity Shader中有一个内置的纹理类型的变量 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->_LightTexture0<!--]--></span><!--]--></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->该纹理中存储了衰减值相关的数据<!--]--></span><!--]--></p><p>​ Unity 内部预先就计算好了相关数据 并存入到该纹理中，避免重复计算，提升性能表现</p><p>​ 其中</p><p>​ 它的对角线上的纹理颜色值，表明了光源空间中不同位置的点对应的衰减值</p><p>​ <strong>纹理中的对角线</strong></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->起点 (0,0) 位置，表示和光源重合的点的衰减值<!--]--></span><!--]--></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->终点（1,1) 位置，表示在光源空间中离光源距离最远的点的衰减值<!--]--></span><!--]--></p><p>​ 一般我们直接从**_LightTexture0中进行纹理采样后，利用其中的<span style="color:red">UNITY_ATTEN_CHANNEL宏</span>来得到衰减值所在的分量**</p><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTexture0, 对应纹理uv坐标).UNITY_ATTEN_CHANNEL</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>​ 注意:</p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果光源存在cookie，也就是灯光遮罩<!--]--></span><!--]--></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>那么衰减查找纹理便是 _LightTextureB0</strong><!--]--></span><!--]--></p><h4 id="_1-光源空间变换矩阵" tabindex="-1">1.光源空间变换矩阵 <a class="header-anchor" href="#_1-光源空间变换矩阵" aria-label="Permalink to &quot;1.光源空间变换矩阵&quot;">​</a></h4><p>​ 是用于将世界空间下的位置转换到光源空间下（光源位置为原点）的</p><p>​ <strong>老版本：<span style="color:red">_LightMatrix0</span></strong></p><p>​ <strong>新版本：<span style="color:red">unity_WorldToLight</span></strong></p><p>​ 由于我们需要从 _LightTexture0 光照纹理中取出对应的衰减数据</p><p>​ 因此我们需要将顶点位置从世界空间中转换到光源空间中</p><p>​ 然后再来从其中取得衰减数据</p><p>​ 我们可以通过矩阵运算将世界空间下的点转换到光源空间下</p><p>​ <span style="color:red">mul(unity_WorldToLight, float4(worldPos, 1));</span></p><hr><h3 id="四、点光源衰减计算" tabindex="-1">四、点光源衰减计算 <a class="header-anchor" href="#四、点光源衰减计算" aria-label="Permalink to &quot;四、点光源衰减计算&quot;">​</a></h3><blockquote><p>点光源衰减计算</p></blockquote><p>​ <strong>注意：一般点光源我们不会为其添加cookie光照遮罩</strong></p><p>​ 一般想要使用光照遮罩都会在聚光灯中使用</p><p>​ 因此我们不用考虑cookie纹理的问题</p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->1. 将顶点从世界空间转换到光源空间<!--]--></span><!--]--></p><pre><code> ```C#
 float3 lightCoord = mul(unity_WorldToLight, float4(worldPos, 1)).xyz;
 ```
</code></pre><p>​ lightCoord 是光源坐标系下顶点根据光源的范围range规范化后的坐标</p><p>​ 相当于是一个模长为<code>0~1</code>之间的向量</p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->2. 利用该光源空间下的坐标来计算离光源的距离<!--]--></span><!--]--></p><p>​ 并利用距离参数，从光源纹理中采样</p><pre><code>```C#
fixed atten = tex2D(_LightTexture0, dot(lightCoord, lightCoord).xx).UNITY_ATTEN_CHANNEL;

dot(LightCoord, LightCoord).xx 中

dot(LightCoord, LightCoord) 是为了通过点乘得到 结果 x² + y² + z² = 离光源距离 distance²
```
</code></pre><p>​ <strong>xx是一种特殊写法，目的是构建一个 float2 代表uv坐标</strong></p><p>​ <strong>这里的 uv坐标 相当于是 (distance², distance²)</strong></p><p>​ <strong>用distance²做uv坐标，而不是distance</strong></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->1. 为了避免开平方带来性能消耗<!--]--></span><!--]--></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->2. 采用这种平方衰减更符合现实世界中光照的特性<!--]--></span><!--]--></p><p>​ 因为人眼对亮部不敏感，而对暗部敏感，这样我们就可以将 衰减值的精度 集中在比较远的地方</p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->distance是0.5时，distance2是0.25<!--]--></span><!--]-->，这样LUT查找表中大部分值都会留给比较远的部分</p><h3 id="五、聚光灯衰减计算" tabindex="-1">五、聚光灯衰减计算 <a class="header-anchor" href="#五、聚光灯衰减计算" aria-label="Permalink to &quot;五、聚光灯衰减计算&quot;">​</a></h3><blockquote><p>聚光灯默认Cookie</p></blockquote><p>​ 我们知道灯光组件中有一个Cookie参数，是用来关联光照遮罩图片的</p><p>​ 对于平行光和点光源，默认是不会提供任何光照遮罩信息的</p><p>​ 但是对于聚光灯来说</p><p>​ Unity会默认为它提供一个Cookie光照遮罩</p><p>​ 主要是用于模拟聚光灯的区域性</p><p>​ 而此时 光照纹理中</p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->_LightTexture0 存储的是Cookie纹理信息<!--]--></span><!--]--></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->_LightTextureB0 存储的是光照纹理信息，里面包含衰减值<!--]--></span><!--]--></p><p>​ 因此</p><p>​ <strong>1.获取聚光灯衰减值时</strong></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->需要从_LightTextureB0中进行采样<!--]--></span><!--]--></p><p>​ <strong>2.获取遮罩范围相关数据时</strong></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->需要从_LightTexture0中进行采样<!--]--></span><!--]--></p><h4 id="_1-聚光灯衰减计算" tabindex="-1">1.聚光灯衰减计算 <a class="header-anchor" href="#_1-聚光灯衰减计算" aria-label="Permalink to &quot;1.聚光灯衰减计算&quot;">​</a></h4><blockquote><p>将顶点从世界空间转换到光源空间</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_WorldToLight, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldPos, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">));</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>​ <strong>注意：</strong></p><p>​ 这里我们转换后和点光源不同的是</p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->点光源<!--]--></span><!--]-->只会获取其中的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->xyz<!--]--></span><!--]--></p><p>​ <strong>而<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->聚光灯<!--]--></span><!--]-->会获取其中的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->xyzw<!--]--></span><!--]--></strong></p><p>​ <strong>这是因为在聚光灯光源空间下的w值有特殊含义</strong></p><p>​ <strong>会参与后续的计算</strong></p><blockquote><p>利用光源空间下的坐标信息</p></blockquote><p>​ 我们会通过3个步骤去获取聚光灯的衰减信息</p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = (lightCoord.z &gt; 0) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //第一步</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTexture0, lightCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightCoord.w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">).w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //第二步</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTextureB0, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//第三步</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//我们首先分析和点光源相同的部分——第三步</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTextureB0, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//这一步的规则和点光源规则一致，直接根据距离光源原点距离的平方从光照纹理中获取衰减值</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>需要注意的是</p><ol><li><strong>聚光灯的光照衰减纹理为_LightTextureB0</strong></li><li><strong>dot函数只会计算xyz，w不会计算</strong></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  接着我们来分析用于进行范围判断的部分——第一、二步</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">第一步：(lightCoord.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">CG语法中没有显示的bool类型，一般情况下 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 表示false，</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">表示true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">也就是说lightCoord.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">的返回值，条件满足时为1，条件不满足为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这里的z代表的其实是 目标点 相对于 聚光灯照射面 距离</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果 lightCoord.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 证明在聚光灯照射方向的背面，就不应该受到聚光灯的影响</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">也就是说这一步的主要作用，是用来决定顶点是否受到聚光灯光照的影响</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">第二步：</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTexture0, lightCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightCoord.w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">).w</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们以前在进行纹理采样时都会进行一个 先缩放 后 平移 的操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">比如：uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">而第二步中的 lightCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightCoord.w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 其实也是在做这样的一个操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这样做的主要目的是因为：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们需要把uv坐标映射到0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">~</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">的范围内再从纹理中采样</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">lightCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightCoord.w </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">进行缩放后</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">y的取值范围是</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">-0.5~0.5</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">之间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">再加上0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.5</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">后</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">x</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">y的取值范围就是0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">~1</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">之间</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">便可以进行正确的纹理采样了</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">而lightCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">xy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> / </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lightCoord</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">w</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 是因为聚光灯有很多横截面</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">我们需要把各横截面映射到最大的面上进行采样</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_2-总结" tabindex="-1">2.总结 <a class="header-anchor" href="#_2-总结" aria-label="Permalink to &quot;2.总结&quot;">​</a></h4><p>看似复杂的聚光灯光照衰减计算方式</p><p>其实就是由 <code>“&lt;ColorText color="red"&gt;遮罩衰减&lt;/ColorText&gt;”</code>和 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->距离衰减<!--]--></span><!--]--> 共同决定的</p><p><strong>第一步：判断是否能有机会照到光 看得到为1，看不到为0</strong></p><pre><code>fixed atten = (lightCoord.z &gt; 0) *
</code></pre><p><strong>第二步：缩放平移，映射到遮罩纹理采样 根据遮罩纹理的信息决定衰减叠加</strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTexture0, lightCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightCoord.w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">).w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p><strong>第三步：从光照衰减纹理中取出按距离得到的衰减值</strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTextureB0, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightCoord, lightCoord).rr).UNITY_ATTEN_CHANNEL;</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p><strong>代码</strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson64_ForwardLighting"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色  光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //Bass Pass 基础渲染通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于帮助我们编译所有变体 并且保证衰减相关光照变量能够正确赋值到对应的内置变量中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到兰伯特光照模型计算的颜色 （逐片元）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光源单位向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算除了兰伯特光照的漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到Blinn Phong式高光反射模型计算的颜色（逐片元）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.视角单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - wPos );</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.光的反射单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //color = 光源颜色 * 材质高光反射颜色 * pow( max(0, dot(视角单位向量, 光的反射单位向量)), 光泽度 )</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, halfA)), _SpecularNum );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v2fData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算兰伯特光照颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算BlinnPhong式高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值 会和 漫反射颜色 + 高光反射颜色 后 再进行乘法运算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> blinnPhongColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(blinnPhongColor.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //Additional Pass 附加渲染通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardAdd"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //线性减淡的效果 进行 光照颜色混合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend One One</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于帮助我们编译所有变体 并且保证衰减相关光照变量能够正确赋值到对应的内置变量中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdadd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v2fData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //平行光 光的方向 其实就是它的位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_DIRECTIONAL_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldLightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //点光源和聚光灯 光的方向 是 光的位置 - 顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 漫反射颜色 = 光颜色 * 属性中颜色 * max(0, dot(世界坐标系下的法线, 世界坐标系下的光方向));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, worldLightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //BlinnPhong高光反射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceCameraPos.xyz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.wPos.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldLightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 高光颜色 = 光颜色 * 属性中的高光颜色 * pow(max(0, dot(世界坐标系法线, 世界坐标系半角向量)), 光泽度);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specular</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, halfDir)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #ifdef USING_DIRECTIONAL_LIGHT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                    fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">POINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                        //将世界坐标系下顶点转到光源空间下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                        float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_WorldToLight, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                        //利用这个坐标得到距离的平方 然后再再光源纹理中隐射得到衰减值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = tex2D(_LightTexture0, dot(lightCoord,lightCoord).xx).UNITY_ATTEN_CHANNEL;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SPOT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                        //将世界坐标系下顶点转到光源空间下 聚光灯需要用w参与后续计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                        float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_WorldToLight, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = (lightCoord.z &gt; 0) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //判断在聚光灯前面吗</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                                      tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTexture0, lightCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightCoord.w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">).w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //映射到大图中进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                                      tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTextureB0, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightCoord,lightCoord).xx).UNITY_ATTEN_CHANNEL; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//距离的平方采样</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在附加渲染通道中不需要在加上环境光颜色了 因为它只需要计算一次 在基础渲染通道中已经计算了</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">((diffuse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specular)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //该注释主要用于进行阴影投影 主要是用来计算阴影映射纹理的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //Pass{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    Tags{"LightMode" = "ShadowCaster"}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  该编译指令时告诉Unity编译器生成多个着色器变体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  用于支持不同类型的阴影（SM，SSSM等等）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  可以确保着色器能够在所有可能的阴影投射模式下正确渲染</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    #pragma multi_compile_shadowcaster</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  其中包含了关键的阴影计算相关的宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    struct v2f{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //顶点到片元着色器阴影投射结构体数据宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //这个宏定义了一些标准的成员变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //这些变量用于在阴影投射路径中传递顶点数据到片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //我们主要在结构体中使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //        V2F_SHADOW_CASTER;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    v2f vert(appdata_base v)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //        v2f data;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //转移阴影投射器法线偏移宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //用于在顶点着色器中计算和传递阴影投射所需的变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //主要做了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //2-2-1.将对象空间的顶点位置转换为裁剪空间的位置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //2-2-2.考虑法线偏移，以减轻阴影失真问题，尤其是在处理自阴影时</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //2-2-3.传递顶点的投影空间位置，用于后续的阴影计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //我们主要在顶点着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //        TRANSFER_SHADOW_CASTER_NORMALOFFSET(data);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //        return data;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    float4 frag(v2f i):SV_Target</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //阴影投射片元宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //将深度值写入到阴影映射纹理中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //我们主要在片元着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //        SHADOW_CASTER_FRAGMENT(i);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //    ENDCG</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Specular"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="阴影" tabindex="-1">阴影 <a class="header-anchor" href="#阴影" aria-label="Permalink to &quot;阴影&quot;">​</a></h2><h3 id="一、阴影的基本原理" tabindex="-1">一、阴影的基本原理 <a class="header-anchor" href="#一、阴影的基本原理" aria-label="Permalink to &quot;一、阴影的基本原理&quot;">​</a></h3><blockquote><p>现实中阴影的产生规则</p></blockquote><p><strong>现实中的阴影产生规则是:</strong></p><p><strong>在不考虑光线反射的前提下</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->当一个光源发射的一条光线遇到一个不透明物体A时<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->这条光线就不能够再继续照亮其他物体了（物体B的一部分）<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->相当于光线被更靠近光源的A物体挡住了一些<!--]--></span><!--]--><p><strong>这时物体A就会向旁边的物体B投射阴影</strong></p><p><strong>也就是说</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->阴影区域的产生就是因为光线无法到达<!--]--></span><!--]--><h4 id="_1-shadow-mapping技术" tabindex="-1">1.Shadow Mapping技术 <a class="header-anchor" href="#_1-shadow-mapping技术" aria-label="Permalink to &quot;1.Shadow Mapping技术&quot;">​</a></h4><blockquote><p><strong>原理：</strong></p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将摄像机的位置放在和光源重合的位置上<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->那么场景中关于这个光源的阴影区域就是摄像机看不到的位置<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：一般情况下，点光源用透视投影，平行光用正交投影<!--]--></span><!--]--><blockquote><p><strong>在Unity中的本质：</strong></p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->生成一张深度图（阴影映射纹理），一般存于显存中<!--]--></span><!--]--><p>这张深度图<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->记录了从该光源位置出发，能看到的场景中距离它 <!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最近表面的位置<!--]--></span><!--]--><p><strong>（一般记录其深度信息，值转换为0~1之间，0最近，1最远）</strong></p><p><strong>Shadow Mapping <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->阴影贴图技术就是将摄像机的位置放在和光 源重合的位置上，场景中关于这个光源的阴影区域就是摄像机看 不到的位置。它会生成一张深度图（阴影隐射纹理），一般存于 显存中。记录了从该光源位置出发，能看到的场景中距离它最近 表面的深度信息<!--]--></span><!--]-->（0~1之间，0最近，1最远）</strong></p><hr><h4 id="_2-unity中如何应用shadow-mapping技术" tabindex="-1">2.Unity中如何应用Shadow Mapping技术 <a class="header-anchor" href="#_2-unity中如何应用shadow-mapping技术" aria-label="Permalink to &quot;2.Unity中如何应用Shadow Mapping技术&quot;">​</a></h4><p>**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->阴影映射纹理的生成是由光源完成的<!--]--></span><!--]--> **</p><p>**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们只需要在Pass中计算出顶点深度和阴影映射纹理中采样出的结果进行比较<!--]--></span><!--]--> **</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->判断该顶点是否在阴影中，进行对应的处理即可<!--]--></span><!--]--><hr><h3 id="二、unity中阴影的实现原理" tabindex="-1">二、Unity中阴影的实现原理 <a class="header-anchor" href="#二、unity中阴影的实现原理" aria-label="Permalink to &quot;二、Unity中阴影的实现原理&quot;">​</a></h3><h4 id="_1-screen-space-shadow-mapping-技术" tabindex="-1">1.Screen Space Shadow Mapping 技术 <a class="header-anchor" href="#_1-screen-space-shadow-mapping-技术" aria-label="Permalink to &quot;1.Screen Space Shadow Mapping 技术&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Screen Space Shadow Mapping（ SSSM ）：屏幕空间阴影映射技术<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基于Shadow Mapping 技术的基础上 需要多生成一张深度图—— 屏幕空间深度图。<!--]--></span><!--]--><blockquote><p><strong>原理：</strong></p></blockquote><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基于光源位置生成的阴影映射纹理<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基于渲染游戏画面时得到的屏幕空间深度图<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将屏幕像素位置变换到光源空间下<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对屏幕空间深度图和阴影映射纹理进行采样比较深度值 决定最后的阴影处理效果<!--]--></span><!--]--></li></ol><hr><h4 id="_2-unity中如何实现阴影" tabindex="-1">2.Unity中如何实现阴影 <a class="header-anchor" href="#_2-unity中如何实现阴影" aria-label="Permalink to &quot;2.Unity中如何实现阴影&quot;">​</a></h4><p>Unity会调用 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->LightMode（灯光模式）<!--]--></span><!--]--></p><p>被设置为<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->ShadowCaster（阴影投射器）的Pass （渲染通道）<!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**来生成对应的阴影映射纹理（Shadow Mapping技术），以便在后续的阴影计算中使用** <!--]--></span><!--]--><p><strong>阴影映射纹理的计算过程往往不需要我们手动处理</strong></p><p><strong>Unity中提供了对应的阴影相关的宏帮助我们进行计算</strong></p><p><strong>我们直接调用它们即可</strong></p><p><strong>注意：如果Shader中没有LightMode为ShadowCaster的Pass，会在Shader中的Fallback指定的 Shader中继续寻找，直到找到对应Pass。如果没有找到，那么该物体就无法向其他物体投射阴影， 因为阴影映射纹理计算中就不会计算该物体的信息。（但是该物体仍可以接收其他物体的投影）</strong></p><p>而对于支持SSSM（屏幕空间阴影映射技术）的设备来说</p><p>除了阴影映射纹理外，还需要屏幕空间深度图。</p><p>而<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>屏幕空间深度图通常由摄像机在渲染过程中自动生成，并存储在摄像机的深度纹理中</strong><!--]--></span><!--]--></p><p>我们只需要在计算时</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->从光源的阴影映射纹理以及屏幕空间深度图中进行采样比较深度即可<!--]--></span><!--]--><p><strong>同样这个过程往往不需要我们手动处理</strong></p><p><strong>Unity中提供了对应的阴影相关的宏帮助我们进行计算 我们直接调用它们即可</strong></p><p>需要注意的是，<strong>物体接收来自其他物体的阴影和物体向其它物体投射阴影是两个过程：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->物体接收来自其他物体的阴影 必须在Shader中对阴影映射纹理（SM或SSSM中的阴影图）进行采样 把采样结果和最后的光照结果相乘来产生阴影效果<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->物体向其它物体投射阴影 必须将该物体加入到光源的阴影映射纹理的计算中，必须要有LightMode（灯光模式）被设置为 B ShadowCaster（阴影投射器）的Pass （渲染通道），这样才能让其他物体在对阴影映射纹理采样 时，得到该物体的相关信息。<!--]--></span><!--]--></li></ol><p>想要让<strong>物体接收来自其他物体的阴影</strong>和<strong>物体向其它物体投射阴影</strong></p><p>我们需要在Unity中对光源和物体进行一些设置：</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->保证光源能够生成阴影映射纹理—— 光源组件上设置Shadow Type（阴影类型）<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->保证物体能接收其他物体的阴影—— 网格渲染器组件上勾选Receive Shadows（接收阴影）<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->保证物体向其它物体投射阴影—— 网格渲染器组件上设置Cast Shadows（投射阴影）<!--]--></span><!--]--></li></ol><p><strong>想要在Unity中实现阴影效果，必须注意以下三点：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对光源 以及物体进行相关设置<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->让光源开启阴影，让物体能够投射和接收阴影<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->想要向其它物体投射阴影的物体Shader 中<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->必须要有LightMode被设置为ShadowCaster的Pass，才能在阴影映射纹理中记录自己的信息<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->想要接收其他物体投射的阴影的物体Shader 中<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->必须对阴影映射纹理进行采样，用于最后的光照计算<!--]--></span><!--]--></li></ol><hr><h3 id="三-让物体投射阴影——不透明物体阴影" tabindex="-1">三.让物体投射阴影——不透明物体阴影 <a class="header-anchor" href="#三-让物体投射阴影——不透明物体阴影" aria-label="Permalink to &quot;三.让物体投射阴影——不透明物体阴影&quot;">​</a></h3><blockquote><p>不投射阴影的原因</p></blockquote><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->该Shader中没有LightMode为ShaderCaster的Pass，无法参与光源的阴影映射纹理的计算<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->该Shader并没有对阴影映射相关纹理进行采样，没有进行阴影相关颜色运算<!--]--></span><!--]--></li></ol><blockquote><p>让物体投射阴影的方法</p></blockquote><p><strong>第一种方法：</strong></p><p>最后加上<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->FallBack <code>"Specular"</code><!--]--></span><!--]--></p><p><strong>第二种方法：</strong></p><p>需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->实现 LightMode(灯光模式) 为 ShadowCaster(阴影投射) 的 Pass(渲染通道)<!--]--></span><!--]--></p><p>一个编译指令，一个内置文件，三个关键宏</p><p><strong>编译指令：</strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma multi_compile_shadowcaster</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>该编译指令时告诉Unity编译器生成多个着色器变体</p><p>用于支持不同类型的阴影（SM，SSSM等等）</p><p>可以确保着色器能够在所有可能的阴影投射模式下正确渲染</p><p><strong>内置文件：</strong></p><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#include "UnityCG.cginc"</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>其中包含了关键的阴影计算相关的宏</p><p><strong>三个关键宏:</strong></p><ol><li></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">V2F_SHADOW_CASTER</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>顶点到片元着色器阴影投射结构体数据宏</p><p>这个宏定义了一些标准的成员变量</p><p>这些变量用于在阴影投射路径中传递顶点数据到片元着色器</p><p>我们主要在结构体中使用</p><ol start="2"><li></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">TRANSFER_SHADOW_CASTER_NORMALOFFSET</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>转移阴影投射器法线偏移宏</p><p>用于在顶点着色器中计算和传递阴影投射所需的变量</p><p><strong>主要做了</strong></p><p><strong>2-1.将对象空间的顶点位置转换为裁剪空间的位置</strong></p><p><strong>2-2.考虑法线偏移，以减轻阴影失真问题，尤其是在处理自阴影时</strong></p><p><strong>2-3.传递顶点的投影空间位置，用于后续的阴影计算</strong></p><ol start="3"><li></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">SHADOW_CASTER_FRAGMENT</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>阴影投射片元宏</p><p>将深度值写入到阴影映射纹理中</p><p>我们主要在片元着色器中使用</p><h4 id="实现" tabindex="-1">实现 <a class="header-anchor" href="#实现" aria-label="Permalink to &quot;实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">        "LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ShadowCaster"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //  该编译指令时告诉Unity编译器生成多个着色器变体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //  用于支持不同类型的阴影（SM，SSSM等等）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //  可以确保着色器能够在所有可能的阴影投射模式下正确渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma multi_compile_shadowcaster</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //  其中包含了关键的阴影计算相关的宏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点到片元着色器阴影投射结构体数据宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //这个宏定义了一些标准的成员变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //这些变量用于在阴影投射路径中传递顶点数据到片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //我们主要在结构体中使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            V2F_SHADOW_CASTER;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //转移阴影投射器法线偏移宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //用于在顶点着色器中计算和传递阴影投射所需的变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //主要做了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //2-2-1.将对象空间的顶点位置转换为裁剪空间的位置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //2-2-2.考虑法线偏移，以减轻阴影失真问题，尤其是在处理自阴影时</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //2-2-3.传递顶点的投影空间位置，用于后续的阴影计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //我们主要在顶点着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        TRANSFER_SHADOW_CASTER_NORMALOFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //阴影投射片元宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //将深度值写入到阴影映射纹理中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //我们主要在片元着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        SHADOW_CASTER_FRAGMENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//第二种方法直接最后写</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Specular"</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="四-让物体接收阴影——不透明物体" tabindex="-1">四.让物体接收阴影——不透明物体 <a class="header-anchor" href="#四-让物体接收阴影——不透明物体" aria-label="Permalink to &quot;四.让物体接收阴影——不透明物体&quot;">​</a></h3><blockquote><p>流程</p></blockquote><ol><li><p><strong>在顶点着色器中进行顶点坐标转换（将顶点坐标 转换为 阴影映射纹理坐标）</strong></p></li><li><p><strong>在片元着色器中使用阴影映射纹理坐标在阴影映射纹理中进行采样</strong></p><p><strong>通过得到的深度值判断片元（像素）是否在阴影中，以计算出阴影衰减值</strong></p></li><li><p><strong>将采样结果参与到最终的颜色计算中</strong></p></li></ol><blockquote><p>实现物体接收阴影效果</p></blockquote><p>1.接受阴影的<strong>三剑客（三个宏）</strong></p><p>首先我们需要在Bass Pass当中引用包含内置文件</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`\#include "AutoLight.cginc"`<!--]--></span><!--]--><p>该内置文件中，有用于计算阴影时需要使用的三剑客</p><p>1-1.<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->SHADOW_COORDS (阴影坐标宏)<!--]--></span><!--]--></p><p>​ 该宏<strong>在v2f结构体（顶点着色器返回值）中使用</strong></p><p>​ 本质上就是声明了一个用于对阴影纹理进行采样的坐标</p><p>​ 在内部实际上就是声明了一个名为_ShadowCoord的阴影纹理坐标变量</p><p>​ 需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意<!--]--></span><!--]-->的是：</p><p>​ 在使用时 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->SHADOW_COORDS(2) 传入参数2<!--]--></span><!--]--></p><p>​ <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->表示需要时下一个可用的插值寄存器的索引值<!--]--></span><!--]--></p><p>1-2.<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->TRANSFER_SHADOW (转移阴影宏)<!--]--></span><!--]--></p><p>​ 该宏<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在顶点着色器函数中调用，传入对应的v2f结构体对象<!--]--></span><!--]--></p><p>​ 该宏会在内部自己判断应该使用哪种阴影映射技术（SM、SSSM）</p><p>​ 最终的目的就是<strong>将顶点进行坐标转换并存储到_ShadowCoord阴影纹理坐标变量中</strong></p><p>需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意<!--]--></span><!--]-->的是：</p><ol><li><p>该宏会在<strong>内部使用顶点着色器中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->传入<!--]--></span><!--]-->的结构体</strong></p><p>该结构体中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点的命名必须是vertex<!--]--></span><!--]--></p></li><li><p>该宏会在<strong>内部使用顶点着色器的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->返回<!--]--></span><!--]-->结构体</strong></p><p>其中的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点位置<!--]--></span><!--]--> <strong>命名必须是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->pos<!--]--></span><!--]--></strong></p></li></ol><p>2-3.<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->SHADOW_ATTENUATION (阴影衰减宏)<!--]--></span><!--]--></p><p>​ 该宏在<strong>片元着色器中调用，传入对应的v2f结构体对象</strong></p><p>​ 该宏会在内部利用v2f中的 阴影纹理坐标变量(ShadowCoord)对相关纹理进行采样</p><p>​ 将采样得到的深度值进行比较，以计算出一个fixed3的阴影衰减值</p><p>​ 我们<strong>只需要使用它<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->返回的结果和 (漫反射+高光反射) 的结果相乘<!--]--></span><!--]-->即可</strong></p><hr><h4 id="实现-1" tabindex="-1">实现 <a class="header-anchor" href="#实现-1" aria-label="Permalink to &quot;实现&quot;">​</a></h4><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson67_Shadow"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //高光反射颜色  光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //Bass Pass 基础渲染通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用于帮助我们编译所有变体 并且保证衰减相关光照变量能够正确赋值到对应的内置变量中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //引用包含该内置文件 其中有计算阴影会用到的三个宏（阴影三剑客）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在v2f结构体（顶点着色器返回值）中使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      本质上就是声明了一个用于对阴影纹理进行采样的坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      在内部实际上就是声明了一个名为_ShadowCoord的阴影纹理坐标变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      需要注意的是：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      在使用时 SHADOW_COORDS(2) 传入参数2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      表示需要时下一个可用的插值寄存器的索引值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影坐标宏 主要用于存储阴影纹理坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到兰伯特光照模型计算的颜色 （逐片元）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光源单位向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算除了兰伯特光照的漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到Blinn Phong式高光反射模型计算的颜色（逐片元）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.视角单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - wPos );</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.光的反射单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //color = 光源颜色 * 材质高光反射颜色 * pow( max(0, dot(视角单位向量, 光的反射单位向量)), 光泽度 )</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, halfA)), _SpecularNum );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v2fData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在顶点着色器函数中调用，传入对应的v2f结构体对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏会在内部自己判断应该使用哪种阴影映射技术（SM、SSSM）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      最终的目的就是将顶点进行坐标转换并存储到_ShadowCoord阴影纹理坐标变量中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      需要注意的是：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      1.该宏会在内部使用顶点着色器中传入的结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //        该结构体中顶点的命名必须是vertex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      2.该宏会在内部使用顶点着色器的返回结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //        其中的顶点位置命名必须是pos</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算阴影映射纹理坐标 它会在内部去进行计算 然后将其存入 v2f中的SHADOW_COORDS中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v2fData);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算兰伯特光照颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算BlinnPhong式高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到阴影衰减值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在片元着色器中调用，传入对应的v2f结构体对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏会在内部利用v2f中的 阴影纹理坐标变量(ShadowCoord)对相关纹理进行采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      将采样得到的深度值进行比较，以计算出一个fixed3的阴影衰减值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      我们只需要使用它返回的结果和 (漫反射+高光反射) 的结果相乘即可</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> shadow</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SHADOW_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值 会和 漫反射颜色 + 高光反射颜色 后 再进行乘法运算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> blinnPhongColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">shadow;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(blinnPhongColor.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //Additional Pass 附加渲染通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardAdd"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //线性减淡的效果 进行 光照颜色混合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend One One</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用于帮助我们编译所有变体 并且保证衰减相关光照变量能够正确赋值到对应的内置变量中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #pragma multi_compile_fwdadd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v2fData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //平行光 光的方向 其实就是它的位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_DIRECTIONAL_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldLightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //点光源和聚光灯 光的方向 是 光的位置 - 顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    // 漫反射颜色 = 光颜色 * 属性中颜色 * max(0, dot(世界坐标系下的法线, 世界坐标系下的光方向));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, worldLightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //BlinnPhong高光反射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceCameraPos.xyz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.wPos.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldLightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 高光颜色 = 光颜色 * 属性中的高光颜色 * pow(max(0, dot(世界坐标系法线, 世界坐标系半角向量)), 光泽度);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specular</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, halfDir)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_DIRECTIONAL_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                    fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_POINT_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //将世界坐标系下顶点转到光源空间下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_WorldToLight, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用这个坐标得到距离的平方 然后再再光源纹理中隐射得到衰减值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = tex2D(_LightTexture0, dot(lightCoord,lightCoord).xx).UNITY_ATTEN_CHANNEL;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_SPOT_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //将世界坐标系下顶点转到光源空间下 聚光灯需要用w参与后续计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightCoord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_WorldToLight, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = (lightCoord.z &gt; 0) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //判断在聚光灯前面吗</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTexture0, lightCoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightCoord.w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">).w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //映射到大图中进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_LightTextureB0, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(lightCoord,lightCoord).xx).UNITY_ATTEN_CHANNEL; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//距离的平方采样</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                    fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //在附加渲染通道中不需要在加上环境光颜色了 因为它只需要计算一次 在基础渲染通道中已经计算了</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">((diffuse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specular)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Specular"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="五-光照衰减和阴影——不透明物体" tabindex="-1">五.光照衰减和阴影——不透明物体 <a class="header-anchor" href="#五-光照衰减和阴影——不透明物体" aria-label="Permalink to &quot;五.光照衰减和阴影——不透明物体&quot;">​</a></h3><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将三剑客中的前两剑客，在Additional Pass 附加渲染通道中也添加上<!--]--></span><!--]--><p><strong>注意：需要在附加渲染通道中包含内置文件 AutoLight.cginc</strong> （因为不仅三剑客来自于它，UNITY_LIGHT_ATTENUATION-Unity光照衰减宏也来自于它）</p></li><li><p>修改两个Pass的片元着色器中衰减计算相关的代码</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->使用 UNITY_LIGHT_ATTENUATION 宏替代原有逻辑<!--]--></span><!--]--><p><strong>该宏需要传入3个参数</strong><strong>第一个参数是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用来存储最终衰减值的变量名<!--]--></span><!--]-->（不用声明，内部会声明）</strong><strong>第二个参数是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->片元着色器中传入的v2f结构体对象<!--]--></span><!--]--></strong><strong>第三个参数是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点相对于世界坐标系的位置<!--]--></span><!--]--></strong><strong>最终<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将得到的衰减结果和 (漫反射+高光反射) 的结果相乘<!--]--></span><!--]-->即可</strong></p></li><li><p><strong>为了让Additional Pass 附加渲染通道能够添加阴影效果</strong> 需要将编译指令进行修改</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将原本的 #pragma multi_compile_fwdadd<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->修改为 #pragma multi_compile_fwdadd_fullshadows<!--]--></span><!--]--><p><strong>这样Unity会生成多个包括支持和不支持阴影的Shader变体</strong><strong>从而为额外的逐像素光源计算阴影，并传递给Shader了</strong></p></li></ol><hr><h4 id="实现-2" tabindex="-1">实现 <a class="header-anchor" href="#实现-2" aria-label="Permalink to &quot;实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson68_Attenuation"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光反射颜色  光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //Bass Pass 基础渲染通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于帮助我们编译所有变体 并且保证衰减相关光照变量能够正确赋值到对应的内置变量中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //引用包含该内置文件 其中有计算阴影会用到的三个宏（阴影三剑客）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在v2f结构体（顶点着色器返回值）中使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      本质上就是声明了一个用于对阴影纹理进行采样的坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      在内部实际上就是声明了一个名为_ShadowCoord的阴影纹理坐标变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      需要注意的是：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      在使用时 SHADOW_COORDS(2) 传入参数2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      表示需要时下一个可用的插值寄存器的索引值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影坐标宏 主要用于存储阴影纹理坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到兰伯特光照模型计算的颜色 （逐片元）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光源单位向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算除了兰伯特光照的漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到Blinn Phong式高光反射模型计算的颜色（逐片元）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">in</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.视角单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - wPos );</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.光的反射单位向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //color = 光源颜色 * 材质高光反射颜色 * pow( max(0, dot(视角单位向量, 光的反射单位向量)), 光泽度 )</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(wNormal, halfA)), _SpecularNum );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v2fData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在顶点着色器函数中调用，传入对应的v2f结构体对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏会在内部自己判断应该使用哪种阴影映射技术（SM、SSSM）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      最终的目的就是将顶点进行坐标转换并存储到_ShadowCoord阴影纹理坐标变量中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      需要注意的是：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      1.该宏会在内部使用顶点着色器中传入的结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //        该结构体中顶点的命名必须是vertex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      2.该宏会在内部使用顶点着色器的返回结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //        其中的顶点位置命名必须是pos</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算阴影映射纹理坐标 它会在内部去进行计算 然后将其存入 v2f中的SHADOW_COORDS中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v2fData);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算兰伯特光照颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getLambertFColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算BlinnPhong式高光反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> getSpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到阴影衰减值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在片元着色器中调用，传入对应的v2f结构体对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏会在内部利用v2f中的 阴影纹理坐标变量(ShadowCoord)对相关纹理进行采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      将采样得到的深度值进行比较，以计算出一个fixed3的阴影衰减值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      我们只需要使用它返回的结果和 (漫反射+高光反射) 的结果相乘即可</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //fixed3 shadow = SHADOW_ATTENUATION(i);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //fixed atten = 1;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用灯光衰减和阴影衰减计算宏统一进行衰减值的计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.wPos)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //物体表面光照颜色 = 环境光颜色 + 兰伯特光照模型所得颜色 + Phong式高光反射光照模型所得颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值 会和 漫反射颜色 + 高光反射颜色 后 再进行乘法运算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> blinnPhongColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(blinnPhongColor.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //Additional Pass 附加渲染通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardAdd"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //线性减淡的效果 进行 光照颜色混合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend One One</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于帮助我们编译所有变体 并且保证衰减相关光照变量能够正确赋值到对应的内置变量中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //#pragma multi_compile_fwdadd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdadd_fullshadows</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //材质漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点着色器返回出去的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的 顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在v2f结构体（顶点着色器返回值）中使用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      本质上就是声明了一个用于对阴影纹理进行采样的坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      在内部实际上就是声明了一个名为_ShadowCoord的阴影纹理坐标变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      需要注意的是：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      在使用时 SHADOW_COORDS(2) 传入参数2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      表示需要时下一个可用的插值寄存器的索引值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影坐标宏 主要用于存储阴影纹理坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v2fData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的顶点到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换模型空间下的法线到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转到世界空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2fData.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏在顶点着色器函数中调用，传入对应的v2f结构体对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      该宏会在内部自己判断应该使用哪种阴影映射技术（SM、SSSM）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      最终的目的就是将顶点进行坐标转换并存储到_ShadowCoord阴影纹理坐标变量中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      需要注意的是：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      1.该宏会在内部使用顶点着色器中传入的结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //        该结构体中顶点的命名必须是vertex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //      2.该宏会在内部使用顶点着色器的返回结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //        其中的顶点位置命名必须是pos</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算阴影映射纹理坐标 它会在内部去进行计算 然后将其存入 v2f中的SHADOW_COORDS中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v2fData);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2fData;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //平行光 光的方向 其实就是它的位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_DIRECTIONAL_LIGHT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldLightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //点光源和聚光灯 光的方向 是 光的位置 - 顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    fixed3 worldLightDir = normalize(_WorldSpaceLightPos0.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 漫反射颜色 = 光颜色 * 属性中颜色 * max(0, dot(世界坐标系下的法线, 世界坐标系下的光方向));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, worldLightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //BlinnPhong高光反射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceCameraPos.xyz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.wPos.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角方向向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldLightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> viewDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 高光颜色 = 光颜色 * 属性中的高光颜色 * pow(max(0, dot(世界坐标系法线, 世界坐标系半角向量)), 光泽度);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specular</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal, halfDir)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //衰减值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //#if defined(_DIRECTIONAL_LIGHT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    fixed atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //#elif defined(_POINT_LIGHT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //将世界坐标系下顶点转到光源空间下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    float3 lightCoord = mul(unity_WorldToLight, float4(i.wPos, 1)).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //利用这个坐标得到距离的平方 然后再再光源纹理中隐射得到衰减值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    fixed atten = tex2D(_LightTexture0, dot(lightCoord,lightCoord).xx).UNITY_ATTEN_CHANNEL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //#elif defined(_SPOT_LIGHT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //将世界坐标系下顶点转到光源空间下 聚光灯需要用w参与后续计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    float4 lightCoord = mul(unity_WorldToLight, float4(i.wPos, 1));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    fixed atten = (lightCoord.z &gt; 0) *</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //判断在聚光灯前面吗</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //                  tex2D(_LightTexture0, lightCoord.xy / lightCoord.w + 0.5).w *</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //映射到大图中进行采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //                  tex2D(_LightTextureB0, dot(lightCoord,lightCoord).xx).UNITY_ATTEN_CHANNEL;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //距离的平方采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //#else</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    fixed atten = 1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用灯光衰减和阴影衰减计算宏统一进行衰减值的计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.wPos)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在附加渲染通道中不需要在加上环境光颜色了 因为它只需要计算一次 在基础渲染通道中已经计算了</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">((diffuse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specular)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Specular"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="六-透明度测试物体阴影实现——透明物体" tabindex="-1">六.透明度测试物体阴影实现——透明物体 <a class="header-anchor" href="#六-透明度测试物体阴影实现——透明物体" aria-label="Permalink to &quot;六.透明度测试物体阴影实现——透明物体&quot;">​</a></h3><h4 id="_6-1-透明物体投射阴影" tabindex="-1">6.1 透明物体投射阴影 <a class="header-anchor" href="#_6-1-透明物体投射阴影" aria-label="Permalink to &quot;6.1 透明物体投射阴影&quot;">​</a></h4><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->同样我们使用FallBack的形式投射阴影<!--]--></span><!--]--><p>但是需要注意的是</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->FallBack的内容为：Transparent/Cutout/VertexLit<!--]--></span><!--]--><p>该默认Shader中会把裁剪后的物体深度信息写入到 阴影映射纹理和摄像机深度图中 注意：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->使用该默认Shader计算投射阴影时，需要使用_Cutoff属性 和 _Color属性来进行相关计算<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->因此我们必须保证我们的Shader当中有名为_Cutoff的阈值属性 和 _Color的漫反射颜色属性<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->否则无法得到正确阴影结果<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->为了得到正确的阴影效果，我们需要将该物体的Cast Shadows（投射阴影）属性设置为Two Sided（双面）<!--]--></span><!--]--><p>强制让Unity计算阴影隐射纹理时计算所有面的深度信息。 因为如果不设置，默认将物体渲染到阴影隐射纹理和摄像机深度图时只会考虑物体的正面 背对光源的面不会参与计算，设置为双面后即可参与计算，得到正确的结果</p></li></ol><h4 id="_6-2-透明物体接收阴影" tabindex="-1">6.2 透明物体接收阴影 <a class="header-anchor" href="#_6-2-透明物体接收阴影" aria-label="Permalink to &quot;6.2 透明物体接收阴影&quot;">​</a></h4><ol><li><p><strong>编译指令</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->#pragma multi_compile_fwdbase<!--]--></span><!--]--><p>用于帮助我们编译所有变体 并且保证衰减相关光照变量能够正确赋值到对应的内置变量中</p></li><li><p><strong>包含内置文件</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->#include "AutoLight.cginc"<!--]--></span><!--]--></li><li><p><strong>结构体中声明阴影坐标宏</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->SHADOW_COORDS(n)<!--]--></span><!--]--><p>n为下一个可用的插值寄存器的索引值（结构体前面有几个TEXCOORD就填几）</p></li><li><p><strong>坐标转换宏</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->TRANSFER_SHADOW(o);<!--]--></span><!--]--></li><li><p><strong>Unity光照衰减计算宏</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->UNITY_LIGHT_ATTENUATION(atten, v2f结构体, 顶点世界坐标位置);<!--]--></span><!--]--></li></ol><h4 id="实现-3" tabindex="-1">实现 <a class="header-anchor" href="#实现-3" aria-label="Permalink to &quot;实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson69_AlphaTestShadow"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //主要就是将单张纹理Shader和布林方光照模型逐片元Shader进行一个结合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 15</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">       //透明度测试用的阈值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">       _Cutoff</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cutoff"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //设置渲染队列 决定对象在何时渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"AlphaTest"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "IgnoreProjector"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"True"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"TransparentCutout"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //关闭剔除 让正面和背面都去进行渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹理贴图对应的映射成员</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色、高光反射颜色、光泽度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //透明度测试用的阈值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Cutoff;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影坐标宏</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //把模型空间下的顶点转换到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.wPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //坐标转换宏</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(data)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理的颜色信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //判断贴图的 颜色信息中的 透明通道 有没有小于阈值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果小于了 就直接丢弃</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Cutoff);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //相当于</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //if(texColor.a - _Cutoff &lt; 0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //if(texColor.a &lt; _Cutoff)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    discard;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：纹理颜色需要和漫反射材质颜色叠加（乘法） 共同决定最终的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向（指向光源方向）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射颜色 = 光的颜色 * 漫反射材质的颜色 * max(0, dot(世界坐标系下的法线, 光的方向))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：兰伯特光照模型计算时，漫反射材质颜色使用 1 中的叠加颜色计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, lightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // 视角方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 viewDir = normalize(_WorldSpaceCameraPos.xyz - i.wPos);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量 = 视角方向 + 光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lightDir);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射的颜色 = 光的颜色 * 高光反射材质的颜色 * pow(max(0, dot(世界坐标系下的法线, 半角向量)), 光泽度)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.wNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算光照衰减和阴影衰减的宏</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.wPos)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方光照颜色 = 环境光颜色 + 兰伯特漫反射颜色 + 高光反射的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //新知识点：最终使用的环境光叠加时，环境光变量UNITY_LIGHTMODEL_AMBIENT需要和 1 中颜色进行乘法叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //         为了避免最终的渲染效果偏灰</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (lambertColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent/Cutout/VertexLit"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七-透明度混合物体阴影实现——透明物体" tabindex="-1">七.透明度混合物体阴影实现——透明物体 <a class="header-anchor" href="#七-透明度混合物体阴影实现——透明物体" aria-label="Permalink to &quot;七.透明度混合物体阴影实现——透明物体&quot;">​</a></h3><ol><li><strong>投射阴影</strong> 在FallBack中关联内置的对应Shader（<code>"Transparent/VertexLit"</code>）</li><li><strong>接受阴影</strong> 在Shader中书写计算阴影衰减值的相关代码 因此对于透明度混合的Shader也会使用同样的思路去制作</li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->但是！！！<!--]--></span><!--]--><p>由于透明度混合需要关闭深度写入 而阴影相关的处理需要用到深度值参与计算 因此Unity中从性能方面考虑（要计算半透明物体的的阴影表现效果是相对复杂的） 所有的内置半透明Shader都不会产生阴影效果（比如 Transparent/VertexLit） 因此 2-1.透明混合Shader想要 投射阴影时 <strong>不管你在FallBack中写入哪种自带的半透明混合Shader</strong><strong>都不会有投射阴影的效果，因为深度不会写入</strong></p><p>2-2.透明混合Shader想要 接受阴影时 <strong>Unity内置关于阴影接收计算的相关宏</strong><strong>不会计算处理 透明混合Shader</strong><strong>混合因子 设置为半透明效果<code>(Blend SrcAlpha OneMinusSrcAlpha)</code>的Shader</strong><strong>因为透明混合物体的深度值和遮挡关系无法直接用传统的深度缓冲和阴影贴图来处理</strong></p><p>结论：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Unity中不会直接为透明度混合Shader处理阴影<!--]--></span><!--]--><hr><h2 id="标准光照着色器" tabindex="-1">标准光照着色器 <a class="header-anchor" href="#标准光照着色器" aria-label="Permalink to &quot;标准光照着色器&quot;">​</a></h2><h3 id="一、标准漫反射shader" tabindex="-1">一、标准漫反射Shader <a class="header-anchor" href="#一、标准漫反射shader" aria-label="Permalink to &quot;一、标准漫反射Shader&quot;">​</a></h3><ol><li><strong>加入渲染标签Tags <code>{ "RenderType"="Opaque" "Queue"="Geometry"}</code></strong><strong>渲染类型设置为不透明的、渲染队列设置为几何队列（不透明的几何体通常使用该队列）</strong></li><li><strong>删除高光反射相关代码</strong></li><li><strong>加入阴影、衰减相关代码</strong></li><li><strong>加入附加渲染通道</strong></li><li><strong>加入<code>FallBac "Diffuse"</code></strong></li></ol><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader "Unlit/BumpedDiffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">   Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainColor("MainColor", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainTex("MainTex", 2D) = ""{}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _BumpMap("BumpMap", 2D) = ""{}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _BumpScale("BumpScale", Range(0,1)) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{ "RenderType"="Opaque" "Queue"="Geometry"}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { "LightMode"="ForwardBase" }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainColor;//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainTex_ST;//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _BumpMap;//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _BumpMap_ST;//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _BumpScale;//凹凸程度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 pos:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 uv:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //顶点相对于世界坐标的位置 主要用于 之后的 视角方向的计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3 worldPos:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //切线 到 世界空间的 变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3x3 rotation:TEXCOORD2;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //代表我们切线空间到世界空间的 变换矩阵的3行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW0:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW1:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW2:TEXCOORD3;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                SHADOW_COORDS(4)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert (appdata_full v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos = UnityObjectToClipPos(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw = v.texcoord.xy * _BumpMap_ST.xy + _BumpMap_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //得到世界空间下的 顶点位置 用于之后在片元中计算视角方向（世界空间下的）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //data.worldPos = mul(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = mul(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //把模型空间下的法线、切线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = UnityObjectToWorldNormal(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldTangent = UnityObjectToWorldDir(v.tangent);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldBinormal = cross(normalize(worldTangent), normalize(worldNormal)) * v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //这个就是我们 切线空间到世界空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //data.rotation = float3x3( worldTangent.x, worldBinormal.x,  worldNormal.x,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //                          worldTangent.y, worldBinormal.y,  worldNormal.y,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //                          worldTangent.z, worldBinormal.z,  worldNormal.z);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW0 = float4(worldTangent.x, worldBinormal.x,  worldNormal.x, worldPos.x);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW1 = float4(worldTangent.y, worldBinormal.y,  worldNormal.y, worldPos.y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW2 = float4(worldTangent.z, worldBinormal.z,  worldNormal.z, worldPos.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                TRANSFER_SHADOW(data);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag (v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //世界空间下光的方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lightDir = normalize(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //世界空间下视角方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = float3(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 viewDir = normalize(UnityWorldSpaceViewDir(worldPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 packedNormal = tex2D(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 tangentNormal = UnpackNormal(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy *= _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //把计算完毕后的切线空间下的法线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3x3 rotation = float3x3(i.TtoW0.xyz, i.TtoW1.xyz, i.TtoW2.xyz );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3 worldNormal = mul(rotation, tangentNormal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //本质 就是在进行矩阵运算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = float3(dot(i.TtoW0.xyz, tangentNormal), dot(i.TtoW1.xyz, tangentNormal), dot(i.TtoW2.xyz, tangentNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 albedo = tex2D(_MainTex, i.uv.xy) * _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //兰伯特</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lambertColor = _LightColor0.rgb * albedo.rgb * max(0, dot(worldNormal, normalize(lightDir)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                UNITY_LIGHT_ATTENUATION(atten, i, worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               //布林方</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 color = UNITY_LIGHTMODEL_AMBIENT.rgb * albedo + lambertColor * atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return fixed4(color.rgb, 1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { "LightMode"="ForwardAdd" }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend One One</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdadd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainColor;//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainTex_ST;//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _BumpMap;//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _BumpMap_ST;//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _BumpScale;//凹凸程度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 pos:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 uv:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //顶点相对于世界坐标的位置 主要用于 之后的 视角方向的计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3 worldPos:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //切线 到 世界空间的 变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3x3 rotation:TEXCOORD2;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //代表我们切线空间到世界空间的 变换矩阵的3行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW0:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW1:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW2:TEXCOORD3;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                SHADOW_COORDS(4)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert (appdata_full v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos = UnityObjectToClipPos(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw = v.texcoord.xy * _BumpMap_ST.xy + _BumpMap_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //得到世界空间下的 顶点位置 用于之后在片元中计算视角方向（世界空间下的）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //data.worldPos = mul(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = mul(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //把模型空间下的法线、切线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = UnityObjectToWorldNormal(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldTangent = UnityObjectToWorldDir(v.tangent);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldBinormal = cross(normalize(worldTangent), normalize(worldNormal)) * v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //这个就是我们 切线空间到世界空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //data.rotation = float3x3( worldTangent.x, worldBinormal.x,  worldNormal.x,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //                          worldTangent.y, worldBinormal.y,  worldNormal.y,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //                          worldTangent.z, worldBinormal.z,  worldNormal.z);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW0 = float4(worldTangent.x, worldBinormal.x,  worldNormal.x, worldPos.x);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW1 = float4(worldTangent.y, worldBinormal.y,  worldNormal.y, worldPos.y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW2 = float4(worldTangent.z, worldBinormal.z,  worldNormal.z, worldPos.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                TRANSFER_SHADOW(data);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag (v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //世界空间下光的方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lightDir = normalize(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //世界空间下视角方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = float3(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 viewDir = normalize(UnityWorldSpaceViewDir(worldPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 packedNormal = tex2D(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 tangentNormal = UnpackNormal(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy *= _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //把计算完毕后的切线空间下的法线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3x3 rotation = float3x3(i.TtoW0.xyz, i.TtoW1.xyz, i.TtoW2.xyz );</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //float3 worldNormal = mul(rotation, tangentNormal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //本质 就是在进行矩阵运算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = float3(dot(i.TtoW0.xyz, tangentNormal), dot(i.TtoW1.xyz, tangentNormal), dot(i.TtoW2.xyz, tangentNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 albedo = tex2D(_MainTex, i.uv.xy) * _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //兰伯特</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lambertColor = _LightColor0.rgb * albedo.rgb * max(0, dot(worldNormal, normalize(lightDir)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                UNITY_LIGHT_ATTENUATION(atten, i, worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               //布林方</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 color = UNITY_LIGHTMODEL_AMBIENT.rgb * albedo + lambertColor * atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return fixed4(color.rgb, 1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback "Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="二、标准高光反射shader" tabindex="-1">二、标准高光反射Shader <a class="header-anchor" href="#二、标准高光反射shader" aria-label="Permalink to &quot;二、标准高光反射Shader&quot;">​</a></h3><ol><li><p>加入渲染标签<code>Tags { "RenderType"="Opaque" "Queue"="Geometry"}</code> 渲染类型设置为不透明的、渲染队列设置为几何队列（不透明的几何体通常使用该队列）</p></li><li><p>加入阴影、衰减相关代码</p></li><li><p>加入附加渲染通道</p></li><li><p>加入<code>FallBack "Specular"</code></p></li></ol><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader "Unlit/BumpedSpecular"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainColor("MainColor", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainTex("MainTex", 2D) = "white" {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _BumpMap("BumpMap", 2D) = "bump" {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _BumpScale("BumpScale", Range(0,1)) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _SpecularColor("SpecularColor", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _SpecularNum("SpecularNum", Range(0,20)) = 18</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{ "RenderType"="Opaque" "Queue"="Geometry" }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { "LightMode"="ForwardBase" }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainTex_ST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _BumpMap;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _BumpMap_ST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 pos:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 uv:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW0:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW1:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW2:TEXCOORD3;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                SHADOW_COORDS(4)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert(appdata_full v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos = UnityObjectToClipPos(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw = v.texcoord.xy * _BumpMap_ST.xy + _BumpMap_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = mul(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = UnityObjectToWorldNormal(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldTangent = UnityObjectToWorldDir(v.tangent);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldBinormal = cross(normalize(worldTangent), normalize(worldNormal)) * v.tangent.w;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW0 = float4(worldTangent.x, worldBinormal.x, worldNormal.x, worldPos.x);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW1 = float4(worldTangent.y, worldBinormal.y, worldNormal.y, worldPos.y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW2 = float4(worldTangent.z, worldBinormal.z, worldNormal.z, worldPos.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                TRANSFER_SHADOW(data);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag(v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lightDir = normalize(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = float3(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 viewDir = normalize(UnityWorldSpaceViewDir(worldPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 packedNormal = tex2D(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 tangentNormal = UnpackNormal(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy *= _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = float3(dot(i.TtoW0.xyz, tangentNormal), dot(i.TtoW1.xyz, tangentNormal), dot(i.TtoW2.xyz, tangentNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 albedo = tex2D(_MainTex, i.uv.xy) * _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lambertColor = _LightColor0.rgb * albedo.rgb * max(0, dot(worldNormal, normalize(lightDir)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 halfA = normalize(normalize(viewDir) + normalize(lightDir));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 specularColor = _LightColor0.rgb * _SpecularColor.rgb * pow(max(0, dot(worldNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                UNITY_LIGHT_ATTENUATION(atten, i, worldPos);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 color = UNITY_LIGHTMODEL_AMBIENT.rgb * albedo + (lambertColor + specularColor) * atten;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return fixed4(color.rgb, 1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { "LightMode"="ForwardAdd" }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend One One</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdadd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainTex_ST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _BumpMap;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _BumpMap_ST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _SpecularColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed _SpecularNum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 pos:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 uv:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW0:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW1:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 TtoW2:TEXCOORD3;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                SHADOW_COORDS(4)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert(appdata_full v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos = UnityObjectToClipPos(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw = v.texcoord.xy * _BumpMap_ST.xy + _BumpMap_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = mul(unity_ObjectToWorld, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = UnityObjectToWorldNormal(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldTangent = UnityObjectToWorldDir(v.tangent);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldBinormal = cross(normalize(worldTangent), normalize(worldNormal)) * v.tangent.w;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW0 = float4(worldTangent.x, worldBinormal.x, worldNormal.x, worldPos.x);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW1 = float4(worldTangent.y, worldBinormal.y, worldNormal.y, worldPos.y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.TtoW2 = float4(worldTangent.z, worldBinormal.z, worldNormal.z, worldPos.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                TRANSFER_SHADOW(data);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag(v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lightDir = normalize(_WorldSpaceLightPos0.xyz);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldPos = float3(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 viewDir = normalize(UnityWorldSpaceViewDir(worldPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 packedNormal = tex2D(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 tangentNormal = UnpackNormal(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy *= _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 worldNormal = float3(dot(i.TtoW0.xyz, tangentNormal), dot(i.TtoW1.xyz, tangentNormal), dot(i.TtoW2.xyz, tangentNormal));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 albedo = tex2D(_MainTex, i.uv.xy) * _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 lambertColor = _LightColor0.rgb * albedo.rgb * max(0, dot(worldNormal, normalize(lightDir)));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 halfA = normalize(normalize(viewDir) + normalize(lightDir));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 specularColor = _LightColor0.rgb * _SpecularColor.rgb * pow(max(0, dot(worldNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                UNITY_LIGHT_ATTENUATION(atten, i, worldPos);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 color = UNITY_LIGHTMODEL_AMBIENT.rgb * albedo + (lambertColor + specularColor) * atten;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return fixed4(color.rgb, 1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback "Specular"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="高级纹理" tabindex="-1">高级纹理 <a class="header-anchor" href="#高级纹理" aria-label="Permalink to &quot;高级纹理&quot;">​</a></h2><h3 id="一、立方体纹理" tabindex="-1">一、立方体纹理 <a class="header-anchor" href="#一、立方体纹理" aria-label="Permalink to &quot;一、立方体纹理&quot;">​</a></h3><blockquote><p>立方体纹理是什么</p></blockquote><p>立方体纹理（CubeMap）是一种特殊的纹理类型</p><p>和之前我们讲过的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>单张纹理、法线纹理、渐变纹理、高光遮罩纹理</strong><!--]--></span><!--]--><strong>不同</strong>，</p><p>立方体纹理包含6个独立的二维纹理，分别对应一个立方体的六个面</p><p>分别为：</p><p><strong>正X面（右）：+X</strong></p><p><strong>负X面（左）：-X</strong></p><p><strong>正Y面（上）：+Y</strong></p><p><strong>负Y面（下）：-Y</strong></p><p><strong>正Z面（前）：+Z</strong></p><p><strong>负Z面（后）：-Z</strong></p><blockquote><p>立方体纹理的用途</p></blockquote><p>立方体纹理（CubeMap）在图形编程中常见的用途有：</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->环境映射：<!--]--></span><!--]--><p>用于模拟反射环境的效果，用立方体纹理存储周围环境的图像 当应用到反射表面时，可以让物体看起来像是在反射其周围的环境。</p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->天空盒<!--]--></span><!--]--><p>用于渲染天空盒，将立方体纹理的六个面映射到一个立方体内表面 从而模拟天空、云朵、远处的山脉等环境</p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->全景图<!--]--></span><!--]--><p>用于展示全景图像、视频，通过立方体纹理来存储全景照片、视频的六个部分 等等</p></li></ol><blockquote><p>立方体纹理如何采样</p></blockquote><p>作为有6张2D纹理的立方体纹理，它的采访方式和我们之前学习的内容不同。</p><p><strong>对立方体纹理进行采样，我们需要提供一个<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->三维的纹理坐标<!--]--></span><!--]--></strong>，</p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->该坐标表示<!--]--></span><!--]-->了<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们在世界空间下的一个三维方向<!--]--></span><!--]-->。</strong></p><p><strong>这个方向向量从立方体的中心出发,</strong></p><p><strong>当它向外延伸时就会和6个纹理之一相交,</strong></p><p><strong>采样结果就是由该交点计算而来！</strong></p><blockquote><p>立方体纹理的优缺点</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->优点：<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->1.多用途：可以有效的模拟环境映射和全景效果，如反射、折射、天空盒、环境光照等<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->2.无缝连接：立方体纹理设计为无缝连接着六个面，减少了可见的接缝和瑕疵<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->3.兼容性较好：大多数现代图形硬件对立方体纹理都有专门的支持<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->等等<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->缺点：<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->1.内存开销：立方体纹理由6个2D纹理组成，内存占用较高，特别是在高分辨率情况下<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->2.采样复杂性：采样方式比起传统的2D纹理更加耗性能，计算更多<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->3.透视变形：6个平面来近似球形环境，有时会出现透视变形的问题<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->等等<!--]--></span><!--]--><hr><h3 id="二、天空盒" tabindex="-1">二、天空盒 <a class="header-anchor" href="#二、天空盒" aria-label="Permalink to &quot;二、天空盒&quot;">​</a></h3><blockquote><p>天空盒是什么</p></blockquote><p>天空盒（Skybox）是计算机图形学和三维游戏开发中常用于模拟背景的一种方式,它通常由一个立方体构成 字面上理解就是一个用于模拟天空的盒子（但是它不仅可以模拟天空，模拟室内等环境也是可以的） 在游戏场景中使用天空盒时，整个场景就被包围在了一个立方体中。 这个立方体的每个面使用的技术就是立方体纹理技术。</p><blockquote><p>好处</p></blockquote><p>它给我们带来的主要好处是：</p><ol><li><strong>可以创建逼真的背景</strong> 天空盒使场景看起来更加逼真，因为它可以展示复杂和详细的背景</li><li><strong>可以提高性能</strong> 可以减少渲染远景所需的消耗，只需要要纹理贴图就可以模拟远景的效果，而无需实际的在远处创建这些物体</li><li><strong>全景视图</strong> 天空盒的六个面（前、后、左、右、上、下）共同构成一个完整的环境，无论玩家向哪个方向看，都能看到连贯的背景图像</li><li><strong>易于实现</strong> 对于开发者来说，制作和应用天空盒相对简单，只需要准备好六个方向的纹理图像，并将它们应用到立方体纹理中即可 等等</li></ol><hr><h3 id="三、反射原理" tabindex="-1">三、反射原理 <a class="header-anchor" href="#三、反射原理" aria-label="Permalink to &quot;三、反射原理&quot;">​</a></h3><blockquote><p>反射效果是什么</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->反射效果指光的反射，是一种光学现象。<!--]--></span><!--]--><p>指光在两种物质分界面上改变传播方向又返回原来物质中的现象，就叫做光的反射。</p><p>比如：光遇到水面、玻璃、金属等许多物体的表面都会发生反射。</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/高级纹理/反射原理.png" loading="lazy"></div><p>在Unity Shader中，反射效果模拟了物体表面反射环境光的特性</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->使得物体看起来像镜子或金属表面，能够反射周围环境的图像。<!--]--></span><!--]--><blockquote><p>反射效果的原理</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->反射效果的原理就是利用立方体纹理（CubeMap）进行环境映射<!--]--></span><!--]--><p>我们利用<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->摄像机看向物体表面顶点的方向向量作为入射光，结合顶点法线<!--]--></span><!--]-->向量可以<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->算出反射向量<!--]--></span><!--]--></p><p>然后<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用反射方向向量在立方体纹理中进行采样<!--]--></span><!--]-->，得到最终反射的颜色。</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/高级纹理/反射效果的原理.png" loading="lazy"></div><p><strong>光路可逆原则：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果光在某一路径上从点A传播到点B,那么光在同一路径上可以从点B传播回点A.换句话说,光的传播路径在没有任何变化的情况下可以被反向利用<!--]--></span><!--]--><hr><h4 id="_1-反射原理的基础实现" tabindex="-1">1. 反射原理的基础实现 <a class="header-anchor" href="#_1-反射原理的基础实现" aria-label="Permalink to &quot;1. 反射原理的基础实现&quot;">​</a></h4><p><strong>立方体纹理采样函数</strong> CG中提供了内置函数 texCUBE 用于进行立方体纹理采样</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->texCUBE(立方体纹理,反射方向向量) 便可以得到在立方体纹理中的采样结果<!--]--></span><!--]--><blockquote><p>步骤</p></blockquote><ol><li><p><strong>属性声明</strong> 我们将声明2个关键属性 1-1:立方体纹理 1-2:反射率（0~1）之间</p></li><li><p><strong>顶点着色器</strong> 关键步骤： 2-1:顶点坐标转裁剪坐标 2-2:顶点法线转世界坐标 2-3:顶点坐标转世界坐标 2-4:世界空间下 视角方向计算 2-5:视角反向逆向得到反射方向</p></li><li><p><strong>片元着色器</strong> 关键步骤： 3-1:立方体纹理采样(利用texCUBE函数) 3-2:结合反射程度返回最终颜色</p></li></ol><h5 id="实现-4" tabindex="-1">实现 <a class="header-anchor" href="#实现-4" aria-label="Permalink to &quot;实现&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson75"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">		//立方体纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">		_Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cubemap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">		//反射率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">		_Reflectivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Reflectivity"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">			"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">      "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Geometry"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		LOD </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">				"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">			// make fog work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma multi_compile_fog</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			samplerCUBE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Reflectivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//世界空间下的反射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//我们将把反射向量的计算放在顶点着色器函数中 节约性能 表现效果也不会太差 肉眼几乎分辨不出来</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldRefl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				o.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//计算反射光向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//1.计算世界空间下法线向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//2.世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//3.计算视角方向 内部是用摄像机位置 - 世界坐标位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldViewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//4.计算反射向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				o.worldRefl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">worldViewDir, worldNormal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//对立方体纹理利用对应的反射向量进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cubemapColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Cube, i.worldRefl);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//用采样颜色 * 反射率 决定最终的颜色效果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> cubemapColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Reflectivity;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h4 id="_2-反射结合漫反射" tabindex="-1">2. 反射结合漫反射 <a class="header-anchor" href="#_2-反射结合漫反射" aria-label="Permalink to &quot;2. 反射结合漫反射&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->插值函数<!--]--></span><!--]--><p>CG中提供了内置函数 <strong>lerp</strong> 用于进行插值计算</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->lerp(a, b, t)<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->a:插值起点值<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->b:插值终点值<!--]--></span><!--]--><p><strong>t:插值因子，0~1之间</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->内部计算公式：`a + t * (b - a)`<!--]--></span><!--]--><p><strong>当 t = 0 时，插值结果为a</strong><strong>当 t = 1 时，插值结果为b</strong><strong>当 t 在 0~1 之间变化时，返回一个a到b之间的一个线性插值结果</strong> 我们将利用该函数来决定反射效果的程度 用它在漫反射颜色和反射颜色之间进行插值控制反射程度</p><blockquote><p>步骤</p></blockquote><ol><li><p><strong>属性声明</strong> 我们将加入2个关键属性 1-1:漫反射颜色 1-2:反射颜色</p></li><li><p><strong>v2f结构体</strong> 因为要在片元着色器中处理光和阴影 需要加入 2-1：世界空间法线: 2-2：世界空间顶点位置 2-3: 阴影宏</p></li><li><p><strong>顶点着色器</strong> 关键步骤： 3-1:顶点坐标转裁剪坐标 3-2:顶点法线转世界坐标 3-3:顶点坐标转世界坐标 3-4:世界空间下 视角方向计算 3-5:视角反向逆向得到反射方向 3-6:阴影相关计算</p></li><li><p><strong>片元着色器</strong> 关键步骤： 4-1:得到光的方向 4-2:兰伯特漫反射颜色计算 4-3:立方体纹理采样(利用texCUBE函数) 4-4:衰减计算 4-5:最终颜色计算(利用lerp函数)</p></li><li><p><code>FallBack "Reflective/VertexLit"</code></p></li></ol><hr><h5 id="实现-5" tabindex="-1">实现 <a class="header-anchor" href="#实现-5" aria-label="Permalink to &quot;实现&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson76"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">		 //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _ReflectColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ReflectColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //立方体纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cubemap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //反射率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Reflectivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Reflectivity"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">			"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Geometry"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		LOD </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">				"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">			// make fog work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			 fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _ReflectColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            samplerCUBE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Reflectivity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的反射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们将把反射向量的计算放在顶点着色器函数中 节约性能 表现效果也不会太差 肉眼几乎分辨不出来</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldRefl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影相关</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算反射光向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.计算世界空间下法线向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //3.计算视角方向 内部是用摄像机位置 - 世界坐标位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldViewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o.worldPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //4.计算反射向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldRefl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">worldViewDir, o.worldNormal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影相关处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//漫反射光照相关计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldLightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldNormal), worldLightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对立方体纹理利用对应的反射向量进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cubemapColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Cube, i.worldRefl).rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _ReflectColor.rgb;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光照衰减以及阴影相关的衰减值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们利用lerp 在漫反射颜色和反射颜色之间 进行插值 0和1就是极限状态 0 没有反射效果 1只有反射效果 0~1之间就是两者叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diffuse, cubemapColor, _Reflectivity) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用采样颜色 * 反射率 决定最终的颜色效果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Reflective/VertexLit"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="四、折射原理" tabindex="-1">四、折射原理 <a class="header-anchor" href="#四、折射原理" aria-label="Permalink to &quot;四、折射原理&quot;">​</a></h3><blockquote><p>折射效果是什么</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->折射效果指光的折射，是一种光学现象。<!--]--></span><!--]--><p><strong>指光从一种透明介质斜射入另一种透明介质时，传播方向一般会发生变化，这种现象叫光的折射。</strong> 光的折射与光的反射一样 都是发生在两种介质的交界处 进入到另一种介质中 ，只是反射光返回原介质中 ，由于光在两种不同的物质里传播速度不同 ，而 折射光则 ，故在两种介质的交界处传播方 向发生变化，这就是光的折射。</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/高级纹理/折射.png" loading="lazy"></div><blockquote><p>折射效果是什么</p></blockquote><p>在Unity Shader中，折射效果模拟了光线通过透明或半透明材质时的弯曲行为。</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->一般用来模拟水面、透明玻璃球、眼镜、钻石、水晶球、空气扰动等等效果 它一般会配合其他表现效果一起使用<!--]--></span><!--]--><blockquote><p>原理</p></blockquote><p><strong>斯涅耳定律（Snell’s Law）：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->当光从介质1沿着表面法线夹角为θ1的方向斜射入介质2时<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们可以利用数学公式n1sinθ1=n2sinθ2 计算出折射光线和法线的夹角θ2<!--]--></span><!--]--><p><strong>其中n1和n2为两种介质的折射率</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/高级纹理/折射2.png" loading="lazy"></div><blockquote><p>折射效果注意点</p></blockquote><p>我们在Unity中处理<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->折射效果<!--]--></span><!--]-->的做法是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->直接用得到的折射方向对立方体纹理进行采样 <!--]--></span><!--]--></p><p>这样做其实不符合物理规律，因为对于一个透明物体来说，更准确的模拟方式应该是进行两侧折 射，一次是光线进入内部，一次是光线从物体内部射出。但是，在实时渲染中模拟第二次折射方 向较为复杂，而我们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->仅模拟一次折射得到的效果在视觉上看起来也是可以接受的！<!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->因此，在实时渲染中，我们通常仅模拟第一次折射来得到最终的结果！<!--]--></span><!--]--><hr><h4 id="_1-折射的基础实现" tabindex="-1">1. 折射的基础实现 <a class="header-anchor" href="#_1-折射的基础实现" aria-label="Permalink to &quot;1. 折射的基础实现&quot;">​</a></h4><p><strong>折射向量计算函数</strong><strong>CG中提供了内置函数 refract 用于进行折射向量的计算</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->refract(入射方向单位向量, 顶点法线单位向量, 入射介质折射率/射入介质折射率)<!--]--></span><!--]--><p>便可以得到在目标介质中的折射向量</p><p>该函数内部就是利用了斯涅耳定律进行的计算 我们无需再自己写逻辑计算了</p><blockquote><p>步骤</p></blockquote><ol><li><p><strong>属性声明</strong> 我们将声明4个关键属性 1-1:介质A折射率 1-2:介质B折射率 1-3:立方体纹理贴图 1-4:折射程度</p></li><li><p><strong>编译指令、内置文件、属性映射、结构体相关</strong></p></li><li><p><strong>顶点着色器</strong> 关键步骤： 3-1:顶点坐标转裁剪坐标 3-2:顶点法线转世界坐标 3-3:顶点坐标转世界坐标 3-4:世界空间下 视角方向计算 3-5:利用折射函数计算折射向量</p></li><li><p><strong>片元着色器</strong> 关键步骤： 4-1:立方体纹理采样(利用texCUBE函数) 4-2:结合折射程度返回最终颜色</p></li></ol><h5 id="实现-6" tabindex="-1">实现 <a class="header-anchor" href="#实现-6" aria-label="Permalink to &quot;实现&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson77"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">		_RefractiveIndexA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RefractiveIndexA"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">		_RefractiveIndexB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RefractiveIndexB"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1.3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">		_Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cubemap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">		_RefracAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RefracAmount"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">			"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Geometry"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		LOD </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			Tags</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">				"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ForwardBase"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">			// make fog work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			#include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			samplerCUBE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefractiveIndexA;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefractiveIndexB;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">			fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefracAmount;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldRefr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			};</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">				//顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				o.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldViewDic</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				o.worldRefr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldViewDic), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">				                                              _RefractiveIndexA </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefractiveIndexB);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">			fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">				fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cubemapColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Cube, i.worldRefr);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">				return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> cubemapColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefracAmount;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">			ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">		}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Reflective/VertexLit"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h4 id="_2-带漫反射和阴影的折射效果" tabindex="-1">2. 带漫反射和阴影的折射效果 <a class="header-anchor" href="#_2-带漫反射和阴影的折射效果" aria-label="Permalink to &quot;2. 带漫反射和阴影的折射效果&quot;">​</a></h4><ol><li><p>将折射率A和折射率B 合并为一个 折射率比值变量 以后在外部算好了传入，避免内部计算浪费性能</p></li><li><p><strong>折射效果结合漫反射和阴影的做法</strong> 和之前反射几乎一模一样 我们可以直接复制之前的代码 避免书写重复内容</p><p>2-1:属性相关代码复制 漫反射颜色和折射颜色 2-2:渲染路径、编译指令、内置文件复制 属性映射复制修改 2-3:结构体相关内容复制 2-4:顶点着色器相关内容修改 2-5:片元着色器相关内容复制修改</p></li></ol><h5 id="实现-7" tabindex="-1">实现 <a class="header-anchor" href="#实现-7" aria-label="Permalink to &quot;实现&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson78_Refraction"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //折射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _RefractColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RefractColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //折射率比值 介质A折射率/介质B折射率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _RefractRatio</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RefractRatio"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //立方体纹理贴图</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cubemap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //折射程度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _RefracAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RefracAmount"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Geometry"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RefractColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            samplerCUBE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefractRatio;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefracAmount;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                 //世界空间下法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //折射向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldRefr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影相关</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //法线转世界</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点转世界</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角方向获取 摄像机 - 顶点位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldViewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o.worldPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算折射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //第三个参数一定是 介质A/介质B的结果 我们可以声明一个变量在外部算好传进来 这里我们用两个变量只是为了讲解知识</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldRefr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> refract</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldViewDir), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o.worldNormal), _RefractRatio);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影相关处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_TARGET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //漫反射光照相关计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldLightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldNormal), worldLightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //立方体纹理采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cubemapColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Cube, i.worldRefr).rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RefractColor.rgb;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光照衰减以及阴影相关的衰减值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们利用lerp 在漫反射颜色和反射颜色之间 进行插值 0和1就是极限状态 0 没有折射效果 1只有折射效果 0~1之间就是两者叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diffuse, cubemapColor, _RefracAmount) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //结合折射程度进行计算返回</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Reflective/VertexLit"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="五、菲涅尔反射原理" tabindex="-1">五、菲涅尔反射原理 <a class="header-anchor" href="#五、菲涅尔反射原理" aria-label="Permalink to &quot;五、菲涅尔反射原理&quot;">​</a></h3><blockquote><p>菲涅耳反射效果是什么</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->菲涅耳反射是一种光学现象。<!--]--></span><!--]--><p><strong>简单的讲，就是视线垂直于观察表面时，反射较弱，（更多的光会透射到进入新介质） 而当视线非垂直观察表面时，夹角越小，反射越明显</strong>。</p><p>真实世界中的例子：</p><p>如果你站在湖边，低头看脚下的水，你会发现水是透明的，反射不是特别强烈；如果你看远处的 湖面，你会发现水并不是透明的，但反射非常强烈，这就是“菲涅耳效应”。</p><p><strong>菲涅耳反射原理是描述光在两种介质的界面上反射和折射的行为。</strong></p><p><strong>反射和折射的强度取决于光的入射角和两种介质的折射率差异。</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->从物理角度来看，世界上所有物体在光线照射下都会遵循菲涅耳反射原理！<!--]--></span><!--]--><p>这意味着光在任何两种介质的界面上都会发生反射和折射，只不过具体反射效果会因为介质的性 质和光的入射角度不同而有所变化。</p><p><strong>无论是透明的、半透明的还是不透明的物体，只要有光线入射到其表面，菲涅耳反射都会发生。</strong></p><p>在Unity Shader中，菲涅耳反射一般用来</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->增强真实感，使物体表面在不同角度和光照条件下呈现出更加真实和自然的外观，增强视觉效果。<!--]--></span><!--]--><p><strong>因为刚才我们提到真实世界中，万物皆遵循菲涅耳反射原理</strong></p><p><strong>那么我们在游戏中使用菲涅耳反射比直接使用反射能更加接近真实世界的效果，</strong></p><p><strong>在实现一些<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->金属感、陶瓷感、玻璃感<!--]--></span><!--]-->时效果更好！</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->也就是说菲涅耳反射在Unity Shader当中实现出来的效果基于反射，<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->但是会比反射更加接近真实的效果<!--]--></span><!--]--><blockquote><p>菲涅耳反射效果的原理</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->菲涅耳反射的原理还是利用立方体纹理（CubeMap）进行环境映射<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/高级纹理/菲涅耳反射.png" loading="lazy"></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们将使用菲涅耳等式来计算反射率<!--]--></span><!--]--><p>但是物理学中的菲涅耳等式是非常复杂的，如果在实时渲染中使用，计算非常复杂。</p><p>因此我们通常会使用近似公式来计算，在Unity Shader当中我们会使用</p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Schlick 菲涅耳<!--]--></span><!--]-->近似等式来计算反射率</strong></p><p><strong>该等式是由Christophe Schlick（克里斯托夫·施利克）于1994年提出的</strong></p><p><strong>它提出的菲涅耳近似等式极大的简化了菲涅耳反射率的计算，非常适用于实时渲染， 同时它还保留了足够的物理真实性！</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Schlick 菲涅耳近似等式<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/高级纹理/菲涅耳反射2.png" loading="lazy"></div><p><strong>其中：</strong></p><p><strong>R(θ) 表示入射角为θ时时的反射率</strong></p><p><strong>R0 是垂直入射某介质时的反射率 顶点法线 反射光 物体</strong></p><p><strong>V 是视角方向单位向量（入射角）</strong></p><p><strong>N 是顶点法线单位向量</strong></p><p>该公式中<strong>视角方向</strong>和<strong>顶点法线</strong>都是已知的</p><p>我们只需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->查阅对应物体在真实世界中的反射 率<!--]--></span><!--]-->，将该反射率<strong>带入公式进行计算</strong></p><p>则可以<strong>得到菲涅耳反射率</strong>，让其<strong>参与最终的颜 色计算</strong>即可！</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通常情况下，我们所说的物体的反射率（或反 射系数）通常是指垂直入射光线时的反射率<!--]--></span><!--]--><hr><h4 id="_1-菲涅尔反射基础实现" tabindex="-1">1.菲涅尔反射基础实现 <a class="header-anchor" href="#_1-菲涅尔反射基础实现" aria-label="Permalink to &quot;1.菲涅尔反射基础实现&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Schlick 菲涅耳近似等式<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**R(θ) = R0 + ( 1− R0 )( 1 − V·𝑵)^𝟓** <!--]--></span><!--]--><p><strong>R(θ)：对应角度的菲涅耳反射率</strong><strong>R0：介质反射率</strong><strong>V：视角单位向量</strong><strong>N：法线单位向量</strong></p><ol><li><p><strong>属性声明</strong> 将反射率变量修改为 _FresnelScale 菲涅耳中介质的反射率</p></li><li><p><strong>结构体</strong> 由于使用Schlick菲涅耳近似等式 需要用到世界空间下视角方向、和法线向量 因此在结构体中加入这两个变量</p></li><li><p><strong>顶点着色器</strong> 关键步骤： 结构体中变量赋值</p></li><li><p><strong>片元着色器</strong> 关键步骤： 利用Schlick菲涅耳近似等式计算出菲涅耳反射率 参与最终颜色计算</p></li></ol><h5 id="实现-8" tabindex="-1">实现 <a class="header-anchor" href="#实现-8" aria-label="Permalink to &quot;实现&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson79_FresnelBase"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //立方体纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cubemap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //菲涅耳反射中 对应介质的反射率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FresnelScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FresnelScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Geometry"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            samplerCUBE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FresnelScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下视角的方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的反射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们将把反射向量的计算放在顶点着色器函数中 节约性能 表现效果也不会太差 肉眼几乎分辨不出来</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldRefl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算反射光向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.计算世界空间下法线向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //3.计算视角方向 内部是用摄像机位置 - 世界坐标位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldViewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //4.计算反射向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldRefl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">o.worldViewDir, o.worldNormal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_TARGET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对立方体纹理利用对应的反射向量进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cubemapColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Cube, i.worldRefl);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用schlick菲涅耳近似等式 计算菲涅耳反射率</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fresnel = _FresnelScale + (1-_FresnelScale) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldViewDir), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldNormal)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用采样颜色 * 反射率 决定最终的颜色效果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> cubemapColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fresnel;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h4 id="_2-菲涅尔反射结合漫反射及-阴影" tabindex="-1">2.菲涅尔反射结合漫反射及 阴影 <a class="header-anchor" href="#_2-菲涅尔反射结合漫反射及-阴影" aria-label="Permalink to &quot;2.菲涅尔反射结合漫反射及 阴影&quot;">​</a></h4><p><strong>1.修改属性</strong> 1-1:去掉反射颜色 1-2:修改反射率为菲涅耳相关的R0反射率</p><p><strong>2.修改v2f结构体</strong> 加入视角方向（需要再片元着色器中用菲涅耳近似公式参与计算）</p><p><strong>3.顶点着色器</strong> 修改视角方向临时变量</p><p><strong>4.片元着色器</strong> 4-1:计算菲涅耳反射率 4-2:用菲涅耳反射率参与lerp计算</p><h5 id="实现-9" tabindex="-1">实现 <a class="header-anchor" href="#实现-9" aria-label="Permalink to &quot;实现&quot;">​</a></h5><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson80_Fresnel"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //立方体纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cubemap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //反射率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FresnelScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FresnelScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Geometry"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            samplerCUBE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FresnelScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:NORMAL;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下视角的方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的反射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们将把反射向量的计算放在顶点着色器函数中 节约性能 表现效果也不会太差 肉眼几乎分辨不出来</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldRefl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影相关</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算反射光向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.计算世界空间下法线向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //3.计算视角方向 内部是用摄像机位置 - 世界坐标位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldViewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o.worldPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //4.计算反射向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldRefl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">o.worldViewDir, o.worldNormal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影相关处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_TARGET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //漫反射光照相关计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光的方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldLightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldPos));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldNormal), worldLightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对立方体纹理利用对应的反射向量进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cubemapColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Cube, i.worldRefl).rgb;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到光照衰减以及阴影相关的衰减值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //菲涅耳反射率计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fresnel = _FresnelScale + (1-_FresnelScale)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldViewDir), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldNormal)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们利用lerp 在漫反射颜色和反射颜色之间 进行插值 0和1就是极限状态 0 没有反射效果 1只有反射效果 0~1之间就是两者叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diffuse, cubemapColor, fresnel) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用采样颜色 * 反射率 决定最终的颜色效果</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Reflective/VertexLit"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="六、渲染目标纹理" tabindex="-1">六、渲染目标纹理 <a class="header-anchor" href="#六、渲染目标纹理" aria-label="Permalink to &quot;六、渲染目标纹理&quot;">​</a></h3><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染目标纹理（Render Target Texture）是一种特殊类型的纹理<!--]--></span><!--]--><p><strong>一般摄像机的渲染结果会输出到颜色缓冲区中</strong><strong>最终渲染到设备屏幕上，让玩家通过屏幕看见游戏画面</strong></p><p><strong>而渲染目标纹理允许我们将渲染结果直接写入到某一张纹理中</strong><strong>我们可以利用这个纹理来处理各种特殊效果</strong><strong>比如：镜子、玻璃、屏幕后处理、阴影映射等等</strong></p><p>在Unity中 <strong>渲染目标纹理（Render Target Texture）通常和渲染纹理（Render Texture）</strong><strong>可以互换使用，指的相同的概念。</strong> 在实际使用中，我们更常听到的是"渲染纹理"这个术语</p><p>说人话： 渲染纹理就是</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将渲染结果存储到一个纹理对象中，以便在后续的渲染步骤中使用<!--]--></span><!--]--><p>它的作用体现在： 我们在进行Shader开发时 <strong>我们经常会希望某摄像机不要直接将结果渲染到屏幕上</strong><strong>而是可以让我们得到它的渲染结果进行二次处理或利用</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染纹理（Render Texture）<!--]--></span><!--]-->Unity引擎中提供的一种专门的纹理类型 我们可以在Project窗口中右键<strong>Create——&gt;Custom Render Texturn</strong>创建 我们只需要把该纹理进行相关的设置，然后关联到摄像机组件的Target Texture中即可 这样对应摄像机渲染的内容就会直接写入到该纹理中 我们便可以使用它来进行相关操作 注意：除了手动创建，我们也可以通过代码创建并关联</li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->GrabPass<!--]--></span><!--]-->在Unity Shader当中 <strong>我们可以在Pass渲染通道中使用 GrabPass 抓取指令</strong><strong>捕获当前屏幕内容并将其保存为纹理，以便在后续的渲染过程中使用</strong></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->OnRenderImage<!--]--></span><!--]--><strong>在继承了MonoBehaviour的脚本中</strong><strong>我们可以使用OnRenderImage来获取摄像机渲染完成的图像</strong><strong>该函数一般用于实现自定义的图像后处理效果</strong><strong>相当于将摄像机渲染完成的图像进行二次处理</strong></li></ol><hr><h3 id="七、镜面效果" tabindex="-1">七、镜面效果 <a class="header-anchor" href="#七、镜面效果" aria-label="Permalink to &quot;七、镜面效果&quot;">​</a></h3><blockquote><p>原理</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->就是将摄像机看到的画面渲染到渲染纹理当中<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->再在Shader中利用该渲染纹理进行翻转渲染即可<!--]--></span><!--]--><blockquote><p>效果实现</p></blockquote><ol><li><strong>在顶点着色器中，让UV坐标的X轴反向（坐标范围0~1，想要反向直接用 1 - uv.x 即可</strong></li><li><strong>将渲染纹理应用到该Shader的纹理中</strong></li></ol><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson83_Mirror"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //主纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //映射对应纹理属性的图片颜色相关数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //映射对应纹理属性的 缩放 平(偏)移数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//xy代表缩放 zw代表平移</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f_img</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">               v2f_img</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //v.texcoord.xy</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //代表uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //v.texcoord.zw</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> //代表一些额外信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //先缩放 后平移 这个是一个固定的算法 规则如此</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //如果没有进行缩放和平移 那么 这个计算后 值是不会产生变化的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //因为缩放默认值是1和1 ，平移默认值是0和0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //由于是镜面效果，所以需要让纹理在x轴方向进行反向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">               data.uv.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data.uv.x;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //这是另一种写法</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">               //TRANSFORM_TEX(v.texcoord.xy, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">               return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f_img</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这传入的uv 是经过插值运算后的 就是每一个片元都有自己的一个uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这样才能精准的在贴图当中取出颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="八、玻璃效果" tabindex="-1">八、玻璃效果 <a class="header-anchor" href="#八、玻璃效果" aria-label="Permalink to &quot;八、玻璃效果&quot;">​</a></h3><blockquote><p>玻璃效果基本原理</p></blockquote><p>透明为什么不能制作透明效果:</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->透明无法表现出复杂的光学效果<!--]--></span><!--]--><p><strong>玻璃不仅仅是透明的，它还具有反射、折射等光学效果，使用透明无法简单的实现这些效果</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->透明物体往往会遇到深度排序问题<!--]--></span><!--]--><p><strong>渲染顺序不正确时，会导致视觉错误</strong></p><p>等等</p><p>因此我们想要实现效果更好的玻璃效果时，往往不会选择使用透明来制作</p></li></ol><p>我们将使用<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染纹理<!--]--></span><!--]-->来制作玻璃效果</p><p><strong>基本原理是</strong></p><p><strong>在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染玻璃效果物体之前，先获取到当前屏幕图像<!--]--></span><!--]-->，将当前屏幕图像<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->存储在渲染纹理之中<!--]--></span><!--]-->，</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->之后在真正处理玻璃效果物体时<!--]--></span><!--]-->，再<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用该渲染纹理<!--]--></span><!--]-->来实现<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->透明、折射<!--]--></span><!--]-->等等效果</strong></p><p>该过程中并不会使用混合相关知识，而是直接进行颜色相乘或相加来进行颜色叠加</p><p><strong>一句话总结：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在渲染玻璃效果之前，先捕获当前屏幕内容并保存到一张渲染纹理当中，<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**在之后的Shader处理中利用该渲染纹理进行采样，参与最终的颜色计算，实现各种玻璃效果**。<!--]--></span><!--]--><blockquote><p>玻璃效果实现使用的新知识点</p></blockquote><h4 id="_1-特殊渲染通道grabpass" tabindex="-1">1.特殊渲染通道GrabPass <a class="header-anchor" href="#_1-特殊渲染通道grabpass" aria-label="Permalink to &quot;1.特殊渲染通道GrabPass&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->GrabPass 的作用是捕获当前屏幕上已经渲染的内容，并将其存储到一张纹理中<!--]--></span><!--]--><p><strong>它需要包含在SubShader语句块中</strong></p><p><strong>它的用法有两种：</strong></p><ol><li><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->大括号中什么都不写<!--]--></span><!--]-->，默认会把屏幕内容写入一个叫做_GrabTexture 的纹理变量中 _</strong></p><p><strong>直接<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在CG语句中声明_GrabTexture <!--]--></span><!--]-->纹理变量即可直接使用抓取的渲染纹理</strong></p></li><li><p>**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->大括号中写入自定义变量名<!--]--></span><!--]-->，会把对应屏幕内容写入该自定义纹理变量中 **</p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在CG语句中声明对应纹理变量<!--]--></span><!--]-->即可使用抓取的渲染纹理</strong></p></li></ol><h4 id="_2-内置函数computegrabscreenpos" tabindex="-1">2.内置函数ComputeGrabScreenPos <a class="header-anchor" href="#_2-内置函数computegrabscreenpos" aria-label="Permalink to &quot;2.内置函数ComputeGrabScreenPos&quot;">​</a></h4><p>该内置函数可以用于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->计算屏幕空间位置<!--]--></span><!--]-->，传入<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点的裁剪空间位置<!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->返回一个float4 结果<!--]--></span><!--]-->，该float4中的内容分别代表：<p><strong>X：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->屏幕空间X坐标<!--]--></span><!--]--></strong></p><p><strong>Y：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->屏幕空间Y坐标<!--]--></span><!--]--></strong></p><p><strong>Z：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->裁剪空间深度值，一般表示顶点距离摄像机的相对深度<!--]--></span><!--]--></strong></p><p><strong>W：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->裁剪空间的W分量，通常用于透视除法<!--]--></span><!--]--></strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**即X或Y/W 后X或Y的范围将在0~1之间** <!--]--></span><!--]--><p><strong>我们可以利用该函数得到顶点相对屏幕的坐标，从而从捕获的渲染纹理中进行采样</strong></p><h4 id="_3-模拟折射的自定义计算规则" tabindex="-1">3.模拟折射的自定义计算规则 <a class="header-anchor" href="#_3-模拟折射的自定义计算规则" aria-label="Permalink to &quot;3.模拟折射的自定义计算规则&quot;">​</a></h4><p>为了模拟出玻璃折射的效果，我们一般不会使用之前学习的折射相关知识点在立方体纹理中采样，</p><p><strong>我们往往会自定义一些计算规则，来模拟计算出折射的效果。</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->总体的设计思路，就是在对捕获纹理进行采样时，进行一些偏移计算。<!--]--></span><!--]--><p>具体的计算规则，我们在之后编写Shader时再来详细讲解。</p><h4 id="_4-玻璃效果实现" tabindex="-1">4.玻璃效果实现 <a class="header-anchor" href="#_4-玻璃效果实现" aria-label="Permalink to &quot;4.玻璃效果实现&quot;">​</a></h4><ol><li><p><strong>玻璃效果基本原理</strong> 在渲染玻璃效果之前，先捕获当前屏幕内容并保存到一张渲染纹理当中， 在之后的Shader处理中利用该渲染纹理进行采样，参与最终的颜色计算，实现 各种玻璃效果。</p></li><li><p><strong>玻璃效果实现使用的新知识点</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->捕获屏幕内容的GrabPass；<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->裁剪坐标转屏幕坐标的ComputeGrabScreenPos方法<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->捕获纹理进行采样时，进行一些偏移计算，模拟折射效果渲染标签中的<!--]--></span><!--]--></li><li><p><strong>渲染队列</strong> Tags<code>{ "Queue" = "标签值" }</code> 常用Unity预先定义好的渲染队列标签值：</p><p><strong>3-1.Background(背景)(队列号:1000)</strong> 最早被渲染的物体的队列，一般用来渲染天空盒或者背景</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Tags`{ "Queue" = "Background" }`<!--]--></span><!--]--><p><strong>3-2.Geometry(几何)(队列号:2000)</strong> 不透明的几何体通常使用该队列，当没有声明渲染队列时，Unity会默认使用这个队列</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Tags`{ "Queue" = "Geometry" }`<!--]--></span><!--]--><p><strong>3-3.AlphaTest(透明测试)(队列号:2450)</strong> 有透明通道的，需要进行Alpha测试的几何体会使用该队列 当所有Geometry队列实体绘制完后再绘制AlphaTest队列，效率更高</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Tags`{ "Queue" = "AlphaTest" }`<!--]--></span><!--]--><p><strong>3-4.Transparent(透明的)(队列号:3000)</strong> 该队列中几何体按照由远到近的顺序进行绘制，半透明物体的渲染队列，所有进行透明混合的几何体都应该使用该队列 比如：玻璃材质，粒子特效等</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Tags`{ "Queue" = "Transparent" }`<!--]--></span><!--]--><p><strong>3-5.Overlay(覆盖)(队列号:4000)</strong> 用是放在最后渲染的队列，于叠加渲染的效果，比如镜头光晕等</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Tags`{ "Queue" = "Overlay" }`<!--]--></span><!--]--><p><strong>3-6.自定义队列</strong> 基于Unity预先定义好的这些渲染队列标签来进行加减运算来定义自己的渲染队列 比如：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Tags`{ "Queue" = "Geometry+1" } ` 代表的队列号就是 2001<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Tags`{ "Queue" = "Transparent-1" }` 代表的队列号就是 2999<!--]--></span><!--]--><p>自定义队列在一些特殊情况下，特别有用 比如 一些水的渲染 想要在不透明物体之后，半透明物体之前进行渲染，就可以自定义</p></li></ol><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.修改相关代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-1:修改属性代码（同时修改CG中的属性映射）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      加入主纹理属性（用于处理物体本身颜色）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      加入立方体纹理属性（用于处理反射）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      将反射率改为折射程度（用于控制折射程度 0表示完全不折射-相当于完全反射，1表示完全折射-相当于完全透明）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-2:修改渲染队列为Transparent，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      但是RenderType渲染类型不修改，因为它本质上还是一个不透明物体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      以后使用着色器替换功能时，可以在被正常渲染</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-3:加入GrabPass，抓取屏幕图像存储渲染纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-4:修改v2f结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      加入相对屏幕坐标float4类型成员</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      加入uv，用于采样物体颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-5:修改顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      使用ComputeGrabScreenPos方法，计算结构体中相对屏幕坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-6:修改片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      用uv采样主纹理颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      将屏幕坐标转为裁剪坐标0~1范围内，对捕获纹理进行采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      用反射在立方体纹理中进行采样，用结果乘以主纹理颜色，进行颜色叠加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      用折射程度参与最终的颜色计算，折射程度值的变化决定了最终表现效果在 完全反射~完全折射 之间变化</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>自定义折射效果</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//目前我们利用屏幕坐标在抓取纹理中采样并没有处理偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//因此呈现出来的效果像是在透明和半透明之前切换</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//我们可以自定义一些简单的偏移计算规则</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//让最终的采样位置发生偏移，模拟折射效果</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_5-带法线纹理的玻璃效果实现" tabindex="-1">5.带法线纹理的玻璃效果实现 <a class="header-anchor" href="#_5-带法线纹理的玻璃效果实现" aria-label="Permalink to &quot;5.带法线纹理的玻璃效果实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.创建Shader 复制上节课的相关代码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.将 BumpedDiffuse 标准法线漫反射Shader中关于法线相关的计算整合进来</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  注意：不再需要_BumpScale来控制凹凸程度，我们默认法线凹凸程度最大化</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.修改反射向量计算规则</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  由于法线需要从法线纹理中获取</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  因此需要将反射向量的计算放入到片元着色器中</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>利用切线空间法线来计算折射偏移</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.加入一个控制折射扭曲程度的新属性_Distortion 取值范围可以大一些</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.利用切线空间下法线来计算偏移值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  加入两行关键代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  第一行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  float2 offset = tangentNormal.xy * _Distortion ;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  使用切线空间下法线的xy * 扭曲值得到一个偏移量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  代表光线经过法线方向扰动后的偏移程度，确定光线折射的方向和强度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  第二行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  屏幕坐标.xy = offset * 屏幕坐标.z + 屏幕坐标.xy;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  用偏移量和屏幕空间深度值相乘，模拟出真实的折射效果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  深度值越大（即距离相机越远），折射效果越明显。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  这样可以实现近大远小的效果，使得物体在不同深度上的折射效果有所差异。</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="九、程序纹理" tabindex="-1">九、程序纹理 <a class="header-anchor" href="#九、程序纹理" aria-label="Permalink to &quot;九、程序纹理&quot;">​</a></h3><p><strong>程序纹理（Procedural Textures）：就是通过程序代码生成的纹理</strong></p><blockquote><p>程序纹理如何生成</p></blockquote><ol><li><p>通过C#脚本生成纹理后传递给Shader</p></li><li><p>直接在Shader代码中自定义逻辑生成纹理</p></li></ol><blockquote><p>优点</p></blockquote><ol><li><p>由于是动态生成，不需要存储大文件，可以在运行时生成任意分辨率的纹理</p></li><li><p>可以根据需求调整自定义参数，实时的更改纹理外观</p></li><li><p>通过适当的函数设计，可以生成无缝平铺的纹理</p></li></ol><blockquote><p>补充</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Shader中的内置函数floor<!--]--></span><!--]-->（属于UnityCG.cginc）<p>该函数 传入一个数值 floor(数值) 会对传入数值<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->向下取整<!--]--></span><!--]--> 比如： floor(2.6) 返回 2 floor(0.4) 返回 0 floor(-2.3) 返回 -3</p><blockquote><p>程序材质是什么</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->程序材质是通过算法和数学函数生成的材质<!--]--></span><!--]-->（主要在Shader代码中实现）<p>它通常包括多个纹理属性和各种其他属性，用于计算模拟现实世界中的各种表面特性</p><p>总的来说 程序材质是由多个程序纹理和材质属性组合而成的 他们共同定义了材质的外观和物理属性，模拟出复杂的表现效果</p><blockquote><p>制作程序材质的工具</p></blockquote><ol><li><strong>Substance Designer</strong>（物质设计师）</li><li>Blender</li><li>Houdini</li></ol><blockquote><p>获取程序材质</p></blockquote><p>1.Unity资源商店 2.Substance Share: <a href="https://substance3d.adobe.com/community-assets" target="_blank" rel="noreferrer">https://substance3d.adobe.com/community-assets</a> 3.GameTextures：<a href="https://gametextures.com/" target="_blank" rel="noreferrer">https://gametextures.com/</a></p><hr><h2 id="动态效果" tabindex="-1">动态效果 <a class="header-anchor" href="#动态效果" aria-label="Permalink to &quot;动态效果&quot;">​</a></h2><blockquote><p>如何制作动态效果</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用Shader制作动态效果的关键就是 `——` 利用时间变化来改变数据，从而导致渲染结果改变，带来画面变化<!--]--></span><!--]--><blockquote><p>内置时间变量</p></blockquote><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->float4 _Time<!--]--></span><!--]--><p><strong>4个分量的值分别是(t<code>/</code>20, t, 2t, 3t)</strong> 其中t代表该<strong>游戏场景从加载开始缩经过的时间</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->float4 _SinTime<!--]--></span><!--]--><p><strong>4个分量的值分别是(t<code>/</code>8, t<code>/</code>4, t<code>/</code>2, t)</strong> 其中t代表 游戏运行的时间的<strong>正弦值</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->float4 _CosTime<!--]--></span><!--]--><p><strong>4个分量的值分别是(t<code>/</code>8, t<code>/</code>4, t<code>/</code>2, t)</strong> 其中t代表 游戏运行的时间的<strong>余弦值</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->float4 unity_DeltaTime<!--]--></span><!--]--><p><strong>4个分量的值分别是(dt, 1/dt, smoothDt, 1/smoothDt)</strong> dt代表帧间隔时间（上一帧到当前帧间隔时间） smoothDt是平滑处理过的时间间隔，对帧间隔时间进行某种平滑算法处理后的结果</p></li></ol><blockquote><p>Shader中经常会改变的数据</p></blockquote><ol><li>颜色 通过时间控制颜色的变化，比如 渐变、闪烁 等效果</li><li>位置 利用时间使顶点在某个方向上移动，比如 波动 等效果</li><li>纹理坐标 利用时间变化来动态改变纹理坐标，比如 水流、云彩、序列帧动画 等效果</li><li>法线 利用时间动态修改法线方向，比如 风吹草动 等效果</li><li>缩放 利用时间改变物体缩放比例，比如 脉动、跳动等效果</li><li>透明度 利用时间控制物体透明度，比如 淡入淡出、闪烁等效果</li></ol><hr><h3 id="一、-序列帧动画" tabindex="-1">一、 序列帧动画 <a class="header-anchor" href="#一、-序列帧动画" aria-label="Permalink to &quot;一、 序列帧动画&quot;">​</a></h3><blockquote><p>关键点</p></blockquote><pre><code>**1.UV坐标范围0~1，原点为图片左下角**

**2.图集序列帧动画播放顺序为从左到右，从上到下**
</code></pre><blockquote><p>问题解决思路</p></blockquote><pre><code>**1.用内置时间参数 _Time.y 参与计算得到具体哪一帧**

 时间是不停增长的数值，用它对总帧数取余，便可以循环获取到当前帧数

**2.利用时间得到当前应该绘制哪一帧后**

 我们只需要确认从当前小图片中，采样开始位置，采样范围即可

 采样开始位置，可以利用当前帧和行列一起计算

 采样范围可以将0~1范围 缩放转换到 小图范围内
</code></pre><blockquote><p>用Shader实现序列帧动画</p></blockquote><ol><li>新建Shader 删除无用代码</li><li>声明属性，进行属性映射 主纹理、图集行列、序列帧切换速度</li><li>透明Shader 设置渲染标签 Tags<code>{ "RenderType"="Opaque" "IgnoreProjector"="True" "Queue"="Transparent" }</code> 关闭深度写入，开启混合 ZWrite Off Blend SrcAlpha OneMinusSrcAlpha</li><li>结构体 只需要顶点坐标和纹理坐标</li><li>顶点着色器 只需要进行坐标转换和纹理坐标赋值</li><li>片元着色器 6-1:利用时间计算帧数 6-2:利用帧数计算当前 uv采样起始位置（得到小图片uv起始位置） 6-3:计算uv缩放比例（将0~1 转换到 0~1/n） 6-4:进行uv偏移计算（在小图片格子中采样） 6-5:采样</li></ol><h4 id="实现-10" tabindex="-1">实现 <a class="header-anchor" href="#实现-10" aria-label="Permalink to &quot;实现&quot;">​</a></h4><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader "Unlit/Lesson92_SequentialFrameAnimation"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainTex ("Texture", 2D) = "white" {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //图集行列</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Rows("Rows", int) = 8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Columns("Columns", int) = 8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //切换动画速度变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Speed("Speed", float) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { "RenderType"="Transparent" "Queue"="Transparent" "IgnoreProjector"="True" }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 uv : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 vertex : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _Rows;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _Columns;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _Speed;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert (appdata_base v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex = UnityObjectToClipPos(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv = v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag (v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //得到当前帧 利用时间变量计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float frameIndex = floor(_Time.y * _Speed) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">% (_Rows * _Columns);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //小格子（小图片）采样时的起始位置计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //除以对应的行和列 目的是将行列值 转换到 0~1的坐标范围内</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //1 - (floor(frameIndex / _Columns) + 1)/_Rows</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //  +1 是因为把格子左上角转换为格子左下角</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //  1- 因为UV坐标采样时从左下角进行采样的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 frameUV = float2(frameIndex </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">% _Columns / _Columns, 1 - (floor(frameIndex / _Columns) + 1)/_Rows);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //得到uv缩放比例 相当于从0~1大图 隐射到一个 0~1/n的一个小图中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 size = float2(1/_Columns, 1/_Rows);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //计算最终的uv采样坐标信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //*size 相当于把0~1范围 缩放到了 0~1/8范围</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //+frameUV 相当于把起始的采样位置 移动到了 对应帧小格子的起始位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 uv = i.uv * size + frameUV;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //最终采样颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return tex2D(_MainTex, uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="二、滚动的背景" tabindex="-1">二、滚动的背景 <a class="header-anchor" href="#二、滚动的背景" aria-label="Permalink to &quot;二、滚动的背景&quot;">​</a></h3><blockquote><p>知识补充</p></blockquote><pre><code>**内置函数 `frac(参数)`**

该函数的内部计算规则为：

**`frac(x) = x - floor(x)`**

一般用于保留数值的小数部分，但是负数时要注意

比如：

`frac(2.5) = 2.5 - 2 = 0.5`

`frac(3.75) = 3.75 - 3 = 0.75`

`frac(-0.25) = -0.25 - (-1) = 0.75`

`frac(-3.75) = -3.75 - (-4) = 0.25`

&lt;ColorText color="red"&gt;它的主要作用是可以帮助我们保证 uv坐标 范围在0~1之间&lt;/ColorText&gt;

相当于

**大于1的uv值重新从0开始向1方向取值**

**小于0的uv值重新从1开始向0方向取值**
</code></pre><blockquote><p>用Shader实现滚动的背景</p></blockquote><ol><li>新建Shader，删除无用代码</li><li>声明属性，属性映射 主纹理、U轴速度、V轴速度（两个速度的原因是因为图片可能竖直或水平滚动）</li><li>透明Shader 往往这种滚动背景图片都会有透明区域 渲染标签修改、关闭深度写入、进行透明混合</li><li>结构体 顶点和纹理坐标</li><li>顶点着色器 顶点坐标转换，纹理坐标直接赋值</li><li>片元着色器 利用时间和速度对uv坐标进行偏移计算 利用偏移后的uv坐标进行采样</li></ol><h4 id="实现-11" tabindex="-1">实现 <a class="header-anchor" href="#实现-11" aria-label="Permalink to &quot;实现&quot;">​</a></h4><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader "Unlit/Lesson93_ScrollingBackground"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainTex ("Texture", 2D) = "white" {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //水平和竖直的滚动速度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _ScrollSpeedU("ScrollSpeedU", float) = 0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _ScrollSpeedV("ScrollSpeedV", float) = 0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { "RenderType"="Transparent" "Queue"="Transparent" "IgnoreProjector"="True" }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 uv : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 vertex : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _ScrollSpeedU;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _ScrollSpeedV;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert (appdata_base v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex = UnityObjectToClipPos(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv = v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag (v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //利用时间 来计算UV的偏移 因为时间一直在变化 所以最终的uv坐标也不停地在变</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 scrollUV = frac(i.uv + float2(_Time.y * _ScrollSpeedU, _Time.y * _ScrollSpeedV));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return tex2D(_MainTex, scrollUV);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="三、流动的河流" tabindex="-1">三、流动的河流 <a class="header-anchor" href="#三、流动的河流" aria-label="Permalink to &quot;三、流动的河流&quot;">​</a></h3><h4 id="_1-基本原理" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><blockquote><p>波浪感的关键因素</p></blockquote><p><strong>波长</strong>:</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->指两个相邻波峰或波谷之间的距离。波长越大，波动越缓慢，波形周期越长.<!--]--></span><!--]--><p><strong>波长的倒数</strong>:</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->1`/`波长，倒数越大，表示波动越频繁，波形周期越短<!--]--></span><!--]--><p><strong>波动频率</strong>:</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->指波动在单位时间内发生的次数(相当于波浪变化的频率).<!--]--></span><!--]--><p><strong>波动幅度:</strong></p><p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->指波峰或波谷相对于中线(静止位置)的最大偏移位置<!--]--></span><!--]--></p><p>我们需要在我们的Shader代码中,声明这三个关键因素变量,用于控制顶点的偏移从而实现流动的2D河流效果</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/动态效果/流动的河流.png" loading="lazy"></div><blockquote><p>基本原理</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>让我们的顶点在对应的轴向产生偏移</strong><!--]--></span><!--]--><p>主要运用的就是Shader中的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->内置函数sin<!--]--></span><!--]-->，以及<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->内置时间变量<code>_Time.y</code><!--]--></span><!--]--></p><p>sin 是正弦函数，正弦函数是一个周期性函数，常用与表示波动和震荡效果，它的返回值是<code>-1~1 _Time.y</code> 是切换到当前场景后所经过的时间，参与到计算中，可以让我们的波浪周期性变化 再结合波长的倒数、波动评率、波动幅度等可变参数，参与到计算中，便可以实现效果</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->关键步骤一：让顶点上下动起来<!--]--></span><!--]--><p>我们可以利用sin函数让顶点在希望移动的轴向上产生偏移，并且为了能够周期性变化，可以让时间 参与到计算中:<code>sin( _Time.y )</code></p><p>该函数随着时间的变化，会不停地返回-1~1 之间的数</p><p>为了控制波动评率，我们可以声明波动评率变量参与计算：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><code>sin( _Time.y * 波动频率)</code><!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用得到的返回值，作为顶点在某一轴向的偏移值，便可以让顶点动起来<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->关键步骤二：让顶点有差异性的动起来<!--]--></span><!--]--><p>为了让顶点之间偏移位置有差异，我们可以在计算sin 时利用每个顶点的不同点制造差异性 对于顶点来说，不同点主要来自坐标，我们可以利用他们变化某个轴的坐标制造差异性</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->sin( _Time.y * 波动频率 + 顶点某轴坐标)<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用得到的返回值，作为顶点在某一轴向的偏移值，便可以让顶点有差异性的动起来<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->关键步骤三：体现波长和波动幅度<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`sin( _Time.y * 波动频率 + 顶点某轴坐标)`<!--]--></span><!--]--> 已经可以帮助我们实现波动变化了<p>想要体现出波长和波动幅度，我们只需要将这两个变量参与计算即可</p><p><strong>波长的体现：</strong> <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><em><em>sin( _Time.y * 波动频率 + 顶点某轴坐标</em> 波长的倒数)</em>*<!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->倒数越大，波形周期越短<!--]--></span><!--]--><p><strong>波动幅度体现： <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><code>sin( _Time.y * 波动频率 + 顶点某轴坐标* 波长的倒数) * 波动幅度</code><!--]--></span><!--]--></strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->相当于将 -1~1 范围扩大了<!--]--></span><!--]--><p>**流动的2D河流基本原理，就是利用下面这个公式，对顶点位置进行偏移计算 **</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->某轴位置偏移量= `sin( _Time.y * 波动频率 + 顶点某轴坐标* 波长的倒数) * 波动幅度`<!--]--></span><!--]--><p><strong>其中</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->具体轴向根据模型空间决定<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->波动频率、波长倒数、波动幅度为自定义变量，可以外部调节<!--]--></span><!--]--><h4 id="_2-实现" tabindex="-1">2. 实现 <a class="header-anchor" href="#_2-实现" aria-label="Permalink to &quot;2. 实现&quot;">​</a></h4><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader "Unlit/Lesson94_2DWater"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainTex ("Texture", 2D) = "white" {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Color("Color", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //波动幅度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _WaveAmplitude("WaveAmplitude", Float) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //波动频率</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _WaveFrequency("WaveFrequency", Float) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //波长的倒数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _InvWaveLength("InvWaveLength", Float) = 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //纹理变化速度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Speed("Speed", Float) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //透明Shader相关渲染标签 + 关闭批处理标签</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { "RenderType"="Transparent" "Queue"="Transparent" "IgnoreProjector"="True" "DisableBatching"="True" }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 uv : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 vertex : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainTex_ST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _Color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _WaveAmplitude;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _WaveFrequency;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _InvWaveLength;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _Speed;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert (appdata_base v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //模型空间下的偏移位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 offset;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //让它在模型空间的x轴方向进行偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                offset.x = sin(_Time.y * _WaveFrequency + v.vertex.z * _InvWaveLength) * _WaveAmplitude;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                offset.yzw = float3(0,0,0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex = UnityObjectToClipPos(v.vertex + offset);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv = v.texcoord * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv += float2(0, _Time.y *_Speed );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag (v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed4 color = tex2D(_MainTex,i.uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                color.rgb *= _Color.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="四、广告牌效果" tabindex="-1">四、广告牌效果 <a class="header-anchor" href="#四、广告牌效果" aria-label="Permalink to &quot;四、广告牌效果&quot;">​</a></h3><blockquote><p>广告牌效果是什么</p></blockquote><p>广告牌效果</p><p>它是一种图形技术</p><p>用于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->确保对象<!--]--></span><!--]-->（通常是二维纹理面片或精灵(Sprite)图片）<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->始终面向摄像机<!--]--></span><!--]--></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->同时在某些轴上保持固定的方向（一般分为全向广告牌和轴对齐广告牌）<!--]--></span><!--]--><p>在3D游戏中非常有用</p><p>它可以确保无论从哪个角度看、对象始终面向玩家，创造出一种始终可见的效果。</p><blockquote><p>广告牌效果是什么</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->全向广告牌效果是<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->无论摄像机位置如何变化，对象在所有轴上始终面向摄像机<!--]--></span><!--]--><p><strong>适用于烟雾、火焰</strong>等需要从任何角度看都要正对摄像机的效果</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->轴对齐广告牌<!--]--></span><!--]-->是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对象在一个特定轴上保持固定方向，而在其他轴上面向摄像机<!--]--></span><!--]--><p><strong>适用于树木、花草、人物</strong>等需要在特定轴上保持正确方向的效果</p><p>其中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->垂直广告牌<!--]--></span><!--]-->就是一种特殊的轴对齐广告牌，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对象在水平面（XZ平面）上旋转 但在垂直方向上始终保持不变<!--]--></span><!--]--></p><h4 id="_1-广告牌基本原理" tabindex="-1">1. 广告牌基本原理 <a class="header-anchor" href="#_1-广告牌基本原理" aria-label="Permalink to &quot;1. 广告牌基本原理&quot;">​</a></h4><p><strong>核心原理是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->旋转模型空间坐标系让其始终面向摄像机<!--]--></span><!--]--></strong></p><p>想要达到这个目的</p><p>我们需要构建一个基于模型空间的新坐标系</p><p><strong>坐标系由两个关键因素决定</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->原点（新坐标系中心点）<!--]--></span><!--]--><p><strong>基于模型空间的，可以自定义，但一般还是用（0,0,0）</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->三个轴向（X轴、Y轴、Z轴）<!--]--></span><!--]--><p><strong>通常情况下三个轴向由视角方向、垂直向上方向、右方向构成</strong></p></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/动态效果/广告牌.png" loading="lazy"></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->关键点就是求出<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->三个轴向（X轴、Y轴、Z轴）<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/动态效果/广告牌 (2).png" loading="lazy"></div><p><strong>Z轴= <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->normal = 将摄像机位置转到模型空间– 模型空间下新轴向空间中心点（一般还是0,0,0）<!--]--></span><!--]--></strong></p><p><strong>old Up = <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->模型空间中Y轴（0,1,0）<!--]--></span><!--]--></strong></p><p><strong>X轴= <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->right = Normal X OldUp<!--]--></span><!--]--> （知识回顾：两个向量叉乘可以得到垂直于两向量所在平面的向量）</strong></p><p><strong>Y轴= <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->new Up = Normal X Right<!--]--></span><!--]--></strong></p><p>我们已经知道了应该如何获取到</p><p>新坐标空间的X、Y、Z轴，有了轴向</p><p>我们再定义一个新坐标系的中心点（相对于模型空间的）</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->一般我们会将中心点Center定为（0,0,0）即原模型空间原点<!--]--></span><!--]--><p>那么此时我们只需要计算以下两步即可：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->偏移位置 = 顶点坐标– Center<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->新顶点位置= Center + X轴 * 偏移位置.x + Y轴 * 偏移位置.y + Z轴 * 偏移位置.z<!--]--></span><!--]--><p><strong>通过以上的计算，我们便可以让顶点更新位置，让对象一直面朝我们了</strong></p><p><strong>实现出一个全向广告牌效果</strong></p><p>如果想要实现出垂直广告牌效果</p><p><strong>那只需要在计算轴向向量时进行修改即可</strong></p><p><strong>只需要在计算<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->normal<!--]--></span><!--]-->向量时，让其的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->y值变为0<!--]--></span><!--]-->即可</strong></p><p><strong>相当于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->normal向量只在xz 平面变化<!--]--></span><!--]--></strong></p><hr><h4 id="_2-广告牌效果实现" tabindex="-1">2.广告牌效果实现 <a class="header-anchor" href="#_2-广告牌效果实现" aria-label="Permalink to &quot;2.广告牌效果实现&quot;">​</a></h4><ol><li>新建Shader，删除无用代码</li><li>声明属性，属性映射 主纹理、颜色叠加、垂直广告牌程度（0为垂直广告牌，1为全向广告牌）</li><li>透明Shader相关 注意：关闭批处理，并让其两面渲染</li><li>结构体相关 顶点和纹理坐标</li><li>顶点着色器 5-1:确定新坐标中心点 5-2:计算Z轴（normal），将摄像机坐标转到模型空间 5-3:用垂直广告牌程度改变Z轴y值后，单位化 5-4:声明Y轴（old up） 5-5:利用Z轴（normal）和Y轴（old up）叉乘计算出X轴（right） 5-6:利用Z轴（normal）和X轴（right）叉乘计算出Y轴（up） 5-7:得到顶点相对于新坐标系中心点的偏移位置 5-8:利用新中心点和3轴计算出顶点新位置 5-9:新顶点转到裁剪空间 5-10:UV缩放偏移</li><li>片元着色器 直接采样 叠加颜色即可</li></ol><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader "Unlit/Lesson95_Billboarding"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainTex ("Texture", 2D) = "white" {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Color("Color", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //用于控制垂直广告牌和全向广告牌的变化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _VerticalBillboarding("VerticalBillboarding", Range(0,1)) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { "RenderType"="Transparent" "Queue"="Transparent" "IgnoreProjector"="True" "DisableBatching"="True" }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 uv : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 vertex : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainTex_ST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 _Color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _VerticalBillboarding;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert (appdata_base v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //新坐标系的中心点（默认我们还是使用的模型空间原定）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 center = float3(0,0,0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //计算Z轴（normal）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 cameraInObjectPos = mul(unity_WorldToObject, float4(_WorldSpaceCameraPos, 1));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //得到Z轴对应的向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 normalDir = cameraInObjectPos - center;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //相当于把y往下压，如果_VerticalBillboarding是0 就代表把我们Z轴压到了xz平面 如果是1 那么就是正常的视角方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                normalDir.y *= _VerticalBillboarding;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //单位化Z轴</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                normalDir = normalize(normalDir);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //模型空间下的Y轴正方向 作为它的 old up</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //为了避免z轴和010重合 ，因为重合后再计算叉乘 可能会得到0向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 upDir = normalDir.y &gt; 0.999 ? float3(0,0,1) : float3(0,1,0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //利用叉乘计算X轴（right）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 rightDir = normalize(cross(upDir, normalDir));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //去计算我们的Y轴 也就是newup</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                upDir = normalize(cross(normalDir, rightDir));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //得到顶点相对于新坐标系中心点的偏移位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 centerOffset = v.vertex.xyz - center;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //利用3个轴向进行最终的顶点位置的计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 newVertexPos = center + rightDir * centerOffset.x + upDir * centerOffset.y + normalDir * centerOffset.z;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //把新顶点转换到裁剪空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex = UnityObjectToClipPos(float4(newVertexPos, 1));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //uv坐标偏移缩放</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag (v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 color = tex2D(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                color.rgb *= _Color.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="五、顶点坐标的注意事件" tabindex="-1">五、顶点坐标的注意事件 <a class="header-anchor" href="#五、顶点坐标的注意事件" aria-label="Permalink to &quot;五、顶点坐标的注意事件&quot;">​</a></h3><h4 id="_1-批处理" tabindex="-1">1.批处理 <a class="header-anchor" href="#_1-批处理" aria-label="Permalink to &quot;1.批处理&quot;">​</a></h4><blockquote><p>为什么批处理会影响顶点动画</p></blockquote><p>Unity中默认有静态批处理和动态批处理 <strong>批处理的主要作用是</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->合并多个对象，将他们作为一个DrawCall进行处理<!--]--></span><!--]--><p>之所以批处理会对顶点动画带来影响 是因为 不同的对象会拥有不同的变换矩阵（位置、旋转、缩放） 而批处理后 他们的变换矩阵会进行统一处理</p><p><strong>举例：</strong><strong>物体A:位于世界空间位置 (0, 0, 0)，无旋转。</strong><strong>物体B:位于世界空间位置 (5, 0, 0)，无旋转。</strong><strong>他们是两个独立的对象，拥有不同的变换矩阵</strong></p><p><strong>不进行批处理时：</strong> 每个对象的变换矩阵会单独传递给Shader，顶点的模型空间位置会根据各自的变换进行正确计算</p><p><strong>进行批处理时：</strong> 启用批处理后，Unity会将对象A和对象B合并为一个Draw Call，并使用一个统一的变换矩阵 比如在静态批处理中，Unity会将对象A和对象B的顶点合并为一个网格，并使用统一的变换进行渲染 批处理后顶点位置是混合的，Shader中无法区分不同对象的模型空间位置 可能带来的问题有:</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点动画失效：<!--]--></span><!--]--><p>假设你希望顶点在模型空间的x方向上进行sin波动动画。 如果对象A和对象B的模型空间位置被混合，波动动画会变得不可预测</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->变换混淆：<!--]--></span><!--]--><p>对象A和对象B有不同的变换矩阵。 如果批处理后使用统一的变换矩阵，Shader无法区分每个顶点属于哪个对象，导致所有顶点的动画效果混淆。</p><p><strong>总结：</strong> 批处理会让对象失去独立性 相当于将多个对象之间独立的模型空间坐标系合并为一个坐标系 从而影响顶点的相对位置和变换矩阵等信息 导致顶点动画结果异常 因此我们通过渲染标签来关闭批处理</p><blockquote><p>关闭批处理带来的问题</p></blockquote><p>关闭批处理带来的最直接问题就是导致 <strong>DrawCall的提升</strong><strong>DrawCall的提升可能会带来性能问题</strong></p><p><strong>如果DrawCall的增加并没有带来性能问题</strong><strong>那我们可以通过关闭批处理来解决顶点动画问题</strong> 如果带来了性能问题，并且必须优化带有顶点动画的Shader，我们应该如何解决呢？</p><blockquote><p>如何解决问题</p></blockquote><ol><li><strong>顶点颜色</strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用顶点颜色来存储每个顶点的位置信息或相对位置信息<!--]--></span><!--]--><strong>我们在tex代码中获取模型网格顶点数据，将数据存储到网格的颜色属性中</strong> 在Shader中通过颜色属性获取顶点信息</li></ol><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">MeshFilter meshFilter = GetComponent&lt;MeshFilter&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">if (meshFilter != null)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Mesh mesh = meshFilter.mesh;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Vector3[] vertices = mesh.vertices;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Color[] colors = new Color[vertices.Length];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    for (int i = 0; i &lt; vertices.Length; i++)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        // 将模型空间位置存储在顶点颜色中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        colors[i] = new Color(vertices[i].x, vertices[i].y, vertices[i].z, 1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    mesh.colors = colors;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><ol start="2"><li><p><strong>uv通道</strong></p><p>和上面的顶点颜色方案类似，只是把相关信息存储到uv通道中而已，但是一般在存储两个值时使用</p></li></ol><hr><h4 id="_2-阴影" tabindex="-1">2. 阴影 <a class="header-anchor" href="#_2-阴影" aria-label="Permalink to &quot;2. 阴影&quot;">​</a></h4><blockquote><p>顶点动画物体投射阴影</p></blockquote><p>我们可以为有顶点动画的物体 使用 LightMode(灯光模式) 为 ShadowCaster(阴影投射) 的 Pass(渲染通道) 这样它便能投射阴影 但是如果我们直接使用内置的这种Pass（默认Shader中的，通过FallBack寻找到的） 投射的阴影会是不正确的，因为默认Pass当中并不会使用新的顶点位置来投射 而是按照模型原来的顶点位置来计算阴影的 举例：</p><ol><li>新建一个Shader,复制 Lesson94_2DWater 流动的2D河流的Shader代码</li><li>为其加上一个不透明的FallBackShader 比如VertexLit</li><li>在Mesh Renderer中开启双面投射阴影</li></ol><p>这时我们使用该Shader投射出来的阴影是没有经过顶点动画变化的模型阴影</p><blockquote><p>让顶点动画物体投射正确的阴影</p></blockquote><pre><code>我们需要自定义一个LightMode(灯光模式) 为 ShadowCaster(阴影投射) 的 Pass(渲染通道)

在顶点着色器函数中进行顶点相关的计算
</code></pre><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->为知识点一种创建的Shader复制基础阴影投射渲染通道代码 Lesson64_ForwardLighting 中注释掉的Pass<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在该Pass中加入 波形频率、波长的倒数、波形幅度 属性的映射<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在该Pass中的顶点着色器函数中 加入顶点的偏移计算（直接复制前面的代码）<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->直接对模型空间中顶点进行偏移，不用进行裁剪坐标空间变换以及UV相关计算<!--]--></span><!--]--></li></ol><blockquote><p>总结</p></blockquote><p><strong>想要让带有顶点动画的对象产生正确的阴影</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们需要自定义 投射阴影的Pass（渲染通道）<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在其中加入对顶点的变换计算即可<!--]--></span><!--]--><h5 id="实现-12" tabindex="-1">实现 <a class="header-anchor" href="#实现-12" aria-label="Permalink to &quot;实现&quot;">​</a></h5><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader "Unlit/Lesson97"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _MainTex ("Texture", 2D) = "white" {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Color("Color", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //波动幅度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _WaveAmplitude("WaveAmplitude", Float) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //波动频率</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _WaveFrequency("WaveFrequency", Float) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //波长的倒数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _InvWaveLength("InvWaveLength", Float) = 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //纹理变化速度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        _Speed("Speed", Float) = 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //透明Shader相关渲染标签 + 关闭批处理标签</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { "RenderType"="Transparent" "Queue"="Transparent" "IgnoreProjector"="True" "DisableBatching"="True" }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 uv : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 vertex : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            sampler2D _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _MainTex_ST;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 _Color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _WaveAmplitude;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _WaveFrequency;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _InvWaveLength;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _Speed;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert (appdata_base v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //模型空间下的偏移位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 offset;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //让它在模型空间的x轴方向进行偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                offset.x = sin(_Time.y * _WaveFrequency + v.vertex.z * _InvWaveLength) * _WaveAmplitude;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                offset.yzw = float3(0,0,0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex = UnityObjectToClipPos(v.vertex + offset);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv = v.texcoord * _MainTex_ST.xy + _MainTex_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv += float2(0, _Time.y *_Speed );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            fixed4 frag (v2f i) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed4 color = tex2D(_MainTex,i.uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                color.rgb *= _Color.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        //该注释主要用于进行阴影投影 主要是用来计算阴影映射纹理的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{"LightMode" = "ShadowCaster"}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            //  该编译指令时告诉Unity编译器生成多个着色器变体</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            //  用于支持不同类型的阴影（SM，SSSM等等）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            //  可以确保着色器能够在所有可能的阴影投射模式下正确渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_shadowcaster</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            //  其中包含了关键的阴影计算相关的宏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //顶点到片元着色器阴影投射结构体数据宏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //这个宏定义了一些标准的成员变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //这些变量用于在阴影投射路径中传递顶点数据到片元着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //我们主要在结构体中使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                V2F_SHADOW_CASTER;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _WaveAmplitude;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _WaveFrequency;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float _InvWaveLength;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f vert(appdata_base v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //模型空间下的偏移位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 offset;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //让它在模型空间的x轴方向进行偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                offset.x = sin(_Time.y * _WaveFrequency + v.vertex.z * _InvWaveLength) * _WaveAmplitude;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                offset.yzw = float3(0,0,0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //需要进行顶点偏移位置的修改</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //直接在模型空间下顶点坐标进行计算即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v.vertex = v.vertex + offset;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //o.vertex = UnityObjectToClipPos(v.vertex + offset);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //转移阴影投射器法线偏移宏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //用于在顶点着色器中计算和传递阴影投射所需的变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //主要做了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //2-2-1.将对象空间的顶点位置转换为裁剪空间的位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //2-2-2.考虑法线偏移，以减轻阴影失真问题，尤其是在处理自阴影时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //2-2-3.传递顶点的投影空间位置，用于后续的阴影计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //我们主要在顶点着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                TRANSFER_SHADOW_CASTER_NORMALOFFSET(data);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                return data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 frag(v2f i):SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //阴影投射片元宏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //将深度值写入到阴影映射纹理中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                //我们主要在片元着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                SHADOW_CASTER_FRAGMENT(i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback "VertexLit"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="屏幕后期处理效果" tabindex="-1">屏幕后期处理效果 <a class="header-anchor" href="#屏幕后期处理效果" aria-label="Permalink to &quot;屏幕后期处理效果&quot;">​</a></h2><h3 id="一、网格、网格渲染器、材质、着色器" tabindex="-1">一、网格、网格渲染器、材质、着色器 <a class="header-anchor" href="#一、网格、网格渲染器、材质、着色器" aria-label="Permalink to &quot;一、网格、网格渲染器、材质、着色器&quot;">​</a></h3><h4 id="_1-网格-mesh" tabindex="-1">1. 网格（Mesh） <a class="header-anchor" href="#_1-网格-mesh" aria-label="Permalink to &quot;1. 网格（Mesh）&quot;">​</a></h4><p><strong>网格是一个3D对象的几何数据。</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它由顶点、边和面组成。网格描述了对象的形状和结构，定义了3D模型的轮廓。<!--]--></span><!--]--><p>网格中<strong>包含了模型的关键数据</strong> 比如： 顶点、法线、切线、纹理坐标、顶点颜色、骨骼权重、骨骼索引、网格边界等等信息 我们在Shader中使用的模型的数据就来自于Mesh</p><p><strong>Unity中不带骨骼动画的模型网格数据一般在MeshFilter（网格过滤器）组件中进行关联</strong><strong>而带骨骼动画的模型网格数据一般在Skinned Mesh Renderer（蒙皮网格渲染器）中进行关联</strong></p><h4 id="_2-网格渲染器-mesh-renderer" tabindex="-1">2. 网格渲染器（Mesh Renderer） <a class="header-anchor" href="#_2-网格渲染器-mesh-renderer" aria-label="Permalink to &quot;2. 网格渲染器（Mesh Renderer）&quot;">​</a></h4><p>网格渲染器是Unity中的一个组件，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于将网格绘制到屏幕上<!--]--></span><!--]--> 它主要用来</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->引用一个网格对象来获取几何数据，Mesh Renderer组件会自动寻找同一GameObject上<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Mesh Filter组件中的网格（Mesh）并将其渲染出来<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->引用一个或多个材质，用于定义对象的外观<!--]--></span><!--]--></li></ol><p>一般<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->不带骨骼动画的模型都使用网格渲染器来进行渲染<!--]--></span><!--]--> 比如： 游戏中的建筑物，箱子，地面等等不需要骨骼动画的模型</p><h4 id="_3-蒙皮网格渲染器-skinned-mesh-renderer" tabindex="-1">3. 蒙皮网格渲染器（Skinned Mesh Renderer） <a class="header-anchor" href="#_3-蒙皮网格渲染器-skinned-mesh-renderer" aria-label="Permalink to &quot;3. 蒙皮网格渲染器（Skinned Mesh Renderer）&quot;">​</a></h4><p>蒙皮网格渲染器是一种特殊的网格渲染器，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于处理带有骨骼动画的网格<!--]--></span><!--]-->。 它不仅<strong>处理网格的几何数据，还处理骨骼和权重，允许网格根据骨骼动画进行变形</strong>。 使用蒙皮网格渲染器的对象不需要再使用Mesh Filter组件 它可以直接关联对应的网格信息</p><p>一般带有动画的模型都使用蒙皮网格渲染器来进行渲染 比如： 游戏中的角色、怪物、机关等等</p><h4 id="_4-材质-material" tabindex="-1">4. 材质（Material） <a class="header-anchor" href="#_4-材质-material" aria-label="Permalink to &quot;4. 材质（Material）&quot;">​</a></h4><p>材质我们也可以称为材质球 它定义了模型网格的外观</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->材质包含对一个着色器的引用，并通过一组属性（例如颜色、纹理等等信息）来配置着色器<!--]--></span><!--]--><p>一个模型可以有多个材质，每个材质应用于模型的不同部分</p><h4 id="_5-着色器" tabindex="-1">5. 着色器 <a class="header-anchor" href="#_5-着色器" aria-label="Permalink to &quot;5. 着色器&quot;">​</a></h4><p>是一种用于<strong>描述如何渲染图形和计算图形外观的程序</strong> 主要用于<strong>控制图形的颜色、光照、纹理和其他视觉效果</strong> 它是运行在<strong>GPU上的程序，用于计算每个像素的颜色</strong></p><h4 id="_6-它们之间的关系" tabindex="-1">6. 它们之间的关系 <a class="header-anchor" href="#_6-它们之间的关系" aria-label="Permalink to &quot;6. 它们之间的关系&quot;">​</a></h4><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Mesh Renderer(网格渲染器)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> └── Mesh(网格) —— MeshFilter(网格过滤器组件进行关联)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       └── Geometry Data(几何数据)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> └── Material(材质)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       └── Shader(着色器)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       └── Properties(属性：颜色、纹理等 —— 在Shader中决定哪些属性暴露在材质上)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Skinned Mesh Renderer(蒙皮网格渲染器)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> └── Mesh(网格)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       └── Geometry Data(几何数据)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> └── Bones &amp; Weights(骨骼与权重)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> └── Material(材质)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       └── Shader(着色器)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">       └── Properties(属性：颜色、纹理等 —— 在Shader中决定哪些属性暴露在材质上)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="二、屏幕后期处理效果" tabindex="-1">二、屏幕后期处理效果 <a class="header-anchor" href="#二、屏幕后期处理效果" aria-label="Permalink to &quot;二、屏幕后期处理效果&quot;">​</a></h3><p>**屏幕后期处理效果（ Screen Post-Processing Effects）**是一种在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染管线的最后阶段应用的视觉效果<!--]--></span><!--]--> 允许你在场景渲染完成后对最终图像进行各种调整和效果处理，从而增强视觉体验 常见的屏幕后期处理效果有： <strong>景深、模糊、色彩调整 等等</strong></p><p>说人话： <strong>屏幕后期处理效果就是当游戏画面渲染完毕后</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通过获取到该画面信息进行额外的效果处理<!--]--></span><!--]--><h4 id="_1-基本实现原理" tabindex="-1">1. 基本实现原理 <a class="header-anchor" href="#_1-基本实现原理" aria-label="Permalink to &quot;1. 基本实现原理&quot;">​</a></h4><blockquote><p><strong>如何获取 游戏画面渲染完毕后的画面信息</strong></p></blockquote><p>在Unity中获取渲染纹理的常用方法有三种</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->RenderTexture、GrabPass、OnRenderImage<!--]--></span><!--]--><p>我们在处理屏幕后期处理效果时会使用 <strong>OnRenderImage函数来获取</strong> 游戏画面渲染完毕后的画面信息</p><blockquote><p><strong>如何为 获取到的画面信息添加自定义效果</strong></p></blockquote><p>主要思路是将获取到的游戏画面作为 自定义Shader的主纹理 通过自定义Shader利用捕获的画面来实现自定义效果</p><h4 id="_2-捕获画面的关键——onrenderimage函数" tabindex="-1">2. 捕获画面的关键——OnRenderImage函数 <a class="header-anchor" href="#_2-捕获画面的关键——onrenderimage函数" aria-label="Permalink to &quot;2. 捕获画面的关键——OnRenderImage函数&quot;">​</a></h4><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">OnRenderImage函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它是在继承了MonoBehaviour的脚本中能够被自动调用的函数（类似生命周期函数）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它会在图像的渲染操作完成后调用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它的固定写法是：</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnRenderImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> destination</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">第一个参数：源渲染纹理，当前渲染得到的屏幕图像存储在该参数当中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">第二个参数：目标渲染纹理，将经过处理后的图像写入到目标纹理中用于最终的显示</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">通过该函数我们便可以得到当前渲染的游戏画面</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">并在该函数中对画面对应的渲染纹理进行处理后用于最终显示</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">该函数得到的源纹理默认是在所有的不透明和透明的Pass执行完毕后调用的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">基于该源纹理进行修改会对游戏场景中所有游戏对象产生影响</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果你想要在不透明的Pass执行完毕后就调用该函数，只需要在该函数前加上特性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[ImageEffectOpaque]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这样就不会对透明物体产生影响</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_3-实现效果的关键——graphics-blit函数" tabindex="-1">3.实现效果的关键——Graphics.Blit函数 <a class="header-anchor" href="#_3-实现效果的关键——graphics-blit函数" aria-label="Permalink to &quot;3.实现效果的关键——Graphics.Blit函数&quot;">​</a></h4><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Graphics.Blit函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于将一个图像从一个纹理复制到另一个纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">同时可以在这个过程中用着色器对图像进行处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它有很多重载，我们主要讲解几个常用的：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.将源纹理直接复制到目标纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (Texture source, RenderTexture dest)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.将源纹理复制到目标纹理并应用一个材质</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (Texture source, RenderTexture dest, Material mat, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> pass</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">source源纹理会被传递给mat材质中Shader中名为_MainTex的纹理属性用于进行处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">pass参数默认值为</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">，表示会依次调用Shader内的所有Pass进行处理，否则，只会调用给定索引的Pass</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_4-补充函数" tabindex="-1">4.补充函数 <a class="header-anchor" href="#_4-补充函数" aria-label="Permalink to &quot;4.补充函数&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.Shader.isSupported</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如何判断Shader在目标平台和硬件上是否能正确运行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们可以通过获取Shader对象中的isSupported属性判断</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果返回false,不支持</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果返回true,支持</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.[ExecuteInEditMode]特性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用于使脚本在编辑器模式下也能执行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RequireComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">组件名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">))]特性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">指定某个脚本所依赖的组件，它确保当你将脚本附加到游戏对象时，</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">所需的组件也会自动添加到该游戏对象中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果这些组件已经存在，它们不会被重复添加</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">因为后处理脚本一般添加到摄像机上，因此我们用于依赖摄像机</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.材质球中的 HideFlags 枚举</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">从材质球对象中可以点出 HideFlags 枚举</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.None</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象是完全可见和可编辑的。这是默认值。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.HideInHierarchy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象在层级视图中被隐藏，但仍然存在于场景中。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.HideInInspector</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象在检查器中被隐藏，但仍然存在于层级视图中。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.DontSaveInEditor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象不会被保存到场景中。适用于编辑器模式，不会影响播放模式。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.NotEditable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象在检查器中是只读的，不能被修改。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.DontSaveInBuild</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象不会被包含在构建中。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.DontUnloadUnusedAsset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象在资源清理时不会被卸载，即使它没有被引用。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">HideFlags.DontSave</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> 对象不会被保存到场景中，不会在构建中保存，也不会在编辑器中保存。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这是 DontSaveInEditor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> DontSaveInBuild </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">|</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> DontUnloadUnusedAsset 的组合。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如果想要设置枚举满足多个条件 直接多个枚举 进行位或运算即可 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">|</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p><strong>注意：</strong> 在一些老版本中，你可能还会在基类中判断目标平台是否支持屏幕后处理和渲染纹理 一般通过Unity中的SystemInfo类判断 该类可以用于确定底层平台和硬件相关的功能是否被支持 官方说明：<a href="https://docs.unity.cn/cn/2022.3/ScriptReference/SystemInfo.html" target="_blank" rel="noreferrer">https://docs.unity.cn/cn/2022.3/ScriptReference/SystemInfo.html</a></p><hr><h3 id="三、亮度、饱和度、对比" tabindex="-1">三、亮度、饱和度、对比 <a class="header-anchor" href="#三、亮度、饱和度、对比" aria-label="Permalink to &quot;三、亮度、饱和度、对比&quot;">​</a></h3><h4 id="_1-亮度" tabindex="-1">1. 亮度 <a class="header-anchor" href="#_1-亮度" aria-label="Permalink to &quot;1. 亮度&quot;">​</a></h4><blockquote><p>基本原理</p></blockquote><p>想要改变图像颜色的亮度 只需要对图像的每个像素<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->进行加法(减法-加负数)或乘法(除法-乘小数)运算<!--]--></span><!--]-->即可实现</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->增加亮度就是 增加像素的RGB值<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->减小亮度则是 减少像素的RGB值<!--]--></span><!--]--><p>也就是说我们只需要在Shader当中加入一个控制亮度的float类型的变量 然后用颜色的RGB乘以该变量或者加上该变量即可 一般我们会采用乘法的形式 即： <strong>最终颜色 = 原始颜色 * 亮度变量</strong><strong>亮度变量 &gt;1 时，图像变亮</strong><strong>亮度变量 &lt;1 时，图像变暗</strong><strong>亮度变量 =1 时，图像不变</strong></p><h4 id="_2-饱和度" tabindex="-1">2. 饱和度 <a class="header-anchor" href="#_2-饱和度" aria-label="Permalink to &quot;2. 饱和度&quot;">​</a></h4><blockquote><p>基本原理</p></blockquote><p>想要改变图像颜色的饱和度 只需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对图像的每个像素的颜色值 相对于灰度颜色进行插值<!--]--></span><!--]-->来实现 基本原理为以下三步：</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->计算灰度值（亮度）<!--]--></span><!--]-->利用图像颜色RGB计算一个平均值，得到一个灰度值 但是由于人眼对不同颜色的敏感度不同，所以在计算平均值时不会直接使用算数平均（R+G+B)/3 在图形学中我们一般使用加权平均法来计算灰度值 所谓加权平均法就是通过对不同数据分配不同权重，计算出更符合实际情况的平均值 常用的权重基于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Rec. 709标准<!--]--></span><!--]-->（高清电视和许多数字图像格式中常用的标准）<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->R 红色通道的权重：0.2126<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->G 绿色通道的权重：0.7152<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->B 蓝色通道的权重：0.0722<!--]--></span><!--]-->这些权重反映了人眼对绿色最敏感，对蓝色最不敏感<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->加权平均法公式：<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灰度值（亮度）0.2126 * R + 0.7152 * G + 0.0722 * B<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->生成灰度颜色<!--]--></span><!--]-->利用第一步中计算出来的灰度值，生成一个灰度颜色<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灰度颜色 = (L, L, L)<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->插值计算<!--]--></span><!--]-->使用<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->插值函数lerp<!--]--></span><!--]-->，在灰度颜色和原始颜色之间进行插值运算 插值系数就是用于控制饱和度的float类型的变量 公式如下：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最终颜色 = lerp( 灰度颜色, 原始颜色, 饱和度变量 )<!--]--></span><!--]--><strong>lerp计算原理</strong>：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最终颜色 = 灰度颜色 + (原始颜色 − 灰度颜色)*饱和度变量<!--]--></span><!--]--><strong>饱和度变量 = 0时，结果为<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灰度颜色<!--]--></span><!--]--></strong><strong>饱和度变量 = 1时，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->保持原始颜色不变<!--]--></span><!--]--></strong><strong>饱和度变量 = 0~1之间时，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灰度颜色和原始颜色的混合<!--]--></span><!--]--></strong><strong>饱和度变量 &gt; 1时，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->颜色的RGB值超出原始范围，从而使颜色看起来更饱和<!--]--></span><!--]--></strong></li></ol><h4 id="_3-颜色对比度" tabindex="-1">3. 颜色对比度 <a class="header-anchor" href="#_3-颜色对比度" aria-label="Permalink to &quot;3. 颜色对比度&quot;">​</a></h4><p>想要改变图像颜色的对比度 只需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对图像的每个像素的颜色值 相对于中性灰色进行插值<!--]--></span><!--]-->来实现 基本原理为以下两步：</p><ol><li>声明中性灰色变量，即RGB都为0.5的颜色变量<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->中性灰颜色 = (0.5,0.5,0.5)<!--]--></span><!--]--></li><li>在中性灰色和原始颜色之间进行插值运算<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最终颜色 = lerp( 中性灰色, 原始颜色, 对比度变量 )<!--]--></span><!--]--><strong>对比度变量 = 0时，此时对比度降到最低，变为中性灰色</strong><strong>对比度变量 = 1时，保持原始颜色不变</strong><strong>对比度变量 = 0~1之间时，降低对比度效果，图像的亮度差异减少，使图像颜色看起来更平淡</strong><strong>对比度变量 &gt; 1时，颜色的RGB值超出原始范围，从而使颜色亮部更亮，暗部更暗，从而增加对比度</strong></li></ol><div class="language-shaderLab"><button title="Copy code" class="copy"></button><span class="lang">shaderLab</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">Shader</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Unlit/Lesson103_BrightnessSaturationContrast"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _MainTex (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //亮度变量</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _Brightness(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Brightness"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //饱和度变量</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _Saturation(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Saturation"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //对比度变量</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        _Contrast(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Contrast"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">Float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        Tags</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            ZTest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> Always</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            Cull</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> Off</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            ZWrite</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex vert</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #pragma</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            #include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">TEXCOORD0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> vertex : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_POSITION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">            sampler2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            half</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Brightness;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            half</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Saturation;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            half</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Contrast;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v2f </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">appdata_base</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v2f o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (v2f i) : </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //从捕获的主纹理中采样</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> renderTexColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //亮度计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> finalColor = renderTexColor.rgb * _Brightness;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //饱和度计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> L = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.2126</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">*finalColor.r + </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.7152</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">*finalColor.g + </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.722</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">*finalColor.b;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> LColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(L,L,L);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                finalColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(LColor, finalColor, _Saturation);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对比度计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> avgColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                finalColor = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(avgColor, finalColor, _Contrast);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(finalColor.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">    Fallback</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson103_BrightnessSaturationContrast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Brightness</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Saturation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Contrast</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    /// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    /// 更新相关属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    /// &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UpdateProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_Brightness"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Brightness);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_Saturation"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Saturation);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_Contrast"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Contrast);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="四、边缘检测" tabindex="-1">四、边缘检测 <a class="header-anchor" href="#四、边缘检测" aria-label="Permalink to &quot;四、边缘检测&quot;">​</a></h3><h4 id="_1-边缘检测效果是什么" tabindex="-1">1. 边缘检测效果是什么 <a class="header-anchor" href="#_1-边缘检测效果是什么" aria-label="Permalink to &quot;1. 边缘检测效果是什么&quot;">​</a></h4><p>边缘检测效果，是一种</p><p>用于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->突出图像中的边缘，使物体的轮廓更加明显<!--]--></span><!--]-->的图像处理技术</p><p><strong>边缘检测</strong>的主要目的是<strong>找到图像中亮度变化显著的区域，这些区域通常对应于物体的边界</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->边缘检测相当于利用Shader 代码自动给屏幕图像进行描边处理<!--]--></span><!--]--><h4 id="_2-边缘检测效果的基本原理" tabindex="-1">2. 边缘检测效果的基本原理 <a class="header-anchor" href="#_2-边缘检测效果的基本原理" aria-label="Permalink to &quot;2. 边缘检测效果的基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->计算每个像素的灰度值，用灰度值结合卷积核进行卷积运算，得到该像素的梯度值<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->梯度值越大越靠近边界，越趋近于描边颜色<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->梯度值越小表明不是边界位置，越趋近于原始颜色<!--]--></span><!--]--><h4 id="_3-灰度值" tabindex="-1">3. 灰度值 <a class="header-anchor" href="#_3-灰度值" aria-label="Permalink to &quot;3. 灰度值&quot;">​</a></h4><p>由于人眼对不同颜色的敏感度不同，所以在计算平均值时不会直接使用算数平均（R+G+B)/3 在图形学中我们一般使用加权平均法来计算灰度值 所谓加权平均法就是通过对不同数据分配不同权重，计算出更符合实际情况的平均值</p><p>下面是基于<strong>Rec. 709</strong>标准计算的灰度值（高清电视和许多数字图像格式中常用的标准）</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灰度值L = 0.2126*R + 0.7152*G + 0.0722*B<!--]--></span><!--]--><h4 id="_4-卷积、卷积核、梯度值" tabindex="-1">4. 卷积、卷积核、梯度值 <a class="header-anchor" href="#_4-卷积、卷积核、梯度值" aria-label="Permalink to &quot;4.  卷积、卷积核、梯度值&quot;">​</a></h4><p><strong>卷积</strong>是一种数学计算方式</p><p>我们首先通过一个比喻来理解卷积在边缘检测中的作用</p><p>它就像是要用一个**放大镜（<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->卷积核<!--]--></span><!--]-->）**在图片上移动，**放大镜<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->（卷积核）<!--]--></span><!--]--><strong>的作用是帮助我们看到图 片上的细微变化。当我们用这个</strong>放大镜（<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->卷积核<!--]--></span><!--]-->）**扫描整张图片时，它能帮助我们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->发现<!--]--></span><!--]-->图片上<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->哪些地方颜色变化突然，这些突然变化的地方往往就是物体的边缘了<!--]--></span><!--]--></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/卷积.png" loading="lazy"></div><p>从卷积的计算方式我们可以得知，其中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->卷积核（也被称为边缘检测因子）<!--]--></span><!--]--></p><p>是非常重要的一个元素，在图形学中，有三种常用的卷积核（边缘检测因子）</p><p>他们分别是：</p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Roberts 算子：<!--]--></span><!--]-->由拉里·罗伯茨(Larry Roberts)于1965年提出</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Prewitt 算子：<!--]--></span><!--]-->由约翰·普雷维特(John Prewitt)于1970年提出</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Sobel 算子：<!--]--></span><!--]-->由欧文·索贝尔(Irwin Sobel)于1968年提出</strong></p><p>他们各有千秋，但是在图形学中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最常用的还是Sobel算子 <!--]--></span><!--]--></p><p>因为它更适合高精度的边缘检测</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/卷积2.png" loading="lazy"></div><p>我们可以看到三种算子都包含了<strong>两个方向的卷积核</strong></p><p>他们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->分别用来检测水平和竖直方向上的边缘信息<!--]--></span><!--]--></p><p>在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->边缘检测的卷积计算<!--]--></span><!--]-->时，只需要<strong>对每个像素进行两次卷积计算</strong>即可</p><p>这样就可以<strong>得到两个方向的梯度值<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Gx<!--]--></span><!--]--> 和<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Gy<!--]--></span><!--]--></strong></p><p>而<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->该像素<!--]--></span><!--]-->的整体<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->梯度值G = abs(Gx) + abs(Gy)<!--]--></span><!--]--></p><p>现在我们已经知道了通过卷积获取梯度值的基本原理</p><p>那么我们只需要定义一个描边颜色，利用Shader中的内置函数lerp</p><p>在原始颜色和描边颜色之间利用梯度值进行插值即可</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最终颜色= lerp（原始颜色，描边颜色，梯度值）<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->梯度值越大表明越接近边缘，则颜色越接近描边颜色；反之越接近原始颜色<!--]--></span><!--]--><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->得到当前像素以及其上下左右、左上左下、右上右下共9个像素的灰度值<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用这9个灰度值和Sobel算子进行卷积计算得到梯度值G = abs(Gx) + abs(Gy)<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最终颜色= lerp（原始颜色，描边颜色，梯度值）<!--]--></span><!--]--></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/卷积3.png" loading="lazy"></div><h5 id="_4-1-如何得到当前像素周围8个像素位置" tabindex="-1">4.1 如何得到当前像素周围8个像素位置 <a class="header-anchor" href="#_4-1-如何得到当前像素周围8个像素位置" aria-label="Permalink to &quot;4.1 如何得到当前像素周围8个像素位置&quot;">​</a></h5><p><strong>Unity 提供给我们用于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->访问纹理对应的每个纹素（像素）的大小的变量 float4 纹理名_TexelSize<!--]--></span><!--]--></strong></p><p><strong>类似纹理名_ST（用于获取纹理缩放偏移的变量）</strong></p><p><strong>其中的xyzw分别代表<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->（假设纹理宽高为1024 * 768）<!--]--></span><!--]--></strong></p><p><strong>x：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->1/纹理宽度= 1/1024<!--]--></span><!--]--></strong></p><p><strong>y：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->1/纹理高度= 1/768<!--]--></span><!--]--></strong></p><p><strong>z：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->纹理宽度= 1024<!--]--></span><!--]--></strong></p><p><strong>w：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->纹理高度= 768<!--]--></span><!--]--></strong></p><p>我们可以利用float4 纹理名_TexelSize 纹素 信息得到当前像素周围8个像素位置</p><p>可以<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->进行uv坐标偏移计算<!--]--></span><!--]-->，在顶点着色器函数或者片元着色器函数中计算都行</p><p>但是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->建议在顶点着色器函数中计算，可以节约计算量<!--]--></span><!--]--></p><p>片元着色器中直接使用插值的结果也不会影响纹理坐标的计算结果</p><h5 id="_4-2-实现" tabindex="-1">4.2 实现 <a class="header-anchor" href="#_4-2-实现" aria-label="Permalink to &quot;4.2 实现&quot;">​</a></h5><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">1.新建Shader，取名边缘检测EdgeDetection，删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">2.声明属性，进行属性映射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主纹理 _MainTex</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">边缘描边用的颜色 _EdgeColor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">注意属性映射时 使用内置纹素变量 _MainTex_TexelSize</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">3.屏幕后处理效果标配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">4.结构体相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">顶点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">uv数组，用于存储9个像素点的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">5.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用uv数组装载9个像素uv坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">6.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">利用卷积获取梯度值（可以声明一个Sobel算子计算函数和一个灰度值计算函数）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">利用梯度值在原始颜色和边缘颜色之间进行插值得到最终颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">7.FallBack Off</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson104_EdgeDetection"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //边缘线的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _EdgeColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"EdgeColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用于存储9个像素uv坐标的变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                half2 uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //Unity内置纹素变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_TexelSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _EdgeColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //当前顶点的纹理坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //去对9个像素的uv坐标进行计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算颜色的灰度值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> calcLuminance(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.2126</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">color.r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.7152</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">color.g </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.722</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">color.b;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //Sobel算子相关的卷积计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Sobel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //Sobel算子对应的两个卷积核</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                half Gx[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">                               0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">                               1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                half Gy[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                              -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                              -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> L</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//灰度值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> edgeX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//水平方向梯度值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> edgeY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//数值方向梯度值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //采样颜色后 计算灰度值 并记录下来</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> calcLuminance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, o.uv[i]));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    edgeX </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Gx[i];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    edgeY </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> L </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Gy[i];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //最终的一个该像素的梯度值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //half G = abs(edgeX) + abs(edgeY);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(edgeX) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(edgeY);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用索贝尔算子计算梯度值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> edge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Sobel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用计算出来的梯度值在原始颜色 和边缘线颜色之间进行插值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]), _EdgeColor, edge);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="五、纯色背景功能" tabindex="-1">五、纯色背景功能 <a class="header-anchor" href="#五、纯色背景功能" aria-label="Permalink to &quot;五、纯色背景功能&quot;">​</a></h3><blockquote><p>什么是纯色背景功能</p></blockquote><p>我们在边缘描边时，有时只想保留描边的边缘线 不想要显示原图的背景颜色 比如把整个背景变为白色、黑色、等等自定义颜色 而抛弃掉原本图片的颜色信息 效果就像是一张描边图片</p><blockquote><p>加入纯色背景功能</p></blockquote><ol><li><p><strong>新属性声明 属性映射</strong> 添加 背景颜色程度变量 _BackgroundExtent 0表示保留图片原始颜色，1表示完全抛弃图片原始颜色，0~1之间可以自己控制保留程度 添加自定义背景颜色 _BackgroundColor，定义用于替换图片原始颜色的颜色</p></li><li><p><strong>修改片元着色器</strong> 利用插值运算，记录纯色背景中像素描边颜色 利用插值运算，在 原始图片描边 和 纯色图片描边 之间用程度变量进行控制</p></li></ol><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //利用索贝尔算子计算梯度值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> edge</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Sobel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //利用计算出来的梯度值在原始颜色 和边缘线颜色之间进行插值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> withEdgeColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]), _EdgeColor, edge);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //纯色上描边</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">    fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> onlyEdgeColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BackgroundColor, _EdgeColor, edge);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //通过程度变量 去控制 是纯色描边 还是 原始颜色描边 在两者之间 进行过渡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(withEdgeColor, onlyEdgeColor, _BackgroundExtent);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="六、高斯模糊" tabindex="-1">六、高斯模糊 <a class="header-anchor" href="#六、高斯模糊" aria-label="Permalink to &quot;六、高斯模糊&quot;">​</a></h3><h4 id="_1-高斯模糊效果是什么" tabindex="-1">1. 高斯模糊效果是什么 <a class="header-anchor" href="#_1-高斯模糊效果是什么" aria-label="Permalink to &quot;1. 高斯模糊效果是什么&quot;">​</a></h4><p>高斯模糊效果，是一种</p><p>用于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->平滑图像并减少图像噪声和细节<!--]--></span><!--]-->的图像处理技术</p><p><strong>高斯模糊</strong>的主要目的是<strong>使图像的边缘和细节变得模糊和平滑</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯模糊相当于利用Shader 代码自动给屏幕图像进行模糊处理<!--]--></span><!--]--><h4 id="_2-基本原理" tabindex="-1">2. 基本原理 <a class="header-anchor" href="#_2-基本原理" aria-label="Permalink to &quot;2. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯模糊是利用高斯函数计算出高斯滤波核中每个元素并进行归一化处理后，<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->再和目标像素通过卷积计算后得到最终的效果<!--]--></span><!--]--><h4 id="_3-高斯滤波核" tabindex="-1">3. 高斯滤波核 <a class="header-anchor" href="#_3-高斯滤波核" aria-label="Permalink to &quot;3. 高斯滤波核&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯滤波核也称为高斯核<!--]--></span><!--]-->，它其实就是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->一个N x N 的卷积核<!--]--></span><!--]--><p>它的<strong>大小可以自定义</strong>，但是一般<strong>会是一个奇数x 奇数</strong>的大小</p><p>通常会是一个3x3 、5x5、7x7、9x9 的大小</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->滤波核越大，模糊效果越明显<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->从效果和效率综合考虑，我们通常会使用<!--]--></span><!--]-->5x5 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->的大小<!--]--></span><!--]--><p>高斯滤波核中各元素的具体值，我们通过<strong>高斯函数</strong>来确定</p><h4 id="_4-高斯函数" tabindex="-1">4. 高斯函数 <a class="header-anchor" href="#_4-高斯函数" aria-label="Permalink to &quot;4. 高斯函数&quot;">​</a></h4><p>高斯函数是由德国数学家和物理学家</p><p>卡尔·弗里德里希·高斯（Carl Friedrich Gauss）提出的。</p><p>我们将使用<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->二维高斯函数<!--]--></span><!--]-->来计算高斯模糊效果中的卷积核</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/高斯模糊.png" loading="lazy"></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->σ 是标准方差，一般取值为1即可<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->x 和 y 是相对于高斯核中心的整数距离<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**e 是自然对数的底≈ 2.71828** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->π 是圆周率≈ 3.14159<!--]--></span><!--]--><h4 id="_5-归一化处理" tabindex="-1">5. 归一化处理 <a class="header-anchor" href="#_5-归一化处理" aria-label="Permalink to &quot;5. 归一化处理&quot;">​</a></h4><p>所谓<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->归一化处理就是<!--]--></span><!--]-->让该卷积核中</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->各元素值/ 所有元素总和<!--]--></span><!--]--><p><strong>使其所有元素的和为1</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->这样是为了避免在卷积计算过程中引入额外的亮度变化或偏差<!--]--></span><!--]--><p>举例：假设一个3x3的卷积核，如果不进行归一化，卷积会将 图像的亮度放大9倍，归一化后卷积核为1，图像亮度将保持不变</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/高斯模糊2.png" loading="lazy"></div><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/高斯模糊3.png" loading="lazy"></div><h4 id="_6-高斯模糊效果的基本原理" tabindex="-1">6. 高斯模糊效果的基本原理 <a class="header-anchor" href="#_6-高斯模糊效果的基本原理" aria-label="Permalink to &quot;6. 高斯模糊效果的基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯模糊是利用高斯函数计算出高斯滤波核中每个元素并进行归一化处理后， 再和目标像素通过卷积计算后得到最终的效果<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/高斯模糊4.png" loading="lazy"></div><p><strong>注意：高斯滤波核中的数值是定死的规则，可以直接写死参与计算， 不用在代码中用高斯函数计算，会浪费性能</strong></p><p>也就是说，我们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用<!--]--></span><!--]-->计算出来的这个<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯滤波核<!--]--></span><!--]-->（高斯核或卷积核或滤波核） <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->和对应的像素点进行卷积计算<!--]--></span><!--]-->，便可以<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->得到<!--]--></span><!--]-->最终该像素<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯模糊<!--]--></span><!--]-->后的结果</p><h4 id="_7-高斯模糊效果的计算公式优化" tabindex="-1">7.高斯模糊效果的计算公式优化 <a class="header-anchor" href="#_7-高斯模糊效果的计算公式优化" aria-label="Permalink to &quot;7.高斯模糊效果的计算公式优化&quot;">​</a></h4><p><strong>为了降低计算次数</strong>，我们可以<strong>利用二维高斯函数的数学特性—— 可分离性</strong></p><p>即<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->二维高斯函数可以表示为两个一维高斯函数的乘积<!--]--></span><!--]--></p><p><strong>从而大幅减少计算量</strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/高斯模糊5.png" loading="lazy"></div><p><strong>Gx 和 Gy 可以分别代表沿x轴和y轴的一维高斯函数</strong></p><p>**我们只需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->让每个像素分别<!--]--></span><!--]--> **</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**Gx 进行水平卷积计算，与Gy进性垂直卷积计算** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->再将最终的计算结果相乘即可得出和之前一样的结果<!--]--></span><!--]--><p>也就是说，我们可以<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用<!--]--></span><!--]-->计算出来的这两个<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->一维高斯滤波核<!--]--></span><!--]-->（高斯核或卷积核或滤波核） <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->和对应的像素点进行卷积计算<!--]--></span><!--]-->，再将两个结果相乘，便可以<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->得到<!--]--></span><!--]-->最终该像素<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯模糊<!--]--></span><!--]-->后的结果</p><p>通过对计算公式的优化，我们将原本需要<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->N * N * W * H<!--]--></span><!--]--> 的计算次数（N为高斯核大小） <strong>优化为了 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->2 * N * W * H<!--]--></span><!--]-->，相当于将时间复杂度从O(n²) 降低到了O(n)</strong></p><h4 id="_8-高斯模糊效果的计算方式优化" tabindex="-1">8. 高斯模糊效果的计算方式优化 <a class="header-anchor" href="#_8-高斯模糊效果的计算方式优化" aria-label="Permalink to &quot;8. 高斯模糊效果的计算方式优化&quot;">​</a></h4><p>我们刚才的知识点中提到，如果<strong>想要图片越模糊</strong>，那么<strong>需要扩大高斯滤波核的大小，越大越模糊</strong> 但是同样通过刚才的基础原理和计算公式优化的讲解大家能够感受到，如果通过扩大高斯滤波核 的大小来达到更模糊的目的，付出的代价就是会更加消耗性能。</p><p>因此在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Shader<!--]--></span><!--]-->中我们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->不会提供控制高斯滤波核大小的参数<!--]--></span><!--]-->，我们的滤波核<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->始终会使用5x5大小的<!--]--></span><!--]-->。</p><p>因此，我们就只能使用其他方式来控制模糊程度了，我们一般会使用以下三种方式：</p><ol><li><p><strong>控制缩放纹理大小</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高斯模糊的目的是让源纹理看起来模糊，那么我们完全可以缩放源纹理 Shader从更小的主纹理中进行采样，尺寸小了，自然计算的也少，也能更模糊<!--]--></span><!--]--></li><li><p><strong>控制模糊代码执行次数</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们可以在OnRenderImage中多次执行Shader代码在模糊的基础上更加模糊， 对源纹理，进行多次迭代模糊处理<!--]--></span><!--]--></li><li><p><strong>控制纹理采样间隔距离</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们在Shader中进行uv采样时，可以自己控制采样像素的间隔位置， 而不是只以一个单位来计算间隔，具体间隔几个单位，我们可以自定义 通过这种方式也能增加模糊程度<!--]--></span><!--]--></li></ol><h4 id="_9-补充-预处理指令-cginclude-endcg" tabindex="-1">9. 补充（预处理指令 CGINCLUDE/ENDCG） <a class="header-anchor" href="#_9-补充-预处理指令-cginclude-endcg" aria-label="Permalink to &quot;9. 补充（预处理指令 CGINCLUDE/ENDCG）&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">CGINCLUDE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">中间包裹CG代码</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它写在SubShader语句块中，Pass外</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>它的作用是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于封装共享代码<!--]--></span><!--]--> 可以在其中定义常量、函数、结构体、宏等等内容 这些封装起来的代码<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->可以在同一个Shader文件中的多个Pass中使用<!--]--></span><!--]--><strong>也可以在其他Shader文件中引用</strong> 使用它可以避免我们重复编写一些相同的代码 从而<strong>提高代码复用性和可维护性</strong></p><h4 id="_10-实现思路" tabindex="-1">10. 实现思路 <a class="header-anchor" href="#_10-实现思路" aria-label="Permalink to &quot;10. 实现思路&quot;">​</a></h4><blockquote><p>实现高斯模糊基础效果的制作思路</p></blockquote><p>在Shader中写两个Pass <strong>一个Pass用来计算 水平方向卷积</strong><strong>一个Pass用来计算 竖直方向卷积</strong> 两个Pass的区别： 顶点着色器中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->计算的uv偏移位置不同，一个水平偏移，一个竖直偏移<!--]--></span><!--]--></p><p>两个Pass的共同点：</p><ol><li>使用的内置文件相同</li><li>使用的属性相同</li><li>片元着色器的计算规则可以相同 我们可以用uv数组存储5个像素的UV坐标偏移 数组中存储的像素UV偏移分别为 index 0 1 2 3 4 x或y偏移 0 1 -1 2 -2 其中 第0个元素 对应的高斯核元素为 0.4026 第1,2个元素 对应的高斯核元素为 0.2442 第3,4个元素 对应的高斯核元素为 0.0545 那么不管竖直还是水平可以统一一套计算规则进行计算</li></ol><blockquote><p>实现 高斯模糊基础屏幕后期处理效果 对应 Shader</p></blockquote><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader,取名为高斯模糊GaussianBlur,删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.声明变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主纹理 _MainTex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.利用补充知识 CGINCLUDE ... ENDCG</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  实现两个Pass共享的代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-1.内置文件引用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-2.属性映射,注意映射纹素，需要用于uv偏移计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-3.结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      顶点和uv数组（用于存储5个像素的uv偏移）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-4.两个顶点着色器函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      一个水平偏移采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      一个竖直偏移采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-5.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      共同的卷积计算方式，对位相乘后相加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.屏幕后处理效果标配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  Cull Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.实现两个Pass</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主要用编译指令指明顶点和片元着色器调用的函数即可</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>实现 高斯模糊基础屏幕后期处理效果 对应 C#</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//补充知识</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//由于我们需要用两个Pass对图像进行处理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//相当于先让捕获的图像进行水平卷积计算得到一个结果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//再用这个结果进行竖直卷积计算得到最终结果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//因此我们需要利用Graphics.Blit进行两次Pass代码的执行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//所以我们需要一个中间纹理缓存区，用于记录中间的处理结果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//我们需要用到</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//RenderTexture.GetTemporary方法</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//它的作用是获取一个临时的RenderTexture对象，我们可以利用它来存储中间结果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//我们使用它传入3个参数的重载</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//RenderTexture.GetTemporary(纹理宽、纹理高、深度缓冲-一般填0即可）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//需要注意的是</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//使用该方法返回的 RenderTexture对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//需要配合使用 RenderTexture.ReleaseTemporary(对象) 方法来释放该对象缓存</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.创建C#脚本，名为高斯模糊GaussianBlur</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.继承屏幕后处理基类PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.重写OnRenderImage函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.在其中利用Graphics.Blit、RenderTexture.GetTemporary、 RenderTexture.ReleaseTemporary</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  函数对纹理进行两次Pass处理</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_11-优化" tabindex="-1">11. 优化 <a class="header-anchor" href="#_11-优化" aria-label="Permalink to &quot;11. 优化&quot;">​</a></h4><blockquote><p>高斯模糊效果的计算方式优化</p></blockquote><p>想要图片变模糊，那么需要扩大高斯滤波核的大小，越大越模糊 如果通过扩大高斯滤波核的大小来达到更模糊的目的，付出的代价就是会更加消耗性能 因此在Shader中我们不会提供控制高斯滤波核大小的参数，我们的滤波核始终会使用5x5大小的 因此，我们就只能使用其他方式来控制模糊程度了，我们一般会使用以下三种方式：</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->控制缩放纹理大小<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->控制模糊代码执行次数<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->控制纹理采样间隔距离<!--]--></span><!--]--></li></ol><h5 id="_11-1-添加控制纹理大小参数" tabindex="-1">11.1 添加控制纹理大小参数 <a class="header-anchor" href="#_11-1-添加控制纹理大小参数" aria-label="Permalink to &quot;11.1 添加控制纹理大小参数&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在高斯模糊效果的C#代码中加入一个控制缩放的参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它主要是用来降低采样质量的，因此取名叫 downSample（降低采样）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如何使用该参数：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在OnRenderImage函数中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们使用RenderT.GetTemporary获取渲染纹理缓存区时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">用源纹理尺寸除以 downSample</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这样在调用Graphics.Blit进行图像复制处理时</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">相当于就将源纹理缩小了，同时在缩小的过程过程中还会用材质球进行效果处理</span></span></code></pre><button class="code-block-unfold-btn"></button></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：<!--]--></span><!--]--><p>在进行复制处理之前，我们可以<strong>设置渲染纹理缓存对象的 缩放过滤模式</strong></p><p><strong>buffer.filterMode = FilterMode.Bilinear;</strong></p><p><strong>FilterMode.Point：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->点过滤。不进行插值。每个像素都直接从最近的纹理像素获取颜色<!--]--></span><!--]--></strong></p><p><strong>FilterMode.Bilinear：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->双线性过滤。它在纹理采样时使用相邻四个纹理像素的加权平均值进行插值，以生成更平滑的图像<!--]--></span><!--]--></strong></p><p><strong>FilterMode.Trilinear：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->三线性过滤。它在双线性过滤的基础上增加了在不同 MIP 贴图级别之间的插值。<!--]--></span><!--]--></strong></p><h5 id="_11-2-添加控制模糊代码执行次数参数" tabindex="-1">11.2 添加控制模糊代码执行次数参数 <a class="header-anchor" href="#_11-2-添加控制模糊代码执行次数参数" aria-label="Permalink to &quot;11.2 添加控制模糊代码执行次数参数&quot;">​</a></h5><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在高斯模糊效果的C#代码中加入一个控制模糊代码执行次数的参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它主要是用来多次执行材质球中的两个Pass，因此取名叫 iteration(迭代)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如何使用该参数：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在OnRenderImage函数中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们使用一个for循环，来对原图像进行多次高斯模糊效果处理</span></span></code></pre><button class="code-block-unfold-btn"></button></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->要保证每次使用完 RenderT.GetTemporary 分配的缓存区<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->都要使用 RenderTexture.ReleaseTemporary 函数将其释放<!--]--></span><!--]--><h5 id="_11-3-添加控制纹理采样间隔距离" tabindex="-1">11.3 添加控制纹理采样间隔距离 <a class="header-anchor" href="#_11-3-添加控制纹理采样间隔距离" aria-label="Permalink to &quot;11.3 添加控制纹理采样间隔距离&quot;">​</a></h5><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在高斯模糊效果的Shader代码中加入一个控制纹理采样间隔距离的属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">它主要是用来控制间隔多少单位偏移uv坐标，因此取名叫 _BlurSpread（模糊半径）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">如何使用该参数：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在顶点着色器进行uv坐标偏移时，乘以该属性，可以通过它控制偏移的多少</span></span></code></pre><button class="code-block-unfold-btn"></button></div><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：<!--]--></span><!--]--><p>理论上来说像素是1个单位1个单位偏移的 _BlurSpread应该为整数变化 但是<strong>为了更精细的控制模糊程度，我们可以让其为小数</strong><strong>小数变化可以更细微的调整模糊程序</strong></p><h4 id="_12-实现代码" tabindex="-1">12. 实现代码 <a class="header-anchor" href="#_12-实现代码" aria-label="Permalink to &quot;12. 实现代码&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson106_GaussianBlur"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BlurSpread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BlurSpread"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //用于包裹共用代码 在之后的多个Pass当中都可以使用的代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        CGINCLUDE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //纹素 x=1/宽  y=1/高</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_TexelSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //纹理偏移间隔单位</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BlurSpread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //5个像素的uv坐标偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            half2 uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //顶点在裁剪空间下坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //片元着色器函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //两个Pass可以使用同一个 我们把里面的逻辑写的通用即可</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fragBlur</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //卷积运算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //卷积核 其中的三个数 因为只有这三个数 没有必要声明为5个单位的卷积核</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> weight[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.4026</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.2442</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.0545</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //先计算当前像素点</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sum</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]).rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> weight[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //去计算左右偏移1个单位的 和 左右偏移两个单位的 对位相乘 累加</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> it</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; it </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; it</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //要和右元素相乘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                sum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv[it</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]).rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> weight[it];</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //和左元素相乘</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                sum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv[it</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]).rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> weight[it];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sum, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ENDCG</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vertBlurHorizontal</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment fragBlur</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //水平方向的 顶点着色器函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vertBlurHorizontal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //5个像素的uv偏移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //去进行5个像素 水平位置的偏移获取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vertBlurVertical</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment fragBlur</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //竖直方向的 顶点着色器函数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vertBlurVertical</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //5个像素的uv偏移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //去进行5个像素 水平位置的偏移获取</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, _MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, _MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, _MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, _MainTex_TexelSize.x</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_BlurSpread;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson106_GaussianBlur</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> downSample</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> iterations</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> blurSpread</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.6f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnRenderImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> destination</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //base.OnRenderImage(source, destination);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rtW</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> source.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> downSample;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rtH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> source.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> downSample;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //准备一个缓存区</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> RenderTexture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">GetTemporary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rtW, rtH, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //采用双线性过滤模式来缩放 可以让缩放效果更平滑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            buffer.filterMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> FilterMode.Bilinear;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //直接缩放写入到缓存纹理中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source, buffer);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //在使用材质球之前设置 模糊半径属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //material.SetFloat("_BlurSpread", blurSpread);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //多次去执行 高斯模糊逻辑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> iterations; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果想要模糊半径影响模糊想过更强烈 更平滑</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //一般可以在我们的迭代中进行设置 相当于每次迭代处理高斯模糊时 都在增加我们的间隔距离</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_BlurSpread"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> blurSpread);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //又声明一个新的缓冲区</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> buffer1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> RenderTexture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">GetTemporary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rtW, rtH, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //因为我们需要用两个Pass 处理图像两次</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //进行第一次 水平卷积计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(buffer, buffer1, material, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//Color1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这时 关键内容都在buffer1中 buffer没用了 释放掉</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                RenderTexture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ReleaseTemporary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(buffer);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> buffer1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                buffer1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> RenderTexture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">GetTemporary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rtW, rtH, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //进行第二次 垂直卷积计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(buffer, buffer1, material, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//在Color1的基础上乘上Color2 得到最终的高斯模糊计算结果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                                                                //释放缓存区</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                RenderTexture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ReleaseTemporary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(buffer);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //buffer和buffer1指向的都是这一次高斯模糊处理的结果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> buffer1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //在for循环中得到最终的模糊结果 然后写入到目标纹理中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(buffer, destination);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //释放掉缓存区</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            RenderTexture.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ReleaseTemporary</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(buffer);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source, destination);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七、bloom效果" tabindex="-1">七、Bloom效果 <a class="header-anchor" href="#七、bloom效果" aria-label="Permalink to &quot;七、Bloom效果&quot;">​</a></h3><h4 id="_1-基本原理-1" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-1" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><blockquote><p>是什么</p></blockquote><p>Bloom效果（中文也可以叫做高光溢出效果），是一种</p><p>使<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->画面中亮度较高的区域产生一种光晕或发光效果<!--]--></span><!--]-->的图像处理技术</p><p><strong>Bloom效果</strong>的主要目的是<strong>模拟现实世界中强光源在相机镜头或人眼中造成的散射和反射现象</strong></p><p>使得画面中较亮的区域“扩散”到周围的区域，造成一种朦胧的效果</p><blockquote><p>基本原理</p></blockquote><p>三步骤概括Unity Shader中实现Bloom效果的基本原理：</p><ol><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->提取<!--]--></span><!--]-->：提取原图像中的亮度区域存储到一张新纹理中</strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->模糊<!--]--></span><!--]-->：将提取出来的纹理进行模糊处理（一般采用高斯模糊）</strong></li><li><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->合成<!--]--></span><!--]-->：将模糊处理后的亮度纹理和源纹理进行颜色叠加</strong></li></ol><blockquote><p>多个Pass的运用</p></blockquote><p>处理高斯模糊效果时，我们使用了2个Pass，分别用来计算水平卷积核竖直卷积</p><p><strong>而我们在处理Bloom效果时将使用4个Pass，他们分别是：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于 提取亮度区域 存储到新纹理中的1 个Pass<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于 模糊处理提取出来的纹理 的高斯模糊的2 个Pass（可以复用高斯模糊Shader中写好的Pass）<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于 与原图像进行合成 的1 个Pass<!--]--></span><!--]--></li></ol><blockquote><p>如何提取</p></blockquote><p>我们需要在Shader中声明一个<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->亮度阈值变量<!--]--></span><!--]-->，亮度低于该值的区域不会被提取</p><p>主要用于“<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->提取<!--]--></span><!--]--> ”Pass的片元着色器函数当中，</p><p>用当前像素的灰度<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->值L = 0.2125&nbsp;* R + 0.7154&nbsp;* G + 0.0721*B<!--]--></span><!--]--> 与 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->亮度阈值变量<!--]--></span><!--]--> 进行计算</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->灰度值– 亮度阈值变量<!--]--></span><!--]-->：是为了仅保留超过阈值的部分，可以提取出图像中亮度较高的地方。<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Clamp函数<!--]--></span><!--]-->：如果结果小于0则为0，大于1则为1。得到的val表示像素的亮度贡献<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->颜色*亮度贡献<!--]--></span><!--]-->：基于亮度阈值调节颜色的亮度，若val为0则为黑色，越接近1越接近原始颜色<p>这样做的目的是保留高亮区域的颜色信息，同时衰减低亮区域的颜色。</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/Bloom.png" loading="lazy"></div><blockquote><p>如何模糊</p></blockquote><p>由于我们目前已经在高斯模糊的课程中写好了两个用于进行水平和竖直卷积运算的Pass</p><p>因此我们可以使用以前学习SubShader语句时学习的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->UsePass<!--]--></span><!--]-->指令</p><p>只需要在之前的<strong>高斯模糊Shader中为两个Pass取名，然后<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在Bloom的Shader中复用<!--]--></span><!--]-->即可</strong></p><p>复用了两个Pass后，我们只需要在Bloom效果对应的C#代码中对“<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->提取<!--]--></span><!--]--> ”出来的纹理 进行高斯模糊Pass的调用即可（逻辑和高斯模糊一致）</p><p>接着，我们需要在Bloom效果的Shader中声明一个<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->纹理属性 _Bloom<!--]--></span><!--]--></p><p>用于存储模糊处理完毕后的纹理</p><p><strong>在C#代码中完成高斯模糊处理后，只需要将缓存区内容，写入材质球中的纹理属性即可</strong></p><p><strong>完成这一步后，在Shader中就能够得到<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->模糊处理后的亮度纹理信息<!--]--></span><!--]-->了</strong></p><p><strong>我们便可以进行第三步“<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->合成<!--]--></span><!--]-->”</strong></p><blockquote><p>如何合成</p></blockquote><p>我们只需要用</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主纹理_MainTex<!--]--></span><!--]--> （其中使用的纹理是屏幕原图像）和<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->纹理属性_Bloom<!--]--></span><!--]--> （其中使用的纹理是模糊处理后的亮度纹理信息）<p>进行颜色叠加即可，我们对两张纹理进行采样，将获取到的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->颜色信息<!--]--></span><!--]-->进行<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->加法<!--]--></span><!--]-->运算</p><p>因为颜色相加带来的效果就是增加亮度，使得原本高亮的部分变得更加显眼</p><p>从而达到Bloom效果（高光溢出效果）</p><hr><h3 id="八、运动模糊" tabindex="-1">八、运动模糊 <a class="header-anchor" href="#八、运动模糊" aria-label="Permalink to &quot;八、运动模糊&quot;">​</a></h3><h4 id="_1-是什么" tabindex="-1">1. 是什么 <a class="header-anchor" href="#_1-是什么" aria-label="Permalink to &quot;1. 是什么&quot;">​</a></h4><p>运动模糊效果，是一种</p><p>用于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->模拟真实世界中快速移动物体产生的模糊现象<!--]--></span><!--]-->的图像处理技术</p><p>**当一个物体以较高速度移动时，由于人眼或摄像机的曝光时间过长，该物体会在图像中留下模糊 的运动轨迹。**这种效果游戏、动画、电影中被广泛应用，以增加视觉真实性和动感。</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/运动模糊.png" loading="lazy"></div><h4 id="_2-基本原理-1" tabindex="-1">2. 基本原理 <a class="header-anchor" href="#_2-基本原理-1" aria-label="Permalink to &quot;2. 基本原理&quot;">​</a></h4><p>想要在屏幕后期处理中实现运动模糊，一般有两种常用方式：</p><ol><li><p><strong>累积缓存：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->物体快速移动时存储多帧图像信息，取它们之间的加权平均值作为最后的运动模糊图像<!--]--></span><!--]--></strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->优点：质量高、效果好；<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->缺点：计算量大，存储开销大<!--]--></span><!--]--></li><li><p><strong>速度缓存：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->物体快速移动时存储多帧运动速度信息，利用速度来决定模糊的方向和大小<!--]--></span><!--]--></strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->优点：性能较累积缓存好；<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->缺点：效果较差，可能产生重影和伪影<!--]--></span><!--]--></li></ol><h4 id="_3-累积缓存实现运动模糊" tabindex="-1">3.累积缓存实现运动模糊 <a class="header-anchor" href="#_3-累积缓存实现运动模糊" aria-label="Permalink to &quot;3.累积缓存实现运动模糊&quot;">​</a></h4><p><strong>不需要像累积缓存中那样存储多张场景信息</strong>，但是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->需要保存之前的渲染结果，不断把当前的渲 染图像叠加到之前的渲染图像中，从而产生一种运动轨迹的视觉效果。<!--]--></span><!--]-->相当于是基于累积缓存的优化， 性能会更好，但是模糊效果可能略有欠缺，但是效果也是可以接受的。</p><h5 id="_3-1-基本原理" tabindex="-1">3.1 基本原理 <a class="header-anchor" href="#_3-1-基本原理" aria-label="Permalink to &quot;3.1 基本原理&quot;">​</a></h5><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用一个RenderTexture记录上一次渲染的信息，然后每一次用新的屏幕图像信息和上一次的图像信息进 行混合渲染，从而产生模糊效果（相当于用一张图保留了之前n次的叠加渲染结果）<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/屏幕后期/运动模糊2.png" loading="lazy"></div><p><strong>在使用Graphics.Blit(源纹理，目标纹理，材质)方法时</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果目标纹理中包含内容，会直接认为目标纹理中的颜色为颜色缓冲区中的颜色<!--]--></span><!--]--><p>因此我们完全可以利用该方法，配合Shader代码将两张图片信息进行混合处理，从而实现运动模糊效果。 它的主要混合思路是：</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->RGB通道由两张图片根据模糊程度决定最终效果<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->A通道根据当前屏幕图像决定<!--]--></span><!--]--></li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用一个模糊程度变量来控制运动模糊程度，值越大模糊程度越强；<!--]--></span><!--]--><p><strong>越小模糊程度越弱 利用两个Pass进行混合处理的方式：</strong></p><p>*<em>第一个Pass：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->让当前屏幕图像 和上一次的屏幕图像 进行指定RGB通道的颜色混合<!--]--></span><!--]--><em>目的是利用模糊程度参数控制两张图片的混合效果，值越大上一次屏幕内容保留的越多</em></em></p><p><strong>第二个Pass：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用第一个Pass处理后得到的颜色在和源纹理进行A通道的颜色混合<!--]--></span><!--]--> 目的是保留源纹理透明度信息</strong></p><blockquote><p>混合方式如何设置：</p></blockquote><p><strong>第一个Pass：</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Blend SrcAlpha OneMinusSrcAlpha<!--]--></span><!--]-->（(源颜色 * SrcAlpha) + (目标颜色 * (1 - SrcAlpha))）</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->ColorMask RGB <!--]--></span><!--]-->（只改变颜色缓冲区中的RGB通道）</strong></p><p><strong>第二个Pass：</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Blend One Zero<!--]--></span><!--]-->（最终颜色 = (源颜色 * 1) + (目标颜色 * 0)）</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->ColorMask A<!--]--></span><!--]-->（只改变颜色缓冲区中的A通道）</strong></p><h4 id="_4-实现" tabindex="-1">4. 实现 <a class="header-anchor" href="#_4-实现" aria-label="Permalink to &quot;4. 实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader 名为运动模糊(MotionBlur) 删除其中无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.属性声明</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主纹理 _MainTex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  模糊程度 _BlurAmount</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.共享CG代码 CGINCLUDE...ENDCG</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  内置文件UnityCG.cginc引用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  结构体（顶点和UV)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  顶点着色器（裁剪空间转换 uv坐标赋值）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.屏幕后处理效果标配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  Cull Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.第一个Pass（用于混合RGB通道）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  混合因子 和 颜色蒙版设置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      Blend SrcAlpha OneMinusSrcAlpha（(源颜色 * SrcAlpha) + (目标颜色 * (1 - SrcAlpha))）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      ColorMask RGB （只改变颜色缓冲区中的RGB通道）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      对主纹理采样后利用模糊程度作为A通道与颜色缓冲区颜色进行混合</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.第二个Pass（用户混合A通道）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  混合因子 和 颜色蒙版设置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      Blend One Zero（最终颜色 = (源颜色 * 1) + (目标颜色 * 0)）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      ColorMask A（只改变颜色缓冲区中的A通道）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      对主纹理采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//7.FallBack Off</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson109_MotionBlur</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.9f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> blurAmount</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //堆积纹理 用于存储之前渲染的结果的 渲染纹理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> accumulationTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnRenderImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> destination</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //初始化堆积纹理 如果为空 或者 屏幕宽高变化了 都需要重新初始化</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( accumulationTex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> ||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                accumulationTex.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> source.width </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                accumulationTex.height </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> source.height)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                DestroyImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(accumulationTex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //初始化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                accumulationTex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> RenderTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source.width, source.height, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                accumulationTex.hideFlags </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> HideFlags.HideAndDontSave;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //保证第一次 累积纹理中也是有内容 因为之后 它的颜色 会作为颜色缓冲区中的颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source, accumulationTex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //1 - 模糊程度的目的 是因为 希望大到的效果是 模糊程度值越大 越模糊</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //因为Shader中的混合因子的计算方式决定的 因此 我们需要1 - 它</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_BlurAmount"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> blurAmount);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //利用我们的材质 进行混合处理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //第二个参数 有内容时  它会作为颜色缓冲区的颜色来进行处理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //没有直接写入目标中的目的 也是可以通过accumulationTex记录当前渲染结果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //那么在下一次时 它就相当于是上一次的结果了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source, accumulationTex, material);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(accumulationTex, destination);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source, destination);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    /// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    /// 如果脚本失活 那么把累积纹理删除掉</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    /// &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">summary</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnDisable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        DestroyImmediate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(accumulationTex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson109_MotionBlur"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //模糊程度变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BlurAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BlurAmount"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        CGINCLUDE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BlurAmount;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ENDCG</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //屏幕后处理效果标配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //第一个Pass 用于混合RGB通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //（(源颜色 * _BlurAmount) + (目标颜色 * (1 - _BlurAmount))）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //（只改变颜色缓冲区中的RGB通道）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ColorMask RGB</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment fragRGB</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fragRGB</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv).rgb, _BlurAmount);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //（最终颜色 = (源颜色 * 1) + (目标颜色 * 0)）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend One Zero</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //（只改变颜色缓冲区中的A通道）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ColorMask A</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment fragA</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fragA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="深度和法线纹理" tabindex="-1">深度和法线纹理 <a class="header-anchor" href="#深度和法线纹理" aria-label="Permalink to &quot;深度和法线纹理&quot;">​</a></h2><h3 id="一、作用和使用" tabindex="-1">一、作用和使用 <a class="header-anchor" href="#一、作用和使用" aria-label="Permalink to &quot;一、作用和使用&quot;">​</a></h3><h4 id="_1-深度和法线纹理分别指什么" tabindex="-1">1. 深度和法线纹理分别指什么 <a class="header-anchor" href="#_1-深度和法线纹理分别指什么" aria-label="Permalink to &quot;1. 深度和法线纹理分别指什么&quot;">​</a></h4><p>确切的说</p><p>应该指的是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->屏幕空间的深度纹理和法线纹理<!--]--></span><!--]--></p><p><strong>屏幕空间深度纹理： <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于存储屏幕图像中每个像素深度信息的纹理<!--]--></span><!--]--></strong></p><p><strong>屏幕空间法线纹理： <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于存储屏幕图像中每个像素法线信息的纹理<!--]--></span><!--]--></strong></p><h4 id="_2-深度和法线纹理的作用" tabindex="-1">2. 深度和法线纹理的作用 <a class="header-anchor" href="#_2-深度和法线纹理的作用" aria-label="Permalink to &quot;2. 深度和法线纹理的作用&quot;">​</a></h4><p><strong>深度纹理作用：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->可以利用其中存储的每个像素的深度信息<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->制作出边缘检测、运动模糊、景深、环境遮挡等等效果<!--]--></span><!--]--><p><strong>法线纹理作用：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->可以利用其中存储的每个像素的法线信息<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**制作出屏幕空间环境遮挡(SSAO)、基于屏幕空间的反射(SSR)、基于法线的边缘检测等等效果** <!--]--></span><!--]--><p><strong>它们的主要作用：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**就是来实现各种视觉效果的，这些效果会利用它们存储的深度和法线信息来增强真实感和细节** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->效果都是算出来的，有了更多的数据，就能进行更多不同的计算，就能出更好更多的效果<!--]--></span><!--]--><h4 id="_3-深度和法线纹理的使用" tabindex="-1">3. 深度和法线纹理的使用 <a class="header-anchor" href="#_3-深度和法线纹理的使用" aria-label="Permalink to &quot;3. 深度和法线纹理的使用&quot;">​</a></h4><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->让Unity知道我们需要使用深度和法线纹理<!--]--></span><!--]--><p>**深度纹理：**DepthTextureMode = DepthTextureMode.Depth;</p><p>**深度纹理+法线纹理（一张纹理）：**DepthTextureMode = DepthTextureMode.DepthNormals;</p><p>**深度纹理和深度纹理+法线纹理（俩张纹理）**DepthTextureMode = DepthTextureMode.Depth|DepthTextureMode.DepthNormals;</p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在Shader当中直接声明对应变量<!--]--></span><!--]--><p><strong>深度纹理：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->sampler2D _CameraDepthTexture;<!--]--></span><!--]--><p><strong>深度+法线纹理：</strong></p><p><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->sampler2D _CameraDepthNormalsTexture;<!--]--></span><!--]-->（一般RG通道存储法线，BA通道存深度）</strong></p><p><strong>之后直接在Shader中使用这两个变量便可以获取到相关信息</strong></p></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/法线和深度纹理/法线和深度.png" loading="lazy"></div><h3 id="二、背后的原理" tabindex="-1">二、背后的原理 <a class="header-anchor" href="#二、背后的原理" aria-label="Permalink to &quot;二、背后的原理&quot;">​</a></h3><h4 id="_1-深度和法线纹理存储的是什么信息" tabindex="-1">1. 深度和法线纹理存储的是什么信息 <a class="header-anchor" href="#_1-深度和法线纹理存储的是什么信息" aria-label="Permalink to &quot;1. 深度和法线纹理存储的是什么信息&quot;">​</a></h4><blockquote><p>Unity中的深度纹理中存储的信息</p></blockquote><p>也就是Shader中使用_CameraDepthTexture 或 _CameraDepthNormalsTexture 采样的信息</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->是进行裁剪空间变换后的z 分量再转换到0~1之后的结果<!--]--></span><!--]--><p>因为齐次裁剪空间坐标范围为-1 ~ 1，而纹理中存储的信息范围是0 ~ 1</p><p>因此Unity会将其利用以下公式进行转换</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->深度纹理值 = 0.5*z + 0.5<!--]--></span><!--]--><p><strong>也就是说我们通过深度纹理直接采样得到的深度纹理值是</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->是进行裁剪空间变换后的z 分量再转换到0~1之后的结果<!--]--></span><!--]--><blockquote><p>Unity中的法线纹理中存储的信息</p></blockquote><p>也就是Shader中使用_CameraDepthNormalsTexture采样得到的float4中的部分信息</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它是观察空间下的法线再转换到0~1之后的结果<!--]--></span><!--]--><p>因为观察空间下的单位向量的分量取值范围是-1~1，而纹理中存储的信息范围是0 ~ 1</p><p>因此Unity会将其利用以下公式进行转换</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->法线纹理值=（观察空间下法线 + 1）* 0.5<!--]--></span><!--]--><p><strong>也就是说我们通过法线纹理直接采样得到的法线纹理值是</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->是观察空间下的法线再转换到0~1之后的结果<!--]--></span><!--]--><h4 id="_2-unity是如何得到深度和法线纹理的" tabindex="-1">2. Unity是如何得到深度和法线纹理的 <a class="header-anchor" href="#_2-unity是如何得到深度和法线纹理的" aria-label="Permalink to &quot;2. Unity是如何得到深度和法线纹理的&quot;">​</a></h4><p>深度和法线纹理的获取：</p><p>Unity中深度和法线纹理一般通过两种途径获取</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->从G-buffer几何缓冲区中获取<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->由一个专门的Pass渲染而来<!--]--></span><!--]--></li></ol><p>具体Unity是通过哪种方式获取，取决于使用的渲染路径和设备的硬件限制。</p><p>当<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->使用延迟渲染路径<!--]--></span><!--]-->时，深度和法线纹理可以直接访问到，因为延迟渲染路径会把信息存储到</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->G-buffer几何缓冲区<!--]--></span><!--]-->中（深度和法线等信息都存储在其中）。<p>而<strong>当无法直接获取</strong>到深度和法线纹理时（比如硬件不支持延迟渲染路径或使用的是前向渲染路 径时），</p><p>Unity<strong>会通过一个单独的Pass来进行渲染</strong>，获取深度和法线信息。</p><p>需要注意的是，当使用单独的Pass渲染获得深度和法线纹理时，两者是有区别的</p><p>对于<strong>深度纹理</strong>来说：</p><p>Unity内部会使用<strong>着色器替换技术</strong>选择<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染类型<!--]--></span><!--]-->RenderType =“Opaque”(不透明物体)** 然后判断它们的**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->渲染队列<!--]--></span><!--]-->Queue是否小于等于2500（Background-1000、Geometry-2000、AlphaTest-2450） 如果<strong>满足这个条件</strong>，就会<strong>使用物体投射阴影时的Pass<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->（LightMode 为ShadowCaster 的Pass）<!--]--></span><!--]--> <strong>来得到深度纹理</strong>，</strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果没有这个Pass，那么该物体不会出现在深度纹理中<!--]--></span><!--]-->！</p><p>因此这里的<strong>重点</strong>是：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果我们希望物体能够正确的出现在深度纹理中<!--]--></span><!--]--><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->必须在 Shader中正确的设置RenderType标签<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->必须有投射阴影用的 Pass（LightMode为ShadowCaster的Pass）<!--]--></span><!--]--></li></ol><p>对于<strong>法线纹理</strong>来说：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Unity底层会使用一个单独的Pass把整个场景再次渲染一次<!--]--></span><!--]-->，从而得到深度和法线信息<p>这里为什么是深度和法线信息呢，因为当需要得到法线纹理时，Unity中是和深度一起获取的 上节课的使用知识点中有讲解（ _CameraDepthNormalsTexture ）</p><p>这个Pass包含在Unity内置的Shader中，我们可以在官方下载源文件解压后进行查看</p><p>总体而言，在获取深度和法线纹理时</p><p>Unity内部帮助我们做了很多事情，我们不需要操心太多</p><p>我们只需要按照上节课的规则就能够获取到对应的信息了</p><p>需要注意的就是，在获取深度纹理时，一定要注意</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->必须在 Shader中正确的设置RenderType标签<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->必须有投射阴影用的 Pass（LightMode为ShadowCaster的Pass）<!--]--></span><!--]--></li></ol><h4 id="_3-深度和法线纹理使用时调用的函数原理" tabindex="-1">3. 深度和法线纹理使用时调用的函数原理 <a class="header-anchor" href="#_3-深度和法线纹理使用时调用的函数原理" aria-label="Permalink to &quot;3. 深度和法线纹理使用时调用的函数原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->SAMPLE_DEPTH_TEXTURE 宏：<!--]--></span><!--]--><p>它是用于从深度纹理中进行采样的宏，相比直接用tex2D进行采样，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它在内部会帮助我们适配各 种不同的平台<!--]--></span><!--]-->，因为不同平台对深度纹理的采样规则会有所不同，因此我们使用它。</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它采样得到的深度值是裁剪空间下的z分量转换到0~1之间的结果<!--]--></span><!--]--><p>通过SAMPLE_DEPTH_TEXTURE得到的深度值是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->非线性<!--]--></span><!--]-->的</p><p><strong>所谓的非线性值的是指在透视摄像机的裁剪空间中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--> 深度值分部不均匀<!--]--></span><!--]--></strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->当深度值接近裁剪面近时，深度值变化迅速，精度高<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->当深度值接远裁剪面近时，深度值变化缓慢，精度低<!--]--></span><!--]--><p>更直观的解释：一个相机在观察一个3D场景时，近处的物体移动一点，视觉上变化很大，所以需 要更高的精度来记录这种变化。而远处的物体移动同样的距离，视觉上的变化很小，因此可以使 用较低的精度来记录</p><p>因此为了让我们在Shader中利用深度值进行的计算更加准确，我们需要获得线性的深度值</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只需要把裁剪空间下的深度值转换到观察空间下，便可以得到线性的深度值<!--]--></span><!--]--><p>Unity Shader中提供了内置函数</p><p><strong>LinearEyeDepth 和 Linear01Depth 都可以得到<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->观察空间下的线性深度值<!--]--></span><!--]--></strong></p><p><strong>LinearEyeDepth：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->得到的是像素到摄像机的实际距离<!--]--></span><!--]--></strong></p><p><strong>Linear01Depth：<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->得到的是实际距离被压缩到0~1之间的值<!--]--></span><!--]--></strong></p><p><strong>DecodeDepthNormal函数</strong>内部其实<strong>也是执行的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->DecodeFloatRG<!--]--></span><!--]-->和<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->DecodeViewNormalStereo<!--]--></span><!--]-->函数</strong></p><p>它的作用就是得到<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->观察空间下<!--]--></span><!--]-->的对应像素的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->法线和线性深度值(0~1)<!--]--></span><!--]--></p><p>你可以一次性的获得两个信息，也可以选择分别调用<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->DecodeFloatRG<!--]--></span><!--]-->和<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->DecodeViewNormalStereo<!--]--></span><!--]--></p><p>单独获取深度和法线信息</p><p><strong>函数中具体做的事情，就是利用法线的xy算出z，得到最终的法线信息；</strong></p><p><strong>将裁剪空间下的非线性深度值 转换为观察空间下线性的范围为0~1的深度值</strong></p><p>通过对这些宏和函数的介绍，大家只要记住，<strong>直接采样出来的深度和法线信息是不会直接使用的</strong></p><p>我们需要将他们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通过内置函数进行转换<!--]--></span><!--]--></p><p><strong>得到最终我们会使用的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->观察空间下的深度和法线信息<!--]--></span><!--]--></strong></p><hr><h3 id="三、-如何查看深度纹理信息" tabindex="-1">三、 如何查看深度纹理信息 <a class="header-anchor" href="#三、-如何查看深度纹理信息" aria-label="Permalink to &quot;三、 如何查看深度纹理信息&quot;">​</a></h3><p>我们可以在屏幕后期处理中用我们学习过的获取深度信息的知识点 将深度值作为颜色的RGB值显示在屏幕上 感受深度纹理中存储的内容 <strong>理论上来说，如果深度值使用0~1范围的线性值</strong><strong>越接近<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->近裁剪<!--]--></span><!--]-->面越靠近黑色</strong><strong>越接近<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->远裁剪<!--]--></span><!--]-->面越靠近白色</strong></p><blockquote><p>实现</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//1.新建Shader，删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//2.声明变量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//  在Shader中通过声明_CameraDepthTexture获取深度纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//3.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//  只需要修改传入结构体类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//4.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//  使用深度纹理采样宏 得到的结果是非线性的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//  float depth = SAMPLE_DEPTH_TEXTURE(_CameraDepthTexture, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//  将非线性的深度值 转换到观察空间下 并将像素点到摄像机的距离转换到[0,1]区间内 （线性深度值）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//  float linearDepth = Linear01Depth(depth);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//  将深度值作为返回颜色的RGB值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">//5.Fallback Off</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson110_DepthTexture"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //按规则命名的 深度纹理变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _CameraDepthTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //非线性的 裁剪空间下的深度值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SAMPLE_DEPTH_TEXTURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthTexture, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到一个线性的 0~1 区间的深度值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> linearDepth = Linear01Depth(depth);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把深度值作为RGB颜色输入 越接近摄像 就呈现出黑色 越远离摄像机 就呈现出白色 中间就是灰色 具体就会呈现出深浅灰</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(linearDepth,linearDepth,linearDepth,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson110_DepthTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Start is called before the first frame update</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //可以在Shader中得到对应的深度纹理信息了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Camera.main.depthTextureMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> DepthTextureMode.Depth;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="四、如何查看法线纹理信息" tabindex="-1">四、如何查看法线纹理信息 <a class="header-anchor" href="#四、如何查看法线纹理信息" aria-label="Permalink to &quot;四、如何查看法线纹理信息&quot;">​</a></h3><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader，删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.声明变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  在Shader中通过声明_CameraDepthNormalsTexture获取深度+法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  只需要修改传入结构体类型</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  对深度+法线纹理进行采样（其中xy是法线信息，zw是深度信息）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  float4 depthNormal = tex2D(_CameraDepthNormalsTexture, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  UnityCG.cginc 内置文件中的方法 用于得到深度值(0~1)和法线信息(观察空间下)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  相当于一次性处理深度和法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  用于存储深度值的变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  float depth;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  用于存储法线的变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  float3 normals;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  DecodeDepthNormal(depthNormal, depth, normals);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  单独得到深度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      depth = DecodeFloatRG(depthNormal.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  单独得到法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      normals = DecodeViewNormalStereo(depthNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.Fallback Off</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson111_DepthNormalTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Start is called before the first frame update</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Camera.main.depthTextureMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> DepthTextureMode.DepthNormals;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson111_DepthNormalTexture"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //深度+法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _CameraDepthNormalsTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //直接采样 获取到的是裁剪空间下的法线和深度信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depthNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthNormalsTexture, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> depth;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                DecodeDepthNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(depthNormal, depth, normals);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //法线的-1到1之间的区间 变换到 0~1之间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(normals</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="五、-深度纹理实现运动模糊" tabindex="-1">五、 深度纹理实现运动模糊 <a class="header-anchor" href="#五、-深度纹理实现运动模糊" aria-label="Permalink to &quot;五、 深度纹理实现运动模糊&quot;">​</a></h3><h4 id="_1-关键注意点说明" tabindex="-1">1.关键注意点说明 <a class="header-anchor" href="#_1-关键注意点说明" aria-label="Permalink to &quot;1.关键注意点说明&quot;">​</a></h4><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->这种实现方式只适合场景静止，即摄像机快速移动的情况， 它不太适用于物体快速移动产生的运动模糊效果，只有摄像机移动时才能看到运动模糊效果<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->这种实现方式并不是基于真实的物理运动规律来计算的，只是一种近似计算！ 它符合图形学基本规则：看起来对那么就是对的<!--]--></span><!--]--></li></ol><p>但是由于它实现出来的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->效果和性能消耗都还不错<!--]--></span><!--]-->，因此它也是一种<strong>常用的运动模糊处理方案</strong>。</p><h4 id="_2-利用深度纹理实现运动模糊基本原理" tabindex="-1">2. 利用深度纹理实现运动模糊基本原理 <a class="header-anchor" href="#_2-利用深度纹理实现运动模糊基本原理" aria-label="Permalink to &quot;2. 利用深度纹理实现运动模糊基本原理&quot;">​</a></h4><blockquote><p>基本原理</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->得到像素当前帧和上一帧中在裁剪空间下的位置，<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用两个位置计算出物体的运动方向，从而模拟出运动模糊的效果。<!--]--></span><!--]--><p>其中的关键点：</p><ol><li><strong>如何得到像素当前帧和上一帧在裁剪空间下的位置</strong></li><li><strong>如何得到运动方向</strong></li><li><strong>如何模拟运动模糊效果</strong></li></ol><h4 id="_3-如何得到像素当前帧和上一帧在裁剪空间下的位置" tabindex="-1">3. 如何得到像素当前帧和上一帧在裁剪空间下的位置 <a class="header-anchor" href="#_3-如何得到像素当前帧和上一帧在裁剪空间下的位置" aria-label="Permalink to &quot;3. 如何得到像素当前帧和上一帧在裁剪空间下的位置&quot;">​</a></h4><p>关键步骤一：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用UV坐标和深度值组合成一个裁剪空间下的组合坐标nowClipPos<!--]--></span><!--]--><p><strong>float4 clipPos = float4(uv.x, uv.y, depth, 1);</strong></p><p>我们知道uv坐标空间下的值是0~1，通过宏取出来的深度值也是0~1，而裁剪空间下的坐标范围是-1~1</p><p>因此，我们需要将它利用简单的公式转换到裁剪空间坐标系下</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->float4 clipPos = float4(uv.x * 2 - 1, uv.y * 2 - 1, depth * 2 - 1, 1);<!--]--></span><!--]--><p><strong>你可以认为这一步是把</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->带有深度值的uv坐标转换到了裁剪空间下 之所以加入深度值是为了让之后的裁剪空间转到世界空间或其他坐标空间更合理 相当于是把UV的2D坐标系转换到了3D坐标系中<!--]--></span><!--]--><p>关键步骤二：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用世界空间—&gt;裁剪空间的变换矩阵的逆矩阵，将刚才裁剪空间下的nowClipPos转换到世界坐标中<!--]--></span><!--]--><p>我们只需要利用上面的这个裁剪空间到世界空间的变换矩阵，就可以将刚才得到的裁剪空间下的组合坐标 变换到世界空间下了。</p><p>关键步骤三：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用上一帧的世界坐标—&gt;裁剪空间的变换矩阵得到上一帧该世界空间下的组合坐标在裁剪空间下位置<!--]--></span><!--]--><h4 id="_4-如何得到运动方向" tabindex="-1">4. 如何得到运动方向 <a class="header-anchor" href="#_4-如何得到运动方向" aria-label="Permalink to &quot;4. 如何得到运动方向&quot;">​</a></h4><p>我们已经知道如何得到像素当前帧和上一帧在裁剪空间下的位置</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->直接用当前位置`.xy`– 上一帧位置`.xy` 便可以得到移动方向<!--]--></span><!--]--><h4 id="_5-如何模拟运动模糊效果" tabindex="-1">5. 如何模拟运动模糊效果 <a class="header-anchor" href="#_5-如何模拟运动模糊效果" aria-label="Permalink to &quot;5. 如何模拟运动模糊效果&quot;">​</a></h4><p>有了像素在裁剪空间的移动方向，相当于知道了像素在<code>“uv纹理空间的移动方向”</code></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->那么我们只需要利用这个方向在纹理中进行多次uv坐标偏移采样后，将得到的颜色累加起来， 最后进行算数平均值计算即可<!--]--></span><!--]--><p><strong>我们会加入一个<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->模糊偏移量<!--]--></span><!--]-->来控制模糊程度</strong></p><p><strong>只需要在每次采样时进行<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->方向<code>*</code> 模糊偏移量<!--]--></span><!--]-->的偏移采样即可</strong></p><h4 id="_6-补充知识" tabindex="-1">6. 补充知识 <a class="header-anchor" href="#_6-补充知识" aria-label="Permalink to &quot;6. 补充知识&quot;">​</a></h4><p>我们需要通过<code>C#</code>代码为Shader设置矩阵变量 但是ShaderLab语法中的属性中并没有矩阵类型的变量 因此我们只需要在CG语句中声明矩阵属性即可 这样C#中通过矩阵的属性名同样可以进行设置 举例：</p><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//CG代码中声明4x4矩阵 ——</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _ClipToWorldMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//C#代码中声明4x4矩阵 ——</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Matrix4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frontClipToWorldMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//通过材质球指明变量进行设置即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_ClipToWorldMatrix"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, frontClipToWorldMatrix);</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_6-运动模糊效果-具体实现" tabindex="-1">6. 运动模糊效果 具体实现 <a class="header-anchor" href="#_6-运动模糊效果-具体实现" aria-label="Permalink to &quot;6. 运动模糊效果 具体实现&quot;">​</a></h4><blockquote><p>步骤</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.声明属性，进行属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主纹理 _MainTex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  模糊偏移量 _BlurSize</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  深度纹理 _CameraDepthTexture</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  当前帧裁剪到世界空间变换矩阵 float4x4 _ClipToWorldMatrix</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  上一帧世界到裁剪空间变换矩阵 float4x4 _FrontWorldToClipMatrix</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.屏幕后处理标配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  Cull Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  顶点和uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  坐标转换 uv坐标赋值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  6-1:得到裁剪空间下的两个点</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      得到点一</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      深度值获取</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      构建裁剪空间下组合坐标 uv 和 深度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      得到点二</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      裁剪空间坐标转世界空间(注意进行齐次除法）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      利用上一帧变换矩阵将世界空间坐标转裁剪空间（注意进行齐次除法）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  6-2:得到运动方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      用当前帧点-上一帧点 得到运动方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  6-3:进行模糊处理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      利用模糊偏移量变量进行3次偏移采样颜色后进行平均值计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//7.FallBack Off</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.继承屏幕后处理基类PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.声明模糊偏移量变量和用于记录上一次变换矩阵的变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.重写OnRenderImage函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  在其中进行属性设置，变换矩阵计算，屏幕后处理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.在生命周期函数中启用深度纹理，初始化上一帧变换矩阵</span></span></code></pre><button class="code-block-unfold-btn"></button></div><p>注意：</p><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.考虑不同平台可能存在的垂直翻转问题、</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UNITY_UV_STARTS_AT_TOP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (_MainTex_TexelSize.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    o.uv_depth.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.uv_depth.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.让移动方向向量除以2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  从而降低运动模糊效果的强度，不要过于强烈</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>实现</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson112_MotionBlurWithDepthTexture"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //用于控制模糊程度的 模糊偏移量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BlurSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BlurSize"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv_depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_TexelSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BlurSize;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _CameraDepthTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//深度纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _ClipToWorldMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//裁剪空间到世界空间的变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FrontWorldToClipMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//上一帧 世界空间到裁剪空间的变换矩阵</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv_depth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //多平台时建议进行判断</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UNITY_UV_STARTS_AT_TOP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (_MainTex_TexelSize.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                        o.uv_depth.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.uv_depth.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.得到裁剪空间下的两个点</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //获取深度值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SAMPLE_DEPTH_TEXTURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthTexture, i.uv_depth);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //裁剪空间下的一个组合坐标 把0~1范围变换到-1~1范围</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //第一个点</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> nowClipPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.uv.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, i.uv.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, depth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用裁剪空间到世界空间的变换矩阵 得到 世界空间下的带你</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_ClipToWorldMatrix, nowClipPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //透视除法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> worldPos.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用上一帧的变换矩阵 得到上一帧 对应的裁剪空间下的点</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //第二个点</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> oldClipPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_FrontWorldToClipMatrix, worldPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //透视除法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                oldClipPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> oldClipPos.w;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.得到运动方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> moveDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (nowClipPos.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> oldClipPos.xy)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //3.进行模糊处理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.uv;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> it</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; it </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">; it</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //第一次采样累加的是当前像素所在位置的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //第二次采样累加的是当前像素进行了 moveDir * _BlurSize 偏移后的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //第二次采样累加的是当前像素进行了 2*moveDir * _BlurSize 偏移后的颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> moveDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BlurSize;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算叠加3次后颜色的平均值 相当于就是在进行模糊处理了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //返回模糊处理后的颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson112_MotionBlurWithDepthTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> blurSize</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //用于记录上一次的变换矩阵的变量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Matrix4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frontWorldToClipMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //开启深度纹理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Camera.main.depthTextureMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> DepthTextureMode.Depth;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //初始化上一次的变换矩阵 用 观察到裁剪变换矩阵（摄像机的透视矩阵） * 世界到观察变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //得到的 就是 世界空间到裁剪空间的变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //frontWorldToClipMatrix = Camera.main.projectionMatrix * Camera.main.worldToCameraMatrix;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnEnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //有时我们会在界面上让脚本失活，每次激活时 可以初始化一次</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        frontWorldToClipMatrix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.projectionMatrix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.worldToCameraMatrix;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnRenderImage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> source</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">RenderTexture</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> destination</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //设置模糊程度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_BlurSize"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, blurSize);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //设置上一帧世界空间到裁剪空间的矩阵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_FrontWorldToClipMatrix"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, frontWorldToClipMatrix);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算这一帧的变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            frontWorldToClipMatrix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.projectionMatrix </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.worldToCameraMatrix;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //设置这一帧的 裁剪到世界空间的变换矩阵</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_ClipToWorldMatrix"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, frontWorldToClipMatrix.inverse);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //进行屏幕后期处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source, destination, material);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Graphics.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Blit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(source, destination);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="六、全局雾效" tabindex="-1">六、全局雾效 <a class="header-anchor" href="#六、全局雾效" aria-label="Permalink to &quot;六、全局雾效&quot;">​</a></h3><h4 id="_1-unity自带全局雾效" tabindex="-1">1. Unity自带全局雾效 <a class="header-anchor" href="#_1-unity自带全局雾效" aria-label="Permalink to &quot;1. Unity自带全局雾效&quot;">​</a></h4><blockquote><p>全局雾效是什么</p></blockquote><p>全局雾效（Global Fog）</p><p>是一种视觉效果，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用于在3D场景中模拟大气中的雾气对远处物体的遮挡<!--]--></span><!--]--></p><p>它通过在场景中加入雾的效果，使得距离摄像机较远的物体看起来逐渐被雾气覆盖， 从而创造出一种朦胧、模糊的视觉效果。</p><blockquote><p>Unity自带的全局雾效</p></blockquote><p>Unity当中本身就存在一个全局雾效功能</p><p>我们可以在Window—&gt;Rendering—&gt;Lighting窗口中的</p><p>Environment 环境页签中进行开启</p><p>雾的计算模式有三种，它们分别是</p><ol><li><p><strong>Linear（线性）</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->f = (end - |d|) / (end – start)<!--]--></span><!--]--><p>d代表里摄像机的距离</p><p>start代表雾开始的距离（可控）</p><p>end代表雾最强时的距离（可控）</p><p>这里的距离都是相对于摄像机的</p></li><li><p><strong>Exponential（指数）</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->f = 1 – e^−density∗|d|<!--]--></span><!--]--><p>d代表里摄像机的距离</p><p>e是自然对数的底约等于2.71828；</p><p>density代表雾的浓度（可控）</p><p>这里的距离都是相对于摄像机的</p></li><li><p><strong>Exponential Squared（指数的平方）</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->f = 1 – e^−(density−|d|)²<!--]--></span><!--]--><p>d代表里摄像机的距离</p><p>e是自然对数的底约等于2.71828；</p><p>density代表雾的浓度（可控）</p><p>这里的距离都是相对于摄像机的</p></li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它们都是用来计算雾的混合因子f 的，有了混合因子，会用雾的颜色和物体本来的颜色进行混合计算<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最终的颜色= （1-f）* 物体的颜色+ f * 雾的颜色<!--]--></span><!--]--><p><strong>也就是说得到的混合因子越大，雾的颜色占比越大，表现效果就是雾越浓</strong></p><p><strong>混合因子越小，物体本来的颜色占比越大，表现效果就是雾越淡</strong></p><p><strong>需要注意的是:</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果想要让物体响应Unity自带的全局雾效，我们需要在对应物体的Shader中加入相关的CG代码。<!--]--></span><!--]--><p><strong>关键的几句CG代码是（创建顶点片元着色器时自带）：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->编译指令#pragma multi_compile_fog <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->内置文件#include “UnityCG.cginc” <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->v2f结构体中加入用于计算雾效坐标信息(通常是计算深度信息)的宏UNITY_FOG_COORDS(数字) 后面的数字和阴影中的宏一样，前面有几个纹理坐标语义，这里就写几 <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点着色器中加入用于计算雾效数据的宏UNITY_TRANSFER_FOG( v2f结构体, v2f结构体.顶点 ); <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->片元着色器中加入用于应用雾效的宏UNITY_APPLY_FOG(v2f结构体.fogCoord, 颜色);<!--]--></span><!--]--></li></ol><hr><h4 id="_2-利用深度纹理实现-全局雾效-的基本原理" tabindex="-1">2. 利用深度纹理实现 全局雾效 的基本原理 <a class="header-anchor" href="#_2-利用深度纹理实现-全局雾效-的基本原理" aria-label="Permalink to &quot;2. 利用深度纹理实现 全局雾效 的基本原理&quot;">​</a></h4><blockquote><p>为什么要实现屏幕后处理效果的全局雾效</p></blockquote><p><strong>为Unity自带的全局雾效有以下几个缺点：</strong></p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->需要为每个自定义Shader按规则书写雾效处理代码<!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->自带的全局雾效无法实现一些自定义效果<!--]--></span><!--]--><p><strong>比如：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基于高度的雾效- 可以用来做出悬浮的水雾效果<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**不规则的雾效（结合噪声图实现）- 可以为雾增加随机性和不规则形** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->动态变化的雾、基于纹理的雾等等<!--]--></span><!--]--></li></ol><p>基于深度纹理的全局雾效，它相对于Unity自带的全局雾效的<strong>好处</strong>是：</p><ol><li><strong>一次屏幕后处理便可以得到雾的效果，不用为每个自定义Shader添加雾效代码</strong></li><li><strong>可以基于该全局雾效拓展出多种雾效，可以方便的模拟出线性、指数、指数平方雾效，甚至实 现一些基于高度的雾效、使用噪声图的雾效、动态变化的雾效等等</strong></li></ol><hr><h4 id="_3-利用深度纹理实现全局雾效的基本原理" tabindex="-1">3. 利用深度纹理实现全局雾效的基本原理 <a class="header-anchor" href="#_3-利用深度纹理实现全局雾效的基本原理" aria-label="Permalink to &quot;3. 利用深度纹理实现全局雾效的基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->halfH = Near * tan(FOV/2) <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->halfW = halfH * aspect (摄像机参数得到Game窗口的宽高比 Aspect = 宽: 高= 宽/ 高)&lt;/span&gt;<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:green" data-v-59b6df29><!--[-->toTop = Camera.up * halfH toRight = Camera.Right * halfW<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->TL = Camera.forward * Near + toTop – toRight<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->TR = Camera.forward * Near + toTop + toRight<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->BL = Camera.forward * Near - toTop – toRight<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->BR = Camera.forward * Near - toTop + toRight<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:#00f" data-v-59b6df29><!--[-->***Scale = |TL|/Near*** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->RayTL = TL.Normalized * Scale<!--]--></span><!--]--><p>**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->RayTR = TR.Normalized * Scale<!--]--></span><!--]--> **</p><p>**<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->RayBL = BL.Normalized * Scale<!--]--></span><!--]--> **</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->RayBR = BR.Normalized * Scale<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->像素的世界坐标 = 摄像机位置+ 观察空间线性深度值* 摄像机指向像素世界坐标的方向向量<!--]--></span><!--]--><hr><h4 id="_4-具体实现" tabindex="-1">4. 具体实现 <a class="header-anchor" href="#_4-具体实现" aria-label="Permalink to &quot;4. 具体实现&quot;">​</a></h4><h5 id="_4-1-c" tabindex="-1">4.1 C# <a class="header-anchor" href="#_4-1-c" aria-label="Permalink to &quot;4.1 C#&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson113_FogWithDepthTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //雾的颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Color</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fogColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Color.gray;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //雾的浓度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fogDensity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //雾开始的距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fogStart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //雾最浓时的距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fogEnd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //4x4的矩阵 用于传递 4个向量参数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Matrix4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rayMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Start is called before the first frame update</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Camera.main.depthTextureMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> DepthTextureMode.Depth;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UpdateProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到摄像机 视口 夹角</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fov</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.fieldOfView </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到近裁剪面距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> near</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.nearClipPlane;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到窗口比例</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> aspect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.aspect;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算高的一半</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> near </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Mathf.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Tan</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(fov </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Mathf.Deg2Rad);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //宽的一半</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfW</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfH </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> aspect;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //计算竖直向上的和水平向右的偏移向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            Vector3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> toTop</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.transform.up </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfH;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            Vector3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> toRight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.transform.right </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfW;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //算出指向四个顶点的向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            Vector3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.transform.forward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> near </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toTop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toRight;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            Vector3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.transform.forward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> near </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toTop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toRight;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            Vector3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> BL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.transform.forward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> near </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toTop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toRight;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            Vector3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> BR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Camera.main.transform.forward </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> near </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toTop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> toRight;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //为了让深度值 计算出来是两点间距离 所以需要乘以一个缩放值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> scale</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TL.magnitude </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> near;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //真正的最终想要的四条射线向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            TL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TL.normalized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> scale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            TR </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TR.normalized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> scale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            BL </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> BL.normalized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> scale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            BR </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> BR.normalized </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> scale;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            rayMatrix.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetRow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, BL);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            rayMatrix.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetRow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, BR);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            rayMatrix.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetRow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, TR);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            rayMatrix.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetRow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, TL);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //设置材质球相关属性(Shader属性)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_FogColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, fogColor);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_FogDensity"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, fogDensity);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_FogStart"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, fogStart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_FogEnd"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, fogEnd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_RayMatrix"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, rayMatrix);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //protected override void OnRenderImage(RenderTexture source, RenderTexture destination)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //    if (material != null)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //    {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //    else</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //        Graphics.Blit(source, destination);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h5 id="_4-2-shader" tabindex="-1">4.2 Shader <a class="header-anchor" href="#_4-2-shader" aria-label="Permalink to &quot;4.2 Shader&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader代码，取名和C#相同，删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.声明属性，映射属性，注意属性和C#中命名相同</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  还有深度纹理、矩阵、纹素属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.屏幕后处理标配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  Cull Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.v2f结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  考虑翻转的深度纹理half2 uv_depth:TEXCOORD1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  射线向量 loat4 ray:TEXCOORD2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.顶点着色器(图片有四个顶点，会进入四次，我们需要判断每一个顶点使用哪一个射线向量）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  坐标转换、uv赋值（考虑深度纹理翻转）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  根据uv坐标判断顶点位置，决定赋值哪一个向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  同样需要考虑翻转</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  深度纹理采样，转换到观察空间下离摄像机的实际距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  利用 摄像机位置 + 深度值*射线向量 得到世界空间坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  利用雾公式 算出混合因子 我们这里不使用传统雾公式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  我们实现一种特殊的基于高度的线性雾效 并且把浓度也用上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  利用混合因子 进行颜色混合</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//7.FallBack Off</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson113_FogWithDepthTexture"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogDensity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogDensity"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogStart"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogEnd"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //深度纹理UV</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv_depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点射线 指向四个角的方向向量 （传递到片元时 会自动进行插值 运算）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹素 用来判断翻转会使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_TexelSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //深度纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _CameraDepthTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //雾相关的属性</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FogDensity;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //矩阵相关 里面存储了 4条射线向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //0-左下 1-右下 2-右上 3-左上</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RayMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv_depth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点着色器函数 每一个顶点都会执行一次</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对于屏幕后处理来说 就会执行4次 因为有4个顶点 （4个角）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过uv坐标判断 当前的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //判断 是否需要进行纹理翻转 如果翻转了 深度的uv和对应顶点需要变化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UNITY_UV_STARTS_AT_TOP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex_TexelSize.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.uv_depth.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.uv_depth.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> index;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //根据顶点的位置 决定使用那一个射线向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.ray </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RayMatrix[index];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //观察空间下 离摄像机的实际距离（Z分量）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> linearDepth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> LinearEyeDepth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SAMPLE_DEPTH_TEXTURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthTexture,i.uv_depth));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算世界空间下 像素的坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WorldSpaceCameraPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> linearDepth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.ray;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //雾相关的计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //混合因子</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (_FogEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> worldPos.y)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_FogEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FogStart);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //取0~1之间 超过会取极值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FogDensity);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用插值 在两个颜色之间进行融合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv).rgb, _FogColor.rgb, f);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七、深度法线纹理边缘检测效果" tabindex="-1">七、深度法线纹理边缘检测效果 <a class="header-anchor" href="#七、深度法线纹理边缘检测效果" aria-label="Permalink to &quot;七、深度法线纹理边缘检测效果&quot;">​</a></h3><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基于深度+法线纹理来实现边缘检测屏幕后期处理效果<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->不会受纹理和光照的影响，只会根据渲染物体的模型信息（深度、法线） 来进行判断检测，这样检测出来的边缘更加的可靠！<!--]--></span><!--]--><p><strong>注意：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**对于2D图片，基于灰度值的边缘检测更合适** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对于3D场景，基于深度+法线纹理的边缘检测更合适 主要原因是2D图片中的深度和法线信息往往是一致的，不存在差异性<!--]--></span><!--]--><h4 id="_1-利用深度-法线纹理实现边缘检测的基本原理" tabindex="-1">1. 利用深度+法线纹理实现边缘检测的基本原理 <a class="header-anchor" href="#_1-利用深度-法线纹理实现边缘检测的基本原理" aria-label="Permalink to &quot;1. 利用深度+法线纹理实现边缘检测的基本原理&quot;">​</a></h4><p>基本原理：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->基于Roberts(罗伯茨)交叉算子，通过比较对角线上的的像素的深度和法线值，判断是否在边缘上。<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/法线和深度纹理/利用深度+法线纹理实现边缘检测.png" loading="lazy"></div><ol><li><p><strong>如何得到对角线上的像素</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在顶点着色器中，利用纹素进行uv坐标偏移计算<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**并且我们可以添加一个可控的采样偏移距离变量_SampleDistance** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**它可以用来决定描边的粗细，值越大描边越粗** <!--]--></span><!--]--><p><strong>原理是</strong></p><p><strong>采样离中心像素越近，检测的变化更细微，深度和法线值变化小，边缘会较细</strong></p><p><strong>采样离中心像素越远，检测的范围较大，深度和法线值变化大，边缘会较粗</strong></p></li><li><p><strong>如何进行深度和法线的比较</strong></p><p><strong>在片元着色器中，利用顶点着色器中得到的uv坐标，</strong></p><p><strong>在深度+法线纹理中进行采样，得到深度值和法线值。</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->再求出对角线上对角的两个像素的深度值差和法线值差。<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**如果其中一个的差值大于了自定义的阈值** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->那么我们认为该像素点在物体的边缘上，否则不是边缘<!--]--></span><!--]--></li><li><p><strong>如何决定是否在边缘上</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**根据刚才进行的深度和法线值的比较，** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**只要其中之一（深度或者法线）满足了大于自定义阈值的条件，** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**那么该像素就在边缘上，就使用描边颜色进行颜色处理** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->关键计算规则如下<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/法线和深度纹理/利用深度+法线纹理实现边缘检测2.png" loading="lazy"></div></li></ol><h4 id="_2-具体实现" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><h5 id="_2-1-shader" tabindex="-1">2.1 Shader <a class="header-anchor" href="#_2-1-shader" aria-label="Permalink to &quot;2.1 Shader&quot;">​</a></h5><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader，取名EdgeDetectionWithDepthNormalsTexture</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.声明属性，属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主纹理 _MainTex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  边缘检测强度 _EdgeOnly 0显示场景 1只显示边缘 用于控制自定义背景色程度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  描边颜色 _EdgeColor</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  背景颜色 _BackgroundColor</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  采样偏移距离 _SampleDistance</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  深度敏感度 _SensitivityDepth</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  法线敏感度 _SensitivityNormal</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  注意：映射属性时需要加入</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  纹素 _MainTex_TexelSize</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  深度+法线纹理 _CameraDepthNormalsTexture</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.屏幕后处理标配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  uv数组，5个空间（存储中心点、对角线4个点）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-1.顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-2.5个uv坐标赋值，按这样的顺序</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      中心点、左上角、右下角、右上角、左下角</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  5-1.直接采样得到对角线四个点的深度法线信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  5-2.实现一个用于比较两点深度、法线信息的函数，返回0或1，方便进行插值计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  5-3.声明一个插值变量 0代表使用边缘色 1代表使用源颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  5-4.考虑背景色差值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//7.FallBack Off</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson114_EdgeDetectionWithDepthNormalsTexture"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //用于控制自定义背景颜色程度的 0要显示原始背景色 1只显示边缘 完全显示自定义背景色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _EdgeOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"EdgeOnly"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //边缘的描边颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _EdgeColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"EdgeColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //自定义背景颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BackgroundColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BackgroundColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //采样偏移程度 主要用来控制描边的粗细 值越大越粗 反之越细</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SampleDistance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SampleDistance"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //深度和法线的敏感度 用来进行这个差值判断时 起作用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SensitivityDepth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SensitivityDepth"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SensitivityNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SensitivityNormal"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //屏幕后处理标配</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用于存储5个像素的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                half2 uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹素 用于进行uv坐标偏移 取得周围像素的uv坐标的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_TexelSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //深度+法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _CameraDepthNormalsTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;\</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于控制自定义背景颜色程度的 0要显示原始背景色 1只显示边缘 完全显示自定义背景色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _EdgeOnly;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //边缘的描边颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _EdgeColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //自定义背景颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BackgroundColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //采样偏移程度 主要用来控制描边的粗细 值越大越粗 反之越细</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SampleDistance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //深度和法线的敏感度 用来进行这个差值判断时 起作用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SensitivityDepth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SensitivityNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //用于比较两个点的深度和法线纹理中采样得到的信息 用来判断是否是边缘</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //返回值的含义</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //1 - 法线和深度值基本相同 处于同一个平面上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //0 - 差异大 不在一个平面上</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> CheckSame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depthNormal1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depthNormal2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //分别得到两个点信息的深度和法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //第一个点的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到深度值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depth1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> DecodeFloatRG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(depthNormal1.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到法线的xy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normal1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> depthNormal1.xy;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //第二个点的</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到深度值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depth2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> DecodeFloatRG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(depthNormal2.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到法线的xy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normal2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> depthNormal2.xy;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //法线的差异计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算两条法线的xy的差值 并且乘以 自定义的敏感度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalDiff</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(normal1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> normal2) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SensitivityNormal;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //判断两个法线是否在一个平面</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果差异不大 证明基本上在一个平面上 返回 1；否则返回0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> isSameNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (normalDiff.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> normalDiff.y) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //深度的差异计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> depthDiff</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(depth1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> depth2) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SensitivityDepth;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //判断深度是不是很接近 是不是相当于在一个平面上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果满足条件 证明深度值差异非常小 基本趋近于在一个平面上 返回1；否则 返回0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> isSameDepth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> depthDiff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> depth1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //返回值的含义</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1 - 法线和深度值基本相同 处于同一个平面上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //0 - 差异大 不在一个平面上</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> isSameDepth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> isSameNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //uv相关坐标赋值</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //中心点</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对角线相关像素uv坐标赋值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //左上角</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SampleDistance;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //右下角</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SampleDistance;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //右上角</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SampleDistance;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //左下角</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_TexelSize.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> half2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SampleDistance;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //获取四个点的深度和法线信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthNormalsTexture, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> BR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthNormalsTexture, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthNormalsTexture, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> BL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthNormalsTexture, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //根据深度+法线信息 去判断 是否是边缘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> edgeLerpValue</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到判断结果 返回1代表是一个平面 值不变为1；返回0代表不是一个平面，值变为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                edgeLerpValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> CheckSame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(TL, BR);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                edgeLerpValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> CheckSame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(TR, BL);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过插值进行颜色变化</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> withEdgeColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_EdgeColor, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]), edgeLerpValue);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> onlyEdgeColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_EdgeColor, _BackgroundColor, edgeLerpValue);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(withEdgeColor, onlyEdgeColor, _EdgeOnly);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h5 id="_2-2-c" tabindex="-1">2.2 C# <a class="header-anchor" href="#_2-2-c" aria-label="Permalink to &quot;2.2 C#&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建C#脚本，取名和Shader相同</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.继承PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.声明可控变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.Start函数中 开启深度+法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  注意：不要直接=，要|=，避免关闭深度纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.重写UpdateProperty函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  在其中设置属性即可</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson114_EdgeDetectionWithDepthNormalsTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PostEffectBase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> edgeOnly</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Color</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> edgeColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Color.black;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Color</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> backgroundColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Color.white;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sampleDistance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sensitivityDepth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sensitivityNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //避免关闭深度纹理 影响其他屏幕后处理效果</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Camera.main.depthTextureMode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">|=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> DepthTextureMode.DepthNormals;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UpdateProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_EdgeOnly"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, edgeOnly);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_EdgeColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, edgeColor);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_BackgroundColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, backgroundColor);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_SampleDistance"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, sampleDistance);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_SensitivityDepth"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, sensitivityDepth);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetFloat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_SensitivityNormal"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, sensitivityNormal);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="shader实践知识" tabindex="-1">Shader实践知识 <a class="header-anchor" href="#shader实践知识" aria-label="Permalink to &quot;Shader实践知识&quot;">​</a></h2><h3 id="一、流光效果" tabindex="-1">一、流光效果 <a class="header-anchor" href="#一、流光效果" aria-label="Permalink to &quot;一、流光效果&quot;">​</a></h3><h4 id="_1-流光效果的基本原理" tabindex="-1">1. 流光效果的基本原理 <a class="header-anchor" href="#_1-流光效果的基本原理" aria-label="Permalink to &quot;1. 流光效果的基本原理&quot;">​</a></h4><p><strong>实现流光效果的原理非常简单</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**就是利用Unity内置的时间变量_Time，让UV坐标沿着一个固定的方向持续递增，** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->然后用偏移后的UV坐标对纹理贴图进行采样，就可以得到流动的效果了。<!--]--></span><!--]--><h4 id="_2-美术注意事项" tabindex="-1">2. 美术注意事项 <a class="header-anchor" href="#_2-美术注意事项" aria-label="Permalink to &quot;2. 美术注意事项&quot;">​</a></h4><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**UV需要均匀的展开，如果UV展开不均匀或者出现拉伸，流光的移动会出现扭曲和不自然 需要确保模型的UV展开尽量均匀和平滑** <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**UV的比例要一致，模型上不同部分的UV比例需要保持一致，确保流光效果的移动速度在 整个模型上是一致的。如果某些区域的UV比例过大或过小，流光在这些区域的移动速度会不同** <!--]--></span><!--]--></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->贴图需要无缝衔接（首尾或上下相连），避免流光效果再边界处出现断裂或跳跃<!--]--></span><!--]--></li></ol><h4 id="_3-实现" tabindex="-1">3. 实现 <a class="header-anchor" href="#_3-实现" aria-label="Permalink to &quot;3. 实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader MovingLight</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.属性声明 属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  叠加颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  移动速度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.透明相关设置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  渲染标签设置——渲染类型，渲染队列</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  混合模式 用 Blend One One 直接叠加颜色 让其效果更亮 更有流光的感觉</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  关闭剔除 两面都渲染</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  坐标转换，纹理缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  用_Time进行u轴方向的偏移采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  返回采样颜色 * 叠加颜色</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson115_MovingLight"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //光叠加的颜色 默认图片时白色 我们叠加一个自定义颜色 可以改变它</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //流光移动的速度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Speed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Speed"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Blend One One</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Speed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //根据时间 进行UV坐标偏移 这样x（u）方向就可以看到移动的效果了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                i.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.uv.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Time.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Speed, i.uv.y);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="二、模型描边效果" tabindex="-1">二、模型描边效果 <a class="header-anchor" href="#二、模型描边效果" aria-label="Permalink to &quot;二、模型描边效果&quot;">​</a></h3><h4 id="_1-基本原理-2" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-2" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->两个Pass渲染对象，一个Pass用于渲染沿法线方向放大的模型，一个Pass用于正常渲染正常模型。 相当于先用纯色渲染一次放大后的模型，再用模型本来的颜色覆盖重合部分<!--]--></span><!--]--><ol><li><p>如何放大模型</p><p>在第一个Pass中</p><p>我们可以在顶点着色器函数 中<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将顶点沿着法线方向进行偏移<!--]--></span><!--]-->，</p><p><strong>偏移的距离可以是一个自定义参数，它可以用来控制边缘线的粗细。</strong></p><p>在片元着色器函数 <strong>中直接返回一个自定义颜色即可，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它决定了边缘线的颜色<!--]--></span><!--]--></strong></p></li><li><p>如何覆盖重合部分</p><p>在第二个Pass中，我们只需要正常按需求(是否受光照影响等)渲染模型即可</p><p><strong>但是正常情况下，放大的部分会直接挡住正常大小的模型内容，</strong></p><p><strong>这是因为第二个Pass的渲染的重合部分无法通过深度写入，直接被抛弃了</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**要解决这个问题很简单，直接让第一个Pass关闭深度写入即可** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->这样重合部分，就会显示为第二个Pass绘制的结果<!--]--></span><!--]--></li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->两个Pass渲染对象，一个Pass用于渲染沿法线方向放大的模型，一个Pass用于正常渲染正常模型。 相当于先用纯色渲染一次放大后的模型，再用模型本来的颜色覆盖重合部分。 为了让重合部分能够正常显示为第二个Pass的渲染内容，需要关闭第一个Pass的深度写入！<!--]--></span><!--]--><h4 id="_2-解决关闭深度写入带来的问题" tabindex="-1">2. 解决关闭深度写入带来的问题 <a class="header-anchor" href="#_2-解决关闭深度写入带来的问题" aria-label="Permalink to &quot;2. 解决关闭深度写入带来的问题&quot;">​</a></h4><p>虽然关闭第一个Pass的深度写入可以帮助我们实现出想要的效果， 但是它会带来一个问题，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->就是物体后方的内容会覆盖掉边缘线！<!--]--></span><!--]--></p><p>解决这个问题的方案是：</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->设置该模型描边效果Shader 的渲染队列为Transparent，让它晚于几何体进行渲染<!--]--></span><!--]--><h4 id="_3-具体实现" tabindex="-1">3. 具体实现 <a class="header-anchor" href="#_3-具体实现" aria-label="Permalink to &quot;3. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader 取名 OutLine</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.属性声明</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  边缘线颜色 _OutLineColor</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  边缘线粗细 _OutLineWidth</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.复制一个Pass</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.编写第一个Pass</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-1.关闭深度写入</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-2.属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-3.结构体相关</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      不需要纹理坐标,因为颜色定死 不需要采样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-4.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      顶点朝法线方向进行偏移后再转换到裁剪空间</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-5.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      直接返回边缘线颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.编写第二个Pass</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  编写传统的纹理采样Pass进行测试即可（如果有光照相关的需求 自定添加即可）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.FallBack "Diffuse"</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson116_OutLine"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _OutLineColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"OutLineColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _OutLineWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"OutLineWidth"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //关闭深度写入 目的是 第二个Pass能够覆盖重合的地方</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //边缘线颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _OutLineColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //边缘线粗细</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _OutLineWidth;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //偏移顶点位置 朝法线方向偏移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //让我们的顶点朝法线方向 偏移 自定义个单位 这个自定义变量 就是决定模型膨胀多少的 就可以决定边缘线的粗细</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> newVertex</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _OutLineWidth;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把膨胀过后的顶点转到裁剪空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(newVertex, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _OutLineColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="三、遮挡半透明效果" tabindex="-1">三、遮挡半透明效果 <a class="header-anchor" href="#三、遮挡半透明效果" aria-label="Permalink to &quot;三、遮挡半透明效果&quot;">​</a></h3><p>遮挡半透明效果就是</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->物体被挡住的部分，也能呈现出一种半透明效果而被看到（具体效果可以自定义）<!--]--></span><!--]--><p>比如当角色在建筑物之间穿行时，被遮挡部分能够呈现出半透明效果而被我们看到。</p><h4 id="_1-基本原理-3" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-3" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->两个Pass渲染对象，一个Pass用于渲染被遮挡部分，一个Pass用于渲染未遮挡模型。 被遮挡部分通过修改深度测试规则和关闭深度写入达到目的<!--]--></span><!--]--><ol><li><p>如何渲染遮挡部分</p><p>在第一个Pass中</p><p>我们<strong>按照想要的遮挡效果去实现Shader</strong>即可（比如半透明或X射线效果）</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最关键的点，是需要修改该 Pass的深度测试规则，并且关闭深度写入！<!--]--></span><!--]--><p><strong>修改深度测试的目的：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只有自己的深度值大于深度缓冲中的值才渲染，相当于只有前方有遮挡时才渲染<!--]--></span><!--]--><p><strong>关闭深度写入的目的：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->如果前方有遮挡，又写入较大的深度值，执行第二个Pass时会通过深度写入， 导致第二个Pass的内容通过深度测试，呈现出未被遮挡的错误效果！<!--]--></span><!--]--></li><li><p>如何渲染未遮挡部分</p><p>在第二个Pass中</p><p>我们<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>只需要正常按需求（是否受光照影响等）渲染模型即可</strong><!--]--></span><!--]--></p><p>不需要做什么特别处理</p></li></ol><h4 id="_2-自定义半透明效果" tabindex="-1">2. 自定义半透明效果 <a class="header-anchor" href="#_2-自定义半透明效果" aria-label="Permalink to &quot;2. 自定义半透明效果&quot;">​</a></h4><p>普通的半透明效果非常容易实现，只需要设置混合因子即可。</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->而要实现类似X射线的效果，也就是边缘不透明，中间透明的效果<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们可以利用我们学习过的菲尼尔反射的公式来得到<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Schlick 菲涅耳近似等式<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->R(θ) = R0 + ( 1− R0 )( 1 − V·𝑵)^𝟓<!--]--></span><!--]--><p><strong>其中：</strong></p><p><strong>R(θ) 表示入射角为θ时时的反射率</strong></p><p><strong>R0 是垂直入射某介质时的反射率</strong></p><p><strong>V 是视角方向单位向量（入射角）</strong></p><p><strong>N 是顶点法线单位向量</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->将得到的入射角为θ的反射率作为自定义颜色的A值，便可以得到类似的结果<!--]--></span><!--]--><h4 id="_3-具体实现-1" tabindex="-1">3. 具体实现 <a class="header-anchor" href="#_3-具体实现-1" aria-label="Permalink to &quot;3. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader 取名 OcclusionTransparent1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  删除无用改代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.声明属性 映射属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  透明度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.复制一个Pass</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.第一个Pass</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-1.关键点 深度测试改为大于 关闭深度写入 传统透明混合因子</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      ZTest Greater</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      Blend SrcAlpha OneMinusSrcAlpha =&gt; 混合后的颜色 = (源颜色*源Alpha)+(目标颜色*(1−源Alpha))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-2.传统纹理采样实现，在片元着色器返回颜色中透明通道用透明度变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.第二个Pass</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  传统纹理采样实现</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson117_OcclusionTransparent1"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Alpha</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Alpha"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZTest Greater</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Alpha;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // sample the texture</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> col</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(col.rgb, _Alpha);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Alpha;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // sample the texture</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> col</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//自定义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson117_OcclusionTransparent2"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //菲涅尔反射 垂直角度反射率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FresnelScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FresnelScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //菲涅尔反射近似公式中的 N次方</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FresnelN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FresnelN"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //自定义颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZTest Greater</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Blend SrcAlpha OneMinusSrcAlpha</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //主要用于进行菲尼尔公式计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下 视角方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下 法线方向</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //在该Pass当中不需要采样 所以不需要映射主纹理相关内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FresnelScale;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FresnelN;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角方向 法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldViewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldNormal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //菲涅尔反射公式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> alpha = _FresnelScale +</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                             (1-_FresnelScale) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldViewDir), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.worldNormal)), _FresnelN);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Color.rgb, alpha);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Alpha;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // sample the texture</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> col</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="四、物体切割效果" tabindex="-1">四、物体切割效果 <a class="header-anchor" href="#四、物体切割效果" aria-label="Permalink to &quot;四、物体切割效果&quot;">​</a></h3><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->物体看似被切割、分割或隐藏一部分的视觉效果。<!--]--></span><!--]--><h4 id="_1-基本原理-4" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-4" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在片元着色器中判断片元的世界坐标是否满足切割条件，如果满足则直接抛弃片元不渲染 判断片元在模型中的正反面，决定使用哪种纹理进行渲染<!--]--></span><!--]--><ol><li><p>如何判断世界坐标</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在Shader中声明一个Vector坐标变量<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通过C#代码把控制切割位置的物体世界空间位置传递给Shader<!--]--></span><!--]--><p>在Shader中用片元的世界坐标和传递进来的世界坐标做比较，我们可以分三种模式，分别比较 x、y、z坐标，切割x、y、z方向的片元</p></li><li><p>如何抛弃片元不渲染</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Unity Shader中提供了一个内置函数 clip(x)<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的作用就是在片元着色器中调用时来丢弃片元的，之前在透明度测试时使用过<!--]--></span><!--]--><p>传入的值x小于0，则会丢弃当前片元，被丢弃的片元不会被进一步处理也就不会被渲染了 也就是说，当我们判断片元位置需要被切割时，直接执行clip函数传入一个负数，这个片元就会被丢弃 不会被渲染了</p></li><li><p>如何判断片元的正反面</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Unity Shader中提供了一个语义 VFACE，它只能在片元着色器中使用<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**它可以作为参数传递给片元着色器** <!--]--></span><!--]--><p>传入值1表示为正面，-1表示为背面，我们可以利用它判断该片元是 模型正面还是背面片元，决定使用哪种纹理或颜色进行渲染</p><p><strong>注意： 在使用它时建议加上编译指令#pragma target 3.0 或 4.0 、5.0 表示设置着色器模型版本，可以让VFACE语义使用上的兼容性和稳定性更好</strong></p></li></ol><h4 id="_2-具体实现-1" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现-1" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><h5 id="_2-1-shader-1" tabindex="-1">2.1 Shader <a class="header-anchor" href="#_2-1-shader-1" aria-label="Permalink to &quot;2.1 Shader&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader ObjectCutting</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.属性声明 属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  主纹理 _MainTex 2D</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  背面纹理 _BackTex 2D</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  切割方向（用来控制比较x、y、z哪个轴）_CuttingDir Float</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  是否翻转切割 _Invert Float</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  切割位置（从C#传递过来）_CuttingPos Vector</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.关闭剔除 因为要两面渲染</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.编译指令 #pragma target 3.0 让VFACE兼容性更好</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  uv、顶点、世界坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.顶点着色器函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  坐标转换、纹理赋值、世界坐标转换</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//7.片元着色器函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-1.加入VFACE语义参数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-2.根据正反面决定采样颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-3.根据切割方向判断是否丢弃（0代表丢弃，1代表不丢弃）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      可以使用step(edge, x)函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      x&gt;=edge 返回 1；x&lt;edge 返回 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-4.利用是否翻转切割参数决定是否反转丢弃</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-5.利用clip函数丢弃片元</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-6.若不丢弃 直接返回颜色</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson118_ObjectCutting"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //用于渲染模型背面像素的纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BackTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BackTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //切割的方向 0-x 1-y 2-z</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _CuttingDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"CuttingDir"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //是否切割翻转 0-不翻转 1-翻转</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Invert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Invert"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //切割的位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _CuttingPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"CuttingPos"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Vector) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //因为正反两面都要渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma target 3.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界坐标位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BackTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _CuttingDir;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Invert;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _CuttingPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> face</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:VFACE) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过用face来进行正反面判断 Unity Shader 因为有了语义 会自动传入对应的参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> col</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> face </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> ?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BackTex, i.uv);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //丢弃中间值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> cutValue;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //比较x坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CuttingDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    cutValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CuttingPos.x, i.worldPos.x);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //比较y坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CuttingDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    cutValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CuttingPos.y, i.worldPos.y);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //比较z坐标</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CuttingDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    cutValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CuttingPos.z, i.worldPos.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //是否进行翻转切割</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                cutValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Invert </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> cutValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> cutValue;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果丢弃中间值 是0代表要丢弃 是1代表不丢弃 直接返回颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(cutValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                    clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//传入-1（小于0） 代表这个片元不会渲染 直接丢弃</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h5 id="_2-2-c-1" tabindex="-1">2.2 C# <a class="header-anchor" href="#_2-2-c-1" aria-label="Permalink to &quot;2.2 C#&quot;">​</a></h5><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //1.新建C#脚本 和Shader名一样</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //2.加入[ExecuteAlways]特性，让编辑模式下也运行，可以看到效果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //3.声明材质球和切割位置对象</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //4.材质球初始化</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //6.在Update中不停的将切割物体位置传递给Shader</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ExecuteAlways</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson118_ObjectCutting</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MonoBehaviour</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //材质</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Material</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> material</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //切割对象 用于决定切割位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> GameObject</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cutObj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Start is called before the first frame update</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">GetComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Renderer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;().sharedMaterial;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    // Update is called once per frame</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(material </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> cutObj </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            material.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SetVector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_CuttingPos"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, cutObj.transform.position);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="五、翻页效果" tabindex="-1">五、翻页效果 <a class="header-anchor" href="#五、翻页效果" aria-label="Permalink to &quot;五、翻页效果&quot;">​</a></h3><h4 id="_1-基本原理-5" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-5" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->对顶点进行平移—&gt;矩阵旋转—&gt;再平移，并利用三角函数相关知识制做出起伏感<!--]--></span><!--]--><ol><li><p>如何制作旋转</p><p>我们将利用以前学习的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->旋转矩阵相关知识，来对顶点进行旋转变换<!--]--></span><!--]--> 但是，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->旋转前<!--]--></span><!--]-->我们需要先对顶点进行平移，否则模型将绕着模型中心点旋转。 因为旋转之前进行了<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->平移<!--]--></span><!--]-->，因此<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->旋转结束后<!--]--></span><!--]-->，我们需要再将<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->顶点平移回来<!--]--></span><!--]--></p></li><li><p>如何制作起伏感</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只需要在旋转前利用三角函数Sin让顶点在Y轴上进行偏移即可 并且0~90~180度之间变换时，0和180度不需要起伏感，90度时起伏感最大（页面最弯曲）<!--]--></span><!--]--></li></ol><h4 id="_2-具体实现-2" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现-2" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建Shader PageTurning</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  删除无用代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.属性声明 属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  正面纹理          _MainTex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  背面纹理          _BackTex</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  翻页进度(0~180度) _AngleProgress</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  y轴弯曲程度(0~1)  _WeightY</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  x轴收缩程度(0~1)  _WeightY</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  波长(0~3)         _WaveLength</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  平移距离          _MoveDis</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.由于要双面渲染</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  Cull Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.由于要使用VFACE语义，加入编译指令</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  #pragma target 3.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  顶点和UV</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.顶点着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  先实现基本的翻页效果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  1.利用sincos函数得到当前翻页精度对应的sin和cos值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2.基于得到的值，构建旋转矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3.旋转前先平移</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3.基于旋转矩阵进行顶点旋转</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4.旋转结束再平移回去</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  5.将处理完毕的顶点转换到裁剪空间中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  6.UV赋值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  实现起伏效果</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  将起伏相关的计算加入到旋转矩阵之前</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//7.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  通过VFACE语义判断正反面进行对应的采样即可</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson119_PageTurning"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BackTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BackTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _AngleProgress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"_AngleProgress"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">180</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _WeightX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"WeightX"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _WeightY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"WeightY"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _WaveLength</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"WaveLength"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MoveDis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MoveDis"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma target 3.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //正面纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //背面纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BackTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //翻页进度 0~180度的角度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _AngleProgress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //x轴收缩权重</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WeightX;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //Y轴弯曲权重</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WeightY;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //波长</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _WaveLength</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //平移距离</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MoveDis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对顶点进行变换</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //先处理旋转</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用sincos函数 配合自定义参数 翻页的角度（进度）来得到对应</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //的sin和cos值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                sincos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">radians</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_AngleProgress), s, c);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //构建Z轴旋转矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rotationM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {c, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">s, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                      s, c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">                                      0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">                                      0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">};</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //由于我们是基于Z轴旋转 所以我们将其按照x轴方向进行偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MoveDis, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //进行起伏处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">90</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _AngleProgress)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //Y轴上下起伏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v.vertex.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WaveLength) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WeightY;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //X轴收缩</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v.vertex.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.vertex.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> weight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WeightX;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //平移后 再旋转</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> postion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotationM, v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //再平移回来</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                postion </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MoveDis,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(postion);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> face</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:VFACE) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> col</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> face </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> ?</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BackTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="六、卡通渲染" tabindex="-1">六、卡通渲染 <a class="header-anchor" href="#六、卡通渲染" aria-label="Permalink to &quot;六、卡通渲染&quot;">​</a></h3><h4 id="_1-基本原理-6" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-6" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->让光的过渡效果变硬并且实现轮廓描边！<!--]--></span><!--]--><ol><li><p>如何让光的过渡效果变硬</p><p><strong>影响对象光照效果的部分主要是 <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->漫反射的计算+ 高光反射的计算<!--]--></span><!--]--></strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->高光反射部分的变硬<!--]--></span><!--]-->我们只需要基于它的公式修改计算规则即可<p>我们把pow( max(0, dot(法线单位向量, 半角单位向量)), 幂) 直接进行简化</p><p>相当于之前平滑的值变化变得只有1和0两种情况，要不有要不没有</p></li><li><p>如何实现轮廓描边</p><p>它的基本原理是</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->两个Pass渲染对象 一个Pass用于渲染沿法线方向放大的模型 一个Pass用于正常渲染正常模型 相当于先用纯色渲染一次放大后的模型 再用模型本来的颜色覆盖重合部分<!--]--></span><!--]--><p><strong>但是我们在实现卡通风格渲染时不会使用这种方式 我们将采用一种新的方式来制作轮廓描边</strong></p><blockquote><p>新方法：</p></blockquote><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->同样两个Pass渲染对象 一个Pass渲染背面将模型背面顶点沿法线方向偏移扩大 一个Pass渲染正面正常渲染<!--]--></span><!--]--><p><strong>这样实现的效果会让模型上有重叠的结构出现描边效果</strong></p><p><strong>注意：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->模型背面就是法线方向和摄像机面朝向呈锐角的部分 模型正面就是法线方向和摄像机面朝向呈钝角的部分<!--]--></span><!--]--></li></ol><h4 id="_2-具体实现-3" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现-3" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson120_ToonShader"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _RampTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RampTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _OutLineColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"OutLineColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _OutLineWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"OutLineWidth"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.04</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Front</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> :SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //边缘线颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _OutLineColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //边缘线宽度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _OutLineWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这是把背面看不到的顶点朝法线方向去往外扩展 让模型变大</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                v.vertex.xyz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_OutLineWidth;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //再转换坐标到裁剪空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //直接返回边缘线颜色 相当于背面是纯色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _OutLineColor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Cull Back</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //ZWrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            ////设定混合计算的计算方式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //BlendOp 混合操作</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            ////写法一：混合方式的 基本格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //Blend 源因子 目标因子, 源透明因子 目标透明因子</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            ////写法二：混合方式的 省略格式</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //Blend 源因子 目标因子</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">viewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD3;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//凹凸程度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RampTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//渐变纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RampTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//渐变纹理的缩放和平移（基本不会用）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//光泽度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_full</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在顶点着色器当中 得到 模型空间到切线空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //切线、副切线、法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> binormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3x3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rotation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3x3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( v.tangent.xyz,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              binormal,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的光的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.lightDir = ObjSpaceLightDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以模型空间到切线空间的转换矩阵 就可以得到切线空间下的 光的方向了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.lightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的视角的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.viewDir = ObjSpaceViewDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //得到世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影相关</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> packedNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tangentNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //修改为 渐变纹理相关的计算方式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> halfLambertNum = dot(normalize(tangentNormal), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.worldPos);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                halfLambertNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //渐变纹理 漫反射计算方式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> diffuseColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_RampTex, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(halfLambertNum,halfLambertNum)).rgb;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.viewDir) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //fixed3 specularColor = _LightColor0.rgb * _SpecularColor.rgb * pow(max(0, dot(tangentNormal, halfA)), _SpecularNum);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> spec = dot(normalize(tangentNormal), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(halfA));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用一个阈值和计算结果进行比较 小于阈值 取0 大于阈值 取1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                spec </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_SpecularNum, spec);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用0或1直接和高光反射颜色进行叠加 要不有颜色 要不没有颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> spec;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diffuseColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七、素描风格渲染" tabindex="-1">七、素描风格渲染 <a class="header-anchor" href="#七、素描风格渲染" aria-label="Permalink to &quot;七、素描风格渲染&quot;">​</a></h3><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要目的是使3D模型看起来像手绘素描的视觉效果。<!--]--></span><!--]--><h4 id="_1-基本原理-7" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-7" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用漫反射系数决定采样权重，在多张具有不同密度和方向的素描纹理中 进行采样，并将采样结果进行叠加得到最终效果<!--]--></span><!--]--><ol><li><p><strong>多张具有不同密度和方向的素描纹理</strong></p><p>美术需要提供多张素描纹理，我们之后会根据不同位置的光照强度 决定从哪种纹理中进行采样</p></li><li><p><strong>漫反射系数决定采样权重（在顶点着色器中决定）</strong></p><p>我们通过兰伯特光照模型中的</p><p><em><em>max（0, 标准化后物体表面法线向量· 标准化后光源方向向量）</em> <!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->（素描纹理数+ 1）<!--]--></span><!--]--></em>*</p><p>将漫反射光照强度0~1 扩充到0~N ，如果是6张素描纹理，那么就是0 ~ 7</p><p>根据不同顶点的不同光照，决定在哪一张纹理中进行采样的权重更大，该权重决定最后的颜色叠加</p><p>6~7：不在素描纹理中采样</p><p>5~6：第1张素描纹理中采样</p><p>4~5：第1、2素描张纹理中采样</p><p>3~4：第2、3张纹理中采样</p><p>2~3：第3、4张纹理中采样</p><p>1~2：第4、5张纹理中采样</p><p>0~1：第5、6张纹理中采样</p></li><li><p><strong>采样结果进行叠加（在片元着色器中叠加）</strong></p><p>根据之前的权重计算，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->越亮的地方、越趋近于白色，或使用的素描纹理中线条更少更稀疏 而越暗的地方使用的素描纹理中线条更密集。<!--]--></span><!--]--></p><p>因此我们只需要使用之前的权重值和纹理采样结果相乘，最后将纹理颜色进行叠加即可</p></li></ol><h4 id="_2-具体实现-4" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现-4" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">	#</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">region</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 知识点二 权重计算(顶点着色器函数逻辑)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //1.v2f结构体声明</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  顶点位置、uv、用两个fixed3记录素描纹理权重</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //2.顶点着色器函数实现</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  2-1 顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  2-2 uv坐标平铺缩放 让纹理*平铺系数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  2-3 世界空间光照方向、世界空间法线转换</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  2-4 兰伯特漫反射光照系数计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  2-5 将光照系数 从 0~1 扩充到 0~7</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  2-6 根据系数决定素描纹理权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endregion</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">region</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 知识点三 颜色采样(片元着色器函数逻辑)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //在片元着色器中实现</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //1.对 1~6 张纹理进行采样 并乘以权重 得到各纹理采样颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //2.根据 1~6张纹理权重计算出白色高光部分颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //3.将1~6张纹理采样颜色 和 白色部分 相加得到最终叠加颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endregion</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">region</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> 知识点四 外轮廓、阴影相关添加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //1.外轮廓</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  直接复用Lesson120_ToonShader中的外轮廓Pass代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //2.阴影相关添加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  加入 SHADOW_COORDS、TRANSFER_SHADOW、UNITY_LIGHT_ATTENUATION</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //  加入 FallBack "Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endregion</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson121_Sketch"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //整体颜色叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //平铺纹理的系数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _TileFactor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"TileFactor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //6张素描纹理贴图</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Sketch0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Sketch0"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Sketch1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Sketch1"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Sketch2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Sketch2"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Sketch3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Sketch3"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Sketch4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Sketch4"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Sketch5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Sketch5"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //边缘线相关参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _OutLineColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"OutLineColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _OutLineWidth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"OutLineWidth"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.04</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        UsePass </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson120_ToonShader/OUTLINE"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _TileFactor;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Sketch0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Sketch1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Sketch2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Sketch3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Sketch4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Sketch5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //xyz分别代表第1、2、3张素描纹理的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">sketchWeights0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //xyz分别代表第4、5、6张素描纹理的权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                fixed3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">sketchWeights1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD3;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //uv坐标平铺缩放 值越大 之后的素描细节越多 越小 细节越粗糙</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _TileFactor;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间光照方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldLightDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">WorldSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间法线方向转换</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特漫反射光照强度 0~1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff = max(0, dot(worldLightDir, worldNormal));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将其扩充到0~7  7/7 = 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //越大越亮 越小越暗</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 7.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //初始化权重 默认每一张素描纹理对应的权重都是0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.sketchWeights0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.sketchWeights1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //代表6张图的权重都会是0 那么采样就不会使用6张图的颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 6.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                    //认为是最亮的部分 我们不需要改变任何权重</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">){</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//代表 会从第1张图中采样 因此对应权重不会为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights0.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 4.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">){</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//代表 会从第1、2张图中采样 因此对应权重不会为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights0.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 5.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights0.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.sketchWeights0.x;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">){</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//代表 会从第2、3张图中采样 因此对应权重不会为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights0.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights0.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.sketchWeights0.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">){</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//代表 会从第3、4张图中采样 因此对应权重不会为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights0.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights1.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.sketchWeights0.z;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">){</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//代表 会从第4、5张图中采样 因此对应权重不会为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights1.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights1.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.sketchWeights1.x;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//代表 会从第5、6张图中采样 因此对应权重不会为0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights1.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.sketchWeights1.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> diff;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标转世界坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //如果在顶点着色器中计算的对应素描纹理图片的权重为0 那么这时 对应颜色会为(0,0,0,0)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sketchColor0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Sketch0, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights0.x;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sketchColor1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Sketch1, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights0.y;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sketchColor2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Sketch2, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights0.z;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sketchColor3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Sketch3, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights1.x;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sketchColor4</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Sketch4, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights1.y;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sketchColor5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Sketch5, i.uv) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights1.z;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //最亮的部分相关的计算 白色叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> whiteColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights0.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights0.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">i.sketchWeights0.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                    i.sketchWeights1.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights1.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.sketchWeights1.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sketchClor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> sketchColor0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> sketchColor1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> sketchColor2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> sketchColor3 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> sketchColor4 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                    sketchColor5 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> whiteColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(sketchClor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> atten </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="八、噪声" tabindex="-1">八、噪声 <a class="header-anchor" href="#八、噪声" aria-label="Permalink to &quot;八、噪声&quot;">​</a></h3><h4 id="_1-噪声是什么" tabindex="-1">1. 噪声是什么 <a class="header-anchor" href="#_1-噪声是什么" aria-label="Permalink to &quot;1. 噪声是什么&quot;">​</a></h4><p><strong>噪声是一种程序生成的随机或伪随机数据</strong>，在图形学中常用来创建各种自然现象和复杂纹理效果。</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它的本质是一种由数学算法公式生成的有规则性或可控的随机数据。<!--]--></span><!--]--><p>通过噪声算法生成的随机数据具有以下特点：</p><ol><li><strong>随机性</strong>：噪声数据本质上是随机的，这意味着它具有不规则性，无法通过简单的模式预测</li><li><strong>平滑性</strong>：数据不会突然跳跃或变化，而是呈现出逐渐过渡的效果，适合模拟自然现象</li><li><strong>周期性</strong>：随着坐标的变化，噪声值会重复出现，形成一个封闭的循环。也可以通过调整噪声的范围或修 改算法来避免</li><li><strong>可调性</strong>：大多数噪声算法的输出是可以调整的，这种可调性允许你根据需求灵活地控制噪声的表现，适 应不同的视觉效果或逻辑处理需求</li><li><strong>多维性</strong>：能够处理多维数据，这意味着它们可以生成二维、三维甚至更高维度的噪声数据</li></ol><h4 id="_2-常用的噪声算法" tabindex="-1">2. 常用的噪声算法 <a class="header-anchor" href="#_2-常用的噪声算法" aria-label="Permalink to &quot;2. 常用的噪声算法&quot;">​</a></h4><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Perlin Noise<!--]--></span><!--]--><strong>（柏林噪声）</strong>：适合生成自然现象的纹理（比如云、火焰、地形）</li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Simplex Noise<!--]--></span><!--]--><strong>（简单噪声）</strong>：Perlin Noise的优化版，更适合实时计算，适用于体积云、流体动画等</li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Random Function<!--]--></span><!--]--><strong>（随机噪声/白噪音）</strong>：计算简单，适合生成粒子效果或星空背景</li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Fractal Noise<!--]--></span><!--]--><strong>（分形噪声）</strong>：将多层PerlinNoise或SimplexNoise叠加，生成复杂效果，适用于高细 节地形、云层、火焰等效果</li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Worley Noise<!--]--></span><!--]--><strong>（沃利噪音）</strong>：生成类似“细胞”的纹理，适用于模拟裂纹或有机表面 等等</li></ol><h4 id="_3-如何在unity中使用噪声" tabindex="-1">3. 如何在Unity中使用噪声 <a class="header-anchor" href="#_3-如何在unity中使用噪声" aria-label="Permalink to &quot;3. 如何在Unity中使用噪声&quot;">​</a></h4><ol><li><strong>使用一些第三方的噪声库，利用别人写好的内容直接来计算</strong></li><li><strong>根据噪声算法原理自己实现计算逻辑</strong></li><li><strong>使用Unity自带的噪声算法API，比如Mathf.PerlinNoise() （但是Unity提供的非常少）</strong></li><li><strong>使用Shader逻辑流程图插件（Shader Graph或ASE）中提供的噪声节点</strong></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->使用预生成的噪声纹理，通过材质或Shader对纹理进行采样<!--]--></span><!--]--></li></ol><h4 id="_4-噪声纹理是什么" tabindex="-1">4.噪声纹理是什么 <a class="header-anchor" href="#_4-噪声纹理是什么" aria-label="Permalink to &quot;4.噪声纹理是什么&quot;">​</a></h4><p>噪声纹理（Noise Texture）是一种常用于计算机图形学中的纹理类型</p><p>常用于模拟自然现象如云层、地形、火焰、岩石表面等等。</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->它本质上就是通过噪声算法生成的图像。<!--]--></span><!--]--><p><strong>它生成的核心原理是利用噪声函数计算每个纹理坐标的值，再将这些值映射为图像的像素值。</strong></p><p><strong>将噪声数据存储到图像中，直接采样拿来使用，而不是实时计算。</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->相当于是在用内存换性能！<!--]--></span><!--]--><p>提前将噪声数据计算好存在图片中，使用时从内存中的图片中取出数据，直接使用！</p><h4 id="_5-补充方法" tabindex="-1">5. 补充方法 <a class="header-anchor" href="#_5-补充方法" aria-label="Permalink to &quot;5. 补充方法&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> Mathf.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PerlinNoise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> x, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> y)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//该函数是 Unity 提供的一个用于生成 Perlin Noise 的函数，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//主要用于生成平滑、连续的伪随机值。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//它广泛应用于纹理生成、地形生成、动画和特效等需要平滑过渡的场景</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//传入的两个参数是二维坐标点，通常用于表示柏林噪声空间中的位置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//返回值为一个浮点数，范围为0~1之间</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//返回的噪声值具有连续性，即相邻输入值对应的输出值是平滑过渡的</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="九、消融效果" tabindex="-1">九、消融效果 <a class="header-anchor" href="#九、消融效果" aria-label="Permalink to &quot;九、消融效果&quot;">​</a></h3><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->消融效果是模拟物体逐渐从屏幕上消失或溶解的过程<!--]--></span><!--]--><p><strong>它通常利用<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->噪声纹理<!--]--></span><!--]-->实现，使物体按照某种规则逐渐透明或完全不可见。</strong></p><h4 id="_1-基本原理-8" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-8" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通过对比噪声纹理值与消融进度参数，剔除低于阈值的像素， 同时在边缘添加渐变颜色实现动态溶解效果。<!--]--></span><!--]--><ol><li><p><strong>如何剔除像素</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->clip(噪声纹理值 – 消融进度参数)<!--]--></span><!--]--><p>我们在片元着色器中对<strong>噪声纹理进行采样</strong>，由于噪声纹理是灰度图，只需</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->取出其中的RGB中的任意一通道的颜色来使用。<!--]--></span><!--]--><p>再<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->自定义一个用于控制消融进度的参数<!--]--></span><!--]-->（0~1）</p><p>最后利用该片元的噪声纹理值– 进度参数 若小于0则不渲染该片元，通过控制进度参数 便可以控制消融程度了</p></li><li><p><strong>如何处理边缘</strong></p><p>在处理边缘渐变颜色效果时，我们将使用Unity中内置的三个Shader函数：</p><ol><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->smoothstep(a, b, x)<!--]--></span><!--]--><p><strong>a起始值；b结束值；x输入值（用于在a和b之间平滑插值） 当xb时，返回1； a &lt; x &lt; b时，返回0~1之间的值</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**lerp(a,b,t)** <!--]--></span><!--]--><p><strong>a起始值；b结束值；t插值因子 当t=0时，返回a；当t=1时，返回b；当0 &lt; t &lt; 1时；返回a和b之间的值</strong></p></li><li><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**step(value, x)** <!--]--></span><!--]--><p><strong>value阈值，x输入值；两值用于比较 x &lt; value，返回0；x&gt;=value，返回1</strong></p></li></ol><p>首先我们利用smoothstep函数决定边缘颜色，我们利用 噪声颜色值– 消融进度值得到一个剔除阈值value 然后自定义一个边缘范围值_Range，然后用smoothstep函数来得到一个值</p><p>接着，我们在原本的颜色和渐变颜色之间进行插值，决定使用哪个颜色</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用smoothstep结合消融阈值来决定在渐变纹理中采用的渐变颜色<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->利用lerp来决定在原始颜色和边缘渐变颜色中使用哪个颜色<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->**利用自定义参数来决定边缘范围** <!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->从而实现消融边缘渐变色<!--]--></span><!--]--></li></ol><h4 id="_2-具体实现-5" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现-5" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.添加属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  _Noise 噪声纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  _Gradient 渐变纹理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  _Dissolve 消融进度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  _Range 边缘范围</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  添加属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.结构体 加入一个噪声纹理uv</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-1:剔除效果制作</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      从噪声纹理中采样，利用clip函数进行剔除</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  3-2:边缘渐变采样，范围控制，颜色插值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      利用smoothstep函数计算出采样系数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      利用lerp函数决定是用哪个颜色</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson124_Dissolve"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">     Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _SpecularNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"SpecularNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 18</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //噪声纹理 用于决定消融效果范围</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Noise"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //渐变纹理 用于决定边缘颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Gradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Gradient"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //消融进度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Dissolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Dissolve"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //消融边界宽窄</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _EdgeRange</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"EdgeRange"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fwdbase</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "AutoLight.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvTex:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float2 uvBump:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们可以单独的声明两个float2的成员用于记录 颜色和法线纹理的uv坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //也可以直接声明一个float4的成员 xy用于记录颜色纹理的uv，zw用于记录法线纹理的uv</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //噪声纹理uv 用于之后计算偏移缩放</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uvNoise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //光的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">lightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //视角的方向 相对于切线空间下的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">viewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD3;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float3 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD4;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//颜色纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//凹凸程度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _SpecularColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//高光颜色</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularNum;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//光泽度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//噪声纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Noise_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Gradient</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//噪声纹理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Dissolve;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//消融进度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _EdgeRange;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//消融边界宽窄范围</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_full</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把模型空间下的顶点转到裁剪空间下</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算噪声纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uvNoise </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Noise_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Noise_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //在顶点着色器当中 得到 模型空间到切线空间的 转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //切线、副切线、法线</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> binormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转换矩阵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3x3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> rotation</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3x3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">( v.tangent.xyz,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              binormal,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                                              v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的光的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.lightDir = ObjSpaceLightDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以模型空间到切线空间的转换矩阵 就可以得到切线空间下的 光的方向了</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.lightDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceLightDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //模型空间下的视角的方向</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //data.viewDir = ObjSpaceViewDir(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.viewDir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(rotation, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ObjSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.worldPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //剔除——消融</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> noiseColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Noise, i.uvNoise.xy).rgb;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Dissolve </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> ?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> noiseColor.r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Dissolve);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> packedNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tangentNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(packedNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //乘以凹凸程度的系数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpScale;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                tangentNormal.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sqrt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal.xy, tangentNormal.xy)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //接下来就来处理 带颜色纹理的 布林方光照模型计算</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //颜色纹理和漫反射颜色的 叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> albedo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv.xy) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //兰伯特</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir)));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //半角向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> halfA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.viewDir) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.lightDir));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //高光反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> specularColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _LightColor0.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _SpecularColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(tangentNormal, halfA)), _SpecularNum);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //强度计算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_LIGHT_ATTENUATION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(atten, i, i.worldPos);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //布林方</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> UNITY_LIGHTMODEL_AMBIENT.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> lambertColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">atten </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> specularColor;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们需要在模型本来的颜色 和 消融边缘的颜色之间去进行选择</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //渐变颜色的采样</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> value = 1 - smoothstep(0, _EdgeRange, noiseColor.r - _Dissolve);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> gradientColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Gradient, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">fixed2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(value, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)).rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //最终颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //当消融进度为0时 一定要让颜色使用我们的模型本来的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> finalColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color, gradientColor, value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.000001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, _Dissolve));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(finalColor.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //该注释主要用于进行阴影投影 主要是用来计算阴影映射纹理的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "ShadowCaster"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //  该编译指令时告诉Unity编译器生成多个着色器变体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //  用于支持不同类型的阴影（SM，SSSM等等）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //  可以确保着色器能够在所有可能的阴影投射模式下正确渲染</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_shadowcaster</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //  其中包含了关键的阴影计算相关的宏</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //噪声纹理uv 用于之后计算偏移缩放</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uvNoise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点到片元着色器阴影投射结构体数据宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这个宏定义了一些标准的成员变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这些变量用于在阴影投射路径中传递顶点数据到片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们主要在结构体中使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                V2F_SHADOW_CASTER;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//噪声纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Noise_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Dissolve;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//消融进度</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算噪声纹理的缩放偏移</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                data.uvNoise </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Noise_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Noise_ST.zw;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //转移阴影投射器法线偏移宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用于在顶点着色器中计算和传递阴影投射所需的变量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //主要做了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2-2-1.将对象空间的顶点位置转换为裁剪空间的位置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2-2-2.考虑法线偏移，以减轻阴影失真问题，尤其是在处理自阴影时</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2-2-3.传递顶点的投影空间位置，用于后续的阴影计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们主要在顶点着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                TRANSFER_SHADOW_CASTER_NORMALOFFSET</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(data);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //剔除——消融</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> noiseColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Noise, i.uvNoise.xy).rgb;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Dissolve </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> ?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> noiseColor.r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Dissolve);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //阴影投射片元宏</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将深度值写入到阴影映射纹理中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们主要在片元着色器中使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                SHADOW_CASTER_FRAGMENT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="十、水波效果" tabindex="-1">十、水波效果 <a class="header-anchor" href="#十、水波效果" aria-label="Permalink to &quot;十、水波效果&quot;">​</a></h3><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->水波效果指在计算机图形学中模拟水面波纹的视觉效果<!--]--></span><!--]--><h4 id="_1-基本原理-9" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-9" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->水波效果可以基于我们之前实现的带法线纹理的玻璃效果进行修改 通过添加噪声法线纹理结合Shader内置时间变量实现水波动态效果 加入菲涅耳计算公式实现水面的光学特性<!--]--></span><!--]--><ol><li><p><strong>噪声纹理的使用</strong></p><p>我们可以利用<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->沃利噪声(细胞噪声)<!--]--></span><!--]-->生成的噪声纹理灰度图</p><p>在Unity中将该噪声纹理灰度图作为高度图使用</p><p>用它代表水面的法线信息，只需要在Unity中将该灰度图设置为</p><p><strong>Normal map</strong>，并勾选<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Create from Grayscale<!--]--></span><!--]-->后应用即可</p></li><li><p><strong>动态效果的实现</strong></p><p>自定义两个属性，代表水平面x和y轴的速度。在片元着色器中利用</p><p>Shader内置时间参数_Time.y 得到累积速度变化。然后用该速度变量</p><p>从噪声法线纹理中进行两次采样，再讲两次采样的结果相加得到扰动后 的法线，最后用该法线处理<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->折射、反射、菲涅耳效果<!--]--></span><!--]--></p><p>这样看起来就会有动态效果了</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->该算法是图形学前辈们总结的高效的模拟流动感的算法，水波、火焰、玻璃折射都可以用<!--]--></span><!--]--></li><li><p>菲涅耳公式的运用</p><p>我们只需要将之前学习过的菲涅耳近似公式在最后的颜色计算中进行运用</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->便可以让水面呈现出菲涅耳现象效果<!--]--></span><!--]--></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/shader实践/水波.png" loading="lazy"></div><h4 id="_2-具体实现-6" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现-6" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.属性相关</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  1-1.添加用于控制动态效果的x和y轴方向的速度属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      _WaveXSpeed、_WaveXSpeed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  1-2.将玻璃种的折射属性删除，改为之后菲涅耳效果会用到的反射率</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      删除_RefractAmount，添加_FresnelScale</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  修改对应的属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.修改片元着色器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-1.将原来的法线相关采样 修改为扰动算法（对噪声法线纹理进行 + - 偏移采样，采样后叠加单位化）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-2.修改折射相关计算，将对应法线换为新发现</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-3.修改反射相关计算，世界空间下法线用扰动后发现进行计算，使用它计算反射相关内容</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  2-4.处理菲涅耳效应，复制Lesson79_FresnelBase中菲涅耳近似公式，用计算出来的系数处理最终的折射和反射相关内容</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson125_WaterWave"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //主纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"MainTex"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //立方体纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Cubemap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Cube) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //控制折射扭曲程度的变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Distortion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Distortion"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //控制水波水平和竖直速度偏移的属性</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _WaveXSpeed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"WaveXSpeed"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.01</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _WaveYSpeed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"WaveYSpeed"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.01</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //之后用于计算菲涅耳效果的系数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FresnelScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FresnelScale"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //将渲染队列改为透明的 目的是让玻璃对象 滞后渲染</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //能够捕获到之前正确的屏幕图像</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //使用它来捕获当前屏幕内容 并存储到默认的渲染纹理变量中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        GrabPass{}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            Tags{</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"LightMode"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"ForwardBase"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "Lighting.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//法线纹理的缩放和平移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            samplerCUBE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Cube</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //GrabPass默认存储的纹理变量 这个是规则</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _GrabTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Distortion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WaveXSpeed;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WaveYSpeed;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FresnelScale</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">pos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:SV_POSITION;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//裁剪空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用于存储从屏幕图像中采样的坐标（顶点相对于屏幕的位置）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">grabPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //用于在颜色纹理中采样的UV坐标</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下的反射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们将把反射向量的计算放在顶点着色器函数中 节约性能 表现效果也不会太差 肉眼几乎分辨不出来</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 worldRefl:TEXCOORD2;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //代表我们切线空间到世界空间的 变换矩阵的3行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TtoW0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD3;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TtoW1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD4;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">TtoW2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD5;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_full</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点坐标转换</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.pos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //屏幕坐标转换相关的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.grabPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> ComputeGrabScreenPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o.pos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //uv坐标计算相关的内容</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _MainTex_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //法线纹理的uv坐标计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _BumpMap_ST.zw;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算反射光向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //1.计算世界空间下法线向量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.normal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //2.世界空间下的顶点坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, v.vertex).xyz;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                ////3.计算视角方向 内部是用摄像机位置 - 世界坐标位置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //fixed3 worldViewDir = UnityWorldSpaceViewDir(worldPos);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                ////4.计算反射向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //o.worldRefl = reflect(-worldViewDir, worldNormal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下切线</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldTangent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToWorldDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.tangent);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算副切线 计算叉乘结果后 垂直与切线和法线的向量有两条 通过乘以 切线当中的w，就可以确定是哪一条</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldBinormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> cross</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.tangent.w;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.TtoW0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent.x, worldBinormal.x,  worldNormal.x, worldPos.x);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.TtoW1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent.y, worldBinormal.y,  worldNormal.y, worldPos.y);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.TtoW2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldTangent.z, worldBinormal.z,  worldNormal.z, worldPos.z);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">):SV_TARGET</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //世界空间下视角方向</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW0.w, i.TtoW1.w, i.TtoW2.w);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> viewDir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">UnityWorldSpaceViewDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldPos));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                ////通过纹理采样函数 取出法线纹理贴图当中的数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float4 packedNormal = tex2D(_BumpMap, i.uv.zw);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                ////将我们取出来的法线数据 进行逆运算并且可能会进行解压缩的运算，最终得到切线空间下的法线数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 tangentNormal = UnpackNormal(packedNormal);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //加入的一个水波移动速度的感觉</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //这个是图形学前辈们总结的一套简单的扰动算法 可以让水波、火焰、玻璃折射等 出现扰动感（动态感）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> speed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Time.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_WaveXSpeed, _WaveYSpeed);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> bump1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> speed)).rgb;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> bump2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, i.uv.zw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> speed)).rgb;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> bump</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(bump1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> bump2);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //把计算完毕后的切线空间下的法线转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3x3 rotation = float3x3(i.TtoW0.xyz, i.TtoW1.xyz, i.TtoW2.xyz );</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //float3 worldNormal = mul(rotation, bump);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //本质 就是在进行矩阵运算</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldNormal</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW0.xyz, bump), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW1.xyz, bump), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.TtoW2.xyz, bump));</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //反射颜色相关的计算 会叠加主纹理颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对颜色纹理进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mainTex</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> speed);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //我们需要在这里计算反射向量 因为这时才把法线纹理中的法线信息 算出来</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> refl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">viewDir, worldNormal);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //将反射颜色和主纹理颜色进行叠加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reflColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texCUBE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Cube, refl) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> mainTex;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //折射相关的颜色</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //其实就是从我们抓取的 屏幕渲染纹理中进行采样 参与计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //抓取纹理中的颜色信息 相当于是这个玻璃对象后面的颜色</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //想要有折射效果 可以在采样之前 进行xy屏幕坐标的偏移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> bump.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Distortion;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //xy偏移一个位置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                i.grabPos.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">i.grabPos.z </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.grabPos.xy;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用透视除法 将屏幕坐标转换到 0~1范围内 然后再进行采样</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> screenUV</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.grabPos.xy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.grabPos.w;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //从捕获的渲染纹理中进行采样 获取后面的颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> grabColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_GrabTexture, screenUV);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用schlick菲涅耳近似等式 计算菲涅耳反射率</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> fresnel = _FresnelScale + (1-_FresnelScale) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">dot</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(viewDir), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">normalize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(worldNormal)), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> reflColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">fresnel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> grabColor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">fresnel);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="十一、噪声雾效" tabindex="-1">十一、噪声雾效 <a class="header-anchor" href="#十一、噪声雾效" aria-label="Permalink to &quot;十一、噪声雾效&quot;">​</a></h3><h4 id="_1-基本原理-10" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-10" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->噪声雾效可以基于我们之前实现的屏幕后处理效果的全局雾效进行修改<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通过添加噪声纹理结合Shader内置时间变量实现雾的不均匀以及动态效果<!--]--></span><!--]--><ol><li><p><strong>不均匀效果的实现</strong></p><p>我们可以利用柏林噪声算法生成的噪声纹理灰度图来制作不均匀感。</p><p><strong>从灰度图中采样得到0~1范围的值，再通过减去0.5的方式将其区间变为-0.5~0.5之间，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->并用这个系数参与最后的雾的混合因子计算中，从而 让均匀的雾变得不均匀。<!--]--></span><!--]--></strong></p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/shader实践/噪声雾效.png" loading="lazy"></div></li><li><p><strong>动态效果的实现</strong></p><p>类似水波效果，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->自定义x轴和y轴的两个速度变量。<!--]--></span><!--]--></p><p>利用Shader内置时间参数<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[--><strong>_Time.y</strong><!--]--></span><!--]-->得到累积变化。</p><p>用该速度变量从噪声纹理中偏移采样，从而达到动态效果。</p></li></ol><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/shader实践/噪声雾效2.png" loading="lazy"></div><h4 id="_2-具体实现-7" tabindex="-1">2. 具体实现 <a class="header-anchor" href="#_2-具体实现-7" aria-label="Permalink to &quot;2. 具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.打开 Lesson109场景</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.新建Shader Lesson126_NoiseFog 删除相关代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.复制屏幕后处理效果的全局雾效 Lesson113_FogWithDepthTexture</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.修改Shader代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-1.属性添加</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      噪声纹理 _Noise</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      噪声值偏移系数 _NoiseAmount</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      X、Y轴移动速度 _FogXSpeed, FogYSpeed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//      属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-2.速度计算，噪声纹理偏移采样，0~1 转 -0.5~0.5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  4-3.参与雾混合因子计算</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson126_NoiseFog"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogColor"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogDensity</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogDensity"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogStart"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogEnd"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //决定不均匀效果的噪声纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Noise"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //噪声系数 控制 偏移范围的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _NoiseAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"NoiseAmount"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //用于控制动态移动速度的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogXSpeed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogXSpeed"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _FogYSpeed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"FogYSpeed"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZTest Always</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Cull Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //深度纹理UV</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv_depth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点射线 指向四个角的方向向量 （传递到片元时 会自动进行插值 运算）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">ray</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:TEXCOORD2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //纹素 用来判断翻转会使用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            half4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_TexelSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //深度纹理</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _CameraDepthTexture</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //雾相关的属性</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogColor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FogDensity;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogStart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //矩阵相关 里面存储了 4条射线向量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //0-左下 1-右下 2-右上 3-左上</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4x4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _RayMatrix</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Noise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _NoiseAmount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogXSpeed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _FogYSpeed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata_base</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv_depth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //顶点着色器函数 每一个顶点都会执行一次</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //对于屏幕后处理来说 就会执行4次 因为有4个顶点 （4个角）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //通过uv坐标判断 当前的顶点位置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> index</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.texcoord.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.texcoord.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //判断 是否需要进行纹理翻转 如果翻转了 深度的uv和对应顶点需要变化</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UNITY_UV_STARTS_AT_TOP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex_TexelSize.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    o.uv_depth.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o.uv_depth.y;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    index </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> -</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> index;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //根据顶点的位置 决定使用那一个射线向量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.ray </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _RayMatrix[index];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //观察空间下 离摄像机的实际距离（Z分量）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> linearDepth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> LinearEyeDepth</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SAMPLE_DEPTH_TEXTURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_CameraDepthTexture,i.uv_depth));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //计算世界空间下 像素的坐标</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WorldSpaceCameraPos </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> linearDepth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> i.ray;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //噪声纹理采样以及偏移</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> speed</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Time.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> float2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_FogXSpeed, _FogYSpeed);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //噪声纹理中采样 采样出来的结果是0~1 我们需要将其转为 -0.5~0.5 然后还可以通过自定义系数控制这个正负范围</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> noise</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> ( </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Noise, i.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> speed).r </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">_NoiseAmount;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //雾相关的计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //混合因子</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (_FogEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> worldPos.y)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_FogEnd </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FogStart);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //取0~1之间 超过会取极值</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //之所以乘以1 + noise，是为了在正常计算出来的混合因子中去进行 上下的扰动</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> saturate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _FogDensity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> noise));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //利用插值 在两个颜色之间进行融合</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> color</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> lerp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv).rgb, _FogColor.rgb, f);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(color.rgb, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Fallback Off</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="shadergui类" tabindex="-1">ShaderGUI类 <a class="header-anchor" href="#shadergui类" aria-label="Permalink to &quot;ShaderGUI类&quot;">​</a></h2><h3 id="一、shadergui类" tabindex="-1">一、ShaderGUI类 <a class="header-anchor" href="#一、shadergui类" aria-label="Permalink to &quot;一、ShaderGUI类&quot;">​</a></h3><blockquote><p>ShaderGUI类是什么</p></blockquote><p>它是一个用于自定义材质 Inspector 界面 的基类 通过继承 ShaderGUI，你可以完全控制材质编辑界面的布局和功能 而不仅仅局限于 Shader 的 属性(Properties) 语句块定义的默认行为</p><p>ShaderGUI可以让我们： <strong>1.自定义材质界面布局</strong><strong>2.通过脚本逻辑，可以基于某些属性值动态隐藏或禁用其他属性</strong><strong>3.添加高级功能，比如通过添加按钮控件，触发某些操作，如实时更新材质预览，显示调试信息等</strong><strong>4.增强材质编辑体验，使美术人员或其他开发者无需关心底层Shader实现，而是通过友好的界面快速调整材质</strong><strong>等等</strong></p><blockquote><p>基本使用</p></blockquote><ol><li><p><strong>自定义C#脚本继承ShaderGUI</strong></p></li><li><p><strong>重写OnGUI方法</strong></p></li><li><p><strong>在OnGUI方法中书写自定义布局逻辑</strong></p></li><li><p><strong>在Shader语句块最后加入 CustomEditor "自定义C#脚本名"</strong></p></li></ol><blockquote><p>自定义材质面板</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//使用ShaderGUI自定义材质面板的核心方法就是我们重写的</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnGUI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MaterialEditor</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> materialEditor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MaterialProperty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) 方法</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//其中两个参数非常重要：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">1.materialEditor:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//提供与材质交互的接口，比如材质属性值等</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//关键属性：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">target</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//可以利用它获取到材质球</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//关键方法：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">ShaderProperty(MaterialProperty对象, "名字")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//可以将属性设置为对应名字，并且用默认GUI显示</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">2.properties:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//包含所有在Shader的属性语句块中定义的属性</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//关键属性：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">displayName</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//获取属性名</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//其他：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">MaterialProperty 属性对象 = FindProperty("属性名", properties)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以利用FindProperty方法，获取到对应属性对象</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="二、materialpropertydrawer类" tabindex="-1">二、MaterialPropertyDrawer类 <a class="header-anchor" href="#二、materialpropertydrawer类" aria-label="Permalink to &quot;二、MaterialPropertyDrawer类&quot;">​</a></h3><p><strong>MaterialPropertyDrawer(材质属性绘制器)</strong> 用于<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->自定义材质 属性 在 材质面板中的显示和交互方式<!--]--></span><!--]-->的 材质属性通常在Shader中通过 属性语句块 定义。 默认情况下，Unity提供了一些基础的控件（如滑块、颜色选择器等） <strong>通过继承 MaterialPropertyDrawer(材质属性绘制器)</strong><strong>你可以为自定义Shader属性创建更加灵活和直观的控件</strong></p><blockquote><p>它和ShaderGUI的区别</p></blockquote><p><strong>ShaderGUI是用来<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->自定义整个材质面板的<!--]--></span><!--]--></strong> 而<strong>MaterialPropertyDrawer(材质属性绘制器) 是<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用来自定义某一个属性的<!--]--></span><!--]--></strong> 相当于可以更加精细的来进行属性自定义显示封装</p><blockquote><p>例子</p></blockquote><p><strong>MaterialPropertyDrawer(材质属性绘制器) 继承自MaterialPropertyDrawer类</strong></p><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> System</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Collections</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Generic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEditor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">using</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson128_MaterialPropertyDrawer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MaterialPropertyDrawer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //构造函数一般是用来初始化我们自定义的一些变量的</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lesson128_MaterialPropertyDrawer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.min </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> min;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.max </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> max;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> override</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> OnGUI</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Rect</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> position</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MaterialProperty</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> prop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">string</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> label</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">MaterialEditor</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> editor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //base.OnGUI(position, prop, label, editor);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(prop.type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> MaterialProperty.PropType.Float )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            EditorGUILayout.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">LabelField</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(label, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"请使用float或者数值 不然无法使用该控件"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        prop.floatValue </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> EditorGUILayout.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Slider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(label, prop.floatValue, min, max);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="三、shader变体和关键字" tabindex="-1">三、Shader变体和关键字 <a class="header-anchor" href="#三、shader变体和关键字" aria-label="Permalink to &quot;三、Shader变体和关键字&quot;">​</a></h3><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->Shader Variant（变体）指的是一个Shader的特定配置<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->通过不同的关键字（Keywords）和 设置组合 来实现不同的效果<!--]--></span><!--]--><p>每一种关键字组合或设置都会生成一个独立的Shader变体 最终以二进制形式存储在构建文件中供运行时使用</p><p>Shader变体就是<strong>基于一个Shader文件当中的代码，编译生成多个版本的Shader</strong> 它<strong>基于关键字来生成各种不同的版本</strong></p><p>举例说明</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->一个Shader中有n个关键字<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->每个关键字有两种状态（启用或禁用）<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->最终生成的变体数量为n²<!--]--></span><!--]--><p><strong>变体 1：没有启用任何关键字（默认）。</strong><strong>变体 2：启用了 关键字1。</strong><strong>变体 3：启用了 关键字2。</strong><strong>变体 4：同时启用了 关键字1 和 关键字2</strong> 运行时，Unity会根据具体设置选择与之匹配的变体来使用</p><p>Unity的一些内置功能会隐式的生成变体</p><h4 id="_1-局部shader关键字" tabindex="-1">1. 局部Shader关键字 <a class="header-anchor" href="#_1-局部shader关键字" aria-label="Permalink to &quot;1. 局部Shader关键字&quot;">​</a></h4><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.声明：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">声明局部关键字有两种方式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma shader_feature 或 #pragma multi_compile 来声明关键词</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.#pragma shader_feature 关键词1 关键词2 关键词3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">该编译指令声明的关键字，只有关键词启用时才会生成对应Shader变体</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.#pragma multi_compile 关键词1 关键词2 关键词3</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">作用：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">该编译指令声明的关键字，不管是否启用都会生成对应Shader变体</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">关键词命名规则</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">通常使用大写字母和下划线分隔</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_大写单词_大写单词</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">比如：_Test_Keyword</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">两种声明方式的区别：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">主要区别在于 生成Shader变体的数量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">shader_feature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">编译更快，Shader文件更小，适用开关功能较少的场景</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">multi_compile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">编译更长，Shader文件更大，适用需要完整覆盖的功能</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">.使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">关键字使用规则：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">利用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">关键词名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">关键词名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">....</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">配合使用，判断关键词启用时处理什么逻辑</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h4 id="_2-shader中利用c-代码启用和禁用关键字" tabindex="-1">2. Shader中利用C#代码启用和禁用关键字 <a class="header-anchor" href="#_2-shader中利用c-代码启用和禁用关键字" aria-label="Permalink to &quot;2. Shader中利用C#代码启用和禁用关键字&quot;">​</a></h4><p>Unity Shader中的关键字是一种用于控制Shader变体的机制 允许我们通过启用或者禁用特定功能来动态调整Shader的行为</p><p>Shader中的关键字可以分为2种</p><ol><li><p><strong>全局关键字</strong> Unity自带的关键字，所有Shader中共享 可以在C#代码中通过 <strong>Shader.EnableKeyword("全局关键字名")</strong><strong>Shader.DisableKeyword("全局关键字名")</strong> 来控制关键字的启用和禁用</p></li><li><p><strong>局部关键字</strong> 只在特定的Shader中有效，不会影响其他Shader Unity更推荐使用局部关键字以减少关键字冲突问题 可以在C#代码中通过 <strong>材质球.EnableKeyword("局部关键字名")</strong><strong>材质球.DisableKeyword("局部关键字名")</strong> 来控制关键字的启用和禁用</p></li></ol><h4 id="_3-变体和条件分支的区别" tabindex="-1">3. 变体和条件分支的区别 <a class="header-anchor" href="#_3-变体和条件分支的区别" aria-label="Permalink to &quot;3. 变体和条件分支的区别&quot;">​</a></h4><p>条件分支语句会带来逻辑上执行的开销 虽然运行时直接判断但是会带来对性能的影响</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->变体<!--]--></span><!--]-->虽然<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->会增加编译时间并占用更多的内容<!--]--></span><!--]--><p><strong>但是它的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->性能高，灵活性强<!--]--></span><!--]--></strong></p><p><strong>在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->静态<!--]--></span><!--]-->功能<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->选择时变体更优<!--]--></span><!--]--></strong><strong>在<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->动态<!--]--></span><!--]-->功能<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->选择时条件分支语句<!--]--></span><!--]-->更适合</strong></p><hr><h3 id="四、toggledrawer类" tabindex="-1">四、ToggleDrawer类 <a class="header-anchor" href="#四、toggledrawer类" aria-label="Permalink to &quot;四、ToggleDrawer类&quot;">​</a></h3><p><strong>作用：</strong> 将float数据以开关的形式在材质属性面板上显示</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->数值只能设置为0或1, 0为关闭, 1为开启<!--]--></span><!--]--><p>使用场景：</p><ol><li><strong>开启或关闭某个特效（比如是否启用边缘）</strong></li><li><strong>切换某些功能（比如是否使用纹理颜色）</strong></li><li><strong>控制条件分支逻辑</strong> 等等</li></ol><p>用法： <strong>在属性语句块中声明属性时</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->在属性前加上`[Toggle]`或`[Toggle(自定义名称)]`<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`[Toggle]_属性名("属性名", Float) = 0或1`<!--]--></span><!--]--><blockquote><p>ToggleDrawer关联关键字</p></blockquote><p><strong>ToggleDrawer可以和关键字编译指令结合使用</strong><strong>达到在材质面板中通过Toggle禁用启用关键字的效果</strong> 从而切换功能或者特效等 它可以让开发者在材质球的Inspector窗口中通过简单的复选框启用或者禁用关键字</p><p>使用方式：</p><ol><li><p><strong>ToggleDrawer和关键词绑定</strong> 当我们使用Toggle定义一个Float属性时 Unity会自动根据属性值设置全局关键词 举例： <strong><code>[Toggle]</code>_ShowTex("ShowTex", Float) = 0或1</strong><strong>默认生成的全局关键词为 _SHOWTEX_ON（勾选时为1时激活）</strong><strong>我们也可以利用Toggle自定义关键词名<code>[Toggle(自定义关键词名)]</code></strong></p></li><li><p><strong>关键词连接</strong> 可以使用</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->#pragma shader_feature 或 #pragma multi_compile 来关联关键词<!--]--></span><!--]--><p>当我们在材质面板切换Toggle时，Unity会启用或禁用对应的关键词，触发对应的Shader变体</p></li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->注意：编译指令必须与ToggleDrawer的关键词一致，才能正确切换功能<!--]--></span><!--]--><h3 id="五、enumdrawer和keywordenumdrawer" tabindex="-1">五、EnumDrawer和KeywordEnumDrawer <a class="header-anchor" href="#五、enumdrawer和keywordenumdrawer" aria-label="Permalink to &quot;五、EnumDrawer和KeywordEnumDrawer&quot;">​</a></h3><blockquote><p>EnumDrawer的使用</p></blockquote><p><strong>作用：</strong> EnumDrawer是Unity自带的继承自MaterialPropertyDrawer(材质属性绘制器) 的类 使用它修饰属性，<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->可以让该属性在Inspector窗口中显示一个下拉列表<!--]--></span><!--]-->，供用户选择</p><p><strong>使用方式：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`[Enum(显示名1, 值1, 显示名2, 值2, ...)]`属性名("显示名称", Float) = 默认值<!--]--></span><!--]--><blockquote><p>KeywordEnumDrawer的使用</p></blockquote><p><strong>作用：</strong> KeywordEnumDrawer同样是Unity自带的继承自MaterialPropertyDrawer(材质属性绘制器) 的类</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->主要使用它和关键词建立联系<!--]--></span><!--]--><p><strong>使用方式：</strong><strong><code>[KeywordEnum(显示名1, 显示名2 ...)]</code>属性名("显示名称", Float) = 0</strong> 当我们使用它是，会自动生成对应关键字 _属性名_显示名1、_属性名_显示名2 …</p><blockquote><p>例子</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson131"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //[Enum(Tex, 0, Red, 1, Green, 2, Blue, 3)]_TestEnum("TestEnum", Float) = 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //默认存在关键字</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //_KEYWORDTESTENUM_TEX</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //_KEYWORDTESTENUM_RED</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //_KEYWORDTESTENUM_GREEN</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //_KEYWORDTESTENUM_BLUE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">KeywordEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(Tex, Red, Green, Blue)]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_KeywordTestEnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"KeywordTestEnum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        LOD </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            // make fog work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fog</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma shader_feature _KEYWORDTESTENUM_TEX _KEYWORDTESTENUM_RED _KEYWORDTESTENUM_GREEN _KEYWORDTESTENUM_BLUE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct appdata</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_FOG_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _TestEnum;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.uv, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_TRANSFER_FOG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o,o.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // sample the texture</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> col</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //if(_TestEnum == 0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    col = tex2D(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //else if(_TestEnum == 1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    col = fixed4(1,0,0,1);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //else if(_TestEnum == 2)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    col = fixed4(0,1,0,1);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //else if(_TestEnum == 3)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                //    col = fixed4(0,0,1,1);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_KEYWORDTESTENUM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    col </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_KEYWORDTESTENUM_RED</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    col </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_KEYWORDTESTENUM_GREEN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    col </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> defined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_KEYWORDTESTENUM_BLUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    col </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                    col </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                #</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // apply fog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_APPLY_FOG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.fogCoord, col);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="六、powersliderdrawer和intrangedrawer" tabindex="-1">六、PowerSliderDrawer和IntRangeDrawer <a class="header-anchor" href="#六、powersliderdrawer和intrangedrawer" aria-label="Permalink to &quot;六、PowerSliderDrawer和IntRangeDrawer&quot;">​</a></h3><blockquote><p>PowerSliderDrawer的使用</p></blockquote><p><strong>作用：</strong> PowerSliderDrawer是Unity自带的继承自MaterialPropertyDrawer(材质属性绘制器) 的类</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->使用它修饰属性，可以让该属性在Inspector窗口中显示为一个指数滑块<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->相比普通的线性滑块，它可以更方便的调整那些变化范围较大、非线性分布的参数<!--]--></span><!--]--><p>比如 <strong>当属性的值范围较大，但其效果对某些特定范围特别敏感时，可以通过 PowerSlider 进行更直观的调整</strong></p><p>它和普通滑块属性的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->区别<!--]--></span><!--]-->是： <strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->普通滑块属性<!--]--></span><!--]-->默认是线性分布，即滑块的位置与参数值成正比</strong><strong><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->PowerSlider<!--]--></span><!--]--> 提供了 非线性映射，适合用在参数值对效果影响不均匀的场景</strong> 我们可以用该类修饰</p><ol><li><strong>光照强度</strong>： 调整光的强弱（低强度变化显著，高强度变化较平滑）。</li><li><strong>对比度</strong>： 调整图像的对比效果。</li><li><strong>模糊程度</strong>： 调整模糊范围，尤其是高斯模糊。 等等</li></ol><p><strong>使用方式：</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->`[PowerSlider(指数)] 属性名 ("显示名称", Range(最小值,最大值)) = 默认值`<!--]--></span><!--]--><p><strong>对应的函数曲线为</strong><strong>y = x的指数次方</strong><strong>x为滑块所在位置</strong><strong>y为属性的数值</strong></p><blockquote><p>IntRangeDrawer的使用</p></blockquote><p>作用： IntRangeDrawer同样是Unity自带的继承自MaterialPropertyDrawer(材质属性绘制器) 的类</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->使用它修饰属性，可以让该属性在Inspector窗口中显示为一个整数范围滑块<!--]--></span><!--]--><p>使用方式： <strong><code>[IntRange]</code> 属性名 ("显示名称", Range(最小值,最大值)) = 默认值</strong></p><blockquote><p>例子</p></blockquote><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Unlit/Lesson132"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Texture"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">PowerSlider</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_TestNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"TestNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        [IntRange]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">_TestIntNum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"TestIntNum"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        LOD </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma vertex vert</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma fragment frag</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            // make fog work</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #pragma multi_compile_fog</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            #include "UnityCG.cginc"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct appdata</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            struct v2f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float2 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">uv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : TEXCOORD0;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_FOG_COORDS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                float4 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vertex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> : SV_POSITION;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex_ST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">appdata</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> v</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.vertex </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnityObjectToClipPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.vertex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">                o.uv </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> TRANSFORM_TEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(v.uv, _MainTex);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_TRANSFER_FOG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(o,o.vertex);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> frag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">v2f</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> i</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) : SV_Target</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // sample the texture</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> col</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, i.uv);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">                // apply fog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">                UNITY_APPLY_FOG</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(i.fogCoord, col);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> col;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h3 id="七、属性的特性" tabindex="-1">七、属性的特性 <a class="header-anchor" href="#七、属性的特性" aria-label="Permalink to &quot;七、属性的特性&quot;">​</a></h3><p>所谓的属性的特性 <strong>就是在属性前加上一些类似特性的限制</strong><strong>让属性在Inspector窗口中进行 有限制的显示 或者 特殊的布局显示</strong></p><blockquote><p>常用的限制特性</p></blockquote><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">HideInInspector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//可以添加到 任意 属性前，是属性在材质面板上隐藏</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">NoScaleOffset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//添加到 2D纹理贴图 属性前，可以让其在材质面板上隐藏纹理Tiling和Offset选项</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//添加到 2D纹理贴图 属性前，可以检测关联的纹理贴图是否为法线贴图，如果不是法线，会弹出修复提示</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">HDR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//添加到 2D纹理贴图 或者 颜色 属性前，可以时属性开启高动态范围（HDR）效果，使数值突破1的限制</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//常用与自发光属性</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>常用的装饰性特性</p></blockquote><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Space</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] 或 [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Space</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(数值)]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//可以在某一个属性前添加一个空白行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//如果填入数值，可以添加对应行数的空白行</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Header</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(文本标题)]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//可以在材质属性面板上添加标题文字</span></span></code></pre><button class="code-block-unfold-btn"></button></div><hr><h2 id="帧调试器" tabindex="-1">帧调试器 <a class="header-anchor" href="#帧调试器" aria-label="Permalink to &quot;帧调试器&quot;">​</a></h2><blockquote><p>帧调试器的作用</p></blockquote><p>我们可以利用Unity自带的帧调试工具 看到游戏图像的某一帧是如何一步步渲染出来的 我们可以在 Window(窗口)——&gt;Analysis(分析)——&gt;Frame Debugger(帧调试) 中打开帧调试工具</p><p>帧调试器是一个非常强大的工具 特别是在渲染调试、优化和效果分析方面有着重要的意义 它可以帮助我们</p><ol><li><strong>精准调试渲染问题，可以逐步查看渲染调用</strong></li><li><strong>有助于优化性能，通过分析渲染调用，找出性能瓶颈并优化</strong></li><li><strong>有助于调试材质、纹理和着色器，可以查看渲染时使用的材质、纹理和参数、快速定位问题</strong></li><li><strong>可视化渲染过程，可以通过查看渲染目标和中间结果，深入了解渲染过程</strong></li></ol><hr><h2 id="表面着色器" tabindex="-1">表面着色器 <a class="header-anchor" href="#表面着色器" aria-label="Permalink to &quot;表面着色器&quot;">​</a></h2><h3 id="一、基本结构和原理" tabindex="-1">一、基本结构和原理 <a class="header-anchor" href="#一、基本结构和原理" aria-label="Permalink to &quot;一、基本结构和原理&quot;">​</a></h3><p>我们通过事例对比表面着色器和顶点/片元着色器的区别 最大区别就是 <strong>表面着色器中没有显示的Pass了</strong> 而其中最为关键的几个部分为：</p><ol><li><strong>编译指令</strong></li><li><strong>结构体</strong></li><li><strong>自定义函数</strong></li></ol><p><strong>当我们编写完表面着色器后，Unity会自动将其编译为顶点/片元着色器</strong><strong>会将光照处理、反射、折射、阴影、雾效等等相关计算代码自动加入</strong></p><h3 id="二、编译指令" tabindex="-1">二、编译指令 <a class="header-anchor" href="#二、编译指令" aria-label="Permalink to &quot;二、编译指令&quot;">​</a></h3><p>编译指令是表面着色器中用来和Unity沟通的重要方式</p><p>通过编译指令，我们可以告诉Unity需要让他做什么和不做什么</p><blockquote><p>编译指令 的基本构成</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma surface 表面函数名 光照模型 可选额外参数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">1.固定部分 #pragma surface</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">2.表面函数名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">3.光照模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">4.可选额外参数</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>第一部分 固定写法</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma surface 表面函数名 光照模型 可选额外参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma surface 是固定写法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">是用于指明该编译指令是用于表面着色器的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">在他后面我们必须填写表面函数和光照模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">还可以填写一些可选参数来控制表面着色器的行为</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>第二部分 表面函数名</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma surface 表面函数名 光照模型 可选额外参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">表面函数名可以随意取名，但是需要在后面的代码中有对应名字的函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">函数的参数有三种固定格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">1. void 表面函数名(Input IN, inout SurfaceOutput o)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">2. void 表面函数名(Input IN, inout SurfaceOutputStandard o)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">3. void 表面函数名(Input IN, inout SurfaceOutputStandardSpecular o)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">其中 Input 为输入结构体，其中可以得到各种表面属性</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">SurfaceOutput、SurfaceOutputStandard 和 SurfaceOutputStandardSpecular</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">是Unity内置的写好的用于输出的结构体，他们分别用于不同的工作流，可以配合不同的光照模型使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们之后就可以利用Input结构体中的数据进行计算，计算得到的结构赋值给输出结构体o中的成员</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">之后会自动传递给光照函数进行下一步计算（如果我们不自定义，Unity会自动生成计算代码）</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>第三部分 光照模型</p></blockquote><div class="language-tex"><button title="Copy code" class="copy"></button><span class="lang">tex</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma surface 表面函数名 光照模型 可选额外参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">光照模型是用来计算物体表面的光照效果的</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Unity内置了基于物理的光照模型函数 Standard 和 StandardSpecular</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">还有简单的非基于物理的光照模型函数 Lambert 和 BlinnPhong</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们可以直接填写他们来应用对应的光照计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">同样我们也可以自定义光照模型计算相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">只需要在代码中按照格式书写以下函数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">不依赖视角的光照模型，比如漫反射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">half4 Lighting自定义名字 (SurfaceOutput s, half3 lightDir, half atten)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">依赖视角的光照模型，比如高光反射</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">half4 Lighting自定义名字 (SurfaceOutput s, half3 lightDir, half3 viewDir, half atten)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">然后只需要在光照模型处填写 自定义名字 即可</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">就会自动调用函数中的逻辑来处理光照相关逻辑了</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>第四部分 可选额外参数</p></blockquote><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">#pragma surface 表面函数名 光照模型 可选额外参数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">中</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可选额外参数包含了很多非常有用的指令类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">我们着重提及几个可选参数：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.自定义顶点修改函数 vertex:顶点函数名</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 顶点函数名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> appdata_full</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.最终颜色修改函数 finalcolor:自定义最终颜色修改函数名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">void 自定义最终颜色修改函数名(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SurfaceOutput</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.阴影相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">addshadow 为一些进行了顶点动画、透明度测试的物体显示的进行阴影投射，避免通过FallBack无法准确处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">fullforwardshadows 在前向渲染路径中支持所有光源类型和阴影</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">noshadow 禁用阴影</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.透明相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">alphatest:变量名 利用它可以使用指定名字的变量来剔除不满足条件的片元</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.光照</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">noambient 不使用任何环境光和光照探针</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">novertexlights 不使用任何逐顶点光照</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">noforwardadd 去掉所有前向渲染中的额外pass，只会支持一个逐像素平行光，其他光源按照逐顶点huoSH来计算</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">nofog 关闭雾效处理</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">nolightmap 关闭光照烘焙处理</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.控制代码生成</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">默认情况下，表面着色器自动生成的代码包含前向渲染路径、延迟渲染路径使用的Pass</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">这会让Shader文件较大，如果我们明确表面着色器只会在某些渲染路径中使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">可以使用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">exclude_path:deferred(排除延迟渲染路径)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">exclude_path:forward（排除前向渲染路径）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">exclude_path:prepass（排除预通道渲染路径）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">来明确告诉Unity，不需要为某些渲染路径生成代码</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="三、输入结构体" tabindex="-1">三、输入结构体 <a class="header-anchor" href="#三、输入结构体" aria-label="Permalink to &quot;三、输入结构体&quot;">​</a></h3><p>Input结构体虽然是需要我们自己声明的结构体 但是我们只要在其中按照规定声明成员变量，便能获取到指定的表面属性 <strong>注意：</strong></p><ol><li><p><strong>如果我们在可选额外参数中自定义了顶点修改函数，该结构体还会是顶点修改函数的输出结构体</strong></p></li><li><p><strong>除了规范好的参数，我们还可以自己添加自定义参数，比如在自定义顶点修改函数中进行赋值</strong></p></li><li><p><strong>在顶点/片元着色器中，这些参数往往需要我们手动计算，而在表面着色器中你可以理解为Unity内部已经</strong> 帮助我们计算好了，直接拿来用即可</p></li></ol><h3 id="四、输出结构体" tabindex="-1">四、输出结构体 <a class="header-anchor" href="#四、输出结构体" aria-label="Permalink to &quot;四、输出结构体&quot;">​</a></h3><p>#pragma surface 表面函数名 光照模型 可选额外参数 其中在讲解表面函数名时提到，需要按规则声明函数 函数的参数有三种固定格式</p><ol><li><strong>void 表面函数名(Input IN, inout SurfaceOutput o)</strong></li><li><strong>void 表面函数名(Input IN, inout SurfaceOutputStandard o)</strong></li><li><strong>void 表面函数名(Input IN, inout SurfaceOutputStandardSpecular o)</strong> 而其中的<!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->SurfaceOutput、SurfaceOutputStandard、SurfaceOutputStandardSpecular<!--]--></span><!--]-->结构体 就是我们的<strong>输出结构体</strong></li></ol><p>我们可以利用输入结构体Input中的数据在表面函数中进行计算后 将计算结果赋值存储在输出结构体中 之后Unity会利用我们输出的数据作为光照模型函数的输入来进行各种光照相关的计算 这三个输出结构体是由Unity提前声明好的，不能自己增加和减少 如果我们没有对其中的某些变量赋值，会使用默认值</p><blockquote><p>输出结构体中有哪些成员</p></blockquote><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">	//SurfaceOutput结构体（在Unity内置文件 Lighting.cginc 中声明）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //当我们在编译指令中使用 Lambert 和 BlinnPhong 光照模型时，就需要使用该结构体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SurfaceOutput</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Albedo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//切线空间法线</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Emission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//自发光：一般Unity会在片元着色器最后输出前 在输出颜色上直接叠加自发光颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Specular</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//镜面反射指数，范围0~1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Gloss</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//镜面反射强度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        镜面相关的两个参数，如果使用了BlinnPhong光照模型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            会使用该公式计算高光反射强度：</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> spec</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> pow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(nh, s.Specular</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> s.Gloss;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Alpha</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//透明通道：如果开启了透明度的话，会用该值和颜色进行混合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">	//SurfaceOutputStandard结构体（在Unity内置文件 UnityPBSLighting.cginc 中声明）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //当我们在编译指令中使用 Standard 光照模型时，就需要使用该结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //我们一般称它为金属工作流输出结构体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SurfaceOutputStandard</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Albedo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//切线空间法线</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Emission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//自发光</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Metallic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//0表示非金属，1表示金属</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Smoothness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//0表示最粗糙，1表示最光滑</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Occlusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//环境光遮蔽，默认为1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Alpha</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//透明通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">	//SurfaceOutputStandardSpecular结构体（在Unity内置文件 UnityPBSLighting.cginc 中声明）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //当我们在编译指令中使用 StandardSpecular 光照模型时，就需要使用该结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">    //我们一般称它为高光工作流输出结构体</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SurfaceOutputStandardSpecular</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Albedo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//漫反射</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Normal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//切线空间法线</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Emission</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//自发光</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Smoothness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//0表示最粗糙，1表示最光滑</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        half</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Occlusion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//环境光遮蔽，默认为1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Alpha</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//透明通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span></code></pre><button class="code-block-unfold-btn"></button></div><blockquote><p>表面着色器的渲染流程</p></blockquote><p>编译指令、结构体、自定义函数（编译指令中的表面函数、光照模型、顶点函数、最终颜色修改函数） 我们只需要了解他们的具体作用便可以知道如何编写表面着色器</p><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/表面着色器/输出结构体.png" loading="lazy"></div><h3 id="五、实现法线贴图" tabindex="-1">五、实现法线贴图 <a class="header-anchor" href="#五、实现法线贴图" aria-label="Permalink to &quot;五、实现法线贴图&quot;">​</a></h3><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Custom/Lesson139"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Albedo (RGB)"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //_Emission("Emission", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Metallic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Metallic"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Smoothness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Smoothness"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        // Physically based Standard lighting model, and enable shadows on all light types</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma surface surf Standard fullforwardshadows</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        // Use shader model 3.0 target, to get nicer looking lighting</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma target 3.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //fixed4 _Emission;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Metallic;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Smoothness;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        struct Input</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv_MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv_BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> surf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SurfaceOutputStandard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, IN.uv_MainTex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //透明通道相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Alpha </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.a;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到切线空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Normal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, IN.uv_BumpMap));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //o.Emission = _Emission.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Metallic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Metallic;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Smoothness </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Smoothness;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="六、顶点膨胀" tabindex="-1">六、顶点膨胀 <a class="header-anchor" href="#六、顶点膨胀" aria-label="Permalink to &quot;六、顶点膨胀&quot;">​</a></h3><blockquote><p>表面着色器中如何处理顶点</p></blockquote><p>在编译指令中 <strong>#pragma surface 表面函数名 光照模型 可选额外参数</strong> 可选额外参数中添加 <strong>vertex:自定义函数名</strong> 函数格式： <strong>void 自定义函数名(inout appdata_full v)</strong></p><blockquote><p>实现顶点膨胀效果</p></blockquote><ol><li>加入顶点碰撞控制参数</li><li>在编译指令中加入顶点处理函数</li><li>自定义顶点处理函数</li><li>在该函数中对顶点进行偏移</li></ol><div class="language-C#"><button title="Copy code" class="copy"></button><span class="lang">C#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//可选额外参数中添加</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">finalcolor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:自定义函数名</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//函数格式：</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> 自定义函数名</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, SurfaceOutput... o, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color)</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Custom/Lesson139"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Albedo (RGB)"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "white"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"BumpMap"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> ""</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //_Emission("Emission", Color) = (1,1,1,1)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Metallic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Metallic"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Smoothness</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Smoothness"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Expansion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Expansion"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Opaque"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        // Physically based Standard lighting model, and enable shadows on all light types</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma surface surf Standard fullforwardshadows vertex:vertexFunc finalcolor:colorFunc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        // Use shader model 3.0 target, to get nicer looking lighting</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma target 3.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        sampler2D</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //fixed4 _Emission;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Metallic;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Smoothness;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //顶点往外扩张多少</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Expansion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        struct Input</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv_MainTex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float2</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> uv_BumpMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> surf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SurfaceOutputStandard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> texColor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_MainTex, IN.uv_MainTex);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //透明通道相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Alpha </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> texColor.a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.a;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //得到切线空间下的法线</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Normal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> UnpackNormal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">tex2D</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_BumpMap, IN.uv_BumpMap));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //o.Emission = _Emission.rgb;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Metallic </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Metallic;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Smoothness </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Smoothness;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> vertexFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> appdata_full</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //修改顶点坐标 往外扩充</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            v.vertex.xyz </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> v.normal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Expansion;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> colorFunc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">SurfaceOutputStandard</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> o</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> fixed4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> color)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            color </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><h3 id="七、动态液体" tabindex="-1">七、动态液体 <a class="header-anchor" href="#七、动态液体" aria-label="Permalink to &quot;七、动态液体&quot;">​</a></h3><p>在游戏开发中，动态液体效果就是</p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用Shader模拟出透明容器装透明液体的效果<!--]--></span><!--]--><p>这种效果常用与游戏和动画中，比如用于制作玻璃瓶装液体的效果</p><h4 id="_1-基本原理-11" tabindex="-1">1. 基本原理 <a class="header-anchor" href="#_1-基本原理-11" aria-label="Permalink to &quot;1. 基本原理&quot;">​</a></h4><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->动态液体效果是通过透明渲染、像素剔除、波纹效果模拟来实现的<!--]--></span><!--]--><ol><li><strong>如何被容器装载</strong></li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->用两个模型，一个容器模型，一个液体模型，液体模型其实和容器模型一模一样<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只是稍小一些，让两个模型使用不同的材质。容器使用透明材质，液体使用动态液体材质即可<!--]--></span><!--]--><ol start="2"><li><strong>如何透明渲染</strong></li></ol><p><strong>在表面着色器中实现透明渲染，和顶点/片元着色器的透明度混合基本一致</strong></p><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->只需要通过设置渲染类型、队列、混合模式、关闭深度写入即可<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/表面着色器/动态液体.png" loading="lazy"></div><ol start="3"><li>如何剔除像素</li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们将模型空间中心点作为参考点，将其转换到世界空间下，再用模型当前世界空间下的点和它进行 减法运算。如果判断点在参考点上方的我们便对其进行剔除 这时我们可以加入自定义变量控制液面高度<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/表面着色器/动态液体2.png" loading="lazy"></div><ol start="4"><li><strong>如何模拟波纹效果</strong></li></ol><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->我们可以利用之前学习的流动的河流的相关公式来计算波纹效果<!--]--></span><!--]--><!--[--><!--
    ColorText
    Usage in Markdown (Valaxy/VitePress):
      <ColorText color="red">你的文本</ColorText>
    or with a tag:
      <ColorText tag="p" color="#0f0">段落文本</ColorText>
  --><span class style="color:red" data-v-59b6df29><!--[-->某轴位置偏移量 = sin( _Time.y * 波动频率 + 顶点某轴坐标 * 波长的倒数) * 波动幅度<!--]--></span><!--]--><div class="v-a-face" style><img class="v-a-face-img" src="/img/face/shader/表面着色器/动态液体3.png" loading="lazy"></div><h4 id="_2-具体实现-8" tabindex="-1">2.具体实现 <a class="header-anchor" href="#_2-具体实现-8" aria-label="Permalink to &quot;2.具体实现&quot;">​</a></h4><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//1.新建表面着色器 DynamicLiquid(动态液体)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//2.删除不必要的代码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//3.声明属性以及属性映射</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  液体颜色 _Color</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  高光颜色和光滑度(rgb做颜色 a做光滑度) _Specular</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  液体高度 _Height</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  波纹变化速度 _Speed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  波动幅度 _WavaAmplitude</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  波动频率 _WavaFrequency</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  波长的倒数 _InvWaveLength</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//4.透明混合相关设置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  RenderType和Queue为Transparent</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  Blend DstColor SrcColor</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  Zwrite Off</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//5.编译指令设置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  光照模型我们使用StandardSpecular 并且不要阴影 noshadow</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//6.输入结构体</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  只需要当前像素的世界坐标位置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//7.实现表面函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-1:模型中心点转世界坐标</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-2:计算中心点和像素点y轴坐标差</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-3:像素剔除</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-4:波纹效果偏移计算</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//  7-5:漫反射颜色、高光颜色、光滑度设置</span></span></code></pre><button class="code-block-unfold-btn"></button></div><div class="language-c#"><button title="Copy code" class="copy"></button><span class="lang">c#</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code v-pre><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Shader </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Custom/DynamicLiquid"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    Properties</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //液体颜色</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Color"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //高光颜色和光滑度参数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Specular</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Specular"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Color) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //液体的高度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Height"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //波纹变化速度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _Speed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Speed"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //波动幅度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _WaveAmplitude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"WaveAmplitude"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //波动频率</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _WaveFrequency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"WaveFrequency"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //波长的倒数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        _InvWaveLength</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"InvWaveLength"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, Float) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    SubShader</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        //透明混合相关</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Tags { </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"RenderType"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> "Queue"</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Transparent"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        Blend DstColor SrcColor</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ZWrite Off</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        CGPROGRAM</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        // Physically based Standard lighting model, and enable shadows on all light types</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma surface surf StandardSpecular noshadow</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">        // Use shader model 3.0 target, to get nicer looking lighting</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        #pragma target 3.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Color</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        fixed4</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Specular</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _Speed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _WaveAmplitude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _WaveFrequency</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> _InvWaveLength</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        struct Input</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //世界空间下的像素点的位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> worldPos</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        };</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> surf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">Input</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> IN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">inout</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> SurfaceOutputStandardSpecular</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> o)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //将模型空间下中心点转换到世界空间下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            float3</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> centerPoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(unity_ObjectToWorld, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">float4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //当前像素点和中心点的高度差</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> liquidHeight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> centerPoint.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> IN.worldPos.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Height</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.01</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //波纹偏移计算</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            float</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> waveOffset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(_Time.y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WaveFrequency </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> IN.worldPos.x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _InvWaveLength) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _WaveAmplitude;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            liquidHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> waveOffset;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //如果liquidHeight &gt;= 0 则返回1 如果小于0 则返回0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //如果是0 就希望被剔除 否则不剔除</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            liquidHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> step</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, liquidHeight);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //如果liquidHeight是0 - 0.001 肯定小于0 就会被剔除 不会被渲染</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">            clip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(liquidHeight </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //漫反射颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Albedo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Color.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //高光颜色</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Specular </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Specular.rgb;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">            //光滑度设置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">            o.Smoothness </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> _Specular.a;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        ENDCG</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    FallBack </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">"Diffuse"</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><button class="code-block-unfold-btn"></button></div><!--]--><!--]--><!----><!----></article><!-- </Transition> --><!--]--><!--[--><!--[--><!--[--><div class="yun-sponsor-container flex-center flex-col" m="t-6"><button class="sponsor-button yun-icon-btn shadow hover:shadow-md" title="我很可爱，请给我钱！" text="red-400"><div class="mt-2px" i-ri-heart-fill></div></button><div m="y-4" class="qrcode-container qrcode flex-center flex-col"><div class="sponsor-description" mb="4" text="sm">这是关于赞助的一些描述</div><div class="flex justify-around"><!--[--><a class="flex-center flex-col animate-iteration-1 animate-fade-in" href target="_blank" style="color:#00a3ee"><img class="sponsor-method-img" border="~ rounded" p="1" loading="lazy" src title="支付宝"><div text="xl" m="2" class="i-ri-alipay-line"></div></a><a class="flex-center flex-col animate-iteration-1 animate-fade-in" href target="_blank" style="color:#2dc100"><img class="sponsor-method-img" border="~ rounded" p="1" loading="lazy" src title="微信支付"><div text="xl" m="2" class="i-ri-wechat-pay-line"></div></a><!--]--></div></div></div><ul class="post-copyright" m="y-4"><li class="post-copyright-author"><strong>本文作者：</strong><span>Hokit</span></li><li class="post-copyright-link"><strong>本文链接：</strong><a href="hokitan.xyz/posts/Shader" target="_blank" title="本文链接">hokitan.xyz/posts/Shader</a></li><li class="post-copyright-license"><strong>版权声明：</strong><span>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 ">CC BY-NC-SA</a> 许可协议。</span></li></ul><!--]--><!--]--><!--]--></div><!--]--><!----></div><!--[--><!--]--><!--[--><div class="post-nav"><div class="post-nav-item"><!----></div><div class="post-nav-item"><a href="/posts/Git&amp;&amp;CMD" class="post-nav-next" title="命令行指令和git学习"><span class="title truncate" text="sm">命令行指令和git学习</span><div class="icon" i-ri-arrow-right-s-line></div></a></div></div><!--]--><!--[--><!--]--><!--[--><div class="yun-card flex-center rounded-2 comment yun-comment sm:p-6 lg:px-12 xl:px-16" flex="col" min-h="100px" bg="$va-c-bg-light" w="full" p="4"><!----><!----><!--[--><!----><!--]--><!----></div><!--]--><!--[--><!-- eslint-disable-next-line vue/no-lone-template empty --><template class="mt-4"></template><!--]--><!--[--><!--]--><!--[--><!--]--></div><!--]--></main><!--[--><button class="xl:hidden toc-btn shadow-md fixed yun-icon-btn z-20 bg-$va-c-bg-soft" opacity="75" right="4" bottom="19"><div i-ri-file-list-line></div></button><!----><aside flex="~ col" class="va-card yun-aside sticky top-0 lg:top-$yun-margin-top min-h-sm" text="center" overflow="auto"><div style="display:none" class="w-full" flex="~ col" pb-2><!--[--><h2 m="t-6 b-2" font="serif black">文章目录</h2><div style="display:none" data-v-91805d19><div class="content" data-v-91805d19><div class="outline-title" data-v-91805d19>本页</div><div class="outline-marker" data-v-91805d19></div><nav aria-labelledby="doc-outline-aria-label" data-v-91805d19><span id="doc-outline-aria-label" class="visually-hidden" data-v-91805d19>Table of Contents for current page</span><ul class="root va-toc relative z-1 css-i18n-toc" data-v-91805d19 data-v-2b472779><!--[--><!--]--></ul></nav></div></div><!--]--><div class="flex-grow"></div><!----></div></aside><!--]--><!--]--></div><footer flex="~ col" class="relative yun-footer va-footer px-4 py-4 pt-0 text-$va-c-text-light w-full mt-14" bg="white dark:$va-c-bg-soft" text="center sm"><div class="yun-cloud absolute top--10 left-0 right-0"><svg class="waves" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" fill="var(--yun-c-cloud)"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><!----><div class="copyright flex justify-center items-center gap-2" p="1"><span>©<!--[--> 2023 -<!--]--> 2025</span><a class="animate-pulse inline-flex" href="https://www.yunyoujun.cn/sponsors/" target="_blank" title="Sponsor YunYouJun"><div class="i-ri-cloud-line"></div></a><span>Hokit</span></div><div class="powered" m="2"><span>由 <a href="git+https://github.com/YunYouJun/valaxy.git" target="_blank" rel="noopener">Valaxy</a> <span class="op-60">v0.26.6</span> 驱动</span><span mx-1>|</span><span><span>主题</span><span mx-1>-</span><a href="git+https://github.com/YunYouJun/valaxy/tree/main/packages/valaxy-theme-yun.git" title="valaxy-theme-yun" target="_blank">Yun</a><span class="ml-1 op-60">v0.26.5</span></span></div><!--[--><!--]--><div class="yun-footer-gradient" style="--gradient-from:161 196 253;--gradient-to:194 233 251"></div></footer><!--]--><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{"yun-app":{},"app":{"showLoading":true},"site":{},"routerStore":{}}}'</script><script type="application/ld+json" data-hid="schema-org-graph">{"@context":"https://schema.org","@graph":[{"@id":"hokitan.xyz/#identity","@type":"Person","name":"Hokit","url":"hokitan.xyz/","image":{"@id":"hokitan.xyz/#/schema/image/23592f2"},"sameAs":["/atom.xml","https://github.com/","https://music.163.com/","https://www.bilibili.com/","mailto:895384611@qq.com"]},{"@id":"hokitan.xyz/#website","@type":"WebSite","dateModified":"2025-09-22T17:23:13.699Z","datePublished":"2025-03-01","inLanguage":"en","name":"shader入门学习","url":"hokitan.xyz/","publisher":{"@id":"hokitan.xyz/#identity"}},{"@id":"hokitan.xyz/#webpage","@type":"WebPage","dateModified":"2025-09-22T17:23:13.699Z","datePublished":"2025-03-01T00:00:00.000Z","description":"世界上只有一种英雄主义，就是在认清生活真相之后依然热爱生活。","name":"shader入门学习","url":"hokitan.xyz/","about":{"@id":"hokitan.xyz/#identity"},"isPartOf":{"@id":"hokitan.xyz/#website"},"potentialAction":[{"@type":"ReadAction","target":["hokitan.xyz/"]}]},{"@id":"hokitan.xyz/#article","dateModified":"2025-09-22T17:23:13.699Z","datePublished":"2025-03-01T00:00:00.000Z","description":"世界上只有一种英雄主义，就是在认清生活真相之后依然热爱生活。","headline":"shader入门学习","inLanguage":"en","thumbnailUrl":"https://img.alicdn.com/imgextra/i2/3343836081/O1CN01WEkPZv1un9ZHW0TBS_!!3343836081.jpg","@type":["Article","BlogPosting"],"author":{"@id":"hokitan.xyz/#/schema/person/e489ec7"},"image":{"@id":"hokitan.xyz/#/schema/image/7d1e9c4"},"isPartOf":{"@id":"hokitan.xyz/#webpage"},"mainEntityOfPage":{"@id":"hokitan.xyz/#webpage"},"publisher":{"@id":"hokitan.xyz/#identity"}},{"@id":"hokitan.xyz/#/schema/person/e489ec7","@type":"Person","name":"Hokit","url":"https://valaxy.site"},{"@id":"hokitan.xyz/#/schema/image/23592f2","@type":"ImageObject","contentUrl":"https://img.alicdn.com/imgextra/i2/3343836081/O1CN01DK4pig1un9Z4a4h1m_!!3343836081.png","inLanguage":"en","url":"https://img.alicdn.com/imgextra/i2/3343836081/O1CN01DK4pig1un9Z4a4h1m_!!3343836081.png"},{"@id":"hokitan.xyz/#/schema/image/7d1e9c4","@type":"ImageObject","contentUrl":"https://img.alicdn.com/imgextra/i2/3343836081/O1CN01WEkPZv1un9ZHW0TBS_!!3343836081.jpg","inLanguage":"en","url":"https://img.alicdn.com/imgextra/i2/3343836081/O1CN01WEkPZv1un9ZHW0TBS_!!3343836081.jpg"}]}</script></body></html>